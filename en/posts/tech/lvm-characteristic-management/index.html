<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>lvm基本特性及日常管理 | lvbibir's Blog</title><meta name=keywords content="linux,lvm"><meta name=description content="LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理） PV物理卷 LV逻辑卷（逻辑卷管理：会在物理存储上生成抽象层，以便创建逻辑存储卷，方便设备命名）（下面是逻辑卷的分类） Linear 线性卷(这是默认的lvm形式，即按顺序占用磁盘，一块写完了再写另一块) Stripe 条带逻辑卷 RAID raid逻辑卷 Mirror 镜"><meta name=author content="作者:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/en/posts/tech/lvm-characteristic-management/><link crossorigin=anonymous href=/assets/css/stylesheet.ea2d3aa74caabd1c227305342e99c488a04870896b2f729dec906b90f7870787.css integrity="sha256-6i06p0yqvRwicwU0LpnEiKBIcIlrL3Kd7JBrkPeHB4c=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=16x16 href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=32x32 href=https://www.lvbibir.cn/img/avatar.gif><link rel=apple-touch-icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=mask-icon href=https://www.lvbibir.cn/img/avatar.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="lvm基本特性及日常管理"><meta property="og:description" content="LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理） PV物理卷 LV逻辑卷（逻辑卷管理：会在物理存储上生成抽象层，以便创建逻辑存储卷，方便设备命名）（下面是逻辑卷的分类） Linear 线性卷(这是默认的lvm形式，即按顺序占用磁盘，一块写完了再写另一块) Stripe 条带逻辑卷 RAID raid逻辑卷 Mirror 镜"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/en/posts/tech/lvm-characteristic-management/"><meta property="og:image" content="https://image.lvbibir.cn/blog/20190818145125498.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-01T00:00:00+00:00"><meta property="article:modified_time" content="2019-08-01T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://image.lvbibir.cn/blog/20190818145125498.png"><meta name=twitter:title content="lvm基本特性及日常管理"><meta name=twitter:description content="LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理） PV物理卷 LV逻辑卷（逻辑卷管理：会在物理存储上生成抽象层，以便创建逻辑存储卷，方便设备命名）（下面是逻辑卷的分类） Linear 线性卷(这是默认的lvm形式，即按顺序占用磁盘，一块写完了再写另一块) Stripe 条带逻辑卷 RAID raid逻辑卷 Mirror 镜"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":5,"name":"lvm基本特性及日常管理","item":"https://www.lvbibir.cn/en/posts/tech/lvm-characteristic-management/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"lvm基本特性及日常管理","name":"lvm基本特性及日常管理","description":"LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理） PV物理卷 LV逻辑卷（逻辑卷管理：会在物理存储上生成抽象层，以便创建逻辑存储卷，方便设备命名）（下面是逻辑卷的分类） Linear 线性卷(这是默认的lvm形式，即按顺序占用磁盘，一块写完了再写另一块) Stripe 条带逻辑卷 RAID raid逻辑卷 Mirror 镜","keywords":["linux","lvm"],"articleBody":"LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理） PV物理卷\nLV逻辑卷（逻辑卷管理：会在物理存储上生成抽象层，以便创建逻辑存储卷，方便设备命名）（下面是逻辑卷的分类） Linear\t线性卷(这是默认的lvm形式，即按顺序占用磁盘，一块写完了再写另一块) Stripe\t条带逻辑卷 RAID\traid逻辑卷 Mirror\t镜像卷 Thinly-Provision\t精简配置逻辑卷 Snapshot\t快照卷 Thinly-Provisioned Snapshot\t精简配置快照卷 Cache\t缓存卷\n创建PV时（一同被创建的有） 1：接近设备起始处，放置一个标签，包括uuid，元数据的位置　#(这个标签每个磁盘默认都保持一份) 2：lvm元数据，包含lvm卷组的配置详情 3：剩余空间，用于存储数据\nlvm逻辑卷概念 及　创建lvm的步骤 LVM的组成 PE：（物理拓展，是VG卷组的基本组成单位） PV：（物理卷） VG：（卷组） LV：（逻辑卷） 创建lvm的步骤 1：将磁盘创建为PV（物理卷），其实物理磁盘被条带化为PV，划成了一个一个的PE，默认每个PE大小是4MB 2：创建VG（卷组），其实它是一个空间池，不同PV加入同一VG 3：创建LV（逻辑卷），组成LV的PE可能来自不同的物理磁盘 4：格式化LV，挂载使用 lvm相关命令工具 pv操作命令 pvchange\t更改物理卷的属性 pvck\t检查物理卷元数据 pvcreate\t初始化磁盘或分区以供lvm使用 pvdisplay\t显示物理卷的属性 pvmove\t移动物理Exent pvremove\t删除物理卷 pvresize\t调整lvm2使用的磁盘或分区的大小 pvs\t报告有关物理卷的信息 pvscan\t扫描物理卷的所有磁盘 vg操作命令 vgcfgbackup\t备份卷组描述符区域 vgcfgrestore\t恢复卷组描述符区域 vgchange\t更改卷组的属性 vgck\t检查卷组元数据 vgconvert\t转换卷组元数据格式 vgcreate\t创建卷组 vgdisplay\t显示卷组的属性 vgexport\t使卷组对系统不了解（这是个什么） vgextend\t将物理卷添加到卷组 vgimportclone\t导入并重命名重复的卷组（例如硬件快照） vgmerge\t合并两个卷组 vgmknodes\t重新创建卷组目录和逻辑卷特殊文件 vgreduce\t通过删除一个或多个物理卷来减少卷组（将物理卷踢出VG） vgremove\t删除卷组 vgrename\t重命名卷组 vgs\t报告有关卷组信息 vgscan\t扫描卷组的所有磁盘并重建高速缓存 vgsplit\t将卷组拆分为两个，通过移动整个物理卷将任何逻辑卷从一个卷组移动到另一个卷组 lv操作命令 lvchange\t更改逻辑卷属性 lvconvert\t将逻辑卷从线性转换为镜像或快照 lvcreate\t将现有卷组中创建逻辑卷 lvdisplay\t显示逻辑卷的属性 lvextend\t扩展逻辑卷的大小 lvmconfig\t在加载lvm.conf和任何其他配置文件后显示配置信息 lvmdiskscan\t扫描lvm2可见的所有设备 lvmdump\t创建lvm2信息转储以用于诊断目的 lvreduce\t减少逻辑卷的大小 lvremove\t删除逻辑卷 lvrename\t重命名逻辑卷 lvresize\t调整逻辑卷大小 lvs\t报告有关逻辑卷的信息 lvscan\t扫描所有的逻辑卷 PV管理 制作PV pvcreate /dev/sdb1\n删除pv撤销PV（需先踢出vg） pvremove /dev/sdb1\nVG管理 制作VG vgcreate datavg /dev/sdb1 vgcreate datavg /dev/sdb1 /dev/sdb2 #解释：vgcreate vg名 分区\nvgcreate -s 16M datavg2 /dev/sdb3 #解释：-s 指定pe的大小为16M，默认不指定是4M\n从卷组中移除缺失的磁盘 vgreduce –removemissing datavg vgreduce –removemissing datavg –force\t#强制移除\n扩展VG空间 vgextend datavg /dev/sdb3 pvs\n踢出vg中的某个成员 vgreduce datavg /dev/sdb3 vgs\nLV管理 制作LV lvcreate -n lvdata1 -L 1.5G datavg #解释：-n lv的name，-L 指定lv的大小，datavg 是vg的名字，表示从那个vg\n激活修复后的逻辑卷 lvchange -ay /dev/datavg/lvdata1 lvchange -ay /dev/datavg/lvdata1 -K\t#强制激活\nLVM的快照 用途：注意用途是数据一致性备份，先做一个快照，冻结当前系统，这样快照里面的内容可暂时保持不变，系统本身继续运行，通过重新挂载备份快照卷，实现不中断服务备份。\nlvcreate -s -n kuaizhao01 -L 100M /dev/datavg/lvdata1\n查看，删除使用方法 1：查看物理卷信息 pvs,pvdisplay\n2：查看卷组信息 vgs,vgdisplay\n3：查看逻辑卷信息 lvs,lvdisplay\n4：删除LV lvremove /dev/mapper/VG-mylv\n5：删除VG vgremove VG\n6：删除PV（注意删除顺序是LV，VG，PV） pvremove /dev/sdb\nvg卷组改名 vgrename xxxx-vgid-xxxx-xxxx xinname 细述LVM基本特性及日常管理细述LVM基本特性及日常管理\n拉伸一个逻辑卷LV 1:用vgdisplay查看vg还有多少空余空间 2:扩充逻辑卷 lvextend -L +1G /dev/VG/LV01 lvextend -L +1G /dev/VG/LV01 -r #这个命令表示在扩展的同时也更新文件系统，但是不是所有的发行版本都支持，部分文件系统不支持在线扩展的除外 3:进行扩充操作后，df -h你会发现大小并没有变 4:更新文件系统（争对不同的文件系统，其更新的命令也不一样） e2fsck -f /dev/datavg/lvdata1\t#ext4文件系统，检查lv的文件系统 resize2fs /dev/VG/LV01\t#ext4文件系统命令，该命令后面接lv的设备名就行\nxfs_growfs /nas\t#xfs文件系统，该命令后面直接跟的是挂载点 当更新文件系统后，你就会发现，df -h正常了\n缩小逻辑卷LV（必须离线，umount） 1：卸载\n2：缩小文件系统 resize2fs /dev/VG/LV01 2G\n3：缩小LV lvreduce -L -1G /dev/VG/LV01\n4：查看lvs，挂载使用\n拉伸一个卷组VG 1:新插入一块硬盘，若不是热插拔的磁盘，可以试试这个在系统上强制刷新硬盘接口 for i in /sys/class/scsi_host/*; do echo “- - -” \u003e $i/scan; done\n2:将/dev/sdd条带化，格式化为PE pvcreate /dev/sdd\n3:将一块新的PV加入到现有的VG中 vgextend VG /dev/sdd\n4:查看大小 vgs\n缩小卷组VG（注意不要有PE在占用） 1：将一个PV从指定卷中移除 vgreduce VG /dev/sdd\n2：查看缩小后的卷组大小\n将磁盘加入和踢出VG 将sdd1踢出datavg组里 vgreduce datavg /dev/sdd1\n将sdb1加入datavg组里 vgextend datavg /dev/sdb1\nlvm灾难恢复场景案例 场景再现： 三块盘做lvm,现在有一块物理坏了，将剩下两块放到其他linux服务器上\n恢复步骤 第一，查看磁盘信息，lvm信息，确认能查到lvm相关信息，找到VG组的名字（pvs,lvs,vgs,fidsk,blkid） 第二：删除lvm信息中损坏的磁盘角色，（强制提出故障磁盘）“vgreduce –removemissing VG_name \" 第三：强制激活VG组 “vgchange -ay” 第四：强制激活LVM “lvchange -ay /dev/VG_name” 第五：挂载\n","wordCount":"2117","inLanguage":"en","image":"https://image.lvbibir.cn/blog/20190818145125498.png","datePublished":"2019-08-01T00:00:00Z","dateModified":"2019-08-01T00:00:00Z","author":{"@type":"Person","name":"lvbibir"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/en/posts/tech/lvm-characteristic-management/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://www.lvbibir.cn/img/avatar.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn/en/ accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://www.lvbibir.cn/img/avatar.gif alt aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li class=menu-item><a href=https://www.lvbibir.cn/en/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/en/posts title="📚 文章"><span>📚 文章</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/en/archives title="📈 归档"><span>📈 归档</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/en/talk title="💬 说说"><span>💬 说说</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/en/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn/en/>主页</a></div><h1 class=post-title>lvm基本特性及日常管理</h1><div class=post-meta>创建:&nbsp;<span title='2019-08-01 00:00:00 +0000 UTC'>2019-08-01</span>&nbsp;|&nbsp;更新:&nbsp;2019-08-01&nbsp;|&nbsp;字数:&nbsp;2117字&nbsp;|&nbsp;作者:&nbsp;lvbibir
|&nbsp;标签:&nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/en/tags/linux/>linux</a></ul><span id=busuanzi_container_page_pv>&nbsp;|&nbsp;访问:&nbsp;<span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>文章目录</span></summary><div class=inner><ul><li><a href=#lvm%e5%9f%ba%e6%9c%ac%e7%89%b9%e6%80%a7%e5%8f%af%e4%bb%a5%e9%80%9a%e8%bf%87%e6%8f%92%e4%bb%b6clvm%e5%ae%9e%e7%8e%b0%e7%be%a4%e9%9b%86%e9%80%bb%e8%be%91%e5%8d%b7%e7%ae%a1%e7%90%86 aria-label=LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理）>LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理）</a></li><li><a href=#lvm%e9%80%bb%e8%be%91%e5%8d%b7%e6%a6%82%e5%bf%b5-%e5%8f%8a%e5%88%9b%e5%bb%balvm%e7%9a%84%e6%ad%a5%e9%aa%a4 aria-label="lvm逻辑卷概念 及　创建lvm的步骤">lvm逻辑卷概念 及　创建lvm的步骤</a><ul><li><a href=#lvm%e7%9a%84%e7%bb%84%e6%88%90 aria-label=LVM的组成>LVM的组成</a></li><li><a href=#%e5%88%9b%e5%bb%balvm%e7%9a%84%e6%ad%a5%e9%aa%a4 aria-label=创建lvm的步骤>创建lvm的步骤</a></li></ul></li><li><a href=#lvm%e7%9b%b8%e5%85%b3%e5%91%bd%e4%bb%a4%e5%b7%a5%e5%85%b7 aria-label=lvm相关命令工具>lvm相关命令工具</a><ul><li><a href=#pv%e6%93%8d%e4%bd%9c%e5%91%bd%e4%bb%a4 aria-label=pv操作命令>pv操作命令</a></li><li><a href=#vg%e6%93%8d%e4%bd%9c%e5%91%bd%e4%bb%a4 aria-label=vg操作命令>vg操作命令</a></li><li><a href=#lv%e6%93%8d%e4%bd%9c%e5%91%bd%e4%bb%a4 aria-label=lv操作命令>lv操作命令</a></li></ul></li><li><a href=#pv%e7%ae%a1%e7%90%86 aria-label=PV管理>PV管理</a></li><li><a href=#vg%e7%ae%a1%e7%90%86 aria-label=VG管理>VG管理</a></li><li><a href=#lv%e7%ae%a1%e7%90%86 aria-label=LV管理>LV管理</a></li><li><a href=#lvm%e7%9a%84%e5%bf%ab%e7%85%a7 aria-label=LVM的快照>LVM的快照</a></li><li><a href=#%e6%9f%a5%e7%9c%8b%e5%88%a0%e9%99%a4%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95 aria-label=查看，删除使用方法>查看，删除使用方法</a></li><li><a href=#vg%e5%8d%b7%e7%bb%84%e6%94%b9%e5%90%8d aria-label=vg卷组改名>vg卷组改名</a></li><li><a href=#%e6%8b%89%e4%bc%b8%e4%b8%80%e4%b8%aa%e9%80%bb%e8%be%91%e5%8d%b7lv aria-label=拉伸一个逻辑卷LV>拉伸一个逻辑卷LV</a></li><li><a href=#%e7%bc%a9%e5%b0%8f%e9%80%bb%e8%be%91%e5%8d%b7lv%e5%bf%85%e9%a1%bb%e7%a6%bb%e7%ba%bfumount aria-label=缩小逻辑卷LV（必须离线，umount）>缩小逻辑卷LV（必须离线，umount）</a></li><li><a href=#%e6%8b%89%e4%bc%b8%e4%b8%80%e4%b8%aa%e5%8d%b7%e7%bb%84vg aria-label=拉伸一个卷组VG>拉伸一个卷组VG</a></li><li><a href=#%e7%bc%a9%e5%b0%8f%e5%8d%b7%e7%bb%84vg%e6%b3%a8%e6%84%8f%e4%b8%8d%e8%a6%81%e6%9c%89pe%e5%9c%a8%e5%8d%a0%e7%94%a8 aria-label=缩小卷组VG（注意不要有PE在占用）>缩小卷组VG（注意不要有PE在占用）</a></li><li><a href=#%e5%b0%86%e7%a3%81%e7%9b%98%e5%8a%a0%e5%85%a5%e5%92%8c%e8%b8%a2%e5%87%bavg aria-label=将磁盘加入和踢出VG>将磁盘加入和踢出VG</a></li><li><a href=#lvm%e7%81%be%e9%9a%be%e6%81%a2%e5%a4%8d%e5%9c%ba%e6%99%af%e6%a1%88%e4%be%8b aria-label=lvm灾难恢复场景案例>lvm灾难恢复场景案例</a><ul><li><a href=#%e5%9c%ba%e6%99%af%e5%86%8d%e7%8e%b0 aria-label=场景再现：>场景再现：</a></li><li><a href=#%e6%81%a2%e5%a4%8d%e6%ad%a5%e9%aa%a4 aria-label=恢复步骤>恢复步骤</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=lvm基本特性可以通过插件clvm实现群集逻辑卷管理>LVM基本特性：（可以通过插件CLVM，实现群集逻辑卷管理）<a hidden class=anchor aria-hidden=true href=#lvm基本特性可以通过插件clvm实现群集逻辑卷管理>#</a></h1><p>PV物理卷</p><p>LV逻辑卷（逻辑卷管理：会在物理存储上生成抽象层，以便创建逻辑存储卷，方便设备命名）（下面是逻辑卷的分类）
Linear 线性卷(这是默认的lvm形式，即按顺序占用磁盘，一块写完了再写另一块)
Stripe 条带逻辑卷
RAID raid逻辑卷
Mirror 镜像卷
Thinly-Provision 精简配置逻辑卷
Snapshot 快照卷
Thinly-Provisioned Snapshot 精简配置快照卷
Cache 缓存卷</p><p>创建PV时（一同被创建的有）
1：接近设备起始处，放置一个标签，包括uuid，元数据的位置　#(这个标签每个磁盘默认都保持一份)
2：lvm元数据，包含lvm卷组的配置详情
3：剩余空间，用于存储数据</p><h1 id=lvm逻辑卷概念-及创建lvm的步骤>lvm逻辑卷概念 及　创建lvm的步骤<a hidden class=anchor aria-hidden=true href=#lvm逻辑卷概念-及创建lvm的步骤>#</a></h1><h2 id=lvm的组成>LVM的组成<a hidden class=anchor aria-hidden=true href=#lvm的组成>#</a></h2><pre><code>PE：（物理拓展，是VG卷组的基本组成单位）
PV：（物理卷）
VG：（卷组）
LV：（逻辑卷）
</code></pre><h2 id=创建lvm的步骤>创建lvm的步骤<a hidden class=anchor aria-hidden=true href=#创建lvm的步骤>#</a></h2><pre><code>1：将磁盘创建为PV（物理卷），其实物理磁盘被条带化为PV，划成了一个一个的PE，默认每个PE大小是4MB
2：创建VG（卷组），其实它是一个空间池，不同PV加入同一VG
3：创建LV（逻辑卷），组成LV的PE可能来自不同的物理磁盘
4：格式化LV，挂载使用
</code></pre><h1 id=lvm相关命令工具>lvm相关命令工具<a hidden class=anchor aria-hidden=true href=#lvm相关命令工具>#</a></h1><h2 id=pv操作命令>pv操作命令<a hidden class=anchor aria-hidden=true href=#pv操作命令>#</a></h2><pre><code>pvchange	更改物理卷的属性
pvck		检查物理卷元数据
pvcreate	初始化磁盘或分区以供lvm使用
pvdisplay	显示物理卷的属性
pvmove		移动物理Exent
pvremove	删除物理卷
pvresize	调整lvm2使用的磁盘或分区的大小
pvs		报告有关物理卷的信息
pvscan		扫描物理卷的所有磁盘
</code></pre><h2 id=vg操作命令>vg操作命令<a hidden class=anchor aria-hidden=true href=#vg操作命令>#</a></h2><pre><code>vgcfgbackup	备份卷组描述符区域
vgcfgrestore	恢复卷组描述符区域
vgchange	更改卷组的属性
vgck		检查卷组元数据
vgconvert	转换卷组元数据格式
vgcreate	创建卷组
vgdisplay	显示卷组的属性
vgexport	使卷组对系统不了解（这是个什么）
vgextend	将物理卷添加到卷组
vgimportclone	导入并重命名重复的卷组（例如硬件快照）
vgmerge		合并两个卷组
vgmknodes	重新创建卷组目录和逻辑卷特殊文件
vgreduce	通过删除一个或多个物理卷来减少卷组（将物理卷踢出VG）
vgremove	删除卷组
vgrename	重命名卷组
vgs		报告有关卷组信息
vgscan		扫描卷组的所有磁盘并重建高速缓存
vgsplit		将卷组拆分为两个，通过移动整个物理卷将任何逻辑卷从一个卷组移动到另一个卷组
</code></pre><h2 id=lv操作命令>lv操作命令<a hidden class=anchor aria-hidden=true href=#lv操作命令>#</a></h2><pre><code>lvchange	更改逻辑卷属性
lvconvert	将逻辑卷从线性转换为镜像或快照
lvcreate	将现有卷组中创建逻辑卷
lvdisplay	显示逻辑卷的属性
lvextend	扩展逻辑卷的大小
lvmconfig	在加载lvm.conf和任何其他配置文件后显示配置信息
lvmdiskscan	扫描lvm2可见的所有设备
lvmdump		创建lvm2信息转储以用于诊断目的
lvreduce	减少逻辑卷的大小
lvremove	删除逻辑卷
lvrename	重命名逻辑卷
lvresize	调整逻辑卷大小
lvs		报告有关逻辑卷的信息
lvscan		扫描所有的逻辑卷
</code></pre><h1 id=pv管理>PV管理<a hidden class=anchor aria-hidden=true href=#pv管理>#</a></h1><p>制作PV
pvcreate /dev/sdb1</p><p>删除pv撤销PV（需先踢出vg）
pvremove /dev/sdb1</p><h1 id=vg管理>VG管理<a hidden class=anchor aria-hidden=true href=#vg管理>#</a></h1><p>制作VG
vgcreate datavg /dev/sdb1
vgcreate datavg /dev/sdb1 /dev/sdb2
#解释：vgcreate vg名 分区</p><p>vgcreate -s 16M datavg2 /dev/sdb3
#解释：-s 指定pe的大小为16M，默认不指定是4M</p><p>从卷组中移除缺失的磁盘
vgreduce &ndash;removemissing datavg
vgreduce &ndash;removemissing datavg &ndash;force #强制移除</p><p>扩展VG空间
vgextend datavg /dev/sdb3
pvs</p><p>踢出vg中的某个成员
vgreduce datavg /dev/sdb3
vgs</p><h1 id=lv管理>LV管理<a hidden class=anchor aria-hidden=true href=#lv管理>#</a></h1><p>制作LV
lvcreate -n lvdata1 -L 1.5G datavg
#解释：-n lv的name，-L 指定lv的大小，datavg 是vg的名字，表示从那个vg</p><p>激活修复后的逻辑卷
lvchange -ay /dev/datavg/lvdata1
lvchange -ay /dev/datavg/lvdata1 -K #强制激活</p><h1 id=lvm的快照>LVM的快照<a hidden class=anchor aria-hidden=true href=#lvm的快照>#</a></h1><p>用途：注意用途是数据一致性备份，先做一个快照，冻结当前系统，这样快照里面的内容可暂时保持不变，系统本身继续运行，通过重新挂载备份快照卷，实现不中断服务备份。</p><p>lvcreate -s -n kuaizhao01 -L 100M /dev/datavg/lvdata1</p><h1 id=查看删除使用方法>查看，删除使用方法<a hidden class=anchor aria-hidden=true href=#查看删除使用方法>#</a></h1><p>1：查看物理卷信息
pvs,pvdisplay</p><p>2：查看卷组信息
vgs,vgdisplay</p><p>3：查看逻辑卷信息
lvs,lvdisplay</p><p>4：删除LV
lvremove /dev/mapper/VG-mylv</p><p>5：删除VG
vgremove VG</p><p>6：删除PV（注意删除顺序是LV，VG，PV）
pvremove /dev/sdb</p><h1 id=vg卷组改名>vg卷组改名<a hidden class=anchor aria-hidden=true href=#vg卷组改名>#</a></h1><p>vgrename xxxx-vgid-xxxx-xxxx xinname
<img loading=lazy src=https://image.lvbibir.cn/blog/20190818145354774.png alt=在这里插入图片描述>
细述LVM基本特性及日常管理细述LVM基本特性及日常管理</p><h1 id=拉伸一个逻辑卷lv>拉伸一个逻辑卷LV<a hidden class=anchor aria-hidden=true href=#拉伸一个逻辑卷lv>#</a></h1><p>1:用vgdisplay查看vg还有多少空余空间
2:扩充逻辑卷
lvextend -L +1G /dev/VG/LV01
lvextend -L +1G /dev/VG/LV01 -r #这个命令表示在扩展的同时也更新文件系统，但是不是所有的发行版本都支持，部分文件系统不支持在线扩展的除外
3:进行扩充操作后，df -h你会发现大小并没有变
4:更新文件系统（争对不同的文件系统，其更新的命令也不一样）
e2fsck -f /dev/datavg/lvdata1 #ext4文件系统，检查lv的文件系统
resize2fs /dev/VG/LV01 #ext4文件系统命令，该命令后面接lv的设备名就行</p><p>xfs_growfs /nas #xfs文件系统，该命令后面直接跟的是挂载点
当更新文件系统后，你就会发现，df -h正常了</p><h1 id=缩小逻辑卷lv必须离线umount>缩小逻辑卷LV（必须离线，umount）<a hidden class=anchor aria-hidden=true href=#缩小逻辑卷lv必须离线umount>#</a></h1><p>1：卸载</p><p>2：缩小文件系统
resize2fs /dev/VG/LV01 2G</p><p>3：缩小LV
lvreduce -L -1G /dev/VG/LV01</p><p>4：查看lvs，挂载使用</p><h1 id=拉伸一个卷组vg>拉伸一个卷组VG<a hidden class=anchor aria-hidden=true href=#拉伸一个卷组vg>#</a></h1><p>1:新插入一块硬盘，若不是热插拔的磁盘，可以试试这个在系统上强制刷新硬盘接口
for i in /sys/class/scsi_host/*; do echo &ldquo;- - -&rdquo; > $i/scan; done</p><p>2:将/dev/sdd条带化，格式化为PE
pvcreate /dev/sdd</p><p>3:将一块新的PV加入到现有的VG中
vgextend VG /dev/sdd</p><p>4:查看大小
vgs</p><h1 id=缩小卷组vg注意不要有pe在占用>缩小卷组VG（注意不要有PE在占用）<a hidden class=anchor aria-hidden=true href=#缩小卷组vg注意不要有pe在占用>#</a></h1><p>1：将一个PV从指定卷中移除
vgreduce VG /dev/sdd</p><p>2：查看缩小后的卷组大小</p><h1 id=将磁盘加入和踢出vg>将磁盘加入和踢出VG<a hidden class=anchor aria-hidden=true href=#将磁盘加入和踢出vg>#</a></h1><p>将sdd1踢出datavg组里
vgreduce datavg /dev/sdd1</p><p>将sdb1加入datavg组里
vgextend datavg /dev/sdb1</p><h1 id=lvm灾难恢复场景案例>lvm灾难恢复场景案例<a hidden class=anchor aria-hidden=true href=#lvm灾难恢复场景案例>#</a></h1><h2 id=场景再现>场景再现：<a hidden class=anchor aria-hidden=true href=#场景再现>#</a></h2><p>三块盘做lvm,现在有一块物理坏了，将剩下两块放到其他linux服务器上</p><h2 id=恢复步骤>恢复步骤<a hidden class=anchor aria-hidden=true href=#恢复步骤>#</a></h2><p>第一，查看磁盘信息，lvm信息，确认能查到lvm相关信息，找到VG组的名字（pvs,lvs,vgs,fidsk,blkid）
第二：删除lvm信息中损坏的磁盘角色，（强制提出故障磁盘）&ldquo;vgreduce &ndash;removemissing VG_name "
第三：强制激活VG组 &ldquo;vgchange -ay&rdquo;
第四：强制激活LVM &ldquo;lvchange -ay /dev/VG_name&rdquo;
第五：挂载</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://www.lvbibir.cn/img/wechat_pay.png alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://www.lvbibir.cn/img/alipay.png alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>🧧 鼓励</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/en/posts/tech/docker-network/><span class=title>« 上一页</span><br><span>docker | 网络简介</span></a>
<a class=next href=https://www.lvbibir.cn/en/posts/tech/shell-get-server-hardware-information/><span class=title>下一页 »</span><br><span>shell | 获取服务器硬件信息（整合为json格式）</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>💬评论</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.6.15/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo.lvbibir.cn/",el:"#tcomment",lang:"zh-CN",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><a href=https://gohugo.io/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/frame-hugo-blue.svg></a>
<a href=https://github.com/adityatelange/hugo-PaperMod target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/theme-papermod-lightgrey.svg></a>
<a href=https://cn.aliyun.com/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/图床-阿里云-orange.svg></a><br><span id=runtime_span></span>
<script type=text/javascript>function show_runtime(){window.setTimeout("show_runtime()",1e3),X=new Date("7/13/2021 1:00:00"),Y=new Date,T=Y.getTime()-X.getTime(),M=24*60*60*1e3,a=T/M,A=Math.floor(a),b=(a-A)*24,B=Math.floor(b),c=(b-B)*60,C=Math.floor((b-B)*60),D=Math.floor((c-C)*60),runtime_span.innerHTML="网站已运行"+A+"天"+B+"小时"+C+"分"+D+"秒"}show_runtime()</script>|
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container>总访客数: <span id=busuanzi_value_site_uv></span>
|
总访问量: <span id=busuanzi_value_site_pv></span></span><br><a href=https://beian.miit.gov.cn/ target=_blank style="border-bottom:1px solid">京ICP备2021023168号-1</a>&nbsp;
|
<span>Copyright
&copy;
2020-2023
<a href=https://www.lvbibir.cn/en/ style="border-bottom:1px solid">lvbibir's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="📄复制";function c(){t.innerText="👌🏻已复制!",setTimeout(()=>{t.innerText="📄复制"},2e3)}t.addEventListener("click",t=>{const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),c()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),i.setAttribute("class","mac bb1"),a.setAttribute("class","mac bb2"),r.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(i),n.appendChild(a),n.appendChild(r),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild===s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName==="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script><script src=https://code.jquery.com/jquery-1.12.4.min.js></script></body></html>