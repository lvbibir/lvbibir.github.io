<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>【置顶】Hello,hugo! | lvbibir's Blog</title><meta name=keywords content="hugo,papermod"><meta name=description content="记录wordpress迁移至hugo的过程，大多参考sulv大佬的博客，本文更偏向于个人备忘，并不是一篇很合格的教程"><meta name=author content="
作者:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/posts/blog/hello_hugo/><link crossorigin=anonymous href=/assets/css/stylesheet.935d168d22d0946048d262a1b7a92749dd2a7c750420ea0b06b57574fa9bfc83.css integrity="sha256-k10WjSLQlGBI0mKht6knSd0qfHUEIOoLBrV1dPqb/IM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.lvbibir.cn/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://www.lvbibir.cn/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://www.lvbibir.cn/img/Q.gif><link rel=apple-touch-icon href=https://www.lvbibir.cn/img/Q.gif><link rel=mask-icon href=https://www.lvbibir.cn/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="【置顶】Hello,hugo!"><meta property="og:description" content="记录wordpress迁移至hugo的过程，大多参考sulv大佬的博客，本文更偏向于个人备忘，并不是一篇很合格的教程"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/posts/blog/hello_hugo/"><meta property="og:image" content="https://image.lvbibir.cn/blog/hugo-logo-wide.svg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-06T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-08T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://image.lvbibir.cn/blog/hugo-logo-wide.svg"><meta name=twitter:title content="【置顶】Hello,hugo!"><meta name=twitter:description content="记录wordpress迁移至hugo的过程，大多参考sulv大佬的博客，本文更偏向于个人备忘，并不是一篇很合格的教程"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"📚文章","item":"https://www.lvbibir.cn/posts/"},{"@type":"ListItem","position":3,"name":"🧱 建站","item":"https://www.lvbibir.cn/posts/blog/"},{"@type":"ListItem","position":4,"name":"【置顶】Hello,hugo!","item":"https://www.lvbibir.cn/posts/blog/hello_hugo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"【置顶】Hello,hugo!","name":"【置顶】Hello,hugo!","description":"记录wordpress迁移至hugo的过程，大多参考sulv大佬的博客，本文更偏向于个人备忘，并不是一篇很合格的教程","keywords":["hugo","papermod"],"articleBody":"博客流水线 编辑文章 采用 typora + picgo + 七牛云图床流程，参考文章\n生成静态文件 hugo -F --cleanDestinationDir 后面两个参数表示会先删除之前生成的 public 目录，保证每次生成的 public 都是新的\n上传静态文件 rsync -avuz --progress --delete Desktop/lvbibir/2-lvbibir.github.io/public/ root@101.201.150.47:/root/wordpress-blog/hugo-public/ mobaxterm 是我一直以来的主力终端，它的本地终端自带了很多linux命令，用rsync命令上传静态文件至阿里服务器，且会先删除服务器上之前的静态文件，保证博客的内容保持最新\n归档备份 研究 hugo 建站之初是打算采用 github pages 来发布静态博客\n优点 仅需一个github账号和简单配置即可将静态博客发布到 github pages 没有维护的时间成本，可以将精力更多的放到博客内容本身上去 无需备案 无需ssl证书 缺点 访问速度较慢 访问速度较慢 访问速度较慢 虽说访问速度较慢可以通过各家的cdn加速来解决，但由于刚开始建立 blog 选择的是 wordpress ，域名、服务器、备案、证书等都已经一应俱全，且之前的架构采用 docker，添加一台 nginx 来跑 hugo 的静态网站是很方便的\n所以干脆沿用之前的 github仓库 ，来作为我博客的归档管理，也可以方便家里电脑和工作电脑之间的数据同步\n将hugo博客部署到阿里云 之前的wordpress博客部署在阿里云的一套 docker-compose 环境下，这篇文章有详细记录\n要做的仅仅是在之前的docker-compose.yml 中添加一个新的nginx环境用于跑hugo生成的静态文件，代理nginx中配置一下新nginx服务器，ssl证书依旧沿用之前的即可\n以下是一些配置文件示例\nwordpress-blog/docker-compose.yml 新增了hugo-nginx容器\nversion: '3.1' services: proxy: # 前端代理nginx image: superng6/nginx:debian-stable-1.18.0 container_name: nginx-proxy restart: always networks: wordpress_net: ipv4_address: 172.19.0.6 ports: - 80:80 - 443:443 volumes: - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro - $PWD/conf/proxy/nginx.conf:/etc/nginx/nginx.conf - $PWD/conf/proxy/default.conf:/etc/nginx/conf.d/default.conf - $PWD/ssl:/etc/nginx/ssl - $PWD/logs/proxy:/var/log/nginx depends_on: - web web: # wordpress的nginx image: superng6/nginx:debian-stable-1.18.0 container_name: wordpress-nginx restart: always networks: wordpress_net: ipv4_address: 172.19.0.5 volumes: - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro - $PWD/conf/nginx/nginx.conf:/etc/nginx/nginx.conf - $PWD/conf/nginx/default.conf:/etc/nginx/conf.d/default.conf - $PWD/conf/fastcgi.conf:/etc/nginx/fastcgi.conf - /dev/shm/nginx-cache:/var/run/nginx-cache # - $PWD/nginx-cache:/var/run/nginx-cache - $PWD/wordpress:/var/www/html - $PWD/logs/nginx:/var/log/nginx depends_on: - wordpress hugo: # hugo的nginx image: superng6/nginx:debian-stable-1.18.0 container_name: hugo-nginx restart: always networks: wordpress_net: ipv4_address: 172.19.0.7 volumes: - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro - $PWD/conf/hugo/nginx.conf:/etc/nginx/nginx.conf - /dev/shm/nginx-cache:/var/run/nginx-cache - $PWD/hugo-public:/var/www/html - $PWD/logs/hugo:/var/log/nginx wordpress: image: wordpress:5-fpm container_name: wordpress-php restart: always networks: wordpress_net: ipv4_address: 172.19.0.4 environment: WORDPRESS_DB_HOST: db WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: #密码填自己的 WORDPRESS_DB_NAME: wordpress volumes: - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro - $PWD/wordpress:/var/www/html - /dev/shm/nginx-cache:/var/run/nginx-cache # - $PWD/nginx-cache:/var/run/nginx-cache - $PWD/conf/uploads.ini:/usr/local/etc/php/php.ini depends_on: - redis - db redis: image: redis:5 container_name: wordpress-redis restart: always networks: wordpress_net: ipv4_address: 172.19.0.3 volumes: - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro - $PWD/redis-data:/data depends_on: - db db: image: mysql:5.7 container_name: wordpress-mysql restart: always networks: wordpress_net: ipv4_address: 172.19.0.2 environment: MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress MYSQL_RANDOM_ROOT_PASSWORD: '1' volumes: - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro - $PWD/mysql-data:/var/lib/mysql - $PWD/conf/mysqld.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf networks: wordpress_net: driver: bridge ipam: config: - subnet: 172.19.0.0/16 wordpress-blog/conf/proxy/default.conf 前端代理nginx的配置文件，原先只有 lvbibir.cn ，新增了 www.lvbibir.cn 相关配置\nserver { listen 80; listen [::]:80; server_name lvbibir.cn; return 301 https://$host$request_uri; } server { listen 443 ssl http2; listen [::]:443 ssl http2; server_name lvbibir.cn; location / { proxy_pass http://172.19.0.5:80; proxy_redirect off; # 保证获取到真实IP proxy_set_header X-Real-IP $remote_addr; # 真实端口号 proxy_set_header X-Real-Port $remote_port; # X-Forwarded-For 是一个 HTTP 扩展头部。 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 在多级代理的情况下，记录每次代理之前的客户端真实ip proxy_set_header HTTP_X_FORWARDED_FOR $remote_addr; # 获取到真实协议 proxy_set_header X-Forwarded-Proto $scheme; # 真实主机名 proxy_set_header Host $host; # 设置变量 proxy_set_header X-NginX-Proxy true; # 开启 brotli proxy_set_header Accept-Encoding \"br\"; } # 日志 access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; # 证书 ssl_certificate /etc/nginx/ssl/lvbibir.cn.pem; ssl_certificate_key /etc/nginx/ssl/lvbibir.cn.key; # curl https://ssl-config.mozilla.org/ffdhe2048.txt \u003e /path/to/dhparam # ssl_dhparam /etc/nginx/ssl/dhparam; # HSTS (ngx_http_headers_module is required) (63072000 seconds) add_header Strict-Transport-Security \"max-age=63072000\" always; # OCSP stapling ssl_stapling on; ssl_stapling_verify on; # verify chain of trust of OCSP response using Root CA and Intermediate certs # ssl_trusted_certificate /etc/nginx/ssl/all.sleele.com/fullchain.cer; # replace with the IP address of your resolver resolver 223.5.5.5; resolver_timeout 5s; } server { listen 80; listen [::]:80; server_name www.lvbibir.cn; return 301 https://$host$request_uri; } server { listen 443 ssl http2; listen [::]:443 ssl http2; server_name www.lvbibir.cn; location / { proxy_pass http://172.19.0.7:80; proxy_redirect off; # 保证获取到真实IP proxy_set_header X-Real-IP $remote_addr; # 真实端口号 proxy_set_header X-Real-Port $remote_port; # X-Forwarded-For 是一个 HTTP 扩展头部。 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 在多级代理的情况下，记录每次代理之前的客户端真实ip proxy_set_header HTTP_X_FORWARDED_FOR $remote_addr; # 获取到真实协议 proxy_set_header X-Forwarded-Proto $scheme; # 真实主机名 proxy_set_header Host $host; # 设置变量 proxy_set_header X-NginX-Proxy true; # 开启 brotli proxy_set_header Accept-Encoding \"br\"; } # 日志 access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; # 证书 ssl_certificate /etc/nginx/ssl/lvbibir.cn.pem; ssl_certificate_key /etc/nginx/ssl/lvbibir.cn.key; # curl https://ssl-config.mozilla.org/ffdhe2048.txt \u003e /path/to/dhparam # ssl_dhparam /etc/nginx/ssl/dhparam; # HSTS (ngx_http_headers_module is required) (63072000 seconds) add_header Strict-Transport-Security \"max-age=63072000\" always; # OCSP stapling ssl_stapling on; ssl_stapling_verify on; # verify chain of trust of OCSP response using Root CA and Intermediate certs # ssl_trusted_certificate /etc/nginx/ssl/all.sleele.com/fullchain.cer; # replace with the IP address of your resolver resolver 223.5.5.5; resolver_timeout 5s; } wordpress-blog/conf/hugo/nginx.conf user root; worker_processes auto; error_log /var/log/nginx/error.log; pid /run/nginx.pid; include /usr/share/nginx/modules/*.conf; events { worker_connections 1024; } http { log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; include /etc/nginx/mime.types; default_type application/octet-stream; include /etc/nginx/conf.d/*.conf; # 配置http server { listen 80 default_server; listen [::]:80 default_server; server_name www.lvbibir.cn; root /var/www/html; include /etc/nginx/default.d/*.conf; location / { root /var/www/html; index index.html index.htm; } error_page 404 /404.html; location = /40x.html { root /var/www/html; } error_page 500 502 503 504 /50x.html; location = /50x.html { } } } seo优化 https://www.sulvblog.cn/posts/blog/hugo_seo/\n添加twikoo评论组件 基本完全按照sulv博主的文章来操作，某些地方官方有更新，不过也只是更改了页面罢了\nhttps://www.sulvblog.cn/posts/blog/hugo_twikoo/\n顺便记录一下账号关系：mongodb使用google账号登录，vercel使用github登录\n修改博客url https://gohugo.io/content-management/urls/\ntodo 修改所有文章的文件名为全英文 百度seo优化 谷歌seo优化 必应seo优化 尝试再次优化nginx的配置，之前的配置对于wordpress可能更适用 图床备份 ","wordCount":"1546","inLanguage":"en","image":"https://image.lvbibir.cn/blog/hugo-logo-wide.svg","datePublished":"2022-07-06T00:00:00Z","dateModified":"2022-07-08T00:00:00Z","author":[{"@type":"Person","name":"lvbibir"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/posts/blog/hello_hugo/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://www.lvbibir.cn/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://www.lvbibir.cn/img/Q.gif alt=logo aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.lvbibir.cn/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://www.lvbibir.cn/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://www.lvbibir.cn/posts title="📚 文章"><span>📚 文章</span></a></li><li><a href=https://www.lvbibir.cn/tags title="🧩 标签"><span>🧩 标签</span></a></li><li><a href=https://www.lvbibir.cn/archives/ title="⏱ 时间轴"><span>⏱ 时间轴</span></a></li><li><a href=https://www.lvbibir.cn/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://www.lvbibir.cn/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn>主页</a>&nbsp;»&nbsp;<a href=https://www.lvbibir.cn/posts/>📚文章</a>&nbsp;»&nbsp;<a href=https://www.lvbibir.cn/posts/blog/>🧱 建站</a></div><h1 class=post-title>【置顶】Hello,hugo!</h1><div class=post-description>记录wordpress迁移至hugo的过程，大多参考sulv大佬的博客，本文更偏向于个人备忘，并不是一篇很合格的教程</div><div class=post-meta>创建:&nbsp;<span title='2022-07-06 00:00:00 +0000 UTC'>2022-07-06</span>&nbsp;|&nbsp;更新:&nbsp;2022-07-08&nbsp;|&nbsp;字数:&nbsp;1546字&nbsp;|&nbsp;时长:&nbsp;4分钟&nbsp;|&nbsp;
作者:&nbsp;lvbibir
&nbsp;|&nbsp;标签: &nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/tags/hugo/>hugo</a>
<a href=https://www.lvbibir.cn/tags/papermod/>、papermod</a></ul><span id=busuanzi_container_page_pv>&nbsp;| 访问: <span id=busuanzi_value_page_pv></span></span></div></header><figure class=entry-cover1><img loading=lazy src=https://image.lvbibir.cn/blog/hugo-logo-wide.svg alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>文章目录</span></summary><div class=inner><ul><li><a href=#%e5%8d%9a%e5%ae%a2%e6%b5%81%e6%b0%b4%e7%ba%bf aria-label=博客流水线>博客流水线</a><ul><li><a href=#%e7%bc%96%e8%be%91%e6%96%87%e7%ab%a0 aria-label=编辑文章>编辑文章</a></li><li><a href=#%e7%94%9f%e6%88%90%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6 aria-label=生成静态文件>生成静态文件</a></li><li><a href=#%e4%b8%8a%e4%bc%a0%e9%9d%99%e6%80%81%e6%96%87%e4%bb%b6 aria-label=上传静态文件>上传静态文件</a></li><li><a href=#%e5%bd%92%e6%a1%a3%e5%a4%87%e4%bb%bd aria-label=归档备份>归档备份</a></li></ul></li><li><a href=#%e5%b0%86hugo%e5%8d%9a%e5%ae%a2%e9%83%a8%e7%bd%b2%e5%88%b0%e9%98%bf%e9%87%8c%e4%ba%91 aria-label=将hugo博客部署到阿里云>将hugo博客部署到阿里云</a><ul><li><a href=#wordpress-blogdocker-composeyml aria-label=wordpress-blog/docker-compose.yml>wordpress-blog/docker-compose.yml</a></li><li><a href=#wordpress-blogconfproxydefaultconf aria-label=wordpress-blog/conf/proxy/default.conf>wordpress-blog/conf/proxy/default.conf</a></li><li><a href=#wordpress-blogconfhugonginxconf aria-label=wordpress-blog/conf/hugo/nginx.conf>wordpress-blog/conf/hugo/nginx.conf</a></li></ul></li><li><a href=#seo%e4%bc%98%e5%8c%96 aria-label=seo优化>seo优化</a></li><li><a href=#%e6%b7%bb%e5%8a%a0twikoo%e8%af%84%e8%ae%ba%e7%bb%84%e4%bb%b6 aria-label=添加twikoo评论组件>添加twikoo评论组件</a></li><li><a href=#%e4%bf%ae%e6%94%b9%e5%8d%9a%e5%ae%a2url aria-label=修改博客url>修改博客url</a></li><li><a href=#todo aria-label=todo>todo</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h3 id=博客流水线>博客流水线<a hidden class=anchor aria-hidden=true href=#博客流水线>#</a></h3><h4 id=编辑文章>编辑文章<a hidden class=anchor aria-hidden=true href=#编辑文章>#</a></h4><p>采用 typora + picgo + 七牛云图床流程，<a href=https://www.lvbibir.cn/posts/blog/typora_picgo_qiniu_upload_image/>参考文章</a></p><h4 id=生成静态文件>生成静态文件<a hidden class=anchor aria-hidden=true href=#生成静态文件>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>hugo -F --cleanDestinationDir
</span></span></code></pre></div><p>后面两个参数表示会先删除之前生成的 public 目录，保证每次生成的 public 都是新的</p><h4 id=上传静态文件>上传静态文件<a hidden class=anchor aria-hidden=true href=#上传静态文件>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>rsync -avuz --progress --delete Desktop/lvbibir/2-lvbibir.github.io/public/ root@101.201.150.47:/root/wordpress-blog/hugo-public/
</span></span></code></pre></div><p><a href=https://mobaxterm.mobatek.net/>mobaxterm</a> 是我一直以来的主力终端，它的本地终端自带了很多linux命令，用<code>rsync</code>命令上传静态文件至阿里服务器，且会先删除服务器上之前的静态文件，保证博客的内容保持最新</p><h4 id=归档备份>归档备份<a hidden class=anchor aria-hidden=true href=#归档备份>#</a></h4><p>研究 hugo 建站之初是打算采用 github pages 来发布静态博客</p><ul><li>优点</li><li><ul><li>仅需一个github账号和简单配置即可将静态博客发布到 github pages</li><li>没有维护的时间成本，可以将精力更多的放到博客内容本身上去</li><li>无需备案</li><li>无需ssl证书</li></ul></li><li>缺点</li><li><ul><li>访问速度较慢</li><li>访问速度较慢</li><li>访问速度较慢</li></ul></li></ul><p>虽说访问速度较慢可以通过各家的cdn加速来解决，但由于刚开始建立 blog 选择的是 wordpress ，域名、服务器、备案、证书等都已经一应俱全，且之前的架构采用 docker，添加一台 nginx 来跑 hugo 的静态网站是很方便的</p><p>所以干脆沿用之前的 <a href=https://github.com/lvbibir/lvbibir.github.io>github仓库</a> ，来作为我博客的归档管理，也可以方便家里电脑和工作电脑之间的数据同步</p><h3 id=将hugo博客部署到阿里云>将hugo博客部署到阿里云<a hidden class=anchor aria-hidden=true href=#将hugo博客部署到阿里云>#</a></h3><p>之前的<a href=https://lvbibir.cn>wordpress博客</a>部署在阿里云的一套 docker-compose 环境下，<a href=https://www.lvbibir.cn/posts/blog/wordpress_to_docker/>这篇文章</a>有详细记录</p><p>要做的仅仅是在之前的docker-compose.yml 中添加一个新的nginx环境用于跑hugo生成的静态文件，代理nginx中配置一下新nginx服务器，ssl证书依旧沿用之前的即可</p><p>以下是一些配置文件示例</p><h4 id=wordpress-blogdocker-composeyml>wordpress-blog/docker-compose.yml<a hidden class=anchor aria-hidden=true href=#wordpress-blogdocker-composeyml>#</a></h4><p>新增了hugo-nginx容器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.1&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>proxy</span>: <span style=color:#75715e># 前端代理nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>superng6/nginx:debian-stable-1.18.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>nginx-proxy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>wordpress_net</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>80</span>:<span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>443</span>:<span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/proxy/nginx.conf:/etc/nginx/nginx.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/proxy/default.conf:/etc/nginx/conf.d/default.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/ssl:/etc/nginx/ssl</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/logs/proxy:/var/log/nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>web</span>: <span style=color:#75715e># wordpress的nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>superng6/nginx:debian-stable-1.18.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>wordpress-nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>wordpress_net</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/nginx/nginx.conf:/etc/nginx/nginx.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/nginx/default.conf:/etc/nginx/conf.d/default.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/fastcgi.conf:/etc/nginx/fastcgi.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/shm/nginx-cache:/var/run/nginx-cache</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - $PWD/nginx-cache:/var/run/nginx-cache</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/wordpress:/var/www/html</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/logs/nginx:/var/log/nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>wordpress</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hugo</span>: <span style=color:#75715e># hugo的nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>superng6/nginx:debian-stable-1.18.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>hugo-nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>wordpress_net</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/hugo/nginx.conf:/etc/nginx/nginx.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/shm/nginx-cache:/var/run/nginx-cache</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/hugo-public:/var/www/html</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/logs/hugo:/var/log/nginx</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>wordpress</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>wordpress:5-fpm</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>wordpress-php</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>wordpress_net</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.4</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>WORDPRESS_DB_HOST</span>: <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>WORDPRESS_DB_USER</span>: <span style=color:#ae81ff>wordpress</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>WORDPRESS_DB_PASSWORD</span>: <span style=color:#75715e>#密码填自己的</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>WORDPRESS_DB_NAME</span>: <span style=color:#ae81ff>wordpress</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/wordpress:/var/www/html</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/shm/nginx-cache:/var/run/nginx-cache</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - $PWD/nginx-cache:/var/run/nginx-cache</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/uploads.ini:/usr/local/etc/php/php.ini</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis:5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>wordpress-redis</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>wordpress_net</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/redis-data:/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mysql:5.7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>wordpress-mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>wordpress_net</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ipv4_address</span>: <span style=color:#ae81ff>172.19.0.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_DATABASE</span>: <span style=color:#ae81ff>wordpress</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_USER</span>: <span style=color:#ae81ff>wordpress</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_PASSWORD</span>: <span style=color:#ae81ff>wordpress</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_RANDOM_ROOT_PASSWORD</span>: <span style=color:#e6db74>&#39;1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/mysql-data:/var/lib/mysql</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/conf/mysqld.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>wordpress_net</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>bridge</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ipam</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>       - <span style=color:#f92672>subnet</span>: <span style=color:#ae81ff>172.19.0.0</span><span style=color:#ae81ff>/16</span>
</span></span></code></pre></div><h4 id=wordpress-blogconfproxydefaultconf>wordpress-blog/conf/proxy/default.conf<a hidden class=anchor aria-hidden=true href=#wordpress-blogconfproxydefaultconf>#</a></h4><p>前端代理nginx的配置文件，原先只有 lvbibir.cn ，新增了 <a href=https://www.lvbibir.cn>www.lvbibir.cn</a> 相关配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>lvbibir.cn</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>lvbibir.cn</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.19.0.5:80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_redirect</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 保证获取到真实IP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 真实端口号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-Port</span> $remote_port;
</span></span><span style=display:flex><span>        <span style=color:#75715e># X-Forwarded-For 是一个 HTTP 扩展头部。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 在多级代理的情况下，记录每次代理之前的客户端真实ip
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>HTTP_X_FORWARDED_FOR</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 获取到真实协议
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-Proto</span> $scheme;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 真实主机名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 设置变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-NginX-Proxy</span> <span style=color:#e6db74>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 开启 brotli
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Accept-Encoding</span> <span style=color:#e6db74>&#34;br&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 日志
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/access.log</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>error_log</span> <span style=color:#e6db74>/var/log/nginx/error.log</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e># 证书
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/nginx/ssl/lvbibir.cn.pem</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/nginx/ssl/lvbibir.cn.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># curl https://ssl-config.mozilla.org/ffdhe2048.txt &gt; /path/to/dhparam
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e># ssl_dhparam /etc/nginx/ssl/dhparam;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># HSTS (ngx_http_headers_module is required) (63072000 seconds)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Strict-Transport-Security</span> <span style=color:#e6db74>&#34;max-age=63072000&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># OCSP stapling
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_stapling</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_stapling_verify</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># verify chain of trust of OCSP response using Root CA and Intermediate certs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e># ssl_trusted_certificate  /etc/nginx/ssl/all.sleele.com/fullchain.cer;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e># replace with the IP address of your resolver
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>resolver</span> <span style=color:#ae81ff>223</span><span style=color:#e6db74>.5.5.5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>resolver_timeout</span> <span style=color:#e6db74>5s</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>www.lvbibir.cn</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>www.lvbibir.cn</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://172.19.0.7:80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_redirect</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 保证获取到真实IP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 真实端口号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-Port</span> $remote_port;
</span></span><span style=display:flex><span>        <span style=color:#75715e># X-Forwarded-For 是一个 HTTP 扩展头部。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 在多级代理的情况下，记录每次代理之前的客户端真实ip
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>HTTP_X_FORWARDED_FOR</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 获取到真实协议
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-Proto</span> $scheme;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 真实主机名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 设置变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-NginX-Proxy</span> <span style=color:#e6db74>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 开启 brotli
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Accept-Encoding</span> <span style=color:#e6db74>&#34;br&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 日志
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/access.log</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>error_log</span> <span style=color:#e6db74>/var/log/nginx/error.log</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e># 证书
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/nginx/ssl/lvbibir.cn.pem</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/nginx/ssl/lvbibir.cn.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># curl https://ssl-config.mozilla.org/ffdhe2048.txt &gt; /path/to/dhparam
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e># ssl_dhparam /etc/nginx/ssl/dhparam;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># HSTS (ngx_http_headers_module is required) (63072000 seconds)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Strict-Transport-Security</span> <span style=color:#e6db74>&#34;max-age=63072000&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># OCSP stapling
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>ssl_stapling</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_stapling_verify</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># verify chain of trust of OCSP response using Root CA and Intermediate certs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e># ssl_trusted_certificate  /etc/nginx/ssl/all.sleele.com/fullchain.cer;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e># replace with the IP address of your resolver
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>resolver</span> <span style=color:#ae81ff>223</span><span style=color:#e6db74>.5.5.5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>resolver_timeout</span> <span style=color:#e6db74>5s</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=wordpress-blogconfhugonginxconf>wordpress-blog/conf/hugo/nginx.conf<a hidden class=anchor aria-hidden=true href=#wordpress-blogconfhugonginxconf>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>user</span> <span style=color:#e6db74>root</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>worker_processes</span> <span style=color:#e6db74>auto</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>error_log</span> <span style=color:#e6db74>/var/log/nginx/error.log</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pid</span> <span style=color:#e6db74>/run/nginx.pid</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> /usr/share/nginx/modules/*.conf;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>events</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>worker_connections</span> <span style=color:#ae81ff>1024</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>log_format</span>  <span style=color:#e6db74>main</span>  <span style=color:#e6db74>&#39;</span>$remote_addr <span style=color:#e6db74>-</span> $remote_user <span style=color:#e6db74>[</span>$time_local] <span style=color:#e6db74>&#34;</span>$request&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;</span>$status $body_bytes_sent <span style=color:#e6db74>&#34;</span>$http_referer&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;&#34;</span>$http_user_agent&#34; <span style=color:#e6db74>&#34;</span>$http_x_forwarded_for&#34;&#39;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>access_log</span>  <span style=color:#e6db74>/var/log/nginx/access.log</span>  <span style=color:#e6db74>main</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sendfile</span>            <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>tcp_nopush</span>          <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>tcp_nodelay</span>         <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>keepalive_timeout</span>   <span style=color:#ae81ff>65</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>types_hash_max_size</span> <span style=color:#ae81ff>2048</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>include</span>             <span style=color:#e6db74>/etc/nginx/mime.types</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>default_type</span>        <span style=color:#e6db74>application/octet-stream</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/nginx/conf.d/*.conf</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 配置http
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span>       <span style=color:#ae81ff>80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span>       <span style=color:#e6db74>[::]:80</span> <span style=color:#e6db74>default_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>www.lvbibir.cn</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/html</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/nginx/default.d/*.conf</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/html</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>index</span>  <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>error_page</span> <span style=color:#ae81ff>404</span> <span style=color:#e6db74>/404.html</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> = <span style=color:#e6db74>/40x.html</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>root</span>   <span style=color:#e6db74>/var/www/html</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>error_page</span> <span style=color:#ae81ff>500</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>503</span> <span style=color:#ae81ff>504</span> <span style=color:#e6db74>/50x.html</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>location</span> = <span style=color:#e6db74>/50x.html</span> {
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=seo优化>seo优化<a hidden class=anchor aria-hidden=true href=#seo优化>#</a></h3><p><a href=https://www.sulvblog.cn/posts/blog/hugo_seo/>https://www.sulvblog.cn/posts/blog/hugo_seo/</a></p><h3 id=添加twikoo评论组件>添加twikoo评论组件<a hidden class=anchor aria-hidden=true href=#添加twikoo评论组件>#</a></h3><p>基本完全按照sulv博主的文章来操作，某些地方官方有更新，不过也只是更改了页面罢了</p><p><a href=https://www.sulvblog.cn/posts/blog/hugo_twikoo/>https://www.sulvblog.cn/posts/blog/hugo_twikoo/</a></p><p>顺便记录一下账号关系：mongodb使用google账号登录，vercel使用github登录</p><h3 id=修改博客url>修改博客url<a hidden class=anchor aria-hidden=true href=#修改博客url>#</a></h3><p><a href=https://gohugo.io/content-management/urls/>https://gohugo.io/content-management/urls/</a></p><h3 id=todo>todo<a hidden class=anchor aria-hidden=true href=#todo>#</a></h3><ul><li><input checked disabled type=checkbox> 修改所有文章的文件名为全英文</li><li><input checked disabled type=checkbox> 百度seo优化</li><li><input checked disabled type=checkbox> 谷歌seo优化</li><li><input checked disabled type=checkbox> 必应seo优化</li><li><input disabled type=checkbox> 尝试再次优化nginx的配置，之前的配置对于wordpress可能更适用</li><li><input disabled type=checkbox> 图床备份</li></ul></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://www.lvbibir.cn/img/wechat_pay.png alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://www.lvbibir.cn/img/alipay.png alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>🧧 鼓励</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/posts/life/running/><span class=title>« 上一页</span><br><span>跑渣的跑步日常</span></a>
<a class=next href=https://www.lvbibir.cn/posts/blog/hugo_image_layout/><span class=title>下一页 »</span><br><span>修改hugo的图片布局，使多张图片可以并排显示</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>💬评论</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.5.11/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo-lvbibir.vercel.app/",el:"#tcomment",lang:"zh-CN",region:"ap-guangzhou",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
2020-2022
<a href=https://www.lvbibir.cn style=color:#939393>lvbibir's Blog</a>
All Rights Reserved</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393>京ICP备2021023168号-1</a>&nbsp;
<span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>总访客数: <span id=busuanzi_value_site_uv></span>
总访问量: <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

————————————————
版权声明：本文为「lvbibir's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href,s=window.getSelection().toString()+`

————————————————
版权声明：本文为「lvbibir's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="📄复制";function s(){t.innerText="👌🏻已复制!",setTimeout(()=>{t.innerText="📄复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
————————————————
版权声明：本文为「lvbibir's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;navigator.clipboard.writeText(t),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>