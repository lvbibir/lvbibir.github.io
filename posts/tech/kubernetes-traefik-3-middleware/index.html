<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>traefik (ä¸‰) Middleware ä¸­é—´ä»¶ | lvbibir's Blog</title><meta name=keywords content="kubernetes,traefik,ingressroute"><meta name=description content="kubernetes ä¸­ä½¿ç”¨ Traefik ingress çš„ Middleware å®ç°é‡å®šå‘ã€ç™½åå•ã€ç”¨æˆ·è®¤è¯ã€é™æµã€ç†”æ–­ã€å‹ç¼©ã€è‡ªå®šä¹‰ error é¡µç­‰æ“ä½œ"><meta name=author content="ä½œè€…:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/posts/tech/kubernetes-traefik-3-middleware/><link crossorigin=anonymous href=/assets/css/stylesheet.ffa261d3d63954dc97f5ace62f9a4c524e57150c014b9abbf2e35de0982c0966.css integrity="sha256-/6Jh09Y5VNyX9azmL5pMUk5XFQwBS5q78uNd4JgsCWY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://image.lvbibir.cn/blog/avatar.webp><link rel=icon type=image/png sizes=16x16 href=https://image.lvbibir.cn/blog/avatar.webp><link rel=icon type=image/png sizes=32x32 href=https://image.lvbibir.cn/blog/avatar.webp><link rel=apple-touch-icon href=https://image.lvbibir.cn/blog/avatar.webp><link rel=mask-icon href=https://image.lvbibir.cn/blog/avatar.webp><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://image.lvbibir.cn/fonts/LXGWWenKaiScreen-v1.521/result.css><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script>document.addEventListener('DOMContentLoaded',function(){const e=document.querySelectorAll('img.lazyload');if('IntersectionObserver'in window){const t=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove('lazyload'),n.classList.add('lazyloaded'),t.unobserve(n)}})},{rootMargin:'50px 0px',threshold:.01});e.forEach(function(e){t.observe(e)})}else e.forEach(function(e){e.src=e.dataset.src})})</script><meta property="og:title" content="traefik (ä¸‰) Middleware ä¸­é—´ä»¶"><meta property="og:description" content="kubernetes ä¸­ä½¿ç”¨ Traefik ingress çš„ Middleware å®ç°é‡å®šå‘ã€ç™½åå•ã€ç”¨æˆ·è®¤è¯ã€é™æµã€ç†”æ–­ã€å‹ç¼©ã€è‡ªå®šä¹‰ error é¡µç­‰æ“ä½œ"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/posts/tech/kubernetes-traefik-3-middleware/"><meta property="og:image" content="https://image.lvbibir.cn/blog/traefik.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-28T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://image.lvbibir.cn/blog/traefik.png"><meta name=twitter:title content="traefik (ä¸‰) Middleware ä¸­é—´ä»¶"><meta name=twitter:description content="kubernetes ä¸­ä½¿ç”¨ Traefik ingress çš„ Middleware å®ç°é‡å®šå‘ã€ç™½åå•ã€ç”¨æˆ·è®¤è¯ã€é™æµã€ç†”æ–­ã€å‹ç¼©ã€è‡ªå®šä¹‰ error é¡µç­‰æ“ä½œ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"ğŸ“š æ–‡ç« ","item":"https://www.lvbibir.cn/posts/"},{"@type":"ListItem","position":3,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://www.lvbibir.cn/posts/tech/"},{"@type":"ListItem","position":4,"name":"traefik (ä¸‰) Middleware ä¸­é—´ä»¶","item":"https://www.lvbibir.cn/posts/tech/kubernetes-traefik-3-middleware/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"traefik (ä¸‰) Middleware ä¸­é—´ä»¶","name":"traefik (ä¸‰) Middleware ä¸­é—´ä»¶","description":"kubernetes ä¸­ä½¿ç”¨ Traefik ingress çš„ Middleware å®ç°é‡å®šå‘ã€ç™½åå•ã€ç”¨æˆ·è®¤è¯ã€é™æµã€ç†”æ–­ã€å‹ç¼©ã€è‡ªå®šä¹‰ error é¡µç­‰æ“ä½œ","keywords":["kubernetes","traefik","ingressroute"],"articleBody":"0 å‰è¨€ åŸºäº centos7.9ï¼Œdocker-ce-20.10.18ï¼Œkubelet-1.22.3-0ï¼Œ traefik-2.9.10\nç¤ºä¾‹ä¸­ç”¨åˆ°çš„ myapp å’Œ secret èµ„æºè¯·æŸ¥çœ‹ç³»åˆ—æ–‡ç« ç¬¬äºŒç¯‡ä¸­çš„æ¼”ç¤º\n1 ç®€ä»‹ å®˜æ–¹æ–‡æ¡£\nTraefik Middlewares æ˜¯ä¸€ä¸ªå¤„äºè·¯ç”±å’Œåç«¯æœåŠ¡ä¹‹å‰çš„ä¸­é—´ä»¶ï¼Œåœ¨å¤–éƒ¨æµé‡è¿›å…¥ Traefikï¼Œä¸”è·¯ç”±è§„åˆ™åŒ¹é…æˆåŠŸåï¼Œå°†æµé‡å‘é€åˆ°å¯¹åº”çš„åç«¯æœåŠ¡å‰ï¼Œå…ˆå°†å…¶å‘ç»™ä¸­é—´ä»¶è¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼ˆç±»ä¼¼äºè¿‡æ»¤å™¨é“¾ Filterï¼Œè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼‰ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ  Header å¤´ä¿¡æ¯ã€é‰´æƒã€æµé‡è½¬å‘ã€å¤„ç†è®¿é—®è·¯å¾„å‰ç¼€ã€IP ç™½åå•ç­‰ç­‰ï¼Œç»è¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸­é—´ä»¶å¤„ç†å®Œæˆåï¼Œå†å‘é€ç»™åç«¯æœåŠ¡ï¼Œè¿™ä¸ªå°±æ˜¯ä¸­é—´ä»¶çš„ä½œç”¨ã€‚\nTraefik å†…ç½®äº†å¾ˆå¤šä¸åŒåŠŸèƒ½çš„ Middlewareï¼Œä¸»è¦æ˜¯é’ˆå¯¹ HTTP å’Œ TCPï¼Œè¿™é‡ŒæŒ‘é€‰å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„è¿›è¡Œæ¼”ç¤ºã€‚\n1.1 é‡å®šå‘ -redirectScheme å®˜æ–¹æ–‡æ¡£\nå®šä¹‰ä¸€ä¸ª ingressrouteï¼ŒåŒ…å«ä¸€ä¸ªè‡ªåŠ¨å°† http è·³è½¬åˆ° https çš„ä¸­é—´ä»¶\napiVersion: traefik.containo.us/v1alpha1 kind: IngressRoute metadata: name: myapp2 spec: entryPoints: - web routes: - match: Host(`myapp2.test.com`) kind: Rule services: - name: myapp2 port: 80 middlewares: - name: redirect-https-middleware # æŒ‡å®šä½¿ç”¨RedirectSchemeä¸­é—´ä»¶ï¼Œå®Œæˆhttpå¼ºåˆ¶è·³è½¬è‡³https --- apiVersion: traefik.containo.us/v1alpha1 kind: Middleware metadata: name: redirect-https-middleware spec: redirectScheme: scheme: https # è‡ªåŠ¨è·³è½¬åˆ° https æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°è®¿é—® http è‡ªåŠ¨ 307 é‡å®šå‘åˆ°äº† https\n[root@k8s-node1 ~]# curl -I http://myapp2.test.com HTTP/1.1 307 Temporary Redirect Location: https://myapp2.test.com/ Date: Wed, 19 Apr 2023 07:58:34 GMT Content-Length: 18 Content-Type: text/plain; charset=utf-8 1.2 å»é™¤è¯·æ±‚è·¯å¾„å‰ç¼€ -stripPrefix å®˜æ–¹æ–‡æ¡£\nå‡è®¾ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œå½“è®¿é—® http://myapp.test.com/v1 æ—¶ï¼Œæµé‡è°ƒåº¦è‡³ myapp1ã€‚å½“è®¿é—® http://myapp.test.com/v2 æ—¶ï¼Œæµé‡è°ƒåº¦è‡³ myapp2ã€‚è¿™ç§éœ€æ±‚æ˜¯éå¸¸å¸¸è§çš„ï¼Œåœ¨ NGINX ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å¤šä¸ª Location æ¥å®šåˆ¶è§„åˆ™ï¼Œä½¿ç”¨ Traefik ä¹Ÿå¯ä»¥è¿™ä¹ˆåšã€‚ä½†æ˜¯å®šåˆ¶ä¸åŒçš„å‰ç¼€åï¼Œç”±äºåº”ç”¨æœ¬èº«å¹¶æ²¡æœ‰è¿™äº›å‰ç¼€ï¼Œå¯¼è‡´è¯·æ±‚è¿”å› 404ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹è¯·æ±‚çš„ path è¿›è¡Œå¤„ç†ã€‚\nåˆ›å»ºä¸€ä¸ª IngressRouteï¼Œå¹¶è®¾ç½®ä¸¤æ¡è§„åˆ™ï¼Œæ ¹æ®ä¸åŒçš„è®¿é—®è·¯å¾„ä»£ç†è‡³ç›¸å¯¹åº”çš„ service\napiVersion: traefik.containo.us/v1alpha1 kind: IngressRoute metadata: name: myapp spec: entryPoints: - web routes: - match: Host(`myapp.test.com`) \u0026\u0026 PathPrefix(`/v1`) kind: Rule services: - name: myapp1 port: 80 middlewares: - name: prefix-url-middleware - match: Host(`myapp.test.com`) \u0026\u0026 PathPrefix(`/v2`) kind: Rule services: - name: myapp2 port: 80 middlewares: - name: prefix-url-middleware --- apiVersion: traefik.containo.us/v1alpha1 kind: Middleware metadata: name: prefix-url-middleware spec: stripPrefix: # å»é™¤å‰ç¼€çš„ä¸­é—´ä»¶ stripPrefixï¼ŒæŒ‡å®šå°†è¯·æ±‚è·¯å¾„ä¸­çš„v1ã€v2å»é™¤ã€‚ prefixes: - /v1 - /v2 éƒ¨ç½²æµ‹è¯•\n[root@k8s-node1 ~]# curl http://myapp.test.com/v1 Hello MyApp | Version: v1 | ","wordCount":"3578","inLanguage":"en","image":"https://image.lvbibir.cn/blog/traefik.png","datePublished":"2023-04-18T00:00:00Z","dateModified":"2024-01-28T00:00:00Z","author":{"@type":"Person","name":"lvbibir"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/posts/tech/kubernetes-traefik-3-middleware/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://image.lvbibir.cn/blog/avatar.webp"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://image.lvbibir.cn/blog/avatar.webp alt aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li class=menu-item><a href=https://www.lvbibir.cn/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/archives title="ğŸ“ˆ å½’æ¡£"><span>ğŸ“ˆ å½’æ¡£</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/talk title="ğŸ’¬ è¯´è¯´"><span>ğŸ’¬ è¯´è¯´</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/>ğŸ“š æ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>traefik (ä¸‰) Middleware ä¸­é—´ä»¶</h1><div class=post-description>kubernetes ä¸­ä½¿ç”¨ Traefik ingress çš„ Middleware å®ç°é‡å®šå‘ã€ç™½åå•ã€ç”¨æˆ·è®¤è¯ã€é™æµã€ç†”æ–­ã€å‹ç¼©ã€è‡ªå®šä¹‰ error é¡µç­‰æ“ä½œ</div><div class=post-meta>åˆ›å»º:&nbsp;<span title='2023-04-18 00:00:00 +0000 UTC'>2023-04-18</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2024-01-28&nbsp;|&nbsp;å­—æ•°:&nbsp;3578å­—&nbsp;|&nbsp;ä½œè€…:&nbsp;lvbibir
|&nbsp;æ ‡ç­¾:&nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/tags/traefik/>traefik</a>
<a href=https://www.lvbibir.cn/tags/kubernetes/>ã€kubernetes</a></ul><span id=busuanzi_container_page_pv>&nbsp;|&nbsp;è®¿é—®:&nbsp;<span id=busuanzi_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>æ–‡ç« ç›®å½•</span></summary><div class=inner><ul><li><a href=#0-%e5%89%8d%e8%a8%80 aria-label="0 å‰è¨€">0 å‰è¨€</a></li><li><a href=#1-%e7%ae%80%e4%bb%8b aria-label="1 ç®€ä»‹">1 ç®€ä»‹</a><ul><li><a href=#11-%e9%87%8d%e5%ae%9a%e5%90%91--redirectscheme aria-label="1.1 é‡å®šå‘ -redirectScheme">1.1 é‡å®šå‘ -redirectScheme</a></li><li><a href=#12-%e5%8e%bb%e9%99%a4%e8%af%b7%e6%b1%82%e8%b7%af%e5%be%84%e5%89%8d%e7%bc%80--stripprefix aria-label="1.2 å»é™¤è¯·æ±‚è·¯å¾„å‰ç¼€ -stripPrefix">1.2 å»é™¤è¯·æ±‚è·¯å¾„å‰ç¼€ -stripPrefix</a></li><li><a href=#13-%e7%99%bd%e5%90%8d%e5%8d%95--ipwhitelist aria-label="1.3 ç™½åå• -IPWhiteList">1.3 ç™½åå• -IPWhiteList</a></li><li><a href=#14-%e5%9f%ba%e7%a1%80%e7%94%a8%e6%88%b7%e8%ae%a4%e8%af%81--basicauth aria-label="1.4 åŸºç¡€ç”¨æˆ·è®¤è¯ -basicAuth">1.4 åŸºç¡€ç”¨æˆ·è®¤è¯ -basicAuth</a></li><li><a href=#15-%e4%bf%ae%e6%94%b9%e8%af%b7%e6%b1%82%e5%93%8d%e5%ba%94%e5%a4%b4%e4%bf%a1%e6%81%af--headers aria-label="1.5 ä¿®æ”¹è¯·æ±‚/å“åº”å¤´ä¿¡æ¯ -headers">1.5 ä¿®æ”¹è¯·æ±‚/å“åº”å¤´ä¿¡æ¯ -headers</a></li><li><a href=#16-%e9%99%90%e6%b5%81--ratelimit aria-label="1.6 é™æµ -rateLimit">1.6 é™æµ -rateLimit</a></li><li><a href=#17-%e7%86%94%e6%96%ad--circuitbreaker aria-label="1.7 ç†”æ–­ -circuitBreaker">1.7 ç†”æ–­ -circuitBreaker</a></li><li><a href=#18-%e8%87%aa%e5%ae%9a%e4%b9%89%e9%94%99%e8%af%af%e9%a1%b5--errorpages aria-label="1.8 è‡ªå®šä¹‰é”™è¯¯é¡µ -errorPages">1.8 è‡ªå®šä¹‰é”™è¯¯é¡µ -errorPages</a></li><li><a href=#19-%e6%95%b0%e6%8d%ae%e5%8e%8b%e7%bc%a9--compress aria-label="1.9 æ•°æ®å‹ç¼© -compress">1.9 æ•°æ®å‹ç¼© -compress</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener('DOMContentLoaded',function(){checkTocPosition(),elements=document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]'),activeElement=elements[0];const e=encodeURI(activeElement.getAttribute('id')).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add('active')},!1),window.addEventListener('resize',function(){checkTocPosition()},!1),window.addEventListener('scroll',()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute('id')).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add('active'):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove('active')})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue('--gap'),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=0-å‰è¨€>0 å‰è¨€<a hidden class=anchor aria-hidden=true href=#0-å‰è¨€>#</a></h1><p>åŸºäº <code>centos7.9</code>ï¼Œ<code>docker-ce-20.10.18</code>ï¼Œ<code>kubelet-1.22.3-0</code>ï¼Œ <code>traefik-2.9.10</code></p><p>ç¤ºä¾‹ä¸­ç”¨åˆ°çš„ <code>myapp</code> å’Œ <code>secret</code> èµ„æºè¯·æŸ¥çœ‹ç³»åˆ—æ–‡ç« ç¬¬äºŒç¯‡ä¸­çš„æ¼”ç¤º</p><h1 id=1-ç®€ä»‹>1 ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#1-ç®€ä»‹>#</a></h1><p><a href=https://doc.traefik.io/traefik/middlewares/overview/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>Traefik Middlewares æ˜¯ä¸€ä¸ªå¤„äºè·¯ç”±å’Œåç«¯æœåŠ¡ä¹‹å‰çš„ä¸­é—´ä»¶ï¼Œåœ¨å¤–éƒ¨æµé‡è¿›å…¥ Traefikï¼Œä¸”è·¯ç”±è§„åˆ™åŒ¹é…æˆåŠŸåï¼Œå°†æµé‡å‘é€åˆ°å¯¹åº”çš„åç«¯æœåŠ¡å‰ï¼Œå…ˆå°†å…¶å‘ç»™ä¸­é—´ä»¶è¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼ˆç±»ä¼¼äºè¿‡æ»¤å™¨é“¾ Filterï¼Œè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼‰ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ  Header å¤´ä¿¡æ¯ã€é‰´æƒã€æµé‡è½¬å‘ã€å¤„ç†è®¿é—®è·¯å¾„å‰ç¼€ã€IP ç™½åå•ç­‰ç­‰ï¼Œç»è¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸­é—´ä»¶å¤„ç†å®Œæˆåï¼Œå†å‘é€ç»™åç«¯æœåŠ¡ï¼Œè¿™ä¸ªå°±æ˜¯ä¸­é—´ä»¶çš„ä½œç”¨ã€‚</p><p>Traefik å†…ç½®äº†å¾ˆå¤šä¸åŒåŠŸèƒ½çš„ Middlewareï¼Œä¸»è¦æ˜¯é’ˆå¯¹ HTTP å’Œ TCPï¼Œè¿™é‡ŒæŒ‘é€‰å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„è¿›è¡Œæ¼”ç¤ºã€‚</p><h2 id=11-é‡å®šå‘--redirectscheme>1.1 é‡å®šå‘ -redirectScheme<a hidden class=anchor aria-hidden=true href=#11-é‡å®šå‘--redirectscheme>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/redirectscheme/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>å®šä¹‰ä¸€ä¸ª ingressrouteï¼ŒåŒ…å«ä¸€ä¸ªè‡ªåŠ¨å°† http è·³è½¬åˆ° https çš„ä¸­é—´ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp2</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp2.test.com`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp2</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>redirect-https-middleware  </span> <span style=color:#776e71># æŒ‡å®šä½¿ç”¨RedirectSchemeä¸­é—´ä»¶ï¼Œå®Œæˆhttpå¼ºåˆ¶è·³è½¬è‡³https</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>redirect-https-middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>redirectScheme</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>scheme</span>: <span style=color:#f99b15>https  </span> <span style=color:#776e71># è‡ªåŠ¨è·³è½¬åˆ° https</span>
</span></span></code></pre></div><p>æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°è®¿é—® http è‡ªåŠ¨ 307 é‡å®šå‘åˆ°äº† https</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl -I http://myapp2.test.com</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#f99b15>307</span> Temporary Redirect
</span></span><span style=display:flex><span>Location: https://myapp2.test.com/
</span></span><span style=display:flex><span>Date: Wed, <span style=color:#f99b15>19</span> Apr <span style=color:#f99b15>2023</span> 07:58:34 GMT
</span></span><span style=display:flex><span>Content-Length: <span style=color:#f99b15>18</span>
</span></span><span style=display:flex><span>Content-Type: text/plain; <span style=color:#ef6155>charset</span><span style=color:#5bc4bf>=</span>utf-8
</span></span></code></pre></div><h2 id=12-å»é™¤è¯·æ±‚è·¯å¾„å‰ç¼€--stripprefix>1.2 å»é™¤è¯·æ±‚è·¯å¾„å‰ç¼€ -stripPrefix<a hidden class=anchor aria-hidden=true href=#12-å»é™¤è¯·æ±‚è·¯å¾„å‰ç¼€--stripprefix>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/stripprefix/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>å‡è®¾ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œå½“è®¿é—® <code>http://myapp.test.com/v1</code> æ—¶ï¼Œæµé‡è°ƒåº¦è‡³ myapp1ã€‚å½“è®¿é—® <code>http://myapp.test.com/v2</code> æ—¶ï¼Œæµé‡è°ƒåº¦è‡³ myapp2ã€‚è¿™ç§éœ€æ±‚æ˜¯éå¸¸å¸¸è§çš„ï¼Œåœ¨ NGINX ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å¤šä¸ª Location æ¥å®šåˆ¶è§„åˆ™ï¼Œä½¿ç”¨ Traefik ä¹Ÿå¯ä»¥è¿™ä¹ˆåšã€‚ä½†æ˜¯å®šåˆ¶ä¸åŒçš„å‰ç¼€åï¼Œç”±äºåº”ç”¨æœ¬èº«å¹¶æ²¡æœ‰è¿™äº›å‰ç¼€ï¼Œå¯¼è‡´è¯·æ±‚è¿”å› 404ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹è¯·æ±‚çš„ path è¿›è¡Œå¤„ç†ã€‚</p><p>åˆ›å»ºä¸€ä¸ª IngressRouteï¼Œå¹¶è®¾ç½®ä¸¤æ¡è§„åˆ™ï¼Œæ ¹æ®ä¸åŒçš„è®¿é—®è·¯å¾„ä»£ç†è‡³ç›¸å¯¹åº”çš„ service</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp.test.com`) &amp;&amp; PathPrefix(`/v1`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>prefix-url-middleware</span>
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp.test.com`) &amp;&amp; PathPrefix(`/v2`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp2</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>prefix-url-middleware</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>prefix-url-middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>stripPrefix</span>: <span style=color:#776e71># å»é™¤å‰ç¼€çš„ä¸­é—´ä»¶ stripPrefixï¼ŒæŒ‡å®šå°†è¯·æ±‚è·¯å¾„ä¸­çš„v1ã€v2å»é™¤ã€‚</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>prefixes</span>: 
</span></span><span style=display:flex><span>      - <span style=color:#f99b15>/v1</span>
</span></span><span style=display:flex><span>      - <span style=color:#f99b15>/v2</span>
</span></span></code></pre></div><p>éƒ¨ç½²æµ‹è¯•</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl http://myapp.test.com/v1</span>
</span></span><span style=display:flex><span>Hello MyApp | Version: v1 | &lt;a <span style=color:#ef6155>href</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;hostname.html&#34;</span>&gt;Pod Name&lt;/a&gt;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl http://myapp.test.com/v2</span>
</span></span><span style=display:flex><span>Hello MyApp | Version: v2 | &lt;a <span style=color:#ef6155>href</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;hostname.html&#34;</span>&gt;Pod Name&lt;/a&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># kubectl logs -l app=myapp1 | tail -2</span>
</span></span><span style=display:flex><span><span style=color:#776e71># æœªæ·»åŠ æ’ä»¶çš„è®¿é—®è·¯å¾„ä¸º /v1/ </span>
</span></span><span style=display:flex><span>10.244.36.64 - - <span style=color:#5bc4bf>[</span>19/Apr/2023:08:02:03 +0000<span style=color:#5bc4bf>]</span> <span style=color:#48b685>&#34;GET /v1/ HTTP/1.1&#34;</span> <span style=color:#f99b15>404</span> <span style=color:#f99b15>169</span> <span style=color:#48b685>&#34;-&#34;</span> <span style=color:#48b685>&#34;curl/7.29.0&#34;</span> <span style=color:#48b685>&#34;1.1.1.1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#776e71># æ·»åŠ æ’ä»¶åçš„è®¿é—®è·¯å¾„ä¸º /</span>
</span></span><span style=display:flex><span>10.244.36.64 - - <span style=color:#5bc4bf>[</span>19/Apr/2023:08:04:31 +0000<span style=color:#5bc4bf>]</span> <span style=color:#48b685>&#34;GET / HTTP/1.1&#34;</span> <span style=color:#f99b15>200</span> <span style=color:#f99b15>65</span> <span style=color:#48b685>&#34;-&#34;</span> <span style=color:#48b685>&#34;curl/7.29.0&#34;</span> <span style=color:#48b685>&#34;1.1.1.1&#34;</span>
</span></span></code></pre></div><h2 id=13-ç™½åå•--ipwhitelist>1.3 ç™½åå• -IPWhiteList<a hidden class=anchor aria-hidden=true href=#13-ç™½åå•--ipwhitelist>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/ipwhitelist/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>ä¸ºæé«˜å®‰å…¨æ€§ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸€äº›ç®¡ç†å‘˜ç•Œé¢ä¼šè®¾ç½® ip è®¿é—®ç™½åå•ï¼Œåªå¸Œæœ›ä¸ªåˆ«ç”¨æˆ·å¯ä»¥è®¿é—®ã€‚</p><p>ç¤ºä¾‹</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp1.test.com`) </span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>ip-white-list-middleware</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>ip-white-list-middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>ipWhiteList</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>sourceRange</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f99b15>127.0.0.1</span><span style=color:#f99b15>/32</span>
</span></span><span style=display:flex><span>      - <span style=color:#f99b15>1.1.1.253</span>
</span></span></code></pre></div><p>æµ‹è¯•</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#776e71># ç™½åå•å¤–ä¸»æœº</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl -I http://myapp1.test.com</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#f99b15>403</span> Forbidden
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># ç™½åå•å†…ä¸»æœº</span>
</span></span><span style=display:flex><span>Admin@BJLPT0152 MINGW64 ~
</span></span><span style=display:flex><span>$ ipconfig | grep 1.1.1.253
</span></span><span style=display:flex><span>   IPv4 åœ°å€ . . . . . . . . . . . . : 1.1.1.253
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Admin@BJLPT0152 MINGW64 ~
</span></span><span style=display:flex><span>$ curl -i  http://myapp1.test.com
</span></span><span style=display:flex><span>Hello MyApp | Version: v1 | &lt;a <span style=color:#ef6155>href</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;hostname.html&#34;</span>&gt;Pod Name&lt;/a&gt;
</span></span></code></pre></div><h2 id=14-åŸºç¡€ç”¨æˆ·è®¤è¯--basicauth>1.4 åŸºç¡€ç”¨æˆ·è®¤è¯ -basicAuth<a hidden class=anchor aria-hidden=true href=#14-åŸºç¡€ç”¨æˆ·è®¤è¯--basicauth>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/basicauth/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>é€šå¸¸ä¼ä¸šå®‰å…¨è¦æ±‚è§„èŒƒé™¤äº†è¦å¯¹ç®¡ç†å‘˜é¡µé¢é™åˆ¶è®¿é—® ip å¤–ï¼Œè¿˜éœ€è¦æ·»åŠ è´¦å·å¯†ç è®¤è¯ï¼Œè€Œ traefik é»˜è®¤æ²¡æœ‰æä¾›è´¦å·å¯†ç è®¤è¯åŠŸèƒ½ï¼Œæ­¤æ—¶å°±å¯ä»¥é€šè¿‡ BasicAuth ä¸­é—´ä»¶å®Œæˆç”¨æˆ·è®¤è¯ï¼Œåªæœ‰è®¤è¯é€šè¿‡çš„æˆæƒç”¨æˆ·æ‰å¯ä»¥è®¿é—®é¡µé¢ã€‚</p><p>å®‰è£… htpasswd å·¥å…·ç”Ÿæˆå¯†ç æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># yum install -y httpd</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># htpasswd -bc basic-auth-secret-lvbibir lvbibir 123</span>
</span></span><span style=display:flex><span>Adding password <span style=color:#815ba4>for</span> user lvbibir
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># kubectl create secret generic basic-auth-lvbibir --from-file=basic-auth-secret-lvbibir</span>
</span></span><span style=display:flex><span>secret/basic-auth-lvbibir created
</span></span></code></pre></div><p>åˆ›å»º ingressrouteï¼Œä½¿ç”¨ basicAuth ä¸­é—´ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp1.test.com`) </span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>basic-auth-middleware</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>basic-auth-middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>basicAuth</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>secret</span>: <span style=color:#f99b15>basic-auth-lvbibir</span>
</span></span></code></pre></div><p>è®¿é—®æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°å¼¹å‡ºç•Œé¢æç¤ºéœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾“å…¥åå›è½¦æ˜¾ç¤ºæ­£å¸¸é¡µé¢</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20230419163142212.png alt=image-20230419163142212 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20230419163142212.png alt=image-20230419163142212></noscript></p><h2 id=15-ä¿®æ”¹è¯·æ±‚å“åº”å¤´ä¿¡æ¯--headers>1.5 ä¿®æ”¹è¯·æ±‚/å“åº”å¤´ä¿¡æ¯ -headers<a hidden class=anchor aria-hidden=true href=#15-ä¿®æ”¹è¯·æ±‚å“åº”å¤´ä¿¡æ¯--headers>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/headers/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>ä¸ºäº†æé«˜ä¸šåŠ¡çš„å®‰å…¨æ€§ï¼Œå®‰å…¨å›¢é˜Ÿä¼šå®šæœŸè¿›è¡Œæ¼æ´æ‰«æï¼Œå…¶ä¸­æœ‰äº› web æ¼æ´å°±éœ€è¦é€šè¿‡ä¿®æ”¹å“åº”å¤´å¤„ç†ï¼Œtraefik çš„ Headers ä¸­é—´ä»¶ä¸ä»…å¯ä»¥ä¿®æ”¹è¿”å›å®¢æˆ·ç«¯çš„å“åº”å¤´ä¿¡æ¯ï¼Œè¿˜èƒ½ä¿®æ”¹åå‘ä»£ç†åç«¯ service æœåŠ¡çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚å¯¹ <code>https://myapp2.test.com</code> æé«˜å®‰å…¨ç­–ç•¥ï¼Œå¼ºåˆ¶å¯ç”¨ HSTS</p><p>HSTSï¼šå³ HTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨å“åº”å¤´ï¼Œæ”¶åˆ°è¯¥å“åº”å¤´çš„æµè§ˆå™¨ä¼šåœ¨ 63072000sï¼ˆçº¦ 2 å¹´ï¼‰çš„æ—¶é—´å†…ï¼Œåªè¦è®¿é—®è¯¥ç½‘ç«™ï¼Œå³ä½¿è¾“å…¥çš„æ˜¯ httpï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è·³è½¬åˆ° httpsã€‚ï¼ˆHSTS æ˜¯æµè§ˆå™¨ç«¯çš„è·³è½¬ï¼Œä¹‹å‰çš„ HTTP é‡å®šå‘åˆ° HTTPS æ˜¯æœåŠ¡å™¨ç«¯çš„è·³è½¬ï¼‰</p><p>åˆ›å»º ingressRoute å’Œ headers ä¸­é—´ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp2-tls</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>websecure</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp2.test.com`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp2</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span> 
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>hsts-header-middleware</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>tls</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>secretName</span>: <span style=color:#f99b15>myapp2-tls        </span> <span style=color:#776e71># æŒ‡å®štlsè¯ä¹¦åç§°</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>hsts-header-middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>headers</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>customResponseHeaders</span>:
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>Strict-Transport-Security</span>: <span style=color:#48b685>&#39;max-age=63072000&#39;</span>
</span></span></code></pre></div><p>è®¿é—®æµ‹è¯•</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl -kI https://myapp2.test.com</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#f99b15>200</span> OK
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span><span style=display:flex><span>Content-Length: <span style=color:#f99b15>65</span>
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Date: Wed, <span style=color:#f99b15>19</span> Apr <span style=color:#f99b15>2023</span> 08:37:07 GMT
</span></span><span style=display:flex><span>Etag: <span style=color:#48b685>&#34;5a9251f0-41&#34;</span>
</span></span><span style=display:flex><span>Last-Modified: Sun, <span style=color:#f99b15>25</span> Feb <span style=color:#f99b15>2018</span> 06:04:32 GMT
</span></span><span style=display:flex><span>Server: nginx/1.12.2
</span></span><span style=display:flex><span>Strict-Transport-Security: max-age<span style=color:#5bc4bf>=</span><span style=color:#f99b15>63072000</span>   <span style=color:#776e71># headers æ’ä»¶æ·»åŠ çš„å“åº”å¤´</span>
</span></span></code></pre></div><h2 id=16-é™æµ--ratelimit>1.6 é™æµ -rateLimit<a hidden class=anchor aria-hidden=true href=#16-é™æµ--ratelimit>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/ratelimit/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæµé‡é™åˆ¶ä¹Ÿæ˜¯ç»å¸¸ç”¨åˆ°çš„ï¼Œå®ƒå¯ä»¥ç”¨ä½œå®‰å…¨ç›®çš„ï¼Œæ¯”å¦‚å¯ä»¥å‡æ…¢æš´åŠ›å¯†ç ç ´è§£çš„é€Ÿç‡ã€‚é€šè¿‡å°†ä¼ å…¥è¯·æ±‚çš„é€Ÿç‡é™åˆ¶ä¸ºçœŸå®ç”¨æˆ·çš„å…¸å‹å€¼ï¼Œå¹¶æ ‡è¯†ç›®æ ‡ URL åœ°å€ (é€šè¿‡æ—¥å¿—)ï¼Œè¿˜å¯ä»¥ç”¨æ¥æŠµå¾¡ DDOS æ”»å‡»ã€‚æ›´å¸¸è§çš„æƒ…å†µï¼Œè¯¥åŠŸèƒ½è¢«ç”¨æ¥ä¿æŠ¤ä¸‹æ¸¸åº”ç”¨æœåŠ¡å™¨ä¸è¢«åŒæ—¶å¤ªå¤šç”¨æˆ·è¯·æ±‚æ‰€å‹å®ã€‚</p><p>åˆ›å»º ingressRoute å’Œ rateLimit ä¸­é—´ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp1.test.com`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1  </span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>   
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>rate-limit-middleware</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>rate-limit-middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>: 
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>rateLimit</span>:    <span style=color:#776e71># æŒ‡å®š 1s å†…è¯·æ±‚æ•°å¹³å‡å€¼ä¸å¤§äº 10 ä¸ªï¼Œé«˜å³°æœ€å¤§å€¼ä¸å¤§äº 50 ä¸ªã€‚</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>burst</span>: <span style=color:#f99b15>10</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>average</span>: <span style=color:#f99b15>50</span>
</span></span></code></pre></div><p>å‹åŠ›æµ‹è¯•ï¼Œä½¿ç”¨ ab å·¥å…·è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œä¸€å…±è¯·æ±‚ 100 æ¬¡ï¼Œæ¯æ¬¡å¹¶å‘ 10ã€‚æµ‹è¯•ç»“æœå¤±è´¥çš„è¯·æ±‚ä¸º 72 æ¬¡ï¼Œæ€»è€—æ—¶ 0.409 ç§’</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ab -n 100 -c 10 &#34;http://myapp1.test.com/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#f99b15>10</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#815ba4>for</span> tests:   0.409 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#f99b15>100</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#f99b15>72</span>
</span></span><span style=display:flex><span>   <span style=color:#5bc4bf>(</span>Connect: 0, Receive: 0, Length: 72, Exceptions: 0<span style=color:#5bc4bf>)</span>
</span></span><span style=display:flex><span>Non-2xx responses:      <span style=color:#f99b15>72</span>
</span></span></code></pre></div><h2 id=17-ç†”æ–­--circuitbreaker>1.7 ç†”æ–­ -circuitBreaker<a hidden class=anchor aria-hidden=true href=#17-ç†”æ–­--circuitbreaker>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/circuitbreaker/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>æœåŠ¡ç†”æ–­çš„ä½œç”¨ç±»ä¼¼äºä¿é™©ä¸ï¼Œå½“æŸæœåŠ¡å‡ºç°ä¸å¯ç”¨æˆ–å“åº”è¶…æ—¶çš„æƒ…å†µæ—¶ï¼Œä¸ºäº†é˜²æ­¢æ•´ä¸ªç³»ç»Ÿå‡ºç°é›ªå´©ï¼Œæš‚æ—¶åœæ­¢å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨ã€‚</p><p>ç†”æ–­å™¨ä¸‰ç§çŠ¶æ€</p><ul><li>Closedï¼šå…³é—­çŠ¶æ€ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æ­£å¸¸è®¿é—®ã€‚</li><li>Openï¼šæ‰“å¼€çŠ¶æ€ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«é™çº§ã€‚traefik ä¼šå¯¹è¯·æ±‚æƒ…å†µè®¡æ•°ï¼Œå½“ä¸€å®šæ—¶é—´å†…å¤±è´¥è¯·æ±‚ç™¾åˆ†æ¯”è¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œæ–­è·¯å™¨ä¼šå®Œå…¨æ‰“å¼€ã€‚</li><li>Recoveringï¼šåŠå¼€æ¢å¤çŠ¶æ€ï¼Œopen çŠ¶æ€ä¸æ˜¯æ°¸ä¹…çš„ï¼Œæ‰“å¼€åä¼šè¿›å…¥ä¼‘çœ æ—¶é—´ã€‚éšåæ–­è·¯å™¨ä¼šè‡ªåŠ¨è¿›å…¥åŠå¼€çŠ¶æ€ã€‚æ­¤æ—¶ä¼šé‡Šæ”¾éƒ¨åˆ†è¯·æ±‚é€šè¿‡ï¼Œè‹¥è¿™äº›è¯·æ±‚éƒ½æ˜¯å¥åº·çš„ï¼Œåˆ™ä¼šå®Œå…¨å…³é—­æ–­è·¯å™¨ï¼Œå¦åˆ™ç»§ç»­ä¿æŒæ‰“å¼€ï¼Œå†æ¬¡è¿›è¡Œä¼‘çœ è®¡æ—¶</li></ul><p>æœåŠ¡ç†”æ–­åŸç† (æ–­è·¯å™¨çš„åŸç†)</p><p>ç»Ÿè®¡ç”¨æˆ·åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´ï¼ˆé»˜è®¤ 10sï¼‰ä¹‹å†…çš„è¯·æ±‚æ€»æ•°è¾¾åˆ°æŒ‡å®šçš„æ•°é‡ä¹‹åï¼Œå¦‚æœä¸å¥åº·çš„è¯·æ±‚ (è¶…æ—¶ã€å¼‚å¸¸) å æ€»è¯·æ±‚æ•°é‡çš„ç™¾åˆ†æ¯”ï¼ˆ50%ï¼‰è¾¾åˆ°äº†æŒ‡å®šçš„é˜ˆå€¼ä¹‹åï¼Œå°±ä¼šè§¦å‘ç†”æ–­ã€‚è§¦å‘ç†”æ–­ï¼Œæ–­è·¯å™¨å°±ä¼šæ‰“å¼€ (open),æ­¤æ—¶æ‰€æœ‰è¯·æ±‚éƒ½ä¸èƒ½é€šè¿‡ã€‚åœ¨ 5s ä¹‹åï¼Œæ–­è·¯å™¨ä¼šæ¢å¤åˆ°åŠå¼€çŠ¶æ€ (half open)ï¼Œä¼šå…è®¸å°‘é‡è¯·æ±‚é€šè¿‡ï¼Œå¦‚æœè¿™äº›è¯·æ±‚éƒ½æ˜¯å¥åº·çš„ï¼Œé‚£ä¹ˆæ–­è·¯å™¨ä¼šå›åˆ°å…³é—­çŠ¶æ€ (close).å¦‚æœè¿™äº›è¯·æ±‚è¿˜æ˜¯å¤±è´¥çš„è¯·æ±‚,æ–­è·¯å™¨è¿˜æ˜¯æ¢å¤åˆ°æ‰“å¼€çš„çŠ¶æ€ (open).</p><p>traefik æ”¯æŒçš„è§¦å‘å™¨</p><ul><li>NetworkErrorRatioï¼šç½‘ç»œé”™è¯¯ç‡</li><li>ResponseCodeRatioï¼šçŠ¶æ€ä»£ç æ¯”ç‡</li><li>LatencyAtQuantileMSï¼šåˆ†ä½æ•°çš„å»¶è¿Ÿï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰</li></ul><p>åˆ›å»º ingressRoute ï¼Œæ·»åŠ  circuitBreaker ä¸­é—´ä»¶ï¼ŒæŒ‡å®š 50% çš„è¯·æ±‚æ¯”ä¾‹å“åº”æ—¶é—´å¤§äº 1MS æ—¶ç†”æ–­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`myapp1.test.com`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1  </span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>   
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>circuit-breaker-middleware</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>circuit-breaker-middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>circuitBreaker</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>expression</span>: <span style=color:#f99b15>LatencyAtQuantileMS(50.0) &gt; 1</span>
</span></span></code></pre></div><p>å‹åŠ›æµ‹è¯•ï¼Œä¸€å…±è¯·æ±‚ 1000 æ¬¡ï¼Œæ¯æ¬¡å¹¶å‘ 100 æ¬¡ã€‚è§¦å‘ç†”æ–­æœºåˆ¶ï¼Œæµ‹è¯•ç»“æœå¤±è´¥çš„è¯·æ±‚ä¸º 999 æ¬¡ï¼Œæ€»è€—æ—¶ 1.742 ç§’ã€‚</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 traefik<span style=color:#5bc4bf>]</span><span style=color:#776e71># ab -n 1000 -c 100  &#34;http://myapp1.test.com/&#34;</span>
</span></span><span style=display:flex><span>Concurrency Level:      <span style=color:#f99b15>100</span>
</span></span><span style=display:flex><span>Time taken <span style=color:#815ba4>for</span> tests:   1.742 seconds
</span></span><span style=display:flex><span>Complete requests:      <span style=color:#f99b15>1000</span>
</span></span><span style=display:flex><span>Failed requests:        <span style=color:#f99b15>999</span>
</span></span><span style=display:flex><span>   <span style=color:#5bc4bf>(</span>Connect: 0, Receive: 0, Length: 2, Exceptions: 0<span style=color:#5bc4bf>)</span>
</span></span><span style=display:flex><span>Write errors:           <span style=color:#f99b15>0</span>
</span></span><span style=display:flex><span>Non-2xx responses:      <span style=color:#f99b15>999</span>
</span></span></code></pre></div><h2 id=18-è‡ªå®šä¹‰é”™è¯¯é¡µ--errorpages>1.8 è‡ªå®šä¹‰é”™è¯¯é¡µ -errorPages<a hidden class=anchor aria-hidden=true href=#18-è‡ªå®šä¹‰é”™è¯¯é¡µ--errorpages>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/errorpages/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>åœ¨å®é™…çš„ä¸šåŠ¡ä¸­ï¼Œè‚¯å®šä¼šå­˜åœ¨ <code>4XX</code> <code>5XX</code> ç›¸å…³çš„é”™è¯¯å¼‚å¸¸ï¼Œå¦‚æœæ¯ä¸ªåº”ç”¨éƒ½å¼€å‘ä¸€ä¸ªå•ç‹¬çš„é”™è¯¯é¡µï¼Œæ— ç–‘å¤§å¤§å¢åŠ äº†å¼€å‘æˆæœ¬ï¼Œtraefik åŒæ ·ä¹Ÿæ”¯æŒè‡ªå®šä¹‰é”™è¯¯é¡µï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé”™è¯¯é¡µé¢ä¸æ˜¯ç”± traefik å­˜å‚¨å¤„ç†ï¼Œè€Œæ˜¯é€šè¿‡å®šä¹‰ä¸­é—´ä»¶ï¼Œå°†é”™è¯¯çš„è¯·æ±‚é‡å®šå‘åˆ°å…¶ä»–çš„é¡µé¢ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåº”ç”¨ã€‚è¿™ä¸ª web åº”ç”¨çš„åŠŸèƒ½æ˜¯ï¼š</p><ul><li>å½“è¯·æ±‚ / æ—¶ï¼Œè¿”å›çŠ¶æ€ç ä¸º 200</li><li>å½“è¯·æ±‚ /400 æ—¶ï¼Œè¿”å› 400 çŠ¶æ€ç </li><li>å½“è¯·æ±‚ /500 æ—¶ï¼Œè¿”å› 500 çŠ¶æ€ç </li></ul><p>åˆ›å»º deployment svc</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>app</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>app</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>image</span>: <span style=color:#f99b15>cuiliang0302/request-code:v2.0</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>imagePullPolicy</span>: <span style=color:#f99b15>IfNotPresent</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#5bc4bf>limits</span>:
</span></span><span style=display:flex><span>            <span style=color:#5bc4bf>memory</span>: <span style=color:#48b685>&#34;128Mi&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#5bc4bf>cpu</span>: <span style=color:#48b685>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#5bc4bf>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#5bc4bf>containerPort</span>: <span style=color:#f99b15>5000</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>v1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Service</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>type</span>: <span style=color:#f99b15>ClusterIP</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>app</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>5000</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>targetPort</span>: <span style=color:#f99b15>5000</span>
</span></span></code></pre></div><p>åˆ›å»º ingressRoute</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`flask.test.com`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask  </span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>5000</span> 
</span></span></code></pre></div><p>è®¿é—®æµ‹è¯•ï¼Œæ¨¡æ‹Ÿ 400 500 é”™è¯¯</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl -I http://flask.test.com</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#f99b15>200</span> OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl -I http://flask.test.com/400</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#f99b15>400</span> Bad Request
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl -I http://flask.test.com/500</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#f99b15>500</span> Internal Server Error
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl -I http://flask.test.com/404</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#f99b15>404</span> Not Found
</span></span></code></pre></div><p>ç°åœ¨æå‡ºä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œå½“æˆ‘è®¿é—® flask é¡¹ç›®æ—¶ï¼Œå¦‚æœé”™è¯¯ç ä¸º 400ï¼Œè¿”å› myapp1 çš„é¡µé¢ï¼Œå¦‚æœé”™è¯¯ç ä¸º 500ï¼Œè¿”å› myapp2 çš„é¡µé¢ (å‰ææ˜¯ myapp1 å’Œ myapp2 æœåŠ¡å·²åˆ›å»º)ã€‚</p><p>åˆ›å»º errors ä¸­é—´ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>errors5</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>errors</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>status</span>:
</span></span><span style=display:flex><span>      - <span style=color:#48b685>&#34;500-599&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71># query: /{status}.html   # å¯ä»¥ä¸ºæ¯ä¸ªé¡µé¢å®šä¹‰ä¸€ä¸ªçŠ¶æ€ç ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š5XXä½¿ç”¨ç»Ÿä¸€é¡µé¢è¿”å›</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>query </span>: <span style=color:#f99b15>/                </span> <span style=color:#776e71># æŒ‡å®šè¿”å›myapp2çš„è¯·æ±‚è·¯å¾„</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>service</span>:
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp2</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>errors4</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>errors</span>:
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>status</span>:
</span></span><span style=display:flex><span>      - <span style=color:#48b685>&#34;400-499&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#776e71># query: /{status}.html   # å¯ä»¥ä¸ºæ¯ä¸ªé¡µé¢å®šä¹‰ä¸€ä¸ªçŠ¶æ€ç ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š5XXä½¿ç”¨ç»Ÿä¸€é¡µé¢è¿”å›</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>query </span>: <span style=color:#f99b15>/                </span> <span style=color:#776e71># æŒ‡å®šè¿”å›myapp1çš„è¯·æ±‚è·¯å¾„</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>service</span>:
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>myapp1</span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>80</span>
</span></span></code></pre></div><p>ä¿®æ”¹ ingressRoute</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`flask.test.com`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask  </span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>5000</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>errors4</span>
</span></span><span style=display:flex><span>      - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>errors5</span>
</span></span></code></pre></div><p>è®¿é—®æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ° 400 é¡µé¢å’Œ 500 é¡µé¢å·²ç»æˆåŠŸé‡å®šå‘äº†</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl http://flask.test.com/</span>
</span></span><span style=display:flex><span>&lt;!DOCTYPE html&gt;
</span></span><span style=display:flex><span>&lt;html <span style=color:#ef6155>lang</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;head&gt;
</span></span><span style=display:flex><span>    &lt;meta <span style=color:#ef6155>charset</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;title&gt;flask&lt;/title&gt;
</span></span><span style=display:flex><span>&lt;/head&gt;
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>&lt;h1&gt;hello flask&lt;/h1&gt;
</span></span><span style=display:flex><span>&lt;img <span style=color:#ef6155>src</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;/static/photo.jpg&#34;</span> <span style=color:#ef6155>alt</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;photo&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl http://flask.test.com/400</span>
</span></span><span style=display:flex><span>Hello MyApp | Version: v1 | &lt;a <span style=color:#ef6155>href</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;hostname.html&#34;</span>&gt;Pod Name&lt;/a&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@k8s-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># curl http://flask.test.com/500</span>
</span></span><span style=display:flex><span>Hello MyApp | Version: v2 | &lt;a <span style=color:#ef6155>href</span><span style=color:#5bc4bf>=</span><span style=color:#48b685>&#34;hostname.html&#34;</span>&gt;Pod Name&lt;/a&gt;
</span></span></code></pre></div><h2 id=19-æ•°æ®å‹ç¼©--compress>1.9 æ•°æ®å‹ç¼© -compress<a hidden class=anchor aria-hidden=true href=#19-æ•°æ®å‹ç¼©--compress>#</a></h2><p><a href=https://doc.traefik.io/traefik/middlewares/http/compress/ target=_blank rel=noopener style=color:#42b983 ;>å®˜æ–¹æ–‡æ¡£</a></p><p>æœ‰æ—¶å€™å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼šä¼ è¾“æ¯”è¾ƒå¤§çš„æŠ¥æ–‡æ•°æ®ï¼Œè¿™æ—¶å€™å°±å ç”¨è¾ƒå¤§çš„ç½‘ç»œå¸¦å®½å’Œæ—¶é•¿ã€‚ä¸ºäº†èŠ‚çœå¸¦å®½ï¼ŒåŠ é€ŸæŠ¥æ–‡çš„å“åº”é€Ÿé€Ÿï¼Œå¯ä»¥å°†ä¼ è¾“çš„æŠ¥æ–‡æ•°æ®å…ˆè¿›è¡Œå‹ç¼©ï¼Œç„¶åå†è¿›è¡Œä¼ è¾“ï¼Œtraefik ä¹ŸåŒæ ·æ”¯æŒæ•°æ®å‹ç¼©ã€‚</p><p>traefik é»˜è®¤åªå¯¹å¤§äº 1024 å­—èŠ‚ï¼Œä¸”è¯·æ±‚æ ‡å¤´åŒ…å« <code>Accept-Encoding gzip</code> çš„èµ„æºè¿›è¡Œå‹ç¼©ã€‚å¯ä»¥æŒ‡å®šæ’é™¤ç‰¹å®šç±»å‹ä¸å¯ç”¨å‹ç¼©æˆ–è€…æ ¹æ®å†…å®¹å¤§å°æ¥å†³å®šæ˜¯å¦å‹ç¼©ã€‚</p><p>ç»§ç»­ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ flask åº”ç”¨ï¼Œç°åœ¨åˆ›å»ºä¸­é—´ä»¶å¹¶ä¿®æ”¹ ingressRouteï¼Œä½¿ç”¨é»˜è®¤é…ç½®ç­–ç•¥å³å¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>IngressRoute</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>entryPoints</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f99b15>web</span>
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>routes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#5bc4bf>match</span>: <span style=color:#f99b15>Host(`flask.test.com`)</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Rule</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>services</span>:
</span></span><span style=display:flex><span>    - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>flask  </span>
</span></span><span style=display:flex><span>      <span style=color:#5bc4bf>port</span>: <span style=color:#f99b15>5000</span>
</span></span><span style=display:flex><span>    <span style=color:#5bc4bf>middlewares</span>:
</span></span><span style=display:flex><span>      - <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>compress</span>
</span></span><span style=display:flex><span><span style=color:#fec418>---</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>apiVersion</span>: <span style=color:#f99b15>traefik.containo.us/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>kind</span>: <span style=color:#f99b15>Middleware</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>name</span>: <span style=color:#f99b15>compress</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#5bc4bf>compress</span>: {}  
</span></span></code></pre></div><p>è®¿é—®æµ‹è¯•</p><p>html æ–‡ä»¶å°äº 1024 å­—èŠ‚ï¼Œæœªå¼€å¯å‹ç¼©</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20230419175108058.png alt=image-20230419175108058 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20230419175108058.png alt=image-20230419175108058></noscript></p><p>å›¾ç‰‡èµ„æºå¤§äº 1024 å­—èŠ‚ï¼Œå¼€å¯äº†å‹ç¼©</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20230419175324586.png alt=image-20230419175324586 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20230419175324586.png alt=image-20230419175324586></noscript></p><p>ä»¥ä¸Š</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://image.lvbibir.cn/blog/wechatpay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://image.lvbibir.cn/blog/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick="var qr=document.getElementById('QR');qr.style.opacity==='0'?qr.style.opacity='1':qr.style.opacity='0'">
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/posts/tech/kubernetes-traefik-4-traefikservice/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>traefik (å››) TraefikService æœåŠ¡</span></a>
<a class=next href=https://www.lvbibir.cn/posts/tech/kubernetes-traefik-2-router/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>traefik (äºŒ) ingressRoute è·¯ç”±</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=https://image.lvbibir.cn/js/twikoo/1.6.44/twikoo.min.js></script><script>twikoo.init({envId:"https://www.lvbibir.cn/twikoo/",el:"#tcomment",lang:'zh-CN',path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><a href=https://gohugo.io/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/frame-hugo-blue.svg></a>
<a href=https://github.com/adityatelange/hugo-PaperMod target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/theme-papermod-lightgrey.svg></a>
<a href=https://cn.aliyun.com/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/å›¾åºŠ-é˜¿é‡Œäº‘-orange.svg></a><br><span id=runtime_span></span>
<script type=text/javascript>function show_runtime(){window.setTimeout("show_runtime()",1e3),X=new Date("7/13/2021 1:00:00"),Y=new Date,T=Y.getTime()-X.getTime(),M=24*60*60*1e3,a=T/M,A=Math.floor(a),b=(a-A)*24,B=Math.floor(b),c=(b-B)*60,C=Math.floor((b-B)*60),D=Math.floor((c-C)*60),runtime_span.innerHTML="ç½‘ç«™å·²è¿è¡Œ"+A+"å¤©"+B+"å°æ—¶"+C+"åˆ†"+D+"ç§’"}show_runtime()</script>|
<script defer src=https://www.lvbibir.cn/busuanzi/js></script>
<span id=busuanzi_container>æ€»è®¿å®¢æ•°: <span id=busuanzi_site_uv></span>
|
æ€»è®¿é—®é‡: <span id=busuanzi_site_pv></span></span><br><a href=https://beian.miit.gov.cn/ target=_blank style="border-bottom:1px solid">äº¬ICPå¤‡2021023168å·-1</a>&nbsp;
|
<span>Copyright
&copy;
2020-2025
<a href=https://www.lvbibir.cn style="border-bottom:1px solid">lvbibir's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener('scroll',function(){const e=document.getElementById("read_progress"),t=document.documentElement.scrollHeight,n=document.documentElement.clientHeight,s=document.documentElement.scrollTop||document.body.scrollTop;e.innerText=((s/(t-n)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(s=>{const n=s.parentNode.parentNode,e=document.createElement('button');e.classList.add('copy-code'),e.innerText='ğŸ“„å¤åˆ¶';function l(){e.innerText='ğŸ‘ŒğŸ»å·²å¤åˆ¶!',setTimeout(()=>{e.innerText='ğŸ“„å¤åˆ¶'},2e3)}e.addEventListener('click',n=>{const e=document.createRange();e.selectNodeContents(s);const t=window.getSelection();t.removeAllRanges(),t.addRange(e);try{document.execCommand('copy'),l()}catch(e){}t.removeRange(e)});let c=s.className.replaceAll("language-",""),t=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");o.innerText=c,t.setAttribute('class','mac-tool'),i.setAttribute('class','mac bb1'),a.setAttribute('class','mac bb2'),r.setAttribute('class','mac bb3'),o.setAttribute('class','language-type'),t.appendChild(i),t.appendChild(a),t.appendChild(r),t.appendChild(o),n.classList.contains("highlight")?(n.appendChild(e),n.appendChild(t)):n.parentNode.firstChild===n||(s.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName==="TABLE"?(s.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e),n.appendChild(t)):(s.parentNode.appendChild(e),n.appendChild(t)))})</script></body></html>