<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>shell | æœåŠ¡å™¨å·¡æ£€è„šæœ¬ | lvbibir's Blog</title><meta name=keywords content="linux"><meta name=description content="#!/bin/bash #å‚æ•°å®šä¹‰ date=`date +&#34;%Y-%m-%d-%H:%M:%S&#34;` centosVersion=$(awk '{print $(NF-1)}' /etc/redhat-release) VERSION=`date +%F` #æ—¥å¿—ç›¸å…³ LOGPATH=&#34;/tmp/awr&#34; [ -e $LOGPATH ] || mkdir -p $LOGPATH RESULTFILE=&#34;$LOGPATH/HostCheck-`hostname`-`date +%Y%m%d`.txt&#34; #è°ƒç”¨å‡½æ•°åº“ [ -f /etc/init.d/functions ] && source /etc/init.d/functions export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile #rootç”¨æˆ·æ‰§è¡Œè„šæœ¬ [ $(id -u) -gt 0 ] && echo &#34"><meta name=author content="
ä½œè€…:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/posts/tech/shell-server-inspection/><link crossorigin=anonymous href=/assets/css/stylesheet.cbbbb48b0be8cd10a489358e70f2e741e106efe3c38b5fda79478d00f11d160e.css integrity="sha256-y7u0iwvozRCkiTWOcPLnQeEG7+PDi1/aeUeNAPEdFg4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=16x16 href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=32x32 href=https://www.lvbibir.cn/img/avatar.gif><link rel=apple-touch-icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=mask-icon href=https://www.lvbibir.cn/img/avatar.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script src=https://kit.fontawesome.com/2e34783cd8.js crossorigin=anonymous></script><meta property="og:title" content="shell | æœåŠ¡å™¨å·¡æ£€è„šæœ¬"><meta property="og:description" content="#!/bin/bash #å‚æ•°å®šä¹‰ date=`date +&#34;%Y-%m-%d-%H:%M:%S&#34;` centosVersion=$(awk '{print $(NF-1)}' /etc/redhat-release) VERSION=`date +%F` #æ—¥å¿—ç›¸å…³ LOGPATH=&#34;/tmp/awr&#34; [ -e $LOGPATH ] || mkdir -p $LOGPATH RESULTFILE=&#34;$LOGPATH/HostCheck-`hostname`-`date +%Y%m%d`.txt&#34; #è°ƒç”¨å‡½æ•°åº“ [ -f /etc/init.d/functions ] && source /etc/init.d/functions export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile #rootç”¨æˆ·æ‰§è¡Œè„šæœ¬ [ $(id -u) -gt 0 ] && echo &#34"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/posts/tech/shell-server-inspection/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-09-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="shell | æœåŠ¡å™¨å·¡æ£€è„šæœ¬"><meta name=twitter:description content="#!/bin/bash #å‚æ•°å®šä¹‰ date=`date +&#34;%Y-%m-%d-%H:%M:%S&#34;` centosVersion=$(awk '{print $(NF-1)}' /etc/redhat-release) VERSION=`date +%F` #æ—¥å¿—ç›¸å…³ LOGPATH=&#34;/tmp/awr&#34; [ -e $LOGPATH ] || mkdir -p $LOGPATH RESULTFILE=&#34;$LOGPATH/HostCheck-`hostname`-`date +%Y%m%d`.txt&#34; #è°ƒç”¨å‡½æ•°åº“ [ -f /etc/init.d/functions ] && source /etc/init.d/functions export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile #rootç”¨æˆ·æ‰§è¡Œè„šæœ¬ [ $(id -u) -gt 0 ] && echo &#34"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"ğŸ“š æ–‡ç« ","item":"https://www.lvbibir.cn/posts/"},{"@type":"ListItem","position":3,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://www.lvbibir.cn/posts/tech/"},{"@type":"ListItem","position":4,"name":"shell | æœåŠ¡å™¨å·¡æ£€è„šæœ¬","item":"https://www.lvbibir.cn/posts/tech/shell-server-inspection/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"shell | æœåŠ¡å™¨å·¡æ£€è„šæœ¬","name":"shell | æœåŠ¡å™¨å·¡æ£€è„šæœ¬","description":"#!/bin/bash #å‚æ•°å®šä¹‰ date=`date +\u0026#34;%Y-%m-%d-%H:%M:%S\u0026#34;` centosVersion=$(awk \u0026#39;{print $(NF-1)}\u0026#39; /etc/redhat-release) VERSION=`date +%F` #æ—¥å¿—ç›¸å…³ LOGPATH=\u0026#34;/tmp/awr\u0026#34; [ -e $LOGPATH ] || mkdir -p $LOGPATH RESULTFILE=\u0026#34;$LOGPATH/HostCheck-`hostname`-`date +%Y%m%d`.txt\u0026#34; #è°ƒç”¨å‡½æ•°åº“ [ -f /etc/init.d/functions ] \u0026amp;\u0026amp; source /etc/init.d/functions export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile #rootç”¨æˆ·æ‰§è¡Œè„šæœ¬ [ $(id -u) -gt 0 ] \u0026amp;\u0026amp; echo \u0026#34","keywords":["linux"],"articleBody":"#!/bin/bash #å‚æ•°å®šä¹‰ date=`date +\"%Y-%m-%d-%H:%M:%S\"` centosVersion=$(awk '{print $(NF-1)}' /etc/redhat-release) VERSION=`date +%F` #æ—¥å¿—ç›¸å…³ LOGPATH=\"/tmp/awr\" [ -e $LOGPATH ] || mkdir -p $LOGPATH RESULTFILE=\"$LOGPATH/HostCheck-`hostname`-`date +%Y%m%d`.txt\" #è°ƒç”¨å‡½æ•°åº“ [ -f /etc/init.d/functions ] \u0026\u0026 source /etc/init.d/functions export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile #rootç”¨æˆ·æ‰§è¡Œè„šæœ¬ [ $(id -u) -gt 0 ] \u0026\u0026 echo \"è¯·ç”¨rootç”¨æˆ·æ‰§è¡Œæ­¤è„šæœ¬ï¼\" \u0026\u0026 exit 1 function version(){ echo \"\" echo \"\" echo \"[${date}] \u003e\u003e\u003e `hostname -s` ä¸»æœºå·¡æ£€\" } function getSystemStatus(){ echo \"\" echo -e \"\\033[33m****************************************************ç³»ç»Ÿæ£€æŸ¥****************************************************\\033[0m\" if [ -e /etc/sysconfig/i18n ];then default_LANG=\"$(grep \"LANG=\" /etc/sysconfig/i18n | grep -v \"^#\" | awk -F '\"' '{print $2}')\" else default_LANG=$LANG fi export LANG=\"en_US.UTF-8\" Release=$(cat /etc/redhat-release 2\u003e/dev/null) Kernel=$(uname -r) OS=$(uname -o) Hostname=$(uname -n) SELinux=$(/usr/sbin/sestatus | grep \"SELinux status: \" | awk '{print $3}') LastReboot=$(who -b | awk '{print $3,$4}') uptime=$(uptime | sed 's/.*up \\([^,]*\\), .*/\\1/') echo \" ç³»ç»Ÿï¼š$OS\" echo \" å‘è¡Œç‰ˆæœ¬ï¼š$Release\" echo \" å†…æ ¸ï¼š$Kernel\" echo \" ä¸»æœºåï¼š$Hostname\" echo \" SELinuxï¼š$SELinux\" echo \"è¯­è¨€/ç¼–ç ï¼š$default_LANG\" echo \" å½“å‰æ—¶é—´ï¼š$(date +'%F %T')\" echo \" æœ€åå¯åŠ¨ï¼š$LastReboot\" echo \" è¿è¡Œæ—¶é—´ï¼š$uptime\" export LANG=\"$default_LANG\" } function getCpuStatus(){ echo \"\" echo -e \"\\033[33m****************************************************CPUæ£€æŸ¥*****************************************************\\033[0m\" Physical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l) Virt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l) CPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}') CPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq) CPU_Arch=$(uname -m) echo \"ç‰©ç†CPUä¸ªæ•°:$Physical_CPUs\" echo \"é€»è¾‘CPUä¸ªæ•°:$Virt_CPUs\" echo \"æ¯CPUæ ¸å¿ƒæ•°:$CPU_Kernels\" echo \" CPUå‹å·:$CPU_Type\" echo \" CPUæ¶æ„:$CPU_Arch\" } function getMemStatus(){ echo \"\" echo -e \"\\033[33m**************************************************å†…å­˜æ£€æŸ¥*****************************************************\\033[0m\" if [[ $centosVersion \u003c 7 ]];then free -mo else free -h fi #æŠ¥è¡¨ä¿¡æ¯ MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}') #KB MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}') #KB let MemUsed=MemTotal-MemFree MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\") } function getDiskStatus(){ echo \"\" echo -e \"\\033[33m**************************************************ç£ç›˜æ£€æŸ¥******************************************************\\033[0m\" df -hiP | sed 's/Mounted on/Mounted/'\u003e /tmp/inode df -hTP | sed 's/Mounted on/Mounted/'\u003e /tmp/disk join /tmp/disk /tmp/inode | awk '{print $1,$2,\"|\",$3,$4,$5,$6,\"|\",$8,$9,$10,$11,\"|\",$12}'| column -t #æŠ¥è¡¨ä¿¡æ¯ diskdata=$(df -TP | sed '1d' | awk '$2!=\"tmpfs\"{print}') #KB disktotal=$(echo \"$diskdata\" | awk '{total+=$3}END{print total}') #KB diskused=$(echo \"$diskdata\" | awk '{total+=$4}END{print total}') #KB diskfree=$((disktotal-diskused)) #KB diskusedpercent=$(echo $disktotal $diskused | awk '{if($1==0){printf 100}else{printf \"%.2f\",$2*100/$1}}') inodedata=$(df -iTP | sed '1d' | awk '$2!=\"tmpfs\"{print}') inodetotal=$(echo \"$inodedata\" | awk '{total+=$3}END{print total}') inodeused=$(echo \"$inodedata\" | awk '{total+=$4}END{print total}') inodefree=$((inodetotal-inodeused)) inodeusedpercent=$(echo $inodetotal $inodeused | awk '{if($1==0){printf 100}else{printf \"%.2f\",$2*100/$1}}') } function get_resource(){ echo \"\" echo -e \"\\033[33m**************************************************èµ„æºæ¶ˆè€—ç»Ÿè®¡**************************************************\\033[0m\" echo -e \"\\033[36m*************å¸¦å®½èµ„æºæ¶ˆè€—ç»Ÿè®¡*************\\033[0m\" #ç”¨æ•°ç»„å­˜æ”¾ç½‘å¡å nic=(`ifconfig | grep ^[a-z] | grep -vE 'lo|docker0'| awk -F: '{print $1}'`) time=`date \"+%Y-%m-%d %k:%M\"` num=0 for ((i=0;i\u003c${#nic[@]};i++)) do #å¾ªç¯äº”æ¬¡ï¼Œé¿å…çœ‹åˆ°çš„æ˜¯å¶ç„¶çš„æ•°æ® while (( $num\u003c5 )) do rx_before=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : \" \" | awk '{print $2}') tx_before=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : \" \" | awk '{print $10}') sleep 2 #ç”¨sedå…ˆè·å–ç¬¬7åˆ—,å†ç”¨awkè·å–ç¬¬2åˆ—ï¼Œå†cutåˆ‡å‰²,ä»ç¬¬7ä¸ªåˆ°æœ€åï¼Œå³åªåˆ‡å‰²ç½‘å¡æµé‡æ•°å­—éƒ¨åˆ† rx_after=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : \" \" | awk '{print $2}') tx_after=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : \" \" | awk '{print $10}') #æ³¨æ„ä¸‹é¢æˆªå–çš„ç›¸å·®2ç§’çš„ä¸¤ä¸ªæ—¶åˆ»çš„ç´¯è®¡å’Œå‘é€çš„bytes(å³ç´¯è®¡ä¼ é€å’Œæ¥æ”¶çš„ä½) rx_result=$[(rx_after-rx_before)/1024/1024/2*8] tx_result=$[(tx_after-tx_before)/1024/1024/2*8] echo \"$time Now_In_Speed: $rx_result Mbps Now_OUt_Speed: $tx_result Mbps\" \u003e\u003e /tmp/network.txt let \"num++\" done #æ³¨æ„ä¸‹é¢grepåé¢çš„$timeå˜é‡è¦ç”¨åŒå¼•å·æ‹¬èµ·æ¥ rx_result=$(cat /tmp/network.txt|grep \"$time\"|awk '{In+=$4}END{print In}') tx_result=$(cat /tmp/network.txt|grep \"$time\"|awk '{Out+=$7}END{print Out}') In_Speed=$(echo \"scale=2;$rx_result/5\"|bc) Out_Speed=$(echo \"scale=2;$tx_result/5\"|bc) echo -e \"\\033[32m In_Speed_average: $In_Speed Mbps Out_Speed_average: $Out_Speed Mbps! \\033[0m\" done echo -e \"\\033[36m*************CPUèµ„æºæ¶ˆè€—ç»Ÿè®¡*************\\033[0m\" #ä½¿ç”¨vmstat 1 5å‘½ä»¤ç»Ÿè®¡5ç§’å†…çš„ä½¿ç”¨æƒ…å†µï¼Œå†è®¡ç®—æ¯ç§’ä½¿ç”¨æƒ…å†µ total=`vmstat 1 5|awk '{x+=$13;y+=$14}END{print x+y}'` cpu_average=$(echo \"scale=2;$total/5\"|bc) #åˆ¤æ–­CPUä½¿ç”¨ç‡ï¼ˆæµ®ç‚¹æ•°ä¸æ•´æ•°æ¯”è¾ƒï¼‰ if [ `echo \"${cpu_average} \u003e 70\" | bc` -eq 1 ];then echo -e \"\\033[31m Total CPU is already use: ${cpu_average}%,è¯·åŠæ—¶å¤„ç†ï¼\\033[0m\" else echo -e \"\\033[32m Total CPU is already use: ${cpu_average}%! \\033[0m\" fi echo -e \"\\033[36m*************ç£ç›˜èµ„æºæ¶ˆè€—ç»Ÿè®¡*************\\033[0m\" #ç£ç›˜ä½¿ç”¨æƒ…å†µ(æ³¨æ„ï¼šéœ€è¦ç”¨sedå…ˆè¿›è¡Œæ ¼å¼åŒ–æ‰èƒ½è¿›è¡Œç´¯åŠ å¤„ç†) disk_used=$(df -m | sed '1d;/ /!N;s/\\n//;s/ \\+/ /;' | awk '{used+=$3} END{print used}') disk_totalSpace=$(df -m | sed '1d;/ /!N;s/\\n//;s/ \\+/ /;' | awk '{totalSpace+=$2} END{print totalSpace}') disk_all=$(echo \"scale=4;$disk_used/$disk_totalSpace\" | bc) disk_percent1=$(echo $disk_all | cut -c 2-3) disk_percent2=$(echo $disk_all | cut -c 4-5) disk_warning=`df -m | sed '1d;/ /!N;s/\\n//;s/ \\+/ /;' | awk '{if ($5\u003e85) print $6 \"ç›®å½•ä½¿ç”¨ç‡ï¼š\" $5;} '` echo -e \"\\033[32m Total disk has used: $disk_percent1.$disk_percent2% \\033[0m\" #echo -e \"\\t\\t..\" è¡¨ç¤ºæ¢è¡Œ if [ -n \"$disk_warning\" ];then echo -e \"\\033[31m${disk_warning} \\n [Error]ä»¥ä¸Šç›®å½•ä½¿ç”¨ç‡è¶…è¿‡85%ï¼Œè¯·åŠæ—¶å¤„ç†ï¼\\033[0m\" fi echo -e \"\\033[36m*************å†…å­˜èµ„æºæ¶ˆè€—ç»Ÿè®¡*************\\033[0m\" #è·å¾—ç³»ç»Ÿæ€»å†…å­˜ memery_all=$(free -m | awk 'NR==2' | awk '{print $2}') #è·å¾—å ç”¨å†…å­˜ï¼ˆæ“ä½œç³»ç»Ÿ è§’åº¦ï¼‰ system_memery_used=$(free -m | awk 'NR==2' | awk '{print $3}') #è·å¾—bufferã€cacheå ç”¨å†…å­˜ï¼Œå½“å†…å­˜ä¸å¤Ÿæ—¶ä¼šåŠæ—¶å›æ”¶ï¼Œæ‰€ä»¥è¿™ä¸¤éƒ¨åˆ†å¯ç”¨äºå¯ç”¨å†…å­˜çš„è®¡ç®— buffer_used=$(free -m | awk 'NR==2' | awk '{print $6}') cache_used=$(free -m | awk 'NR==2' | awk '{print $7}') #è·å¾—è¢«ä½¿ç”¨å†…å­˜ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å¯ç”¨äºå¯ç”¨å†…å­˜çš„è®¡ç®—ï¼Œæ³¨æ„è®¡ç®—æ–¹æ³• actual_used_all=$[memery_all-(free+buffer_used+cache_used)] #è·å¾—å®é™…å ç”¨çš„å†…å­˜ actual_used_all=`expr $memery_all - $free + $buffer_used + $cache_used ` memery_percent=$(echo \"scale=4;$system_memery_used / $memery_all\" | bc) memery_percent2=$(echo \"scale=4; $actual_used_all / $memery_all\" | bc) percent_part1=$(echo $memery_percent | cut -c 2-3) percent_part2=$(echo $memery_percent | cut -c 4-5) percent_part11=$(echo $memery_percent2 | cut -c 2-3) percent_part22=$(echo $memery_percent2 | cut -c 4-5) #è·å¾—å ç”¨å†…å­˜ï¼ˆæ“ä½œç³»ç»Ÿè§’åº¦ï¼‰ echo -e \"\\033[32m system memery is already use: $percent_part1.$percent_part2% \\033[0m\" #è·å¾—å®é™…å†…å­˜å ç”¨ç‡ echo -e \"\\033[32m actual memery is already use: $percent_part11.$percent_part22% \\033[0m\" echo -e \"\\033[32m buffer is already used : $buffer_used M \\033[0m\" echo -e \"\\033[32m cache is already used : $cache_used M \\033[0m\" } function getServiceStatus(){ echo \"\" echo -e \"\\033[33m*************************************************æœåŠ¡æ£€æŸ¥*******************************************************\\033[0m\" echo \"\" if [[ $centosVersion \u003e 7 ]];then conf=$(systemctl list-unit-files --type=service --state=enabled --no-pager | grep \"enabled\") process=$(systemctl list-units --type=service --state=running --no-pager | grep \".service\") else conf=$(/sbin/chkconfig | grep -E \":on|:å¯ç”¨\") process=$(/sbin/service --status-all 2\u003e/dev/null | grep -E \"is running|æ­£åœ¨è¿è¡Œ\") fi echo -e \"\\033[36m******************æœåŠ¡é…ç½®******************\\033[0m\" echo \"$conf\" | column -t echo \"\" echo -e \"\\033[36m**************æ­£åœ¨è¿è¡Œçš„æœåŠ¡****************\\033[0m\" echo \"$process\" } function getAutoStartStatus(){ echo \"\" echo -e \"\\033[33m***********************************************è‡ªå¯åŠ¨æ£€æŸ¥*******************************************************\\033[0m\" echo -e \"\\033[36m****************è‡ªå¯åŠ¨å‘½ä»¤*****************\\033[0m\" conf=$(grep -v \"^#\" /etc/rc.d/rc.local| sed '/^$/d') echo \"$conf\" } function getLoginStatus(){ echo \"\" echo -e \"\\033[33m************************************************ç™»å½•æ£€æŸ¥********************************************************\\033[0m\" last | head } function getNetworkStatus(){ echo \"\" echo -e \"\\033[33m************************************************ç½‘ç»œæ£€æŸ¥********************************************************\\033[0m\" if [[ $centosVersion \u003c 7 ]];then /sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v i net6 else #ip a for i in $(ip link | grep BROADCAST | awk -F: '{print $2}');do ip add show $i | grep -E \"BROADCAST|global\"| awk '{print $2}' | tr '\\n' ' ' ;echo \"\" ;done fi GATEWAY=$(ip route | grep default | awk '{print $3}') DNS=$(grep nameserver /etc/resolv.conf| grep -v \"#\" | awk '{print $2}' | tr '\\n' ',' | sed 's/,$//') echo \"\" echo \"ç½‘å…³ï¼š$GATEWAY \" echo \"DNSï¼š$DNS\" #æŠ¥è¡¨ä¿¡æ¯ IP=$(ip -f inet addr | grep -v 127.0.0.1 | grep inet | awk '{print $NF,$2}' | tr '\\n' ',' | sed 's/,$//') MAC=$(ip link | grep -v \"LOOPBACK\\|loopback\" | awk '{print $2}' | sed 'N;s/\\n//' | tr '\\n' ',' | sed 's/,$//') echo \"\" ping -c 4 www.baidu.com \u003e/dev/null 2\u003e\u00261 if [ $? -eq 0 ];then echo \"\" echo -e \"\\033[32mç½‘ç»œè¿æ¥ï¼šæ­£å¸¸ï¼\\033[0m\" else echo \"\" echo -e \"\\033[31mç½‘ç»œè¿æ¥ï¼šå¼‚å¸¸ï¼\\033[0m\" fi } function getListenStatus(){ echo \"\" echo -e \"\\033[33m***********************************************ç›‘å¬æ£€æŸ¥********************************************************\\033[0m\" TCPListen=$(ss -ntul | column -t) echo \"$TCPListen\" } function getCronStatus(){ echo \"\" echo -e \"\\033[33m**********************************************è®¡åˆ’ä»»åŠ¡æ£€æŸ¥******************************************************\\033[0m\" Crontab=0 for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(grep \"$shell\" /etc/passwd| awk -F: '{print $1}');do crontab -l -u $user \u003e/dev/null 2\u003e\u00261 status=$? if [ $status -eq 0 ];then echo -e \"\\033[36m************$userç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡**************\\033[0m\" crontab -l -u $user let Crontab=Crontab+$(crontab -l -u $user | wc -l) echo \"\" fi done done #è®¡åˆ’ä»»åŠ¡ #find /etc/cron* -type f | xargs -i ls -l {} | column -t #let Crontab=Crontab+$(find /etc/cron* -type f | wc -l) } function getHowLongAgo(){ # è®¡ç®—ä¸€ä¸ªæ—¶é—´æˆ³ç¦»ç°åœ¨æœ‰å¤šä¹…äº† datetime=\"$*\" [ -z \"$datetime\" ] \u0026\u0026 echo `stat /etc/passwd|awk \"NR==6\"` Timestamp=$(date +%s -d \"$datetime\") Now_Timestamp=$(date +%s) Difference_Timestamp=$(($Now_Timestamp-$Timestamp)) days=0;hours=0;minutes=0; sec_in_day=$((60*60*24)); sec_in_hour=$((60*60)); sec_in_minute=60 while (( $(($Difference_Timestamp-$sec_in_day)) \u003e 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_day let days++ done while (( $(($Difference_Timestamp-$sec_in_hour)) \u003e 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_hour let hours++ done echo \"$days å¤© $hours å°æ—¶å‰\" } function getUserLastLogin(){ # è·å–ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡ç™»å½•çš„æ—¶é—´ï¼Œå«å¹´ä»½ # å¾ˆé—æ†¾lastå‘½ä»¤ä¸æ”¯æŒæ˜¾ç¤ºå¹´ä»½ï¼Œåªæœ‰\"last -t YYYYMMDDHHMMSS\"è¡¨ç¤ºæŸä¸ªæ—¶é—´ä¹‹é—´çš„ç™»å½•ï¼Œæˆ‘ # ä»¬åªèƒ½ç”¨æœ€ç¬¨çš„æ–¹æ³•äº†ï¼Œå¯¹æ¯”ä»Šå¤©ä¹‹å‰å’Œä»Šå¹´å…ƒæ—¦ä¹‹å‰ï¼ˆæˆ–è€…å»å¹´ä¹‹å‰å’Œå‰å¹´ä¹‹å‰â€¦â€¦ï¼‰æŸä¸ªç”¨æˆ· # ç™»å½•æ¬¡æ•°ï¼Œå¦‚æœç™»å½•ç»Ÿè®¡æ¬¡æ•°æœ‰å˜åŒ–ï¼Œåˆ™è¯´æ˜æœ€è¿‘ä¸€æ¬¡ç™»å½•æ˜¯ä»Šå¹´ã€‚ username=$1 : ${username:=\"`whoami`\"} thisYear=$(date +%Y) oldesYear=$(last | tail -n1 | awk '{print $NF}') while(( $thisYear \u003e= $oldesYear));do loginBeforeToday=$(last $username | grep $username | wc -l) loginBeforeNewYearsDayOfThisYear=$(last $username -t $thisYear\"0101000000\" | grep $username | wc -l) if [ $loginBeforeToday -eq 0 ];then echo \"ä»æœªç™»å½•è¿‡\" break elif [ $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear ];then lastDateTime=$(last -i $username | head -n1 | awk '{for(i=4;i\u003c(NF-2);i++)printf\"%s \",$i}')\" $thisYear\" lastDateTime=$(date \"+%Y-%m-%d %H:%M:%S\" -d \"$lastDateTime\") echo \"$lastDateTime\" break else thisYear=$((thisYear-1)) fi done } function getUserStatus(){ echo \"\" echo -e \"\\033[33m*************************************************ç”¨æˆ·æ£€æŸ¥*******************************************************\\033[0m\" #/etc/passwd æœ€åä¿®æ”¹æ—¶é—´ pwdfile=\"$(cat /etc/passwd)\" Modify=$(stat /etc/passwd | grep Modify | tr '.' ' ' | awk '{print $2,$3}') echo \"/etc/passwd: $Modify ($(getHowLongAgo $Modify))\" echo \"\" echo -e \"\\033[36m******************ç‰¹æƒç”¨æˆ·******************\\033[0m\" RootUser=\"\" for user in $(echo \"$pwdfile\" | awk -F: '{print $1}');do if [ $(id -u $user) -eq 0 ];then echo \"$user\" RootUser=\"$RootUser,$user\" fi done echo \"\" echo -e \"\\033[36m******************ç”¨æˆ·åˆ—è¡¨******************\\033[0m\" USERs=0 echo \"$( echo \"ç”¨æˆ·å UID GID HOME SHELL æœ€åä¸€æ¬¡ç™»å½•\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for username in $(grep \"$shell\" /etc/passwd| awk -F: '{print $1}');do userLastLogin=\"$(getUserLastLogin $username)\" echo \"$pwdfile\" | grep -w \"$username\" |grep -w \"$shell\"| awk -F: -v lastlogin=\"$(echo \"$userLastLogin\" | tr ' ' '_')\" '{print $1,$3,$4,$6,$7,lastlogin}' done let USERs=USERs+$(echo \"$pwdfile\" | grep \"$shell\"| wc -l) done )\" | column -t echo \"\" echo -e \"\\033[36m******************ç©ºå¯†ç ç”¨æˆ·****************\\033[0m\" USEREmptyPassword=\"\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(echo \"$pwdfile\" | grep \"$shell\" | cut -d: -f1);do r=$(awk -F: '$2==\"!!\"{print $1}' /etc/shadow | grep -w $user) if [ ! -z $r ];then echo $r USEREmptyPassword=\"$USEREmptyPassword,\"$r fi done done echo \"\" echo -e \"\\033[36m*****************ç›¸åŒIDç”¨æˆ·*****************\\033[0m\" USERTheSameUID=\"\" UIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '$1\u003e1{print $2}') for uid in $UIDs;do echo -n \"$uid\"; USERTheSameUID=\"$uid\" r=$(awk -F: 'ORS=\"\";$3=='\"$uid\"'{print \":\",$1}' /etc/passwd) echo \"$r\" echo \"\" USERTheSameUID=\"$USERTheSameUID $r,\" done } function getPasswordStatus { echo \"\" echo -e \"\\033[33m*************************************************å¯†ç æ£€æŸ¥*******************************************************\\033[0m\" pwdfile=\"$(cat /etc/passwd)\" echo \"\" echo -e \"\\033[36m****************å¯†ç è¿‡æœŸæ£€æŸ¥****************\\033[0m\" result=\"\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(echo \"$pwdfile\" | grep \"$shell\" | cut -d: -f1);do get_expiry_date=$(/usr/bin/chage -l $user | grep 'Password expires' | cut -d: -f2) if [[ $get_expiry_date = ' never' || $get_expiry_date = 'never' ]];then printf \"%-15s æ°¸ä¸è¿‡æœŸ\\n\" $user result=\"$result,$user:never\" else password_expiry_date=$(date -d \"$get_expiry_date\" \"+%s\") current_date=$(date \"+%s\") diff=$(($password_expiry_date-$current_date)) let DAYS=$(($diff/(60*60*24))) printf \"%-15s %så¤©åè¿‡æœŸ\\n\" $user $DAYS result=\"$result,$user:$DAYS days\" fi done done report_PasswordExpiry=$(echo $result | sed 's/^,//') echo \"\" echo -e \"\\033[36m****************å¯†ç ç­–ç•¥æ£€æŸ¥****************\\033[0m\" grep -v \"#\" /etc/login.defs | grep -E \"PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE\" } function getSudoersStatus(){ echo \"\" echo -e \"\\033[33m**********************************************Sudoersæ£€æŸ¥*******************************************************\\033[0m\" conf=$(grep -v \"^#\" /etc/sudoers| grep -v \"^Defaults\" | sed '/^$/d') echo \"$conf\" echo \"\" } function getInstalledStatus(){ echo \"\" echo -e \"\\033[33m*************************************************è½¯ä»¶æ£€æŸ¥*******************************************************\\033[0m\" rpm -qa --last | head | column -t } function getProcessStatus(){ echo \"\" echo -e \"\\033[33m*************************************************è¿›ç¨‹æ£€æŸ¥*******************************************************\\033[0m\" if [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then echo \"\" echo -e \"\\033[36m***************åƒµå°¸è¿›ç¨‹***************\\033[0m\" ps -ef | head -n1 ps -ef | grep defunct | grep -v grep fi echo \"\" echo -e \"\\033[36m************CPUå ç”¨TOP 10è¿›ç¨‹*************\\033[0m\" echo -e \"ç”¨æˆ· è¿›ç¨‹ID %CPU å‘½ä»¤ $(ps aux | awk '{print $1, $2, $3, $11}' | sort -k3rn | head -n 10 )\"| column -t echo \"\" echo -e \"\\033[36m************å†…å­˜å ç”¨TOP 10è¿›ç¨‹*************\\033[0m\" echo -e \"ç”¨æˆ· è¿›ç¨‹ID %MEM è™šæ‹Ÿå†…å­˜ å¸¸é©»å†…å­˜ å‘½ä»¤ $(ps aux | awk '{print $1, $2, $4, $5, $6, $11}' | sort -k3rn | head -n 10 )\"| column -t #echo \"\" #echo -e \"\\033[36m************SWAPå ç”¨TOP 10è¿›ç¨‹*************\\033[0m\" #awk: fatal: cannot open file `/proc/18713/smaps' for reading (No such file or directory) #for i in `cd /proc;ls |grep \"^[0-9]\"|awk ' $0 \u003e100'`;do awk '{if (-f /proc/$i/smaps) print \"$i file is not exist\"; else print \"$i\"}';done # for i in `cd /proc;ls |grep \"^[0-9]\"|awk ' $0 \u003e100'` ;do awk '/Swap:/{a=a+$2}END{print '\"$i\"',a/1024\"M\"}' /proc/$i/smaps ;done |sort -k2nr \u003e /tmp/swap.txt #echo -e \"è¿›ç¨‹ID SWAPä½¿ç”¨ $(cat /tmp/swap.txt|grep -v awk | head -n 10)\"| column -t } function getSyslogStatus(){ echo \"\" echo -e \"\\033[33m***********************************************syslogæ£€æŸ¥*******************************************************\\033[0m\" echo \"SYSLOGæœåŠ¡çŠ¶æ€ï¼š$(getState rsyslog)\" echo \"\" echo -e \"\\033[36m***************rsyslogé…ç½®******************\\033[0m\" cat /etc/rsyslog.conf 2\u003e/dev/null | grep -v \"^#\" | grep -v \"^\\\\$\" | sed '/^$/d' | column -t } function getFirewallStatus(){ echo \"\" echo -e \"\\033[33m***********************************************é˜²ç«å¢™æ£€æŸ¥*******************************************************\\033[0m\" echo -e \"\\033[36m****************é˜²ç«å¢™çŠ¶æ€******************\\033[0m\" if [[ $centosVersion = 7 ]];then systemctl status firewalld \u003e/dev/null 2\u003e\u00261 status=$? if [ $status -eq 0 ];then s=\"active\" elif [ $status -eq 3 ];then s=\"inactive\" elif [ $status -eq 4 ];then s=\"permission denied\" else s=\"unknown\" fi else s=\"$(getState iptables)\" fi echo \"firewalld: $s\" echo \"\" echo -e \"\\033[36m****************é˜²ç«å¢™é…ç½®******************\\033[0m\" cat /etc/sysconfig/firewalld 2\u003e/dev/null } function getSNMPStatus(){ #SNMPæœåŠ¡çŠ¶æ€ï¼Œé…ç½®ç­‰ echo \"\" echo -e \"\\033[33m***********************************************SNMPæ£€æŸ¥*********************************************************\\033[0m\" status=\"$(getState snmpd)\" echo \"SNMPæœåŠ¡çŠ¶æ€ï¼š$status\" echo \"\" if [ -e /etc/snmp/snmpd.conf ];then echo \"/etc/snmp/snmpd.conf\" echo \"--------------------\" cat /etc/snmp/snmpd.conf 2\u003e/dev/null | grep -v \"^#\" | sed '/^$/d' fi } function getState(){ if [[ $centosVersion \u003c 7 ]];then if [ -e \"/etc/init.d/$1\" ];then if [ `/etc/init.d/$1 status 2\u003e/dev/null | grep -E \"is running|æ­£åœ¨è¿è¡Œ\" | wc -l` -ge 1 ];then r=\"active\" else r=\"inactive\" fi else r=\"unknown\" fi else #CentOS 7+ r=\"$(systemctl is-active $1 2\u003e\u00261)\" fi echo \"$r\" } function getSSHStatus(){ #SSHDæœåŠ¡çŠ¶æ€ï¼Œé…ç½®,å—ä¿¡ä»»ä¸»æœºç­‰ echo \"\" echo -e \"\\033[33m************************************************SSHæ£€æŸ¥*********************************************************\\033[0m\" #æ£€æŸ¥å—ä¿¡ä»»ä¸»æœº pwdfile=\"$(cat /etc/passwd)\" echo \"SSHæœåŠ¡çŠ¶æ€ï¼š$(getState sshd)\" Protocol_Version=$(cat /etc/ssh/sshd_config | grep Protocol | awk '{print $2}') echo \"SSHåè®®ç‰ˆæœ¬ï¼š$Protocol_Version\" echo \"\" echo -e \"\\033[36m****************ä¿¡ä»»ä¸»æœº******************\\033[0m\" authorized=0 for user in $(echo \"$pwdfile\" | grep /bin/bash | awk -F: '{print $1}');do authorize_file=$(echo \"$pwdfile\" | grep -w $user | awk -F: '{printf $6\"/.ssh/authorized_keys\"}') authorized_host=$(cat $authorize_file 2\u003e/dev/null | awk '{print $3}' | tr '\\n' ',' | sed 's/,$//') if [ ! -z $authorized_host ];then echo \"$user æˆæƒ \\\"$authorized_host\\\" æ— å¯†ç è®¿é—®\" fi let authorized=authorized+$(cat $authorize_file 2\u003e/dev/null | awk '{print $3}'|wc -l) done echo \"\" echo -e \"\\033[36m*******æ˜¯å¦å…è®¸ROOTè¿œç¨‹ç™»å½•***************\\033[0m\" config=$(cat /etc/ssh/sshd_config | grep PermitRootLogin) firstChar=${config:0:1} if [ $firstChar == \"#\" ];then PermitRootLogin=\"yes\" else PermitRootLogin=$(echo $config | awk '{print $2}') fi echo \"PermitRootLogin $PermitRootLogin\" echo \"\" echo -e \"\\033[36m*************sshæœåŠ¡é…ç½®******************\\033[0m\" cat /etc/ssh/sshd_config | grep -v \"^#\" | sed '/^$/d' } function getNTPStatus(){ #NTPæœåŠ¡çŠ¶æ€ï¼Œå½“å‰æ—¶é—´ï¼Œé…ç½®ç­‰ echo \"\" echo -e \"\\033[33m***********************************************NTPæ£€æŸ¥**********************************************************\\033[0m\" if [ -e /etc/ntp.conf ];then echo \"NTPæœåŠ¡çŠ¶æ€ï¼š$(getState ntpd)\" echo \"\" echo -e \"\\033[36m*************NTPæœåŠ¡é…ç½®******************\\033[0m\" cat /etc/ntp.conf 2\u003e/dev/null | grep -v \"^#\" | sed '/^$/d' fi } function check(){ version getSystemStatus get_resource getCpuStatus getMemStatus getDiskStatus getNetworkStatus getListenStatus getProcessStatus getServiceStatus getAutoStartStatus getLoginStatus getCronStatus getUserStatus getPasswordStatus getSudoersStatus getFirewallStatus getSSHStatus getSyslogStatus getSNMPStatus getNTPStatus getInstalledStatus } #æ‰§è¡Œæ£€æŸ¥å¹¶ä¿å­˜æ£€æŸ¥ç»“æœ check \u003e $RESULTFILE echo -e \"\\033[44;37m ä¸»æœºå·¡æ£€ç»“æœå­˜æ”¾åœ¨ï¼š$RESULTFILE \\033[0m\" #ä¸Šä¼ æ£€æŸ¥ç»“æœçš„æ–‡ä»¶ #curl -F \"filename=@$RESULTFILE\" \"$uploadHostDailyCheckApi\" 2\u003e/dev/null cat $RESULTFILE ","wordCount":"7914","inLanguage":"en","datePublished":"2021-09-01T00:00:00Z","dateModified":"2021-09-01T00:00:00Z","author":[{"@type":"Person","name":"lvbibir"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/posts/tech/shell-server-inspection/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://www.lvbibir.cn/img/avatar.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://www.lvbibir.cn/img/avatar.gif alt aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.lvbibir.cn/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://www.lvbibir.cn/ title="ğŸ¡ ä¸»é¡µ"><span>ğŸ¡ ä¸»é¡µ</span></a></li><li><a href=https://www.lvbibir.cn/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://www.lvbibir.cn/tags title="ğŸ·ï¸ æ ‡ç­¾"><span>ğŸ·ï¸ æ ‡ç­¾</span></a></li><li><a href=https://www.lvbibir.cn/archives title="ğŸ“ˆ æ—¶é—´è½´"><span>ğŸ“ˆ æ—¶é—´è½´</span></a></li><li><a href=https://www.lvbibir.cn/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://www.lvbibir.cn/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/>ğŸ“š æ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>shell | æœåŠ¡å™¨å·¡æ£€è„šæœ¬</h1><div class=post-meta>åˆ›å»º:&nbsp;<span title='2021-09-01 00:00:00 +0000 UTC'>2021-09-01</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2021-09-01&nbsp;|&nbsp;å­—æ•°:&nbsp;7914å­—&nbsp;|&nbsp;æ—¶é•¿:&nbsp;16åˆ†é’Ÿ&nbsp;|&nbsp;
ä½œè€…:&nbsp;lvbibir
&nbsp;|&nbsp;æ ‡ç­¾: &nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/tags/linux/>linux</a></ul><span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-content><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#å‚æ•°å®šä¹‰</span>
</span></span><span style=display:flex><span>date<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d-%H:%M:%S&#34;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>centosVersion<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk <span style=color:#e6db74>&#39;{print $(NF-1)}&#39;</span> /etc/redhat-release<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>VERSION<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%F<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#æ—¥å¿—ç›¸å…³</span>
</span></span><span style=display:flex><span>LOGPATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/tmp/awr&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -e $LOGPATH <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> mkdir -p $LOGPATH
</span></span><span style=display:flex><span>RESULTFILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$LOGPATH<span style=color:#e6db74>/HostCheck-`hostname`-`date +%Y%m%d`.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#è°ƒç”¨å‡½æ•°åº“</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -f /etc/init.d/functions <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> source /etc/init.d/functions
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
</span></span><span style=display:flex><span>source /etc/profile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#rootç”¨æˆ·æ‰§è¡Œè„šæœ¬</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span> -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;è¯·ç”¨rootç”¨æˆ·æ‰§è¡Œæ­¤è„šæœ¬ï¼&#34;</span> <span style=color:#f92672>&amp;&amp;</span> exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> version<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;[</span><span style=color:#e6db74>${</span>date<span style=color:#e6db74>}</span><span style=color:#e6db74>] &gt;&gt;&gt; `hostname -s` ä¸»æœºå·¡æ£€&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSystemStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m****************************************************ç³»ç»Ÿæ£€æŸ¥****************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e /etc/sysconfig/i18n <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        default_LANG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;LANG=&#34;</span> /etc/sysconfig/i18n | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | awk -F <span style=color:#e6db74>&#39;&#34;&#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        default_LANG<span style=color:#f92672>=</span>$LANG
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    export LANG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en_US.UTF-8&#34;</span>
</span></span><span style=display:flex><span>    Release<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/redhat-release 2&gt;/dev/null<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    Kernel<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -r<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    OS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -o<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    Hostname<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -n<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    SELinux<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/usr/sbin/sestatus | grep <span style=color:#e6db74>&#34;SELinux status: &#34;</span> | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    LastReboot<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>who -b | awk <span style=color:#e6db74>&#39;{print $3,$4}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    uptime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uptime | sed <span style=color:#e6db74>&#39;s/.*up \([^,]*\), .*/\1/&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;     ç³»ç»Ÿï¼š</span>$OS<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34; å‘è¡Œç‰ˆæœ¬ï¼š</span>$Release<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;     å†…æ ¸ï¼š</span>$Kernel<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;   ä¸»æœºåï¼š</span>$Hostname<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;  SELinuxï¼š</span>$SELinux<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;è¯­è¨€/ç¼–ç ï¼š</span>$default_LANG<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34; å½“å‰æ—¶é—´ï¼š</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#39;%F %T&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34; æœ€åå¯åŠ¨ï¼š</span>$LastReboot<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34; è¿è¡Œæ—¶é—´ï¼š</span>$uptime<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    export LANG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$default_LANG<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getCpuStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m****************************************************CPUæ£€æŸ¥*****************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    Physical_CPUs<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;physical id&#34;</span> /proc/cpuinfo| sort | uniq | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    Virt_CPUs<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;processor&#34;</span> /proc/cpuinfo | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    CPU_Kernels<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;cores&#34;</span> /proc/cpuinfo|uniq| awk -F <span style=color:#e6db74>&#39;: &#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    CPU_Type<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;model name&#34;</span> /proc/cpuinfo | awk -F <span style=color:#e6db74>&#39;: &#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span> | sort | uniq<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    CPU_Arch<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -m<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;ç‰©ç†CPUä¸ªæ•°:</span>$Physical_CPUs<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;é€»è¾‘CPUä¸ªæ•°:</span>$Virt_CPUs<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;æ¯CPUæ ¸å¿ƒæ•°:</span>$CPU_Kernels<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;    CPUå‹å·:</span>$CPU_Type<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;    CPUæ¶æ„:</span>$CPU_Arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getMemStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo  -e <span style=color:#e6db74>&#34;\033[33m**************************************************å†…å­˜æ£€æŸ¥*****************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        free -mo
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        free -h
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#æŠ¥è¡¨ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    MemTotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep MemTotal /proc/meminfo| awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>  <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>    MemFree<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep MemFree /proc/meminfo| awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>    <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>    let MemUsed<span style=color:#f92672>=</span>MemTotal-MemFree
</span></span><span style=display:flex><span>    MemPercent<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk <span style=color:#e6db74>&#34;BEGIN {if(</span>$MemTotal<span style=color:#e6db74>==0){printf 100}else{printf \&#34;%.2f\&#34;,</span>$MemUsed<span style=color:#e6db74>*100/</span>$MemTotal<span style=color:#e6db74>}}&#34;</span><span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getDiskStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m**************************************************ç£ç›˜æ£€æŸ¥******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    df -hiP | sed <span style=color:#e6db74>&#39;s/Mounted on/Mounted/&#39;</span>&gt; /tmp/inode
</span></span><span style=display:flex><span>    df -hTP | sed <span style=color:#e6db74>&#39;s/Mounted on/Mounted/&#39;</span>&gt; /tmp/disk 
</span></span><span style=display:flex><span>    join /tmp/disk /tmp/inode | awk <span style=color:#e6db74>&#39;{print $1,$2,&#34;|&#34;,$3,$4,$5,$6,&#34;|&#34;,$8,$9,$10,$11,&#34;|&#34;,$12}&#39;</span>| column -t
</span></span><span style=display:flex><span>    <span style=color:#75715e>#æŠ¥è¡¨ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    diskdata<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -TP | sed <span style=color:#e6db74>&#39;1d&#39;</span> | awk <span style=color:#e6db74>&#39;$2!=&#34;tmpfs&#34;{print}&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>    disktotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$diskdata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$3}END{print total}&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>    diskused<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$diskdata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$4}END{print total}&#39;</span><span style=color:#66d9ef>)</span>  <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>    diskfree<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>disktotal-diskused<span style=color:#66d9ef>))</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>    diskusedpercent<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $disktotal $diskused | awk <span style=color:#e6db74>&#39;{if($1==0){printf 100}else{printf &#34;%.2f&#34;,$2*100/$1}}&#39;</span><span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span>    inodedata<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -iTP | sed <span style=color:#e6db74>&#39;1d&#39;</span> | awk <span style=color:#e6db74>&#39;$2!=&#34;tmpfs&#34;{print}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    inodetotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$inodedata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$3}END{print total}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    inodeused<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$inodedata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$4}END{print total}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    inodefree<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>inodetotal-inodeused<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>    inodeusedpercent<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $inodetotal $inodeused | awk <span style=color:#e6db74>&#39;{if($1==0){printf 100}else{printf &#34;%.2f&#34;,$2*100/$1}}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> get_resource<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m**************************************************èµ„æºæ¶ˆè€—ç»Ÿè®¡**************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m*************å¸¦å®½èµ„æºæ¶ˆè€—ç»Ÿè®¡*************\033[0m&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#ç”¨æ•°ç»„å­˜æ”¾ç½‘å¡å</span>
</span></span><span style=display:flex><span>    nic<span style=color:#f92672>=(</span><span style=color:#e6db74>`</span>ifconfig | grep ^<span style=color:#f92672>[</span>a-z<span style=color:#f92672>]</span> | grep -vE <span style=color:#e6db74>&#39;lo|docker0&#39;</span>| awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#e6db74>`</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	time<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date <span style=color:#e6db74>&#34;+%Y-%m-%d %k:%M&#34;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>	num<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>((</span>i<span style=color:#f92672>=</span>0;i&lt;<span style=color:#e6db74>${#</span>nic[@]<span style=color:#e6db74>}</span>;i++<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>	   <span style=color:#75715e>#å¾ªç¯äº”æ¬¡ï¼Œé¿å…çœ‹åˆ°çš„æ˜¯å¶ç„¶çš„æ•°æ®</span>
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>while</span> <span style=color:#f92672>((</span> $num&lt;<span style=color:#ae81ff>5</span> <span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>	   <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>	     rx_before<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /proc/net/dev | grep <span style=color:#e6db74>&#39;${nic[$i]}&#39;</span> | tr : <span style=color:#e6db74>&#34; &#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>         tx_before<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /proc/net/dev | grep <span style=color:#e6db74>&#39;${nic[$i]}&#39;</span> | tr : <span style=color:#e6db74>&#34; &#34;</span> | awk <span style=color:#e6db74>&#39;{print $10}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>		 sleep <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		 <span style=color:#75715e>#ç”¨sedå…ˆè·å–ç¬¬7åˆ—,å†ç”¨awkè·å–ç¬¬2åˆ—ï¼Œå†cutåˆ‡å‰²,ä»ç¬¬7ä¸ªåˆ°æœ€åï¼Œå³åªåˆ‡å‰²ç½‘å¡æµé‡æ•°å­—éƒ¨åˆ†</span>
</span></span><span style=display:flex><span>         rx_after<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /proc/net/dev | grep <span style=color:#e6db74>&#39;${nic[$i]}&#39;</span> | tr : <span style=color:#e6db74>&#34; &#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>         tx_after<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /proc/net/dev | grep <span style=color:#e6db74>&#39;${nic[$i]}&#39;</span> | tr : <span style=color:#e6db74>&#34; &#34;</span> | awk <span style=color:#e6db74>&#39;{print $10}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>		 <span style=color:#75715e>#æ³¨æ„ä¸‹é¢æˆªå–çš„ç›¸å·®2ç§’çš„ä¸¤ä¸ªæ—¶åˆ»çš„ç´¯è®¡å’Œå‘é€çš„bytes(å³ç´¯è®¡ä¼ é€å’Œæ¥æ”¶çš„ä½)</span>
</span></span><span style=display:flex><span>         rx_result<span style=color:#f92672>=</span>$<span style=color:#f92672>[(</span>rx_after-rx_before<span style=color:#f92672>)</span>/1024/1024/2*8<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>         tx_result<span style=color:#f92672>=</span>$<span style=color:#f92672>[(</span>tx_after-tx_before<span style=color:#f92672>)</span>/1024/1024/2*8<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>		 echo  <span style=color:#e6db74>&#34;</span>$time<span style=color:#e6db74> Now_In_Speed: </span>$rx_result<span style=color:#e6db74> Mbps  Now_OUt_Speed: </span>$tx_result<span style=color:#e6db74> Mbps&#34;</span> &gt;&gt; /tmp/network.txt
</span></span><span style=display:flex><span>		 let <span style=color:#e6db74>&#34;num++&#34;</span>
</span></span><span style=display:flex><span>	   <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>	   <span style=color:#75715e>#æ³¨æ„ä¸‹é¢grepåé¢çš„$timeå˜é‡è¦ç”¨åŒå¼•å·æ‹¬èµ·æ¥</span>
</span></span><span style=display:flex><span>       rx_result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /tmp/network.txt|grep <span style=color:#e6db74>&#34;</span>$time<span style=color:#e6db74>&#34;</span>|awk <span style=color:#e6db74>&#39;{In+=$4}END{print In}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>       tx_result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /tmp/network.txt|grep <span style=color:#e6db74>&#34;</span>$time<span style=color:#e6db74>&#34;</span>|awk <span style=color:#e6db74>&#39;{Out+=$7}END{print Out}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>       In_Speed<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=2;</span>$rx_result<span style=color:#e6db74>/5&#34;</span>|bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>       Out_Speed<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=2;</span>$tx_result<span style=color:#e6db74>/5&#34;</span>|bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>       echo -e  <span style=color:#e6db74>&#34;\033[32m In_Speed_average: </span>$In_Speed<span style=color:#e6db74> Mbps Out_Speed_average: </span>$Out_Speed<span style=color:#e6db74> Mbps! \033[0m&#34;</span> 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m*************CPUèµ„æºæ¶ˆè€—ç»Ÿè®¡*************\033[0m&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#ä½¿ç”¨vmstat 1 5å‘½ä»¤ç»Ÿè®¡5ç§’å†…çš„ä½¿ç”¨æƒ…å†µï¼Œå†è®¡ç®—æ¯ç§’ä½¿ç”¨æƒ…å†µ</span>
</span></span><span style=display:flex><span>	total<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>vmstat <span style=color:#ae81ff>1</span> 5|awk <span style=color:#e6db74>&#39;{x+=$13;y+=$14}END{print x+y}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>	cpu_average<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=2;</span>$total<span style=color:#e6db74>/5&#34;</span>|bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>#åˆ¤æ–­CPUä½¿ç”¨ç‡ï¼ˆæµ®ç‚¹æ•°ä¸æ•´æ•°æ¯”è¾ƒï¼‰</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>`</span>echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>cpu_average<span style=color:#e6db74>}</span><span style=color:#e6db74> &gt; 70&#34;</span> | bc<span style=color:#e6db74>`</span> -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	    echo -e  <span style=color:#e6db74>&#34;\033[31m Total CPU is already use: </span><span style=color:#e6db74>${</span>cpu_average<span style=color:#e6db74>}</span><span style=color:#e6db74>%,è¯·åŠæ—¶å¤„ç†ï¼\033[0m&#34;</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> 
</span></span><span style=display:flex><span>	    echo -e  <span style=color:#e6db74>&#34;\033[32m Total CPU is already use: </span><span style=color:#e6db74>${</span>cpu_average<span style=color:#e6db74>}</span><span style=color:#e6db74>%! \033[0m&#34;</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m*************ç£ç›˜èµ„æºæ¶ˆè€—ç»Ÿè®¡*************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#ç£ç›˜ä½¿ç”¨æƒ…å†µ(æ³¨æ„ï¼šéœ€è¦ç”¨sedå…ˆè¿›è¡Œæ ¼å¼åŒ–æ‰èƒ½è¿›è¡Œç´¯åŠ å¤„ç†)</span>
</span></span><span style=display:flex><span>    disk_used<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -m | sed <span style=color:#e6db74>&#39;1d;/ /!N;s/\n//;s/ \+/ /;&#39;</span> | awk <span style=color:#e6db74>&#39;{used+=$3} END{print used}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    disk_totalSpace<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -m | sed <span style=color:#e6db74>&#39;1d;/ /!N;s/\n//;s/ \+/ /;&#39;</span> | awk <span style=color:#e6db74>&#39;{totalSpace+=$2} END{print totalSpace}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    disk_all<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=4;</span>$disk_used<span style=color:#e6db74>/</span>$disk_totalSpace<span style=color:#e6db74>&#34;</span> | bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    disk_percent1<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $disk_all | cut -c 2-3<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    disk_percent2<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $disk_all | cut -c 4-5<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    disk_warning<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>df -m | sed <span style=color:#e6db74>&#39;1d;/ /!N;s/\n//;s/ \+/ /;&#39;</span> | awk <span style=color:#e6db74>&#39;{if ($5&gt;85) print $6 &#34;ç›®å½•ä½¿ç”¨ç‡ï¼š&#34; $5;} &#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>	echo -e  <span style=color:#e6db74>&#34;\033[32m Total disk has used: </span>$disk_percent1<span style=color:#e6db74>.</span>$disk_percent2<span style=color:#e6db74>% \033[0m&#34;</span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e>#echo -e &#34;\t\t..&#34; è¡¨ç¤ºæ¢è¡Œ</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -n  <span style=color:#e6db74>&#34;</span>$disk_warning<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	    echo -e <span style=color:#e6db74>&#34;\033[31m</span><span style=color:#e6db74>${</span>disk_warning<span style=color:#e6db74>}</span><span style=color:#e6db74> \n [Error]ä»¥ä¸Šç›®å½•ä½¿ç”¨ç‡è¶…è¿‡85%ï¼Œè¯·åŠæ—¶å¤„ç†ï¼\033[0m&#34;</span> 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m*************å†…å­˜èµ„æºæ¶ˆè€—ç»Ÿè®¡*************\033[0m&#34;</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>    <span style=color:#75715e>#è·å¾—ç³»ç»Ÿæ€»å†…å­˜</span>
</span></span><span style=display:flex><span>	memery_all<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free -m | awk <span style=color:#e6db74>&#39;NR==2&#39;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#è·å¾—å ç”¨å†…å­˜ï¼ˆæ“ä½œç³»ç»Ÿ è§’åº¦ï¼‰</span>
</span></span><span style=display:flex><span>	system_memery_used<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free -m | awk <span style=color:#e6db74>&#39;NR==2&#39;</span> | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#è·å¾—bufferã€cacheå ç”¨å†…å­˜ï¼Œå½“å†…å­˜ä¸å¤Ÿæ—¶ä¼šåŠæ—¶å›æ”¶ï¼Œæ‰€ä»¥è¿™ä¸¤éƒ¨åˆ†å¯ç”¨äºå¯ç”¨å†…å­˜çš„è®¡ç®—</span>
</span></span><span style=display:flex><span>	buffer_used<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free -m | awk <span style=color:#e6db74>&#39;NR==2&#39;</span> | awk <span style=color:#e6db74>&#39;{print $6}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>	cache_used<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>free -m | awk <span style=color:#e6db74>&#39;NR==2&#39;</span> | awk <span style=color:#e6db74>&#39;{print $7}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#è·å¾—è¢«ä½¿ç”¨å†…å­˜ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å¯ç”¨äºå¯ç”¨å†…å­˜çš„è®¡ç®—ï¼Œæ³¨æ„è®¡ç®—æ–¹æ³•</span>
</span></span><span style=display:flex><span>	actual_used_all<span style=color:#f92672>=</span>$<span style=color:#f92672>[</span>memery_all-<span style=color:#f92672>(</span>free+buffer_used+cache_used<span style=color:#f92672>)]</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#è·å¾—å®é™…å ç”¨çš„å†…å­˜</span>
</span></span><span style=display:flex><span>	actual_used_all<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>expr $memery_all - $free + $buffer_used + $cache_used <span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>    memery_percent<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=4;</span>$system_memery_used<span style=color:#e6db74> / </span>$memery_all<span style=color:#e6db74>&#34;</span> | bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    memery_percent2<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=4; </span>$actual_used_all<span style=color:#e6db74> / </span>$memery_all<span style=color:#e6db74>&#34;</span> | bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    percent_part1<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $memery_percent | cut -c 2-3<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    percent_part2<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $memery_percent | cut -c 4-5<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    percent_part11<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $memery_percent2 | cut -c 2-3<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    percent_part22<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $memery_percent2 | cut -c 4-5<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>	<span style=color:#75715e>#è·å¾—å ç”¨å†…å­˜ï¼ˆæ“ä½œç³»ç»Ÿè§’åº¦ï¼‰</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[32m system memery is already use: </span>$percent_part1<span style=color:#e6db74>.</span>$percent_part2<span style=color:#e6db74>% \033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#è·å¾—å®é™…å†…å­˜å ç”¨ç‡</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[32m actual memery is already use: </span>$percent_part11<span style=color:#e6db74>.</span>$percent_part22<span style=color:#e6db74>% \033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[32m buffer is already used : </span>$buffer_used<span style=color:#e6db74> M \033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[32m cache is already used : </span>$cache_used<span style=color:#e6db74> M \033[0m&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getServiceStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m*************************************************æœåŠ¡æ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &gt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>systemctl list-unit-files --type<span style=color:#f92672>=</span>service --state<span style=color:#f92672>=</span>enabled --no-pager | grep <span style=color:#e6db74>&#34;enabled&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        process<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>systemctl list-units --type<span style=color:#f92672>=</span>service --state<span style=color:#f92672>=</span>running --no-pager | grep <span style=color:#e6db74>&#34;.service&#34;</span><span style=color:#66d9ef>)</span>      
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/sbin/chkconfig | grep -E <span style=color:#e6db74>&#34;:on|:å¯ç”¨&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        process<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/sbin/service --status-all 2&gt;/dev/null | grep -E <span style=color:#e6db74>&#34;is running|æ­£åœ¨è¿è¡Œ&#34;</span><span style=color:#66d9ef>)</span>        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>	echo -e <span style=color:#e6db74>&#34;\033[36m******************æœåŠ¡é…ç½®******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span>  | column -t
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>	echo -e <span style=color:#e6db74>&#34;\033[36m**************æ­£åœ¨è¿è¡Œçš„æœåŠ¡****************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$process<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getAutoStartStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m***********************************************è‡ªå¯åŠ¨æ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m****************è‡ªå¯åŠ¨å‘½ä»¤*****************\033[0m&#34;</span>
</span></span><span style=display:flex><span>	conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;^#&#34;</span> /etc/rc.d/rc.local| sed <span style=color:#e6db74>&#39;/^$/d&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getLoginStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m************************************************ç™»å½•æ£€æŸ¥********************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    last | head 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getNetworkStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m************************************************ç½‘ç»œæ£€æŸ¥********************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        /sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v i
</span></span><span style=display:flex><span>		net6
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#ip a</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>ip link | grep BROADCAST | awk -F: <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span> ip add show $i | grep -E <span style=color:#e6db74>&#34;BROADCAST|global&#34;</span>| awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39; &#39;</span> ;echo <span style=color:#e6db74>&#34;&#34;</span> ;<span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    GATEWAY<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip route | grep default | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    DNS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep nameserver /etc/resolv.conf| grep -v <span style=color:#e6db74>&#34;#&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;ç½‘å…³ï¼š</span>$GATEWAY<span style=color:#e6db74> &#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;DNSï¼š</span>$DNS<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#æŠ¥è¡¨ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    IP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip -f inet addr | grep -v 127.0.0.1 |  grep inet | awk <span style=color:#e6db74>&#39;{print $NF,$2}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    MAC<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip link | grep -v <span style=color:#e6db74>&#34;LOOPBACK\|loopback&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> | sed <span style=color:#e6db74>&#39;N;s/\n//&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>ping -c <span style=color:#ae81ff>4</span> www.baidu.com &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>   echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>   echo -e <span style=color:#e6db74>&#34;\033[32mç½‘ç»œè¿æ¥ï¼šæ­£å¸¸ï¼\033[0m&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>   echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>   echo -e <span style=color:#e6db74>&#34;\033[31mç½‘ç»œè¿æ¥ï¼šå¼‚å¸¸ï¼\033[0m&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getListenStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo  -e <span style=color:#e6db74>&#34;\033[33m***********************************************ç›‘å¬æ£€æŸ¥********************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    TCPListen<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ss -ntul | column -t<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$TCPListen<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getCronStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m**********************************************è®¡åˆ’ä»»åŠ¡æ£€æŸ¥******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    Crontab<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> /etc/passwd| awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            crontab -l -u $user &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                echo -e <span style=color:#e6db74>&#34;\033[36m************</span>$userç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡<span style=color:#e6db74>**************\033[0m&#34;</span>
</span></span><span style=display:flex><span>                crontab -l -u $user
</span></span><span style=display:flex><span>                let Crontab<span style=color:#f92672>=</span>Crontab+<span style=color:#66d9ef>$(</span>crontab -l -u $user | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#è®¡åˆ’ä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#find /etc/cron* -type f | xargs -i ls -l {} | column  -t</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#let Crontab=Crontab+$(find /etc/cron* -type f | wc -l) </span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getHowLongAgo<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®¡ç®—ä¸€ä¸ªæ—¶é—´æˆ³ç¦»ç°åœ¨æœ‰å¤šä¹…äº†</span>
</span></span><span style=display:flex><span>    datetime<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$*<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$datetime<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>`</span>stat /etc/passwd|awk <span style=color:#e6db74>&#34;NR==6&#34;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>    Timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s -d <span style=color:#e6db74>&#34;</span>$datetime<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>  
</span></span><span style=display:flex><span>    Now_Timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    Difference_Timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>$Now_Timestamp<span style=color:#f92672>-</span>$Timestamp<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>    days<span style=color:#f92672>=</span>0;hours<span style=color:#f92672>=</span>0;minutes<span style=color:#f92672>=</span>0;
</span></span><span style=display:flex><span>    sec_in_day<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>24</span><span style=color:#66d9ef>))</span>;
</span></span><span style=display:flex><span>    sec_in_hour<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60</span><span style=color:#66d9ef>))</span>;
</span></span><span style=display:flex><span>    sec_in_minute<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#f92672>((</span> <span style=color:#66d9ef>$((</span>$Difference_Timestamp<span style=color:#f92672>-</span>$sec_in_day<span style=color:#66d9ef>))</span> &gt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        let Difference_Timestamp<span style=color:#f92672>=</span>Difference_Timestamp-sec_in_day
</span></span><span style=display:flex><span>        let days++
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#f92672>((</span> <span style=color:#66d9ef>$((</span>$Difference_Timestamp<span style=color:#f92672>-</span>$sec_in_hour<span style=color:#66d9ef>))</span> &gt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        let Difference_Timestamp<span style=color:#f92672>=</span>Difference_Timestamp-sec_in_hour
</span></span><span style=display:flex><span>        let hours++
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$days<span style=color:#e6db74> å¤© </span>$hours<span style=color:#e6db74> å°æ—¶å‰&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getUserLastLogin<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è·å–ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡ç™»å½•çš„æ—¶é—´ï¼Œå«å¹´ä»½</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¾ˆé—æ†¾lastå‘½ä»¤ä¸æ”¯æŒæ˜¾ç¤ºå¹´ä»½ï¼Œåªæœ‰&#34;last -t YYYYMMDDHHMMSS&#34;è¡¨ç¤ºæŸä¸ªæ—¶é—´ä¹‹é—´çš„ç™»å½•ï¼Œæˆ‘</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ä»¬åªèƒ½ç”¨æœ€ç¬¨çš„æ–¹æ³•äº†ï¼Œå¯¹æ¯”ä»Šå¤©ä¹‹å‰å’Œä»Šå¹´å…ƒæ—¦ä¹‹å‰ï¼ˆæˆ–è€…å»å¹´ä¹‹å‰å’Œå‰å¹´ä¹‹å‰â€¦â€¦ï¼‰æŸä¸ªç”¨æˆ·</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ç™»å½•æ¬¡æ•°ï¼Œå¦‚æœç™»å½•ç»Ÿè®¡æ¬¡æ•°æœ‰å˜åŒ–ï¼Œåˆ™è¯´æ˜æœ€è¿‘ä¸€æ¬¡ç™»å½•æ˜¯ä»Šå¹´ã€‚</span>
</span></span><span style=display:flex><span>    username<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>    : <span style=color:#e6db74>${</span>username:=<span style=color:#e6db74>&#34;`whoami`&#34;</span><span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>    thisYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    oldesYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last | tail -n1 | awk <span style=color:#e6db74>&#39;{print $NF}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span><span style=color:#f92672>((</span> $thisYear &gt;<span style=color:#f92672>=</span> $oldesYear<span style=color:#f92672>))</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        loginBeforeToday<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last $username | grep $username | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        loginBeforeNewYearsDayOfThisYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last $username -t $thisYear<span style=color:#e6db74>&#34;0101000000&#34;</span> | grep $username | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $loginBeforeToday -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;ä»æœªç™»å½•è¿‡&#34;</span>
</span></span><span style=display:flex><span>            break
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            lastDateTime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last -i $username | head -n1 | awk <span style=color:#e6db74>&#39;{for(i=4;i&lt;(NF-2);i++)printf&#34;%s &#34;,$i}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34; </span>$thisYear<span style=color:#e6db74>&#34;</span> 
</span></span><span style=display:flex><span>            lastDateTime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#34;+%Y-%m-%d %H:%M:%S&#34;</span> -d <span style=color:#e6db74>&#34;</span>$lastDateTime<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;</span>$lastDateTime<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            break
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            thisYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>thisYear-1<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getUserStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m*************************************************ç”¨æˆ·æ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#/etc/passwd æœ€åä¿®æ”¹æ—¶é—´</span>
</span></span><span style=display:flex><span>    pwdfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /etc/passwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    Modify<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>stat /etc/passwd | grep Modify | tr <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#e6db74>&#39; &#39;</span> | awk <span style=color:#e6db74>&#39;{print $2,$3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;/etc/passwd: </span>$Modify<span style=color:#e6db74> (</span><span style=color:#66d9ef>$(</span>getHowLongAgo $Modify<span style=color:#66d9ef>)</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m******************ç‰¹æƒç”¨æˆ·******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    RootUser<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>id -u $user<span style=color:#66d9ef>)</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;</span>$user<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            RootUser<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$RootUser<span style=color:#e6db74>,</span>$user<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>	echo -e <span style=color:#e6db74>&#34;\033[36m******************ç”¨æˆ·åˆ—è¡¨******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    USERs<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;ç”¨æˆ·å UID GID HOME SHELL æœ€åä¸€æ¬¡ç™»å½•&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> username in <span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> /etc/passwd| awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            userLastLogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getUserLastLogin $username<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep -w <span style=color:#e6db74>&#34;</span>$username<span style=color:#e6db74>&#34;</span> |grep -w <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span>| awk -F: -v lastlogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$userLastLogin<span style=color:#e6db74>&#34;</span> | tr <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#e6db74>&#39;_&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;{print $1,$3,$4,$6,$7,lastlogin}&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>        let USERs<span style=color:#f92672>=</span>USERs+<span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span>| wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> | column -t
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>	echo -e <span style=color:#e6db74>&#34;\033[36m******************ç©ºå¯†ç ç”¨æˆ·****************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    USEREmptyPassword<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> | cut -d: -f1<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            r<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk -F: <span style=color:#e6db74>&#39;$2==&#34;!!&#34;{print $1}&#39;</span> /etc/shadow | grep -w $user<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -z $r <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                echo $r
</span></span><span style=display:flex><span>                USEREmptyPassword<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$USEREmptyPassword<span style=color:#e6db74>,&#34;</span>$r
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>	echo -e <span style=color:#e6db74>&#34;\033[36m*****************ç›¸åŒIDç”¨æˆ·*****************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    USERTheSameUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    UIDs<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cut -d: -f3 /etc/passwd | sort | uniq -c | awk <span style=color:#e6db74>&#39;$1&gt;1{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> uid in $UIDs;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        echo -n <span style=color:#e6db74>&#34;</span>$uid<span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>        USERTheSameUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$uid<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        r<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk -F: <span style=color:#e6db74>&#39;ORS=&#34;&#34;;$3==&#39;</span><span style=color:#e6db74>&#34;</span>$uid<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#39;{print &#34;:&#34;,$1}&#39;</span> /etc/passwd<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;</span>$r<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        USERTheSameUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$USERTheSameUID<span style=color:#e6db74> </span>$r<span style=color:#e6db74>,&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getPasswordStatus <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m*************************************************å¯†ç æ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    pwdfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /etc/passwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m****************å¯†ç è¿‡æœŸæ£€æŸ¥****************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> | cut -d: -f1<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            get_expiry_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/usr/bin/chage -l $user | grep <span style=color:#e6db74>&#39;Password expires&#39;</span> | cut -d: -f2<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $get_expiry_date <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39; never&#39;</span> <span style=color:#f92672>||</span> $get_expiry_date <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;never&#39;</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                printf <span style=color:#e6db74>&#34;%-15s æ°¸ä¸è¿‡æœŸ\n&#34;</span> $user
</span></span><span style=display:flex><span>                result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$result<span style=color:#e6db74>,</span>$user<span style=color:#e6db74>:never&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                password_expiry_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date -d <span style=color:#e6db74>&#34;</span>$get_expiry_date<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;+%s&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>                current_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#34;+%s&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>                diff<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>$password_expiry_date<span style=color:#f92672>-</span>$current_date<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>                let DAYS<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>$diff<span style=color:#f92672>/(</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>24</span><span style=color:#66d9ef>))</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                printf <span style=color:#e6db74>&#34;%-15s %så¤©åè¿‡æœŸ\n&#34;</span> $user $DAYS
</span></span><span style=display:flex><span>                result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$result<span style=color:#e6db74>,</span>$user<span style=color:#e6db74>:</span>$DAYS<span style=color:#e6db74> days&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    report_PasswordExpiry<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | sed <span style=color:#e6db74>&#39;s/^,//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>	echo -e <span style=color:#e6db74>&#34;\033[36m****************å¯†ç ç­–ç•¥æ£€æŸ¥****************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    grep -v <span style=color:#e6db74>&#34;#&#34;</span> /etc/login.defs | grep -E <span style=color:#e6db74>&#34;PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSudoersStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m**********************************************Sudoersæ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;^#&#34;</span> /etc/sudoers| grep -v <span style=color:#e6db74>&#34;^Defaults&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getInstalledStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m*************************************************è½¯ä»¶æ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    rpm -qa --last | head | column -t 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getProcessStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m*************************************************è¿›ç¨‹æ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>ps -ef | grep defunct | grep -v grep | wc -l<span style=color:#66d9ef>)</span> -ge <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        echo -e <span style=color:#e6db74>&#34;\033[36m***************åƒµå°¸è¿›ç¨‹***************\033[0m&#34;</span>
</span></span><span style=display:flex><span>        ps -ef | head -n1
</span></span><span style=display:flex><span>        ps -ef | grep defunct | grep -v grep
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>	echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m************CPUå ç”¨TOP 10è¿›ç¨‹*************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;ç”¨æˆ· è¿›ç¨‹ID %CPU å‘½ä»¤ 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	</span><span style=color:#66d9ef>$(</span>ps aux | awk <span style=color:#e6db74>&#39;{print $1, $2, $3, $11}&#39;</span> | sort -k3rn | head -n <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>| column -t 
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m************å†…å­˜å ç”¨TOP 10è¿›ç¨‹*************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;ç”¨æˆ· è¿›ç¨‹ID %MEM è™šæ‹Ÿå†…å­˜  å¸¸é©»å†…å­˜ å‘½ä»¤ 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	</span><span style=color:#66d9ef>$(</span>ps aux | awk <span style=color:#e6db74>&#39;{print $1, $2, $4, $5, $6, $11}&#39;</span> | sort -k3rn | head -n <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>| column -t 
</span></span><span style=display:flex><span>	<span style=color:#75715e>#echo &#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#echo -e &#34;\033[36m************SWAPå ç”¨TOP 10è¿›ç¨‹*************\033[0m&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#awk: fatal: cannot open file `/proc/18713/smaps&#39; for reading (No such file or directory)</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#for i in `cd /proc;ls |grep &#34;^[0-9]&#34;|awk &#39; $0 &gt;100&#39;`;do awk &#39;{if (-f /proc/$i/smaps) print &#34;$i file is not exist&#34;; else print &#34;$i&#34;}&#39;;done</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#    for i in `cd /proc;ls |grep &#34;^[0-9]&#34;|awk &#39; $0 &gt;100&#39;` ;do awk &#39;/Swap:/{a=a+$2}END{print &#39;&#34;$i&#34;&#39;,a/1024&#34;M&#34;}&#39; /proc/$i/smaps ;done |sort -k2nr &gt; /tmp/swap.txt</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#echo -e &#34;è¿›ç¨‹ID SWAPä½¿ç”¨ $(cat /tmp/swap.txt|grep -v awk | head -n 10)&#34;| column -t</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSyslogStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m***********************************************syslogæ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;SYSLOGæœåŠ¡çŠ¶æ€ï¼š</span><span style=color:#66d9ef>$(</span>getState rsyslog<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m***************rsyslogé…ç½®******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    cat /etc/rsyslog.conf 2&gt;/dev/null | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | grep -v <span style=color:#e6db74>&#34;^\\</span>$<span style=color:#e6db74>&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span>  | column -t
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getFirewallStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m***********************************************é˜²ç«å¢™æ£€æŸ¥*******************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m****************é˜²ç«å¢™çŠ¶æ€******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        systemctl status firewalld &gt;/dev/null  2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;active&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>3</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inactive&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>4</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;permission denied&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getState iptables<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;firewalld: </span>$s<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m****************é˜²ç«å¢™é…ç½®******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    cat /etc/sysconfig/firewalld 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSNMPStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#SNMPæœåŠ¡çŠ¶æ€ï¼Œé…ç½®ç­‰</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m***********************************************SNMPæ£€æŸ¥*********************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    status<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getState snmpd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;SNMPæœåŠ¡çŠ¶æ€ï¼š</span>$status<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e /etc/snmp/snmpd.conf <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;/etc/snmp/snmpd.conf&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;--------------------&#34;</span>
</span></span><span style=display:flex><span>        cat /etc/snmp/snmpd.conf 2&gt;/dev/null | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getState<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e <span style=color:#e6db74>&#34;/etc/init.d/</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>`</span>/etc/init.d/$1 status 2&gt;/dev/null | grep -E <span style=color:#e6db74>&#34;is running|æ­£åœ¨è¿è¡Œ&#34;</span> | wc -l<span style=color:#e6db74>`</span> -ge <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;active&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inactive&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#CentOS 7+</span>
</span></span><span style=display:flex><span>        r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>systemctl is-active $1 2&gt;&amp;1<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$r<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSSHStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#SSHDæœåŠ¡çŠ¶æ€ï¼Œé…ç½®,å—ä¿¡ä»»ä¸»æœºç­‰</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m************************************************SSHæ£€æŸ¥*********************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#æ£€æŸ¥å—ä¿¡ä»»ä¸»æœº</span>
</span></span><span style=display:flex><span>    pwdfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /etc/passwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;SSHæœåŠ¡çŠ¶æ€ï¼š</span><span style=color:#66d9ef>$(</span>getState sshd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    Protocol_Version<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/ssh/sshd_config | grep Protocol | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;SSHåè®®ç‰ˆæœ¬ï¼š</span>$Protocol_Version<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m****************ä¿¡ä»»ä¸»æœº******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    authorized<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep /bin/bash | awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        authorize_file<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep -w $user | awk -F: <span style=color:#e6db74>&#39;{printf $6&#34;/.ssh/authorized_keys&#34;}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        authorized_host<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat $authorize_file 2&gt;/dev/null | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -z $authorized_host <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#34;</span>$user<span style=color:#e6db74> æˆæƒ \&#34;</span>$authorized_host<span style=color:#e6db74>\&#34; æ— å¯†ç è®¿é—®&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>        let authorized<span style=color:#f92672>=</span>authorized+<span style=color:#66d9ef>$(</span>cat $authorize_file 2&gt;/dev/null | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span>|wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m*******æ˜¯å¦å…è®¸ROOTè¿œç¨‹ç™»å½•***************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    config<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/ssh/sshd_config | grep PermitRootLogin<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    firstChar<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>config:0:1<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $firstChar <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;#&#34;</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        PermitRootLogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yes&#34;</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        PermitRootLogin<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $config | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;PermitRootLogin </span>$PermitRootLogin<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[36m*************sshæœåŠ¡é…ç½®******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    cat /etc/ssh/sshd_config | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getNTPStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#NTPæœåŠ¡çŠ¶æ€ï¼Œå½“å‰æ—¶é—´ï¼Œé…ç½®ç­‰</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#e6db74>&#34;\033[33m***********************************************NTPæ£€æŸ¥**********************************************************\033[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e /etc/ntp.conf <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;NTPæœåŠ¡çŠ¶æ€ï¼š</span><span style=color:#66d9ef>$(</span>getState ntpd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        echo -e <span style=color:#e6db74>&#34;\033[36m*************NTPæœåŠ¡é…ç½®******************\033[0m&#34;</span>
</span></span><span style=display:flex><span>        cat /etc/ntp.conf 2&gt;/dev/null | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> check<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    version
</span></span><span style=display:flex><span>    getSystemStatus
</span></span><span style=display:flex><span>	get_resource
</span></span><span style=display:flex><span>    getCpuStatus
</span></span><span style=display:flex><span>    getMemStatus
</span></span><span style=display:flex><span>    getDiskStatus
</span></span><span style=display:flex><span>    getNetworkStatus
</span></span><span style=display:flex><span>    getListenStatus
</span></span><span style=display:flex><span>    getProcessStatus
</span></span><span style=display:flex><span>    getServiceStatus
</span></span><span style=display:flex><span>    getAutoStartStatus
</span></span><span style=display:flex><span>    getLoginStatus
</span></span><span style=display:flex><span>    getCronStatus
</span></span><span style=display:flex><span>    getUserStatus
</span></span><span style=display:flex><span>    getPasswordStatus
</span></span><span style=display:flex><span>    getSudoersStatus
</span></span><span style=display:flex><span>    getFirewallStatus
</span></span><span style=display:flex><span>    getSSHStatus
</span></span><span style=display:flex><span>    getSyslogStatus
</span></span><span style=display:flex><span>    getSNMPStatus
</span></span><span style=display:flex><span>    getNTPStatus
</span></span><span style=display:flex><span>    getInstalledStatus
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#æ‰§è¡Œæ£€æŸ¥å¹¶ä¿å­˜æ£€æŸ¥ç»“æœ</span>
</span></span><span style=display:flex><span>check &gt; $RESULTFILE
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\033[44;37m ä¸»æœºå·¡æ£€ç»“æœå­˜æ”¾åœ¨ï¼š</span>$RESULTFILE<span style=color:#e6db74>   \033[0m&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ä¸Šä¼ æ£€æŸ¥ç»“æœçš„æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#curl -F &#34;filename=@$RESULTFILE&#34; &#34;$uploadHostDailyCheckApi&#34; 2&gt;/dev/null</span>
</span></span><span style=display:flex><span>cat $RESULTFILE
</span></span></code></pre></div></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://www.lvbibir.cn/img/wechat_pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://www.lvbibir.cn/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/posts/tech/redhat-update-kernel/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>redhatæœåŠ¡å™¨å‡çº§å†…æ ¸</span></a>
<a class=next href=https://www.lvbibir.cn/posts/tech/record-of-program-test/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>è®°ä¸€æ¬¡ç¨‹åºæµ‹è¯•</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.5.11/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo-lvbibir.vercel.app/",el:"#tcomment",lang:"zh-CN",region:"ap-guangzhou",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
2020-2022
<a href=https://www.lvbibir.cn style=color:#939393>lvbibir's Blog</a>
All Rights Reserved</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393>äº¬ICPå¤‡2021023168å·-1</a>&nbsp;
<span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>æ€»è®¿å®¢æ•°: <span id=busuanzi_value_site_uv></span>
æ€»è®¿é—®é‡: <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="ğŸ“„å¤åˆ¶";function s(){t.innerText="ğŸ‘ŒğŸ»å·²å¤åˆ¶!",setTimeout(()=>{t.innerText="ğŸ“„å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>