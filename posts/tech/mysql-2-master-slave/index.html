<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>mysql (äºŒ) ä¸»ä»å¤åˆ¶åŸç† GTID å¹¶è¡Œå¤åˆ¶ | lvbibir's Blog</title><meta name=keywords content="mysql"><meta name=description content="mysql ä¸»ä»å¤åˆ¶çš„è¯¦ç»†åŸç†, ä¸»ä»å¤åˆ¶æ¨¡å¼, ä¸»ä»å¤åˆ¶æ–¹å¼, ä»¥åŠ GTID å¤åˆ¶å’Œå¹¶è¡Œå¤åˆ¶"><meta name=author content="ä½œè€…:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/posts/tech/mysql-2-master-slave/><link crossorigin=anonymous href=/assets/css/stylesheet.6ae04185be267d218870ba8449572db8ef0ebb0e2863c2c015d6a0d5bce015cf.css integrity="sha256-auBBhb4mfSGIcLqESVctuO8Ouw4oY8LAFdag1bzgFc8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.lvbibir.cn/images/avatar.webp><link rel=icon type=image/png sizes=16x16 href=https://www.lvbibir.cn/images/avatar.webp><link rel=icon type=image/png sizes=32x32 href=https://www.lvbibir.cn/images/avatar.webp><link rel=apple-touch-icon href=https://www.lvbibir.cn/images/avatar.webp><link rel=mask-icon href=https://www.lvbibir.cn/images/avatar.webp><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/fonts/JetBrainsLxgwNerdMono/all.css><script>document.addEventListener('DOMContentLoaded',function(){const e=document.querySelectorAll('img.lazyload');if('IntersectionObserver'in window){const t=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove('lazyload'),n.classList.add('lazyloaded'),t.unobserve(n)}})},{rootMargin:'50px 0px',threshold:.01});e.forEach(function(e){t.observe(e)})}else e.forEach(function(e){e.src=e.dataset.src})})</script><meta property="og:title" content="mysql (äºŒ) ä¸»ä»å¤åˆ¶åŸç† GTID å¹¶è¡Œå¤åˆ¶"><meta property="og:description" content="mysql ä¸»ä»å¤åˆ¶çš„è¯¦ç»†åŸç†, ä¸»ä»å¤åˆ¶æ¨¡å¼, ä¸»ä»å¤åˆ¶æ–¹å¼, ä»¥åŠ GTID å¤åˆ¶å’Œå¹¶è¡Œå¤åˆ¶"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/posts/tech/mysql-2-master-slave/"><meta property="og:image" content="https://www.lvbibir.cn/images/cover-mysql.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-03T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-28T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.lvbibir.cn/images/cover-mysql.png"><meta name=twitter:title content="mysql (äºŒ) ä¸»ä»å¤åˆ¶åŸç† GTID å¹¶è¡Œå¤åˆ¶"><meta name=twitter:description content="mysql ä¸»ä»å¤åˆ¶çš„è¯¦ç»†åŸç†, ä¸»ä»å¤åˆ¶æ¨¡å¼, ä¸»ä»å¤åˆ¶æ–¹å¼, ä»¥åŠ GTID å¤åˆ¶å’Œå¹¶è¡Œå¤åˆ¶"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"ğŸ“š æ–‡ç« ","item":"https://www.lvbibir.cn/posts/"},{"@type":"ListItem","position":3,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://www.lvbibir.cn/posts/tech/"},{"@type":"ListItem","position":4,"name":"mysql (äºŒ) ä¸»ä»å¤åˆ¶åŸç† GTID å¹¶è¡Œå¤åˆ¶","item":"https://www.lvbibir.cn/posts/tech/mysql-2-master-slave/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"mysql (äºŒ) ä¸»ä»å¤åˆ¶åŸç† GTID å¹¶è¡Œå¤åˆ¶","name":"mysql (äºŒ) ä¸»ä»å¤åˆ¶åŸç† GTID å¹¶è¡Œå¤åˆ¶","description":"mysql ä¸»ä»å¤åˆ¶çš„è¯¦ç»†åŸç†, ä¸»ä»å¤åˆ¶æ¨¡å¼, ä¸»ä»å¤åˆ¶æ–¹å¼, ä»¥åŠ GTID å¤åˆ¶å’Œå¹¶è¡Œå¤åˆ¶","keywords":["mysql"],"articleBody":"0 å‰è¨€ æœ¬æ–‡å‚è€ƒä»¥ä¸‹é“¾æ¥:\nã€MySQLã€‘ä¸»ä»å¤åˆ¶å®ç°åŸç†è¯¦è§£ åŸºäº centos-7.9 mysql-5.7.42\nmysql å®‰è£…å‚è€ƒ mysql ç³»åˆ—æ–‡ç« \n1 ä¸»ä»å¤åˆ¶åŸç† ä¸»ä»å¤åˆ¶æ¶‰åŠåˆ° 3 ä¸ªçº¿ç¨‹, 4 ä¸ªæ–‡ä»¶\n1.1 çº¿ç¨‹ master:\nlog dump : å½“ slave è¿æ¥ master æ—¶, ä¸»èŠ‚ç‚¹ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ª log dump çº¿ç¨‹, ç”¨äºå‘é€å’Œè¯»å– binlog çš„å†…å®¹. åœ¨è¯»å– binlog ä¸­çš„æ“ä½œæ—¶, log dump çº¿ç¨‹ä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„ binlog åŠ é”, å½“è¯»å–å®Œæˆ, åœ¨å‘é€ç»™ä»èŠ‚ç‚¹ä¹‹å‰, é”ä¼šè¢«é‡Šæ”¾.\nä¸»èŠ‚ç‚¹ä¼šä¸ºè‡ªå·±çš„æ¯ä¸€ä¸ªä»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª log dump çº¿ç¨‹ .\nslave:\nIO : æ¥å— master å‘é€çš„ binlog æ–‡ä»¶ä½ç½®çš„å‰¯æœ¬. ç„¶åå°†æ•°æ®çš„æ›´æ–°è®°å½•åˆ° relaylog ä¸­. SQL : è´Ÿè´£è¯»å– relaylog ä¸­çš„å†…å®¹, è§£ææˆå…·ä½“çš„æ“ä½œå¹¶æ‰§è¡Œ, æœ€ç»ˆä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ 1.2 æ–‡ä»¶ master:\nbinlog : äºŒè¿›åˆ¶æ–‡ä»¶, è®°å½•åº“ä¸­çš„ä¿¡æ¯ slave:\nrelaylog : ä¸­ç»§æ—¥å¿—, ç”¨æ¥åŒæ­¥ master çš„ binlog relaylog.info : è®°å½•æ–‡ä»¶å¤åˆ¶çš„è¿›åº¦. master.info : å­˜æ”¾ master ä¿¡æ¯, ä»¥åŠä¸Šæ¬¡è¯»å–åˆ°çš„ master åŒæ­¥è¿‡æ¥çš„ binlog çš„ä½ç½® 1.3 è¯¦ç»†æ­¥éª¤ slave æ‰§è¡Œ change master to å‘½ä»¤ ( master çš„è¿æ¥ä¿¡æ¯ + å¤åˆ¶çš„èµ·ç‚¹), å°†ä»¥ä¸Šä¿¡æ¯è®°å½•åˆ° master.info æ–‡ä»¶ slave æ‰§è¡Œ start slave å‘½ä»¤,å¼€å¯ IO çº¿ç¨‹å’Œ SQL çº¿ç¨‹ slave çš„ IO çº¿ç¨‹è¯»å– master.info æ–‡ä»¶ä¸­çš„ä¿¡æ¯, è·å–åˆ° IP, PORT, User, Pass, binlog çš„ä½ç½®ä¿¡æ¯ slave çš„ IO çº¿ç¨‹è¯·æ±‚è¿æ¥ master, master æä¾›ä¸€ä¸ª log dump çº¿ç¨‹, è´Ÿè´£å’Œ IO çº¿ç¨‹äº¤äº’ IO çº¿ç¨‹æ ¹æ® binlog çš„ä½ç½®ä¿¡æ¯ (mysql-bin.000004 , 444), è¯·æ±‚ master æ–°çš„ binlog master é€šè¿‡ log dump çº¿ç¨‹å°†æœ€æ–°çš„ binlog ä¼ è¾“ç»™ slave çš„ IO çº¿ç¨‹ IO çº¿ç¨‹æ¥æ”¶åˆ°æ–°çš„ binlog æ—¥å¿—, å­˜å‚¨åˆ° TCP/IP ç¼“å­˜, ç«‹å³è¿”å› ACK ç»™ master , å¹¶æ›´æ–° master.info IO çº¿ç¨‹å°† TCP/IP ç¼“å­˜ä¸­çš„æ•°æ®, è½¬å‚¨åˆ°ç£ç›˜ relaylog ä¸­ SQL çº¿ç¨‹è¯»å– relaylog.info ä¸­çš„ä¿¡æ¯, è·å–åˆ°ä¸Šæ¬¡å·²ç»åº”ç”¨è¿‡çš„ relaylog çš„ä½ç½®ä¿¡æ¯ SQL çº¿ç¨‹ä¼šæŒ‰ç…§ä¸Šæ¬¡çš„ä½ç½®ç‚¹å›æ”¾æœ€æ–°çš„ relaylog, å†æ¬¡æ›´æ–° relaylog.info ä¿¡æ¯ slave ä¼šè‡ªåŠ¨ purge åº”ç”¨è¿‡çš„ relaylog è¿›è¡Œå®šæœŸæ¸…ç† 2 ä¸»ä»å¤åˆ¶æ¨¡å¼ mysql é»˜è®¤ä¸€èˆ¬ä¸ºå¼‚æ­¥åŒæ­¥æ•°æ®\n2.1 å…¨åŒæ­¥ å½“ mster æ‰§è¡Œå®Œä¸€ä¸ªäº‹åŠ¡, ç„¶åæ‰€æœ‰çš„ slave éƒ½å¤åˆ¶äº†è¯¥äº‹åŠ¡å¹¶æˆåŠŸæ‰§è¡Œå®Œæ‰è¿”å›æˆåŠŸä¿¡æ¯ç»™å®¢æˆ·ç«¯. å› ä¸ºéœ€è¦ç­‰å¾…æ‰€æœ‰ slave æ‰§è¡Œå®Œè¯¥äº‹åŠ¡æ‰èƒ½è¿”å›æˆåŠŸä¿¡æ¯, æ‰€ä»¥å…¨åŒæ­¥å¤åˆ¶çš„æ€§èƒ½å¿…ç„¶ä¼šæ”¶åˆ°ä¸¥é‡çš„å½±å“.\n2.2 åŠåŒæ­¥ ä»‹äºå¼‚æ­¥å¤åˆ¶å’Œå…¨åŒæ­¥å¤åˆ¶ä¹‹é—´, master åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¸æ˜¯ç«‹åˆ»è¿”å›ç»™å®¢æˆ·ç«¯, è€Œæ˜¯ç­‰å¾…è‡³å°‘ä¸€ä¸ª slave æ¥æ”¶åˆ°å¹¶å†™åˆ° relaylog ä¸­æ‰è¿”å›æˆåŠŸä¿¡æ¯ç»™å®¢æˆ·ç«¯ (åªèƒ½ä¿è¯ master çš„ binlog è‡³å°‘ä¼ è¾“åˆ°äº†ä¸€ä¸ª slave ä¸Š, ä½†å¹¶ä¸èƒ½ä¿è¯ slave å°†æ­¤äº‹åŠ¡æ‰§è¡Œæ›´æ–°åˆ° db ä¸­), å¦åˆ™éœ€è¦ç­‰å¾…ç›´åˆ°è¶…æ—¶æ—¶é—´ç„¶ååˆ‡æ¢æˆå¼‚æ­¥æ¨¡å¼å†æäº¤. ç›¸å¯¹äºå¼‚æ­¥å¤åˆ¶, åŠåŒæ­¥å¤åˆ¶æé«˜äº†æ•°æ®çš„å®‰å…¨æ€§, ä¸€å®šç¨‹åº¦çš„ä¿è¯äº†æ•°æ®èƒ½æˆåŠŸå¤‡ä»½åˆ° slave, åŒæ—¶å®ƒä¹Ÿé€ æˆäº†ä¸€å®šç¨‹åº¦çš„å»¶è¿Ÿ, ä½†æ˜¯æ¯”å…¨åŒæ­¥æ¨¡å¼å»¶è¿Ÿè¦ä½, è¿™ä¸ªå»¶è¿Ÿæœ€å°‘æ˜¯ä¸€ä¸ª TCP/IP å¾€è¿”çš„æ—¶é—´. æ‰€ä»¥, åŠåŒæ­¥å¤åˆ¶æœ€å¥½åœ¨ä½å»¶æ—¶çš„ç½‘ç»œä¸­ä½¿ç”¨.\n2.3 å¼‚æ­¥ master ä¸ä¼šä¸»åŠ¨æ¨é€ binlog åˆ° slave, master åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¼šç«‹å³å°†ç»“æœè¿”ç»™ç»™å®¢æˆ·ç«¯, å¹¶ä¸å…³å¿ƒ slave æ˜¯å¦å·²ç»æ¥æ”¶å¹¶å¤„ç†, è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜, master å¦‚æœå´©æºƒæ‰äº†, æ­¤æ—¶ master ä¸Šå·²ç»æäº¤çš„äº‹åŠ¡å¯èƒ½å¹¶æ²¡æœ‰ä¼ åˆ° slave ä¸Š, å¦‚æœæ­¤æ—¶, å¼ºè¡Œå°† slave æå‡ä¸º master, å¯èƒ½å¯¼è‡´æ–° master èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¸å®Œæ•´.\n3 ä¸»ä»å¤åˆ¶æ–¹å¼ MySQL ä¸»ä»å¤åˆ¶æœ‰ä¸‰ç§æ–¹å¼: åŸºäº SQL è¯­å¥çš„å¤åˆ¶ (statement-based replication, SBR), åŸºäºè¡Œçš„å¤åˆ¶ (row-based replication, RBR), æ··åˆæ¨¡å¼å¤åˆ¶ (mixed-based replication, MBR). å¯¹åº”çš„ bin-log æ–‡ä»¶çš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§: STATEMENT, ROW, MIXED\nå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ binlog æ ¼å¼\nSHOW VARIABLES LIKE \"binlog_format\"; 3.1 SBR å°±æ˜¯è®°å½• sql è¯­å¥åœ¨ bin-log ä¸­, Mysql 5.1.4 åŠä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§å¤åˆ¶æ ¼å¼. ä¼˜ç‚¹æ˜¯åªéœ€è¦è®°å½•ä¼šä¿®æ”¹æ•°æ®çš„ sql è¯­å¥åˆ° bin-log ä¸­, å‡å°‘äº† bin-log æ—¥è´¨é‡, èŠ‚çº¦ I/O, æé«˜æ€§èƒ½. ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹, ä¼šå¯¼è‡´ä¸»ä»èŠ‚ç‚¹ä¸­æ•°æ®ä¸ä¸€è‡´ (æ¯”å¦‚ sleep(), now() ç­‰).\n3.2 RBR mysql master å°† SQL è¯­å¥åˆ†è§£ä¸ºåŸºäº Row æ›´æ”¹çš„è¯­å¥å¹¶è®°å½•åœ¨ bin-log ä¸­, ä¹Ÿå°±æ˜¯åªè®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†, ä¿®æ”¹æˆä»€ä¹ˆæ ·. ä¼˜ç‚¹æ˜¯ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ã€æˆ–è€…å‡½æ•°ã€æˆ–è€… trigger çš„è°ƒç”¨æˆ–è€…è§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜. ç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—, å°¤å…¶æ˜¯ä¿®æ”¹ table çš„æ—¶å€™ä¼šè®©æ—¥å¿—æš´å¢,åŒæ—¶å¢åŠ  bin-log åŒæ­¥æ—¶é—´. ä¹Ÿä¸èƒ½é€šè¿‡ bin-log è§£æè·å–æ‰§è¡Œè¿‡çš„ sql è¯­å¥, åªèƒ½çœ‹åˆ°å‘ç”Ÿçš„ data å˜æ›´.\n3.3 MBR MySQL NDB cluster 7.3 å’Œ 7.4 ä½¿ç”¨çš„ MBR. æ˜¯ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ··åˆ, å¯¹äºä¸€èˆ¬çš„å¤åˆ¶ä½¿ç”¨ STATEMENT æ¨¡å¼ä¿å­˜åˆ° bin-log, å¯¹äº STATEMENT æ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œåˆ™ä½¿ç”¨ ROW æ¨¡å¼æ¥ä¿å­˜, MySQL ä¼šæ ¹æ®æ‰§è¡Œçš„ SQL è¯­å¥é€‰æ‹©æ—¥å¿—ä¿å­˜æ–¹å¼.\n4 GTID å¤åˆ¶ åœ¨åŸæ¥åŸºäºæ—¥å¿—çš„å¤åˆ¶ä¸­, slave éœ€è¦å‘ŠçŸ¥ master è¦ä»å“ªä¸ªåç§»é‡è¿›è¡Œå¢é‡åŒæ­¥, å¦‚æœæŒ‡å®šé”™è¯¯ä¼šé€ æˆæ•°æ®çš„é—æ¼, ä»è€Œé€ æˆæ•°æ®çš„ä¸ä¸€è‡´.\nè€ŒåŸºäº GTID çš„å¤åˆ¶ä¸­, slave ä¼šå‘ŠçŸ¥ master å·²ç»æ‰§è¡Œçš„äº‹åŠ¡çš„ GTID çš„å€¼, ç„¶å master ä¼šå°†æ‰€æœ‰æœªæ‰§è¡Œçš„äº‹åŠ¡çš„ GTID çš„åˆ—è¡¨è¿”å›ç»™ slave. å¹¶ä¸”å¯ä»¥ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡åªåœ¨æŒ‡å®šçš„ slave æ‰§è¡Œä¸€æ¬¡. é€šè¿‡å…¨å±€çš„äº‹åŠ¡ ID ç¡®å®š slave è¦æ‰§è¡Œçš„äº‹åŠ¡çš„æ–¹å¼ä»£æ›¿äº†ä»¥å‰éœ€è¦ç”¨ binlog å’Œ pos ç‚¹ç¡®å®š slave è¦æ‰§è¡Œçš„äº‹åŠ¡çš„æ–¹å¼.\nGTID æ˜¯ç”± server_uuid å’Œäº‹ç‰© id ç»„æˆ, æ ¼å¼ä¸º: GTID=server_uuid:transaction_id. server_uuid æ˜¯åœ¨æ•°æ®åº“å¯åŠ¨è¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆ, æ¯å°æœºå™¨çš„ server-uuid ä¸ä¸€æ ·. uuid å­˜æ”¾åœ¨æ•°æ®ç›®å½•çš„ auto.cnf æ–‡ä»¶ä¸­ï¼Œè€Œ transaction_id å°±æ˜¯äº‹åŠ¡æäº¤æ—¶ç³»ç»Ÿé¡ºåºåˆ†é…çš„ä¸€ä¸ªä¸ä¼šé‡å¤çš„åºåˆ—å·\nmaster æ›´æ–°æ•°æ®æ—¶, ä¼šåœ¨äº‹åŠ¡å‰äº§ç”Ÿ GTID, ä¸€èµ·è®°å½•åˆ° binlog æ—¥å¿—ä¸­. slave çš„ IO çº¿ç¨‹å°†å˜æ›´çš„ binlog å†™å…¥åˆ°æœ¬åœ°çš„ relaylog ä¸­. SQL çº¿ç¨‹ä» relaylog ä¸­è·å– GTID, ç„¶åå¯¹æ¯”æœ¬åœ° binlog æ˜¯å¦æœ‰è®°å½• (æ‰€ä»¥ slave å¿…é¡»è¦å¼€å¯ binlog, å¹¶ä¸”å°† log_slave_updates è®¾ç½®ä¸º ON). å¦‚æœæœ‰è®°å½•ï¼Œè¯´æ˜è¯¥ GTID çš„äº‹åŠ¡å·²ç»æ‰§è¡Œ, slave ä¼šå¿½ç•¥. å¦‚æœæ²¡æœ‰è®°å½•, slave å°±ä¼šä» relaylog ä¸­æ‰§è¡Œè¯¥ GTID çš„äº‹åŠ¡, å¹¶è®°å½•åˆ° binlog. åœ¨è§£æè¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ä¸»é”®, å¦‚æœæ²¡æœ‰å°±ç”¨äºŒçº§ç´¢å¼•, å¦‚æœæœ‰å°±ç”¨å…¨éƒ¨æ‰«æ.\n5 å¹¶è¡Œå¤åˆ¶ master å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¤šçº¿ç¨‹å¤šå®¢æˆ·ç«¯å»å†™, è€Œ slave åªæœ‰ä¸€ä¸ª SQL çº¿ç¨‹è¿›è¡Œå†™, æ— æ³•é¿å…åœ°ä¼šå‡ºç°ä¸»ä»å¤åˆ¶çš„å»¶è¿Ÿé—®é¢˜, å¹¶è¡Œå¤åˆ¶å¯ä»¥æŒ‡å®šçº¿ç¨‹æ•°é‡, ä»è€Œæé«˜ slave å†™çš„é€Ÿåº¦.\nåœ¨ mysql 5.6 ç‰ˆæœ¬ä¹‹åå¼•å…¥äº†å¹¶è¡Œå¤åˆ¶çš„æ¦‚å¿µ\né€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å‘ç°å…¶å®æ‰€è°“çš„å¹¶è¡Œå¤åˆ¶, å°±æ˜¯åœ¨ä¸­é—´æ·»åŠ äº†ä¸€ä¸ªåˆ†å‘çš„ç¯èŠ‚, ä¹Ÿå°±æ˜¯è¯´åŸæ¥çš„ SQL çº¿ç¨‹å˜æˆäº†ç°åœ¨çš„ coordinator ç»„ä»¶, å½“ relaylog æ—¥å¿—æ›´æ–°å, coordinator è´Ÿè´£è¯»å–æ—¥å¿—ä¿¡æ¯ä»¥åŠåˆ†å‘äº‹åŠ¡, çœŸæ­£çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯æ”¾åœ¨äº† worker çº¿ç¨‹ä¸Š, ç”±å¤šä¸ªçº¿ç¨‹å¹¶è¡Œçš„å»æ‰§è¡Œ.\n# æŸ¥çœ‹å¹¶è¡Œçš„slaveçš„çº¿ç¨‹çš„ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯0.è¡¨ç¤ºå•çº¿ç¨‹ show global variables like 'slave_parallel_workers'; # æ ¹æ®å®é™…æƒ…å†µä¿è¯å¼€å¯å¤šå°‘çº¿ç¨‹ set global slave_parallel_workers = 4; # è®¾ç½®å¹¶å‘å¤åˆ¶çš„æ–¹å¼ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªåº“ï¼Œå€¼ä¸ºdatabase show global variables like '%slave_parallel_type%'; # åœæ­¢slave stop slave; # è®¾ç½®å±æ€§å€¼ set global slave_parallel_type='logical_check'; # å¼€å¯slave start slave # æŸ¥çœ‹çº¿ç¨‹æ•° show full processlist; ä»¥ä¸Š\n","wordCount":"2245","inLanguage":"en","image":"https://www.lvbibir.cn/images/cover-mysql.png","datePublished":"2022-05-03T00:00:00Z","dateModified":"2024-01-28T00:00:00Z","author":{"@type":"Person","name":"lvbibir"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/posts/tech/mysql-2-master-slave/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://www.lvbibir.cn/images/avatar.webp"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://www.lvbibir.cn/images/avatar.webp alt aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li class=menu-item><a href=https://www.lvbibir.cn/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/archives title="ğŸ“ˆ å½’æ¡£"><span>ğŸ“ˆ å½’æ¡£</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/talk title="ğŸ’¬ è¯´è¯´"><span>ğŸ’¬ è¯´è¯´</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/>ğŸ“š æ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>mysql (äºŒ) ä¸»ä»å¤åˆ¶åŸç† GTID å¹¶è¡Œå¤åˆ¶</h1><div class=post-description>mysql ä¸»ä»å¤åˆ¶çš„è¯¦ç»†åŸç†, ä¸»ä»å¤åˆ¶æ¨¡å¼, ä¸»ä»å¤åˆ¶æ–¹å¼, ä»¥åŠ GTID å¤åˆ¶å’Œå¹¶è¡Œå¤åˆ¶</div><div class=post-meta>åˆ›å»º:&nbsp;<span title='2022-05-03 00:00:00 +0000 UTC'>2022-05-03</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2024-01-28&nbsp;|&nbsp;å­—æ•°:&nbsp;2245å­—&nbsp;|&nbsp;ä½œè€…:&nbsp;lvbibir
|&nbsp;æ ‡ç­¾:&nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/tags/mysql/>mysql</a></ul><span id=busuanzi_container_page_pv>&nbsp;|&nbsp;è®¿é—®:&nbsp;<span id=busuanzi_page_pv></span></span></div></header><button id=toc-toggle-btn class=toc-toggle-btn aria-label="Toggle Table of Contents" title=æ–‡ç« ç›®å½•><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg></button><div id=toc-overlay class=toc-overlay></div><aside id=toc-container class="toc-container wide"><button id=toc-close-btn class=toc-close-btn aria-label="Close Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>æ–‡ç« ç›®å½•</span></summary><div class=inner><ul><li><a href=#0-%e5%89%8d%e8%a8%80 aria-label="0 å‰è¨€">0 å‰è¨€</a></li><li><a href=#1-%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e5%8e%9f%e7%90%86 aria-label="1 ä¸»ä»å¤åˆ¶åŸç†">1 ä¸»ä»å¤åˆ¶åŸç†</a><ul><li><a href=#11-%e7%ba%bf%e7%a8%8b aria-label="1.1 çº¿ç¨‹">1.1 çº¿ç¨‹</a></li><li><a href=#12-%e6%96%87%e4%bb%b6 aria-label="1.2 æ–‡ä»¶">1.2 æ–‡ä»¶</a></li><li><a href=#13-%e8%af%a6%e7%bb%86%e6%ad%a5%e9%aa%a4 aria-label="1.3 è¯¦ç»†æ­¥éª¤">1.3 è¯¦ç»†æ­¥éª¤</a></li></ul></li><li><a href=#2-%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e6%a8%a1%e5%bc%8f aria-label="2 ä¸»ä»å¤åˆ¶æ¨¡å¼">2 ä¸»ä»å¤åˆ¶æ¨¡å¼</a><ul><li><a href=#21-%e5%85%a8%e5%90%8c%e6%ad%a5 aria-label="2.1 å…¨åŒæ­¥">2.1 å…¨åŒæ­¥</a></li><li><a href=#22-%e5%8d%8a%e5%90%8c%e6%ad%a5 aria-label="2.2 åŠåŒæ­¥">2.2 åŠåŒæ­¥</a></li><li><a href=#23-%e5%bc%82%e6%ad%a5 aria-label="2.3 å¼‚æ­¥">2.3 å¼‚æ­¥</a></li></ul></li><li><a href=#3-%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e6%96%b9%e5%bc%8f aria-label="3 ä¸»ä»å¤åˆ¶æ–¹å¼">3 ä¸»ä»å¤åˆ¶æ–¹å¼</a><ul><li><a href=#31-sbr aria-label="3.1 SBR">3.1 SBR</a></li><li><a href=#32-rbr aria-label="3.2 RBR">3.2 RBR</a></li><li><a href=#33-mbr aria-label="3.3 MBR">3.3 MBR</a></li></ul></li><li><a href=#4-gtid-%e5%a4%8d%e5%88%b6 aria-label="4 GTID å¤åˆ¶">4 GTID å¤åˆ¶</a></li><li><a href=#5-%e5%b9%b6%e8%a1%8c%e5%a4%8d%e5%88%b6 aria-label="5 å¹¶è¡Œå¤åˆ¶">5 å¹¶è¡Œå¤åˆ¶</a></li></ul></div></details></div></aside><script>let activeElement,elements;const tocContainer=document.getElementById("toc-container"),tocToggleBtn=document.getElementById("toc-toggle-btn"),tocCloseBtn=document.getElementById("toc-close-btn"),tocOverlay=document.getElementById("toc-overlay");window.addEventListener('DOMContentLoaded',function(){if(checkTocPosition(),elements=document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]'),elements.length>0){activeElement=elements[0];const t=encodeURI(activeElement.getAttribute('id')).toLowerCase(),e=document.querySelector(`.inner ul li a[href="#${t}"]`);e&&e.classList.add('active')}},!1),window.addEventListener('resize',function(){checkTocPosition()},!1),window.addEventListener('scroll',()=>{if(!elements||elements.length===0)return;activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(t=>{const n=encodeURI(t.getAttribute('id')).toLowerCase(),e=document.querySelector(`.inner ul li a[href="#${n}"]`);e&&(t===activeElement?e.classList.add('active'):e.classList.remove('active'))})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue('--gap'),10);let isWideMode=!1,isTocVisible=!0;function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?(isWideMode=!0,isTocVisible?(tocContainer.classList.add("wide"),tocContainer.classList.remove("collapsed"),tocContainer.classList.remove("mobile-popup"),tocToggleBtn.classList.add("active")):(tocContainer.classList.remove("wide"),tocContainer.classList.add("collapsed"),tocContainer.classList.remove("mobile-popup"),tocToggleBtn.classList.remove("active")),closeTocPopup()):(isWideMode=!1,tocContainer.classList.remove("wide"),tocContainer.classList.contains("mobile-popup")||tocContainer.classList.add("collapsed"),tocContainer.classList.contains("active")?tocToggleBtn.classList.add("active"):tocToggleBtn.classList.remove("active"))}function openTocPopup(){tocContainer.classList.remove("collapsed"),tocContainer.classList.add("mobile-popup"),tocContainer.classList.add("active"),tocOverlay.classList.add("active"),tocToggleBtn.classList.add("active"),document.body.style.overflow="hidden"}function closeTocPopup(){tocContainer.classList.remove("active"),tocOverlay.classList.remove("active"),document.body.style.overflow="",setTimeout(()=>{tocContainer.classList.contains("active")||(tocContainer.classList.remove("mobile-popup"),(!isWideMode||!isTocVisible)&&tocContainer.classList.add("collapsed"))},300)}function toggleToc(){isWideMode?(isTocVisible=!isTocVisible,isTocVisible?(tocContainer.classList.add("wide"),tocContainer.classList.remove("collapsed"),tocToggleBtn.classList.add("active")):(tocContainer.classList.remove("wide"),tocContainer.classList.add("collapsed"),tocToggleBtn.classList.remove("active"))):tocContainer.classList.contains("active")?(closeTocPopup(),tocToggleBtn.classList.remove("active")):openTocPopup()}tocToggleBtn.addEventListener('click',function(){toggleToc()}),tocCloseBtn.addEventListener('click',function(){closeTocPopup(),tocToggleBtn.classList.remove("active")}),tocOverlay.addEventListener('click',function(){closeTocPopup(),tocToggleBtn.classList.remove("active")}),tocContainer.querySelectorAll('.inner a').forEach(function(e){e.addEventListener('click',function(){tocContainer.classList.contains("mobile-popup")&&(closeTocPopup(),tocToggleBtn.classList.remove("active"))})}),document.addEventListener('keydown',function(e){e.key==='Escape'&&tocContainer.classList.contains("active")&&(closeTocPopup(),tocToggleBtn.classList.remove("active"))});function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=0-å‰è¨€>0 å‰è¨€<a hidden class=anchor aria-hidden=true href=#0-å‰è¨€>#</a></h1><p>æœ¬æ–‡å‚è€ƒä»¥ä¸‹é“¾æ¥:</p><ul><li><a href=https://blog.nowcoder.net/n/b90c959437734a8583fddeaa6d102e43 target=_blank rel=noopener style=color:#42b983 ;>ã€MySQLã€‘ä¸»ä»å¤åˆ¶å®ç°åŸç†è¯¦è§£</a></li></ul><p>åŸºäº <code>centos-7.9</code> <code>mysql-5.7.42</code></p><p>mysql å®‰è£…å‚è€ƒ <a href=https://www.lvbibir.cn/tags/mysql target=_blank rel=noopener style=color:#42b983 ;>mysql ç³»åˆ—æ–‡ç« </a></p><h1 id=1-ä¸»ä»å¤åˆ¶åŸç†>1 ä¸»ä»å¤åˆ¶åŸç†<a hidden class=anchor aria-hidden=true href=#1-ä¸»ä»å¤åˆ¶åŸç†>#</a></h1><p>ä¸»ä»å¤åˆ¶æ¶‰åŠåˆ° 3 ä¸ªçº¿ç¨‹, 4 ä¸ªæ–‡ä»¶</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=/images/image-20260106-211319.webp alt=v2-12f36a0aa2ea88020809173182e54e73_1440w decoding=async><noscript><img src=/images/image-20260106-211319.webp alt=v2-12f36a0aa2ea88020809173182e54e73_1440w></noscript></p><h2 id=11-çº¿ç¨‹>1.1 çº¿ç¨‹<a hidden class=anchor aria-hidden=true href=#11-çº¿ç¨‹>#</a></h2><p>master:</p><ul><li><p>log dump : å½“ slave è¿æ¥ master æ—¶, ä¸»èŠ‚ç‚¹ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ª log dump çº¿ç¨‹, ç”¨äºå‘é€å’Œè¯»å– binlog çš„å†…å®¹. åœ¨è¯»å– binlog ä¸­çš„æ“ä½œæ—¶, log dump çº¿ç¨‹ä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„ binlog åŠ é”, å½“è¯»å–å®Œæˆ, åœ¨å‘é€ç»™ä»èŠ‚ç‚¹ä¹‹å‰, é”ä¼šè¢«é‡Šæ”¾.</p><p>ä¸»èŠ‚ç‚¹ä¼šä¸ºè‡ªå·±çš„æ¯ä¸€ä¸ªä»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª log dump çº¿ç¨‹ .</p></li></ul><p>slave:</p><ul><li>IO : æ¥å— master å‘é€çš„ binlog æ–‡ä»¶ä½ç½®çš„å‰¯æœ¬. ç„¶åå°†æ•°æ®çš„æ›´æ–°è®°å½•åˆ° relaylog ä¸­.</li><li>SQL : è´Ÿè´£è¯»å– relaylog ä¸­çš„å†…å®¹, è§£ææˆå…·ä½“çš„æ“ä½œå¹¶æ‰§è¡Œ, æœ€ç»ˆä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§</li></ul><h2 id=12-æ–‡ä»¶>1.2 æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#12-æ–‡ä»¶>#</a></h2><p>master:</p><ul><li>binlog : äºŒè¿›åˆ¶æ–‡ä»¶, è®°å½•åº“ä¸­çš„ä¿¡æ¯</li></ul><p>slave:</p><ul><li>relaylog : ä¸­ç»§æ—¥å¿—, ç”¨æ¥åŒæ­¥ master çš„ binlog</li><li>relaylog.info : è®°å½•æ–‡ä»¶å¤åˆ¶çš„è¿›åº¦.</li><li>master.info : å­˜æ”¾ master ä¿¡æ¯, ä»¥åŠä¸Šæ¬¡è¯»å–åˆ°çš„ master åŒæ­¥è¿‡æ¥çš„ binlog çš„ä½ç½®</li></ul><h2 id=13-è¯¦ç»†æ­¥éª¤>1.3 è¯¦ç»†æ­¥éª¤<a hidden class=anchor aria-hidden=true href=#13-è¯¦ç»†æ­¥éª¤>#</a></h2><ul><li>slave æ‰§è¡Œ <code>change master to</code> å‘½ä»¤ ( master çš„è¿æ¥ä¿¡æ¯ + å¤åˆ¶çš„èµ·ç‚¹), å°†ä»¥ä¸Šä¿¡æ¯è®°å½•åˆ° master.info æ–‡ä»¶</li><li>slave æ‰§è¡Œ <code>start slave</code> å‘½ä»¤,å¼€å¯ IO çº¿ç¨‹å’Œ SQL çº¿ç¨‹</li><li>slave çš„ IO çº¿ç¨‹è¯»å– master.info æ–‡ä»¶ä¸­çš„ä¿¡æ¯, è·å–åˆ° IP, PORT, User, Pass, binlog çš„ä½ç½®ä¿¡æ¯</li><li>slave çš„ IO çº¿ç¨‹è¯·æ±‚è¿æ¥ master, master æä¾›ä¸€ä¸ª log dump çº¿ç¨‹, è´Ÿè´£å’Œ IO çº¿ç¨‹äº¤äº’</li><li>IO çº¿ç¨‹æ ¹æ® binlog çš„ä½ç½®ä¿¡æ¯ (mysql-bin.000004 , 444), è¯·æ±‚ master æ–°çš„ binlog</li><li>master é€šè¿‡ log dump çº¿ç¨‹å°†æœ€æ–°çš„ binlog ä¼ è¾“ç»™ slave çš„ IO çº¿ç¨‹</li><li>IO çº¿ç¨‹æ¥æ”¶åˆ°æ–°çš„ binlog æ—¥å¿—, å­˜å‚¨åˆ° TCP/IP ç¼“å­˜, ç«‹å³è¿”å› ACK ç»™ master , å¹¶æ›´æ–° master.info</li><li>IO çº¿ç¨‹å°† TCP/IP ç¼“å­˜ä¸­çš„æ•°æ®, è½¬å‚¨åˆ°ç£ç›˜ relaylog ä¸­</li><li>SQL çº¿ç¨‹è¯»å– relaylog.info ä¸­çš„ä¿¡æ¯, è·å–åˆ°ä¸Šæ¬¡å·²ç»åº”ç”¨è¿‡çš„ relaylog çš„ä½ç½®ä¿¡æ¯</li><li>SQL çº¿ç¨‹ä¼šæŒ‰ç…§ä¸Šæ¬¡çš„ä½ç½®ç‚¹å›æ”¾æœ€æ–°çš„ relaylog, å†æ¬¡æ›´æ–° relaylog.info ä¿¡æ¯</li><li>slave ä¼šè‡ªåŠ¨ purge åº”ç”¨è¿‡çš„ relaylog è¿›è¡Œå®šæœŸæ¸…ç†</li></ul><h1 id=2-ä¸»ä»å¤åˆ¶æ¨¡å¼>2 ä¸»ä»å¤åˆ¶æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#2-ä¸»ä»å¤åˆ¶æ¨¡å¼>#</a></h1><p>mysql é»˜è®¤ä¸€èˆ¬ä¸ºå¼‚æ­¥åŒæ­¥æ•°æ®</p><h2 id=21-å…¨åŒæ­¥>2.1 å…¨åŒæ­¥<a hidden class=anchor aria-hidden=true href=#21-å…¨åŒæ­¥>#</a></h2><p>å½“ mster æ‰§è¡Œå®Œä¸€ä¸ªäº‹åŠ¡, ç„¶åæ‰€æœ‰çš„ slave éƒ½å¤åˆ¶äº†è¯¥äº‹åŠ¡å¹¶æˆåŠŸæ‰§è¡Œå®Œæ‰è¿”å›æˆåŠŸä¿¡æ¯ç»™å®¢æˆ·ç«¯. å› ä¸ºéœ€è¦ç­‰å¾…æ‰€æœ‰ slave æ‰§è¡Œå®Œè¯¥äº‹åŠ¡æ‰èƒ½è¿”å›æˆåŠŸä¿¡æ¯, æ‰€ä»¥å…¨åŒæ­¥å¤åˆ¶çš„æ€§èƒ½å¿…ç„¶ä¼šæ”¶åˆ°ä¸¥é‡çš„å½±å“.</p><h2 id=22-åŠåŒæ­¥>2.2 åŠåŒæ­¥<a hidden class=anchor aria-hidden=true href=#22-åŠåŒæ­¥>#</a></h2><p>ä»‹äºå¼‚æ­¥å¤åˆ¶å’Œå…¨åŒæ­¥å¤åˆ¶ä¹‹é—´, master åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¸æ˜¯ç«‹åˆ»è¿”å›ç»™å®¢æˆ·ç«¯, è€Œæ˜¯ç­‰å¾…è‡³å°‘ä¸€ä¸ª slave æ¥æ”¶åˆ°å¹¶å†™åˆ° relaylog ä¸­æ‰è¿”å›æˆåŠŸä¿¡æ¯ç»™å®¢æˆ·ç«¯ (åªèƒ½ä¿è¯ master çš„ binlog è‡³å°‘ä¼ è¾“åˆ°äº†ä¸€ä¸ª slave ä¸Š, ä½†å¹¶ä¸èƒ½ä¿è¯ slave å°†æ­¤äº‹åŠ¡æ‰§è¡Œæ›´æ–°åˆ° db ä¸­), å¦åˆ™éœ€è¦ç­‰å¾…ç›´åˆ°è¶…æ—¶æ—¶é—´ç„¶ååˆ‡æ¢æˆå¼‚æ­¥æ¨¡å¼å†æäº¤. ç›¸å¯¹äºå¼‚æ­¥å¤åˆ¶, åŠåŒæ­¥å¤åˆ¶æé«˜äº†æ•°æ®çš„å®‰å…¨æ€§, ä¸€å®šç¨‹åº¦çš„ä¿è¯äº†æ•°æ®èƒ½æˆåŠŸå¤‡ä»½åˆ° slave, åŒæ—¶å®ƒä¹Ÿé€ æˆäº†ä¸€å®šç¨‹åº¦çš„å»¶è¿Ÿ, ä½†æ˜¯æ¯”å…¨åŒæ­¥æ¨¡å¼å»¶è¿Ÿè¦ä½, è¿™ä¸ªå»¶è¿Ÿæœ€å°‘æ˜¯ä¸€ä¸ª TCP/IP å¾€è¿”çš„æ—¶é—´. æ‰€ä»¥, åŠåŒæ­¥å¤åˆ¶æœ€å¥½åœ¨ä½å»¶æ—¶çš„ç½‘ç»œä¸­ä½¿ç”¨.</p><h2 id=23-å¼‚æ­¥>2.3 å¼‚æ­¥<a hidden class=anchor aria-hidden=true href=#23-å¼‚æ­¥>#</a></h2><p>master ä¸ä¼šä¸»åŠ¨æ¨é€ binlog åˆ° slave, master åœ¨æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åä¼šç«‹å³å°†ç»“æœè¿”ç»™ç»™å®¢æˆ·ç«¯, å¹¶ä¸å…³å¿ƒ slave æ˜¯å¦å·²ç»æ¥æ”¶å¹¶å¤„ç†, è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜, master å¦‚æœå´©æºƒæ‰äº†, æ­¤æ—¶ master ä¸Šå·²ç»æäº¤çš„äº‹åŠ¡å¯èƒ½å¹¶æ²¡æœ‰ä¼ åˆ° slave ä¸Š, å¦‚æœæ­¤æ—¶, å¼ºè¡Œå°† slave æå‡ä¸º master, å¯èƒ½å¯¼è‡´æ–° master èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¸å®Œæ•´.</p><h1 id=3-ä¸»ä»å¤åˆ¶æ–¹å¼>3 ä¸»ä»å¤åˆ¶æ–¹å¼<a hidden class=anchor aria-hidden=true href=#3-ä¸»ä»å¤åˆ¶æ–¹å¼>#</a></h1><p>MySQL ä¸»ä»å¤åˆ¶æœ‰ä¸‰ç§æ–¹å¼: åŸºäº SQL è¯­å¥çš„å¤åˆ¶ (statement-based replication, SBR), åŸºäºè¡Œçš„å¤åˆ¶ (row-based replication, RBR), æ··åˆæ¨¡å¼å¤åˆ¶ (mixed-based replication, MBR). å¯¹åº”çš„ bin-log æ–‡ä»¶çš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§: STATEMENT, ROW, MIXED</p><p>å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ binlog æ ¼å¼</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SHOW VARIABLES LIKE <span style=color:#48b685>&#34;binlog_format&#34;</span>;
</span></span></code></pre></div><h2 id=31-sbr>3.1 SBR<a hidden class=anchor aria-hidden=true href=#31-sbr>#</a></h2><p>å°±æ˜¯è®°å½• sql è¯­å¥åœ¨ bin-log ä¸­, Mysql 5.1.4 åŠä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§å¤åˆ¶æ ¼å¼. ä¼˜ç‚¹æ˜¯åªéœ€è¦è®°å½•ä¼šä¿®æ”¹æ•°æ®çš„ sql è¯­å¥åˆ° bin-log ä¸­, å‡å°‘äº† bin-log æ—¥è´¨é‡, èŠ‚çº¦ I/O, æé«˜æ€§èƒ½. ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹, ä¼šå¯¼è‡´ä¸»ä»èŠ‚ç‚¹ä¸­æ•°æ®ä¸ä¸€è‡´ (æ¯”å¦‚ sleep(), now() ç­‰).</p><h2 id=32-rbr>3.2 RBR<a hidden class=anchor aria-hidden=true href=#32-rbr>#</a></h2><p>mysql master å°† SQL è¯­å¥åˆ†è§£ä¸ºåŸºäº Row æ›´æ”¹çš„è¯­å¥å¹¶è®°å½•åœ¨ bin-log ä¸­, ä¹Ÿå°±æ˜¯åªè®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†, ä¿®æ”¹æˆä»€ä¹ˆæ ·. ä¼˜ç‚¹æ˜¯ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ã€æˆ–è€…å‡½æ•°ã€æˆ–è€… trigger çš„è°ƒç”¨æˆ–è€…è§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜. ç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—, å°¤å…¶æ˜¯ä¿®æ”¹ table çš„æ—¶å€™ä¼šè®©æ—¥å¿—æš´å¢,åŒæ—¶å¢åŠ  bin-log åŒæ­¥æ—¶é—´. ä¹Ÿä¸èƒ½é€šè¿‡ bin-log è§£æè·å–æ‰§è¡Œè¿‡çš„ sql è¯­å¥, åªèƒ½çœ‹åˆ°å‘ç”Ÿçš„ data å˜æ›´.</p><h2 id=33-mbr>3.3 MBR<a hidden class=anchor aria-hidden=true href=#33-mbr>#</a></h2><p>MySQL NDB cluster 7.3 å’Œ 7.4 ä½¿ç”¨çš„ MBR. æ˜¯ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ··åˆ, å¯¹äºä¸€èˆ¬çš„å¤åˆ¶ä½¿ç”¨ STATEMENT æ¨¡å¼ä¿å­˜åˆ° bin-log, å¯¹äº STATEMENT æ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œåˆ™ä½¿ç”¨ ROW æ¨¡å¼æ¥ä¿å­˜, MySQL ä¼šæ ¹æ®æ‰§è¡Œçš„ SQL è¯­å¥é€‰æ‹©æ—¥å¿—ä¿å­˜æ–¹å¼.</p><h1 id=4-gtid-å¤åˆ¶>4 GTID å¤åˆ¶<a hidden class=anchor aria-hidden=true href=#4-gtid-å¤åˆ¶>#</a></h1><p>åœ¨åŸæ¥åŸºäºæ—¥å¿—çš„å¤åˆ¶ä¸­, slave éœ€è¦å‘ŠçŸ¥ master è¦ä»å“ªä¸ªåç§»é‡è¿›è¡Œå¢é‡åŒæ­¥, å¦‚æœæŒ‡å®šé”™è¯¯ä¼šé€ æˆæ•°æ®çš„é—æ¼, ä»è€Œé€ æˆæ•°æ®çš„ä¸ä¸€è‡´.</p><p>è€ŒåŸºäº GTID çš„å¤åˆ¶ä¸­, slave ä¼šå‘ŠçŸ¥ master å·²ç»æ‰§è¡Œçš„äº‹åŠ¡çš„ GTID çš„å€¼, ç„¶å master ä¼šå°†æ‰€æœ‰æœªæ‰§è¡Œçš„äº‹åŠ¡çš„ GTID çš„åˆ—è¡¨è¿”å›ç»™ slave. å¹¶ä¸”å¯ä»¥ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡åªåœ¨æŒ‡å®šçš„ slave æ‰§è¡Œä¸€æ¬¡. é€šè¿‡å…¨å±€çš„äº‹åŠ¡ ID ç¡®å®š slave è¦æ‰§è¡Œçš„äº‹åŠ¡çš„æ–¹å¼ä»£æ›¿äº†ä»¥å‰éœ€è¦ç”¨ binlog å’Œ pos ç‚¹ç¡®å®š slave è¦æ‰§è¡Œçš„äº‹åŠ¡çš„æ–¹å¼.</p><p>GTID æ˜¯ç”± server_uuid å’Œäº‹ç‰© id ç»„æˆ, æ ¼å¼ä¸º: GTID=server_uuid:transaction_id. server_uuid æ˜¯åœ¨æ•°æ®åº“å¯åŠ¨è¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆ, æ¯å°æœºå™¨çš„ server-uuid ä¸ä¸€æ ·. uuid å­˜æ”¾åœ¨æ•°æ®ç›®å½•çš„ auto.cnf æ–‡ä»¶ä¸­ï¼Œè€Œ transaction_id å°±æ˜¯äº‹åŠ¡æäº¤æ—¶ç³»ç»Ÿé¡ºåºåˆ†é…çš„ä¸€ä¸ªä¸ä¼šé‡å¤çš„åºåˆ—å·</p><p>master æ›´æ–°æ•°æ®æ—¶, ä¼šåœ¨äº‹åŠ¡å‰äº§ç”Ÿ GTID, ä¸€èµ·è®°å½•åˆ° binlog æ—¥å¿—ä¸­. slave çš„ IO çº¿ç¨‹å°†å˜æ›´çš„ binlog å†™å…¥åˆ°æœ¬åœ°çš„ relaylog ä¸­. SQL çº¿ç¨‹ä» relaylog ä¸­è·å– GTID, ç„¶åå¯¹æ¯”æœ¬åœ° binlog æ˜¯å¦æœ‰è®°å½• (æ‰€ä»¥ slave å¿…é¡»è¦å¼€å¯ binlog, å¹¶ä¸”å°† <code>log_slave_updates</code> è®¾ç½®ä¸º ON). å¦‚æœæœ‰è®°å½•ï¼Œè¯´æ˜è¯¥ GTID çš„äº‹åŠ¡å·²ç»æ‰§è¡Œ, slave ä¼šå¿½ç•¥. å¦‚æœæ²¡æœ‰è®°å½•, slave å°±ä¼šä» relaylog ä¸­æ‰§è¡Œè¯¥ GTID çš„äº‹åŠ¡, å¹¶è®°å½•åˆ° binlog. åœ¨è§£æè¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ä¸»é”®, å¦‚æœæ²¡æœ‰å°±ç”¨äºŒçº§ç´¢å¼•, å¦‚æœæœ‰å°±ç”¨å…¨éƒ¨æ‰«æ.</p><h1 id=5-å¹¶è¡Œå¤åˆ¶>5 å¹¶è¡Œå¤åˆ¶<a hidden class=anchor aria-hidden=true href=#5-å¹¶è¡Œå¤åˆ¶>#</a></h1><p>master å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¤šçº¿ç¨‹å¤šå®¢æˆ·ç«¯å»å†™, è€Œ slave åªæœ‰ä¸€ä¸ª SQL çº¿ç¨‹è¿›è¡Œå†™, æ— æ³•é¿å…åœ°ä¼šå‡ºç°ä¸»ä»å¤åˆ¶çš„å»¶è¿Ÿé—®é¢˜, å¹¶è¡Œå¤åˆ¶å¯ä»¥æŒ‡å®šçº¿ç¨‹æ•°é‡, ä»è€Œæé«˜ slave å†™çš„é€Ÿåº¦.</p><p>åœ¨ mysql 5.6 ç‰ˆæœ¬ä¹‹åå¼•å…¥äº†å¹¶è¡Œå¤åˆ¶çš„æ¦‚å¿µ</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=/images/image-20260106-211318-5.png alt=img decoding=async><noscript><img src=/images/image-20260106-211318-5.png alt=img></noscript></p><p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å‘ç°å…¶å®æ‰€è°“çš„å¹¶è¡Œå¤åˆ¶, å°±æ˜¯åœ¨ä¸­é—´æ·»åŠ äº†ä¸€ä¸ªåˆ†å‘çš„ç¯èŠ‚, ä¹Ÿå°±æ˜¯è¯´åŸæ¥çš„ SQL çº¿ç¨‹å˜æˆäº†ç°åœ¨çš„ coordinator ç»„ä»¶, å½“ relaylog æ—¥å¿—æ›´æ–°å, coordinator è´Ÿè´£è¯»å–æ—¥å¿—ä¿¡æ¯ä»¥åŠåˆ†å‘äº‹åŠ¡, çœŸæ­£çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯æ”¾åœ¨äº† worker çº¿ç¨‹ä¸Š, ç”±å¤šä¸ªçº¿ç¨‹å¹¶è¡Œçš„å»æ‰§è¡Œ.</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#5bc4bf>#</span> <span style=color:#ef6155>æŸ¥çœ‹å¹¶è¡Œçš„</span>slaveçš„çº¿ç¨‹çš„ä¸ªæ•°<span style=color:#ef6155>ï¼Œé»˜è®¤æ˜¯</span><span style=color:#f99b15>0</span>.<span style=color:#ef6155>è¡¨ç¤ºå•çº¿ç¨‹</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>show</span> <span style=color:#815ba4>global</span> variables <span style=color:#815ba4>like</span> <span style=color:#48b685>&#39;slave_parallel_workers&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>#</span> <span style=color:#ef6155>æ ¹æ®å®é™…æƒ…å†µä¿è¯å¼€å¯å¤šå°‘çº¿ç¨‹</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>set</span> <span style=color:#815ba4>global</span> slave_parallel_workers <span style=color:#5bc4bf>=</span> <span style=color:#f99b15>4</span>;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>#</span> <span style=color:#ef6155>è®¾ç½®å¹¶å‘å¤åˆ¶çš„æ–¹å¼ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªåº“ï¼Œå€¼ä¸º</span><span style=color:#815ba4>database</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>show</span> <span style=color:#815ba4>global</span> variables <span style=color:#815ba4>like</span> <span style=color:#48b685>&#39;%slave_parallel_type%&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>#</span> <span style=color:#ef6155>åœæ­¢</span>slave
</span></span><span style=display:flex><span>stop slave;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>#</span> <span style=color:#ef6155>è®¾ç½®å±æ€§å€¼</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>set</span> <span style=color:#815ba4>global</span> slave_parallel_type<span style=color:#5bc4bf>=</span><span style=color:#48b685>&#39;logical_check&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>#</span> <span style=color:#ef6155>å¼€å¯</span>slave
</span></span><span style=display:flex><span><span style=color:#815ba4>start</span> slave
</span></span><span style=display:flex><span><span style=color:#5bc4bf>#</span> <span style=color:#ef6155>æŸ¥çœ‹çº¿ç¨‹æ•°</span>
</span></span><span style=display:flex><span><span style=color:#815ba4>show</span> <span style=color:#815ba4>full</span> processlist;
</span></span></code></pre></div><p>ä»¥ä¸Š</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://www.lvbibir.cn/images/blog-wechatpay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://www.lvbibir.cn/images/blog-alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick="var qr=document.getElementById('QR');qr.style.opacity==='0'?qr.style.opacity='1':qr.style.opacity='0'">
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/posts/tech/network-priority/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>windows & linux å¤šç½‘å¡æ—¶è®¾ç½®é»˜è®¤è·¯ç”±ä»¥åŠæ·»åŠ é™æ€è·¯ç”±</span></a>
<a class=next href=https://www.lvbibir.cn/posts/tech/mysql-1-deploy/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>mysql (ä¸€) éƒ¨ç½²</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=/js/twikoo/1.6.44/twikoo.min.js></script><script>twikoo.init({envId:"https://www.lvbibir.cn/twikoo/",el:"#tcomment",lang:'zh-CN',path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><a href=https://gohugo.io/ target=_blank><img style=display:unset src=/images/blog-hugo.svg></a>
<a href=https://github.com/adityatelange/hugo-PaperMod target=_blank><img style=display:unset src=/images/blog-papermod.svg></a>
<a href=https://cn.aliyun.com/ target=_blank><img style=display:unset src=/images/blog-aliyun.svg></a><br><span id=runtime_span></span>
<script type=text/javascript>function show_runtime(){window.setTimeout("show_runtime()",1e3);var a=new Date("7/13/2021 1:00:00"),r=new Date,c=r.getTime()-a.getTime(),l=24*60*60*1e3,o=c/l,i=Math.floor(o),e=(o-i)*24,t=Math.floor(e),n=(e-t)*60,s=Math.floor(n),d=Math.floor((n-s)*60);document.getElementById("runtime_span").innerHTML="ç½‘ç«™å·²è¿è¡Œ"+i+"å¤©"+t+"å°æ—¶"+s+"åˆ†"+d+"ç§’"}show_runtime()</script>|
<script defer src=https://www.lvbibir.cn/busuanzi/js></script>
<span id=busuanzi_container>æ€»è®¿å®¢æ•°: <span id=busuanzi_site_uv></span>
|
æ€»è®¿é—®é‡: <span id=busuanzi_site_pv></span></span><br><a href=https://beian.miit.gov.cn/ target=_blank style="border-bottom:1px solid">äº¬ICPå¤‡2021023168å·-1</a>&nbsp;
|
<span>Copyright &copy; 2020-2026
<a href=https://www.lvbibir.cn style="border-bottom:1px solid">lvbibir's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener('scroll',function(){const e=document.getElementById("read_progress"),t=document.documentElement.scrollHeight,n=document.documentElement.clientHeight,s=document.documentElement.scrollTop||document.body.scrollTop;e.innerText=((s/(t-n)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(s=>{const n=s.parentNode.parentNode,e=document.createElement('button');e.classList.add('copy-code'),e.innerText='ğŸ“„å¤åˆ¶';function l(){e.innerText='ğŸ‘ŒğŸ»å·²å¤åˆ¶!',setTimeout(()=>{e.innerText='ğŸ“„å¤åˆ¶'},2e3)}e.addEventListener('click',n=>{const e=document.createRange();e.selectNodeContents(s);const t=window.getSelection();t.removeAllRanges(),t.addRange(e);try{document.execCommand('copy'),l()}catch(e){}t.removeRange(e)});let c=s.className.replaceAll("language-",""),t=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");o.innerText=c,t.setAttribute('class','mac-tool'),i.setAttribute('class','mac bb1'),a.setAttribute('class','mac bb2'),r.setAttribute('class','mac bb3'),o.setAttribute('class','language-type'),t.appendChild(i),t.appendChild(a),t.appendChild(r),t.appendChild(o),n.classList.contains("highlight")?(n.appendChild(e),n.appendChild(t)):n.parentNode.firstChild===n||(s.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName==="TABLE"?(s.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e),n.appendChild(t)):(s.parentNode.appendChild(e),n.appendChild(t)))})</script></body></html>