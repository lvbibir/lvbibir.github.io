<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ceph | centos7 éƒ¨ç½² ceph-v12 | lvbibir's Blog</title><meta name=keywords content="linux,centos,ceph"><meta name=description content="ä»‹ç»åœ¨ centos7 ç¯å¢ƒä¸­é€šè¿‡ ceph-deploy éƒ¨ç½² ceph-v12 (natuilus) é›†ç¾¤å’Œå¯è§†åŒ–çš„ dashboard"><meta name=author content="ä½œè€…:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/posts/tech/ceph-v12-nautilus-cephdeploy/><link crossorigin=anonymous href=/assets/css/stylesheet.3b824f4c9b61760310d4a1f35d1d6e1499ac0057f6c3116572e104b07651493d.css integrity="sha256-O4JPTJthdgMQ1KHzXR1uFJmsAFf2wxFlcuEEsHZRST0=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://image.lvbibir.cn/blog/avatar.webp><link rel=icon type=image/png sizes=16x16 href=https://image.lvbibir.cn/blog/avatar.webp><link rel=icon type=image/png sizes=32x32 href=https://image.lvbibir.cn/blog/avatar.webp><link rel=apple-touch-icon href=https://image.lvbibir.cn/blog/avatar.webp><link rel=mask-icon href=https://image.lvbibir.cn/blog/avatar.webp><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://image.lvbibir.cn/fonts/LXGWWenKaiScreen-v1.521/result.css><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script>document.addEventListener('DOMContentLoaded',function(){const e=document.querySelectorAll('img.lazyload');if('IntersectionObserver'in window){const t=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove('lazyload'),n.classList.add('lazyloaded'),t.unobserve(n)}})},{rootMargin:'50px 0px',threshold:.01});e.forEach(function(e){t.observe(e)})}else e.forEach(function(e){e.src=e.dataset.src})})</script><meta property="og:title" content="ceph | centos7 éƒ¨ç½² ceph-v12"><meta property="og:description" content="ä»‹ç»åœ¨ centos7 ç¯å¢ƒä¸­é€šè¿‡ ceph-deploy éƒ¨ç½² ceph-v12 (natuilus) é›†ç¾¤å’Œå¯è§†åŒ–çš„ dashboard"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/posts/tech/ceph-v12-nautilus-cephdeploy/"><meta property="og:image" content="https://image.lvbibir.cn/blog/ceph.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-27T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://image.lvbibir.cn/blog/ceph.png"><meta name=twitter:title content="ceph | centos7 éƒ¨ç½² ceph-v12"><meta name=twitter:description content="ä»‹ç»åœ¨ centos7 ç¯å¢ƒä¸­é€šè¿‡ ceph-deploy éƒ¨ç½² ceph-v12 (natuilus) é›†ç¾¤å’Œå¯è§†åŒ–çš„ dashboard"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"ğŸ“š æ–‡ç« ","item":"https://www.lvbibir.cn/posts/"},{"@type":"ListItem","position":3,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://www.lvbibir.cn/posts/tech/"},{"@type":"ListItem","position":4,"name":"ceph | centos7 éƒ¨ç½² ceph-v12","item":"https://www.lvbibir.cn/posts/tech/ceph-v12-nautilus-cephdeploy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ceph | centos7 éƒ¨ç½² ceph-v12","name":"ceph | centos7 éƒ¨ç½² ceph-v12","description":"ä»‹ç»åœ¨ centos7 ç¯å¢ƒä¸­é€šè¿‡ ceph-deploy éƒ¨ç½² ceph-v12 (natuilus) é›†ç¾¤å’Œå¯è§†åŒ–çš„ dashboard","keywords":["linux","centos","ceph"],"articleBody":"0 å‰è¨€ æœ¬æ–‡å‚è€ƒä»¥ä¸‹é“¾æ¥:\nCeph-deploy å¿«é€Ÿéƒ¨ç½² Ceph åˆ†å¸ƒå¼å­˜å‚¨ centos 7 ä¸‹ Ceph é…ç½®å®‰è£… ceph luminous æ–°åŠŸèƒ½ä¹‹å†…ç½® dashboard ä¹‹ mgr åŠŸèƒ½æ¨¡å—é…ç½® ceph dashboard rgw ç®¡ç†åŠŸèƒ½çš„å¼€å¯ 1 åŸºæœ¬ç¯å¢ƒ ç‰©ç†ç¯å¢ƒï¼šVmware Workstaion ç³»ç»Ÿç‰ˆæœ¬ï¼šCentos-7.9-Minimal ä¸¤ä¸ª osd èŠ‚ç‚¹æ·»åŠ ä¸€å—è™šæ‹Ÿç£ç›˜ï¼Œå»ºè®®ä¸å°äº 20G ip hostname services 192.168.150.101 ceph-admin(ceph-deploy) mds1ã€mon1ã€mon_mgrã€ntp-server 192.168.150.102 ceph-node1 osd1 192.168.150.103 ceph-node2 osd2 2 å‰æœŸé…ç½® ä»¥ä¸‹æ“ä½œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€æ‰§è¡Œ\nä¿®æ”¹ä¸»æœºå\nhostnamectl set-hostname ceph-admin bash hostnamectl set-hostname ceph-node1 bash hostnamectl set-hostname ceph-node2 bash ä¿®æ”¹ hosts æ–‡ä»¶\nvim /etc/hosts 192.168.150.101 ceph-admin 192.168.150.102 ceph-node1 192.168.150.103 ceph-node2 å…³é—­é˜²ç«å¢™å’Œ selinuxã€ä¿®æ”¹ yum æºåŠå®‰è£…ä¸€äº›å¸¸ç”¨å·¥å…·\nè¿™é‡Œæä¾›äº†ä¸€ä¸ªç®€å•çš„ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬ç”¨æ¥åšä¸Šè¿°æ“ä½œï¼Œé€‚ç”¨äº Centos7\nchmod 777 init.sh ./init.sh init.sh æ–‡ä»¶å†…å®¹\n#!/bin/bash echo \"========start=============\" sed -i '/SELINUX/s/enforcing/disabled/' /etc/sysconfig/selinux setenforce 0 iptables -F systemctl disable firewalld systemctl stop firewalld echo \"====dowload wget=========\" yum install -y wget echo \"====backup repo===========\" mkdir /etc/yum.repos.d/bak mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/ echo \"====dowload aliyum-repo====\" wget http://mirrors.aliyun.com/repo/Centos-7.repo -O /etc/yum.repos.d/Centos-Base.repo wget http://mirrors.aliyun.com/repo/epel-7.repo -O /etc/yum.repos.d/epel.repo echo \"====upgrade yum============\" yum clean all yum makecache fast echo \"====dowload tools=========\" yum install -y net-tools vim bash-completion echo \"=========finish============\" æ¯ä¸ªèŠ‚ç‚¹å®‰è£…å’Œé…ç½® NTP (å®˜æ–¹æ¨èçš„æ˜¯é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹å…¨éƒ¨å®‰è£…å¹¶é…ç½® NTPï¼Œéœ€è¦ä¿è¯å„èŠ‚ç‚¹çš„ç³»ç»Ÿæ—¶é—´ä¸€è‡´ã€‚æ²¡æœ‰è‡ªå·±éƒ¨ç½² ntp æœåŠ¡å™¨ï¼Œå°±åœ¨çº¿åŒæ­¥ NTP)\nyum install chrony -y systemctl start chronyd systemctl enable chronyd ceph-admin\nvim /etc/chrony.conf systemctl restart chronyd chronyc sources è¿™é‡Œä½¿ç”¨é˜¿é‡Œäº‘çš„ ntp æœåŠ¡å™¨\nceph-node1ã€ceph-node2\nvim /etc/chrony.conf systemctl restart chronyd chronyc sources è¿™é‡ŒæŒ‡å®š ceph-admin èŠ‚ç‚¹çš„ ip å³å¯\næ·»åŠ  ceph æº\nyum -y install epel-release rpm --import http://mirrors.163.com/ceph/keys/release.asc rpm -Uvh --replacepkgs http://mirrors.163.com/ceph/rpm-nautilus/el7/noarch/ceph-release-1-1.el7.noarch.rpm å®‰è£…å®Œååº”æœ‰å¦‚ä¸‹å†…å®¹çš„ repo æ–‡ä»¶\n[Ceph] name=Ceph packages for $basearch baseurl=http://download.ceph.com/rpm-nautilus/el7/$basearch enabled=1 gpgcheck=1 type=rpm-md gpgkey=https://download.ceph.com/keys/release.asc [Ceph-noarch] name=Ceph noarch packages baseurl=http://download.ceph.com/rpm-nautilus/el7/noarch enabled=1 gpgcheck=1 type=rpm-md gpgkey=https://download.ceph.com/keys/release.asc [ceph-source] name=Ceph source packages baseurl=http://download.ceph.com/rpm-nautilus/el7/SRPMS enabled=1 gpgcheck=1 type=rpm-md gpgkey=https://download.ceph.com/keys/release.asc 3 ç£ç›˜å‡†å¤‡ ä»¥ä¸‹æ“ä½œåœ¨ osd èŠ‚ç‚¹ï¼ˆceph-node1ã€ceph-node2ï¼‰æ‰§è¡Œ\n# æ£€æŸ¥ç£ç›˜ [root@ceph-node1 ~]# fdisk -l /dev/sdb # æ ¼å¼åŒ–ç£ç›˜ [root@ceph-node1 ~]# parted -s /dev/sdb mklabel gpt mkpart primary xfs 0% 100% [root@ceph-node1 ~]# mkfs.xfs /dev/sdb -f # æŸ¥çœ‹ç£ç›˜æ ¼å¼ [root@ceph-node1 ~]# blkid -o value -s TYPE /dev/sdb xfs 4 å®‰è£… ceph é›†ç¾¤ é…ç½® ssh å…å¯†\n[root@ceph-admin ~]# ssh-keygen # ä¸€è·¯å›è½¦ [root@ceph-admin ~]# ssh-copy-id root@ceph-node1 [root@ceph-admin ~]# ssh-copy-id root@ceph-node2 å®‰è£… ceph-deploy\n[root@ceph-admin ~]# yum install -y python2-pip [root@ceph-admin ~]# yum install -y ceph-deploy åˆ›å»ºæ–‡ä»¶å¤¹ç”¨æˆ·å­˜æ”¾é›†ç¾¤æ–‡ä»¶\n[root@ceph-admin ~]# mkdir /root/my-ceph [root@ceph-admin ~]# cd /root/my-ceph/ åˆ›å»ºé›†ç¾¤, åé¢å¡«å†™ monit èŠ‚ç‚¹çš„ä¸»æœºåï¼Œè¿™é‡Œ monit èŠ‚ç‚¹å’Œç®¡ç†èŠ‚ç‚¹æ˜¯åŒä¸€å°æœºå™¨ï¼Œå³ ceph-admin\n[root@ceph-admin my-ceph]# ceph-deploy new ceph-admin [ceph_deploy.conf][DEBUG ] found configuration file at: /root/.cephdeploy.conf [ceph_deploy.cli][INFO ] Invoked (2.0.1): /usr/bin/ceph-deploy new ceph-admin [ceph_deploy.cli][INFO ] ceph-deploy options: [ceph_deploy.cli][INFO ] username : None [ceph_deploy.cli][INFO ] func : \u003cfunction new at 0x7f2217df3de8\u003e [ceph_deploy.cli][INFO ] verbose : False [ceph_deploy.cli][INFO ] overwrite_conf : False [ceph_deploy.cli][INFO ] quiet : False [ceph_deploy.cli][INFO ] cd_conf : [ceph_deploy.cli][INFO ] cluster : ceph [ceph_deploy.cli][INFO ] ssh_copykey : True [ceph_deploy.cli][INFO ] mon : ['ceph-admin'] [ceph_deploy.cli][INFO ] public_network : None [ceph_deploy.cli][INFO ] ceph_conf : None [ceph_deploy.cli][INFO ] cluster_network : None [ceph_deploy.cli][INFO ] default_release : False [ceph_deploy.cli][INFO ] fsid : None [ceph_deploy.new][DEBUG ] Creating new cluster named ceph [ceph_deploy.new][INFO ] making sure passwordless SSH succeeds [ceph-admin][DEBUG ] connected to host: ceph-admin [ceph-admin][DEBUG ] detect platform information from remote host [ceph-admin][DEBUG ] detect machine type [ceph-admin][DEBUG ] find the location of an executable [ceph-admin][INFO ] Running command: /usr/sbin/ip link show [ceph-admin][INFO ] Running command: /usr/sbin/ip addr show [ceph-admin][DEBUG ] IP addresses found: [u'192.168.150.101'] [ceph_deploy.new][DEBUG ] Resolving host ceph-admin [ceph_deploy.new][DEBUG ] Monitor ceph-admin at 192.168.150.101 [ceph_deploy.new][DEBUG ] Monitor initial members are ['ceph-admin'] [ceph_deploy.new][DEBUG ] Monitor addrs are ['192.168.150.101'] [ceph_deploy.new][DEBUG ] Creating a random mon key... [ceph_deploy.new][DEBUG ] Writing monitor keyring to ceph.mon.keyring... [ceph_deploy.new][DEBUG ] Writing initial config to ceph.conf... ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶\næ³¨æ„ï¼šmon_host å¿…é¡»å’Œ public network ç½‘ç»œæ˜¯åŒç½‘æ®µå†…\n[root@ceph-admin my-ceph]# vim ceph.conf # æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œå†…å®¹ ...... public_network = 192.168.150.0/24 osd_pool_default_size = 2 å¼€å§‹å®‰è£…\n[root@ceph-admin my-ceph]# ceph-deploy install --release nautilus ceph-admin ceph-node1 ceph-node2 # å‡ºç°ä»¥ä¸‹æç¤ºè¯´æ˜å®‰è£…æˆåŠŸ [ceph-node2][DEBUG ] Complete! [ceph-node2][INFO ] Running command: ceph --version [ceph-node2][DEBUG ] ceph version 12.2.13 (584a20eb0237c657dc0567da126be145106aa47e) nautilus (stable) åˆå§‹åŒ– monit ç›‘æ§èŠ‚ç‚¹ï¼Œå¹¶æ”¶é›†æ‰€æœ‰å¯†é’¥\n[root@ceph-admin my-ceph]# ceph-deploy mon create-initial [root@ceph-admin my-ceph]# ceph-deploy gatherkeys ceph-admin æ£€æŸ¥ OSD èŠ‚ç‚¹ä¸Šæ‰€æœ‰å¯ç”¨çš„ç£ç›˜\n[root@ceph-admin my-ceph]# ceph-deploy disk list ceph-node1 ceph-node2 åˆ é™¤æ‰€æœ‰ osd èŠ‚ç‚¹ä¸Šçš„åˆ†åŒºã€å‡†å¤‡ osd åŠæ¿€æ´» osd\nä¸»æœºä¸Šæœ‰å¤šå—ç£ç›˜è¦ä½œä¸º osd æ—¶æ–°å¢ --data å³å¯, æ¯ä¸ª --data åè·Ÿä¸€å—ç£ç›˜\n[root@ceph-admin my-ceph]# ceph-deploy osd create ceph-node1 --data /dev/sdb [root@ceph-admin my-ceph]# ceph-deploy osd create ceph-node2 --data /dev/sdb åœ¨ä¸¤ä¸ª osd èŠ‚ç‚¹ä¸Šé€šè¿‡å‘½ä»¤å·²æ˜¾ç¤ºç£ç›˜å·²æˆåŠŸ mount\n[root@ceph-node1 ~]# lsblk æŸ¥çœ‹ osd\n[root@ceph-admin my-ceph]# ceph-deploy disk list ceph-node1 ceph-node2 ...... ...... [ceph-node1][INFO ] Disk /dev/mapper/ceph--2bb0ec8d--547c--42c2--9858--08ccfd043bd4-osd--block--33e8dba4--6dfc--4753--b9ba--0d0c54166f0c: 21.5 GB, 21470642176 bytes, 41934848 sectors ...... ...... [ceph-node2][INFO ] Disk /dev/mapper/ceph--f9a95e6c--fc7b--46b4--a835--dd997c0d6335-osd--block--db903124--4c01--40d7--8a58--b26e17c1db29: 21.5 GB, 21470642176 bytes, 41934848 sectors åŒæ­¥é›†ç¾¤æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ ceph å‘½ä»¤äº†\n[root@ceph-admin my-ceph]# ceph-deploy admin ceph-admin ceph-node1 ceph-node2 åœ¨å…¶ä»–èŠ‚ç‚¹æŸ¥çœ‹ osd çš„ç›®å½•æ ‘\n[root@ceph-node1 ~]# ceph osd tree ID CLASS WEIGHT TYPE NAME STATUS REWEIGHT PRI-AFF -1 0.03897 root default -3 0.01949 host ceph-node1 0 hdd 0.01949 osd.0 up 1.00000 1.00000 -5 0.01949 host ceph-node2 1 hdd 0.01949 osd.1 up 1.00000 1.00000 é…ç½® mgr\n[root@ceph-admin my-ceph]# ceph-deploy mgr create ceph-admin æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å’Œé›†ç¾¤ service çŠ¶æ€\næ­¤æ—¶æ˜¯ HEALTH_WARN çŠ¶æ€ï¼Œæ˜¯ç”±äºå¯ç”¨äº†ä¸å®‰å…¨æ¨¡å¼\n[root@ceph-admin my-ceph]# ceph health HEALTH_WARN mon is allowing insecure global_id reclaim [root@ceph-admin my-ceph]# ceph -s cluster: id: fd816347-598c-4ed6-b356-591a618a0bdc health: HEALTH_WARN mon is allowing insecure global_id reclaim services: mon: 1 daemons, quorum ceph-admin (age 3h) mgr: mon_mgr(active, since 17s) osd: 2 osds: 2 up (since 3m), 2 in (since 3m) data: pools: 0 pools, 0 pgs objects: 0 objects, 0 B usage: 2.0 GiB used, 38 GiB / 40 GiB avail pgs: ç¦ç”¨ä¸å®‰å…¨æ¨¡å¼\n[root@ceph-admin my-ceph]# ceph config set mon auth_allow_insecure_global_id_reclaim false [root@ceph-admin my-ceph]# ceph health HEALTH_OK 5 å¼€å¯ dashboard [root@ceph-admin my-ceph]# yum install -y ceph-mgr-dashboard [root@ceph-admin my-ceph]# ceph mgr module enable dashboard # åˆ›å»ºè‡ªç­¾è¯ä¹¦ [root@ceph-admin my-ceph]# ceph dashboard create-self-signed-cert # åˆ›å»ºå¯†ç æ–‡ä»¶ [root@ceph-admin my-ceph]# echo abc123 \u003e ./dashboard_user_pw # åˆ›å»ºdashboardçš„ç™»å½•ç”¨æˆ· [root@ceph-admin my-ceph]# ceph dashboard ac-user-create admin -i ./dashboard_user_pw administrator {\"username\": \"admin\", \"lastUpdate\": 1646037503, \"name\": null, \"roles\": [\"administrator\"], \"password\": \"$2b$12$jGsvau8jFMb4pDwLU/t8KO1sKvmBMcNUYycbXusmgkvTQzlzrMyKi\", \"email\": null} [root@ceph-admin my-ceph]# ceph mgr services { \"dashboard\": \"https://ceph-admin:8443/\" } æµ‹è¯•è®¿é—®\nä¸Šå›¾ä¸­æµ‹è¯•ç¯å¢ƒæ˜¯ win10+chromeï¼ŒåŒäº‹ååº” mac+chrome ä¼šå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼ŒåŸå› æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„è‡ªç­¾è¯ä¹¦ï¼Œæµè§ˆå™¨å¹¶ä¸ä¿¡ä»»æ­¤è¯ä¹¦ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è§£å†³\nå…³é—­ dashboard çš„ ssl è®¿é—® ä¸‹è½½è¯ä¹¦é…ç½®æµè§ˆå™¨ä¿¡ä»»è¯ä¹¦ 5.1 å…³é—­ ssl [root@ceph-admin my-ceph]# ceph config set mgr mgr/dashboard/ssl false [root@ceph-admin my-ceph]# ceph mgr module disable dashboard [root@ceph-admin my-ceph]# ceph mgr module enable dashboard [root@ceph-admin my-ceph]# ceph mgr services { \"dashboard\": \"http://ceph-admin:8080/\" } å¦‚æœå‡ºç° Module 'dashboard' has failed: IOError(\"Port 8443 not free on '::'\",) è¿™ç§æŠ¥é”™ï¼Œéœ€è¦é‡å¯ä¸‹ mgrï¼šsystemctl restart ceph-mgr@ceph-admin\næµ‹è¯•è®¿é—®\n5.2 å¼€å¯ rgw é»˜è®¤ object gateway åŠŸèƒ½æ²¡æœ‰å¼€å¯\nåˆ›å»º rgw å®ä¾‹\nceph-deploy rgw create ceph-admin é»˜è®¤è¿è¡Œç«¯å£æ˜¯ 7480\nåˆ›å»º rgw ç”¨æˆ·\n[root@ceph-admin my-ceph]# radosgw-admin user create --uid=rgw --display-name=rgw --system æä¾› dashboard è¯ä¹¦\n[root@ceph-admin my-ceph]# echo UI2T50HNZUCVVYYZNDHP \u003e rgw_user_access_key [root@ceph-admin my-ceph]# echo 11rg0WbXuh2Svexck3vJKs19u1UQINixDWIpN5Dq \u003e rgw_user_secret_key [root@ceph-admin my-ceph]# ceph dashboard set-rgw-api-access-key -i rgw_user_access_key Option RGW_API_ACCESS_KEY updated [root@ceph-admin my-ceph]# ceph dashboard set-rgw-api-secret-key -i rgw_user_secret_key Option RGW_API_SECRET_KEY updated ç¦ç”¨ ssl\n[root@ceph-admin my-ceph]# ceph dashboard set-rgw-api-ssl-verify False Option RGW_API_SSL_VERIFY updated å¯ç”¨ rgw\n[root@ceph-admin my-ceph]# ceph dashboard set-rgw-api-host 192.168.150.101 Option RGW_API_HOST updated [root@ceph-admin my-ceph]# ceph dashboard set-rgw-api-port 7480 Option RGW_API_PORT updated [root@ceph-admin my-ceph]# ceph dashboard set-rgw-api-scheme http Option RGW_API_SCHEME updated [root@ceph-admin my-ceph]# ceph dashboard set-rgw-api-user-id rgw Option RGW_API_USER_ID updated [root@ceph-admin my-ceph]# systemctl restart ceph-radosgw.target éªŒè¯\nç›®å‰ object gateway åŠŸèƒ½å·²æˆåŠŸå¼€å¯\n6 å…¶ä»– 6.1 æ¸…é™¤ ceph é›†ç¾¤ æ¸…é™¤å®‰è£…åŒ…\n[root@ceph-admin ~]# ceph-deploy purge ceph-admin ceph-node1 ceph-node2 æ¸…é™¤é…ç½®ä¿¡æ¯\n[root@ceph-admin ~]# ceph-deploy purgedata ceph-admin ceph-node1 ceph-node2 [root@ceph-admin ~]# ceph-deploy forgetkeys æ¯ä¸ªèŠ‚ç‚¹åˆ é™¤æ®‹ç•™çš„é…ç½®æ–‡ä»¶\nrm -rf /var/lib/ceph/osd/* rm -rf /var/lib/ceph/mon/* rm -rf /var/lib/ceph/mds/* rm -rf /var/lib/ceph/bootstrap-mds/* rm -rf /var/lib/ceph/bootstrap-osd/* rm -rf /var/lib/ceph/bootstrap-mon/* rm -rf /var/lib/ceph/tmp/* rm -rf /etc/ceph/* rm -rf /var/run/ceph/* æ¸…ç†ç£ç›˜è®¾å¤‡ (/dev/mapper/ceph*)\nls /dev/mapper/ceph-* | xargs -I% -- dmsetup remove % 6.2 dashboard æ— æ³•è®¿é—®çš„é—®é¢˜ åœ¨å…³é—­ dashboard çš„ https åï¼Œå‡ºç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œä½¿ç”¨ chrome æµè§ˆå™¨æ— æ³•è®¿é—® dashboard äº†ï¼Œedge æˆ–è€…ä½¿ç”¨ chrome æ— ç—•æ¨¡å¼å¯ä»¥æ­£å¸¸è®¿é—®ï¼ŒæœŸé—´å°è¯•äº†å„ç§æ–¹æ³•åŒ…æ‹¬é‡æ–°é…ç½® dashboard å’Œæ¸…ç† chrome æµè§ˆå™¨çš„ç¼“å­˜å’Œ cookie ç­‰æ–¹å¼éƒ½æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œç»“æœç¬¬äºŒå¤©èµ·æ¥æ‰“å¼€ç¯å¢ƒä¸€çœ‹è‡ªå·±å¥½äº† ï¼ï¹ï¼œ\né—®é¢˜æƒ…å†µè§ä¸‹å›¾\næ—¥å¿—æŠ¥é”™ï¼š\n6.3 åŒæ­¥é…ç½®æ–‡ä»¶ ceph-deploy --overwrite-conf config push ceph-node{1,2,3,4} 6.4 æ·»åŠ  mon èŠ‚ç‚¹å’Œ mgr èŠ‚ç‚¹ ceph-deploy mon create ceph-node{1,2,3,4} ceph-deploy mgr create ceph-node{1,2,3,4} è®°å¾—ä¿®æ”¹é…ç½®æ–‡ä»¶\nä¹‹ååŒæ­¥é…ç½®æ–‡ä»¶\nceph-deploy --overwrite-conf config push ceph-node{1,2,3,4} ä»¥ä¸Š\n","wordCount":"2081","inLanguage":"en","image":"https://image.lvbibir.cn/blog/ceph.png","datePublished":"2021-12-01T00:00:00Z","dateModified":"2024-01-27T00:00:00Z","author":{"@type":"Person","name":"lvbibir"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/posts/tech/ceph-v12-nautilus-cephdeploy/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://image.lvbibir.cn/blog/avatar.webp"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://image.lvbibir.cn/blog/avatar.webp alt aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li class=menu-item><a href=https://www.lvbibir.cn/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/archives title="ğŸ“ˆ å½’æ¡£"><span>ğŸ“ˆ å½’æ¡£</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/talk title="ğŸ’¬ è¯´è¯´"><span>ğŸ’¬ è¯´è¯´</span></a></li><li class=menu-item><a href=https://www.lvbibir.cn/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/>ğŸ“š æ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://www.lvbibir.cn/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>ceph | centos7 éƒ¨ç½² ceph-v12</h1><div class=post-description>ä»‹ç»åœ¨ centos7 ç¯å¢ƒä¸­é€šè¿‡ ceph-deploy éƒ¨ç½² ceph-v12 (natuilus) é›†ç¾¤å’Œå¯è§†åŒ–çš„ dashboard</div><div class=post-meta>åˆ›å»º:&nbsp;<span title='2021-12-01 00:00:00 +0000 UTC'>2021-12-01</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2024-01-27&nbsp;|&nbsp;å­—æ•°:&nbsp;2081å­—&nbsp;|&nbsp;ä½œè€…:&nbsp;lvbibir
|&nbsp;æ ‡ç­¾:&nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/tags/ceph/>ceph</a></ul><span id=busuanzi_container_page_pv>&nbsp;|&nbsp;è®¿é—®:&nbsp;<span id=busuanzi_page_pv></span></span></div></header><button id=toc-toggle-btn class=toc-toggle-btn aria-label="Toggle Table of Contents" title=æ–‡ç« ç›®å½•><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg></button><div id=toc-overlay class=toc-overlay></div><aside id=toc-container class="toc-container wide"><button id=toc-close-btn class=toc-close-btn aria-label="Close Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>æ–‡ç« ç›®å½•</span></summary><div class=inner><ul><li><a href=#0-%e5%89%8d%e8%a8%80 aria-label="0 å‰è¨€">0 å‰è¨€</a></li><li><a href=#1-%e5%9f%ba%e6%9c%ac%e7%8e%af%e5%a2%83 aria-label="1 åŸºæœ¬ç¯å¢ƒ">1 åŸºæœ¬ç¯å¢ƒ</a></li><li><a href=#2-%e5%89%8d%e6%9c%9f%e9%85%8d%e7%bd%ae aria-label="2 å‰æœŸé…ç½®">2 å‰æœŸé…ç½®</a></li><li><a href=#3-%e7%a3%81%e7%9b%98%e5%87%86%e5%a4%87 aria-label="3 ç£ç›˜å‡†å¤‡">3 ç£ç›˜å‡†å¤‡</a></li><li><a href=#4-%e5%ae%89%e8%a3%85-ceph-%e9%9b%86%e7%be%a4 aria-label="4 å®‰è£… ceph é›†ç¾¤">4 å®‰è£… ceph é›†ç¾¤</a></li><li><a href=#5-%e5%bc%80%e5%90%af-dashboard aria-label="5 å¼€å¯ dashboard">5 å¼€å¯ dashboard</a><ul><li><a href=#51-%e5%85%b3%e9%97%ad-ssl aria-label="5.1 å…³é—­ ssl">5.1 å…³é—­ ssl</a></li><li><a href=#52-%e5%bc%80%e5%90%af-rgw aria-label="5.2 å¼€å¯ rgw">5.2 å¼€å¯ rgw</a></li></ul></li><li><a href=#6-%e5%85%b6%e4%bb%96 aria-label="6 å…¶ä»–">6 å…¶ä»–</a><ul><li><a href=#61-%e6%b8%85%e9%99%a4-ceph-%e9%9b%86%e7%be%a4 aria-label="6.1 æ¸…é™¤ ceph é›†ç¾¤">6.1 æ¸…é™¤ ceph é›†ç¾¤</a></li><li><a href=#62-dashboard-%e6%97%a0%e6%b3%95%e8%ae%bf%e9%97%ae%e7%9a%84%e9%97%ae%e9%a2%98 aria-label="6.2 dashboard æ— æ³•è®¿é—®çš„é—®é¢˜">6.2 dashboard æ— æ³•è®¿é—®çš„é—®é¢˜</a></li><li><a href=#63-%e5%90%8c%e6%ad%a5%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="6.3 åŒæ­¥é…ç½®æ–‡ä»¶">6.3 åŒæ­¥é…ç½®æ–‡ä»¶</a></li><li><a href=#64-%e6%b7%bb%e5%8a%a0-mon-%e8%8a%82%e7%82%b9%e5%92%8c-mgr-%e8%8a%82%e7%82%b9 aria-label="6.4 æ·»åŠ  mon èŠ‚ç‚¹å’Œ mgr èŠ‚ç‚¹">6.4 æ·»åŠ  mon èŠ‚ç‚¹å’Œ mgr èŠ‚ç‚¹</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;const tocContainer=document.getElementById("toc-container"),tocToggleBtn=document.getElementById("toc-toggle-btn"),tocCloseBtn=document.getElementById("toc-close-btn"),tocOverlay=document.getElementById("toc-overlay");window.addEventListener('DOMContentLoaded',function(){if(checkTocPosition(),elements=document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]'),elements.length>0){activeElement=elements[0];const t=encodeURI(activeElement.getAttribute('id')).toLowerCase(),e=document.querySelector(`.inner ul li a[href="#${t}"]`);e&&e.classList.add('active')}},!1),window.addEventListener('resize',function(){checkTocPosition()},!1),window.addEventListener('scroll',()=>{if(!elements||elements.length===0)return;activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(t=>{const n=encodeURI(t.getAttribute('id')).toLowerCase(),e=document.querySelector(`.inner ul li a[href="#${n}"]`);e&&(t===activeElement?e.classList.add('active'):e.classList.remove('active'))})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue('--gap'),10);let isWideMode=!1,isTocVisible=!0;function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?(isWideMode=!0,isTocVisible?(tocContainer.classList.add("wide"),tocContainer.classList.remove("collapsed"),tocContainer.classList.remove("mobile-popup"),tocToggleBtn.classList.add("active")):(tocContainer.classList.remove("wide"),tocContainer.classList.add("collapsed"),tocContainer.classList.remove("mobile-popup"),tocToggleBtn.classList.remove("active")),closeTocPopup()):(isWideMode=!1,tocContainer.classList.remove("wide"),tocContainer.classList.contains("mobile-popup")||tocContainer.classList.add("collapsed"),tocContainer.classList.contains("active")?tocToggleBtn.classList.add("active"):tocToggleBtn.classList.remove("active"))}function openTocPopup(){tocContainer.classList.remove("collapsed"),tocContainer.classList.add("mobile-popup"),tocContainer.classList.add("active"),tocOverlay.classList.add("active"),tocToggleBtn.classList.add("active"),document.body.style.overflow="hidden"}function closeTocPopup(){tocContainer.classList.remove("active"),tocOverlay.classList.remove("active"),document.body.style.overflow="",setTimeout(()=>{tocContainer.classList.contains("active")||(tocContainer.classList.remove("mobile-popup"),(!isWideMode||!isTocVisible)&&tocContainer.classList.add("collapsed"))},300)}function toggleToc(){isWideMode?(isTocVisible=!isTocVisible,isTocVisible?(tocContainer.classList.add("wide"),tocContainer.classList.remove("collapsed"),tocToggleBtn.classList.add("active")):(tocContainer.classList.remove("wide"),tocContainer.classList.add("collapsed"),tocToggleBtn.classList.remove("active"))):tocContainer.classList.contains("active")?(closeTocPopup(),tocToggleBtn.classList.remove("active")):openTocPopup()}tocToggleBtn.addEventListener('click',function(){toggleToc()}),tocCloseBtn.addEventListener('click',function(){closeTocPopup(),tocToggleBtn.classList.remove("active")}),tocOverlay.addEventListener('click',function(){closeTocPopup(),tocToggleBtn.classList.remove("active")}),tocContainer.querySelectorAll('.inner a').forEach(function(e){e.addEventListener('click',function(){tocContainer.classList.contains("mobile-popup")&&(closeTocPopup(),tocToggleBtn.classList.remove("active"))})}),document.addEventListener('keydown',function(e){e.key==='Escape'&&tocContainer.classList.contains("active")&&(closeTocPopup(),tocToggleBtn.classList.remove("active"))});function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=0-å‰è¨€>0 å‰è¨€<a hidden class=anchor aria-hidden=true href=#0-å‰è¨€>#</a></h1><p>æœ¬æ–‡å‚è€ƒä»¥ä¸‹é“¾æ¥:</p><ul><li><a href=https://www.cnblogs.com/kevingrace/p/9141432.html target=_blank rel=noopener style=color:#42b983 ;>Ceph-deploy å¿«é€Ÿéƒ¨ç½² Ceph åˆ†å¸ƒå¼å­˜å‚¨</a></li><li><a href=https://www.cnblogs.com/weijie0717/p/8378485.html target=_blank rel=noopener style=color:#42b983 ;>centos 7 ä¸‹ Ceph é…ç½®å®‰è£…</a></li><li><a href=https://www.cnblogs.com/weijie0717/p/8383938.html target=_blank rel=noopener style=color:#42b983 ;>ceph luminous æ–°åŠŸèƒ½ä¹‹å†…ç½® dashboard ä¹‹ mgr åŠŸèƒ½æ¨¡å—é…ç½®</a></li><li><a href=https://blog.csdn.net/qq_40017427/article/details/106235456 target=_blank rel=noopener style=color:#42b983 ;>ceph dashboard rgw ç®¡ç†åŠŸèƒ½çš„å¼€å¯</a></li></ul><h1 id=1-åŸºæœ¬ç¯å¢ƒ>1 åŸºæœ¬ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#1-åŸºæœ¬ç¯å¢ƒ>#</a></h1><ul><li>ç‰©ç†ç¯å¢ƒï¼šVmware Workstaion</li><li>ç³»ç»Ÿç‰ˆæœ¬ï¼šCentos-7.9-Minimal</li><li>ä¸¤ä¸ª osd èŠ‚ç‚¹æ·»åŠ ä¸€å—è™šæ‹Ÿç£ç›˜ï¼Œå»ºè®®ä¸å°äº 20G</li></ul><table><thead><tr><th>ip</th><th>hostname</th><th>services</th></tr></thead><tbody><tr><td>192.168.150.101</td><td>ceph-admin(ceph-deploy)</td><td>mds1ã€mon1ã€mon_mgrã€ntp-server</td></tr><tr><td>192.168.150.102</td><td>ceph-node1</td><td>osd1</td></tr><tr><td>192.168.150.103</td><td>ceph-node2</td><td>osd2</td></tr></tbody></table><h1 id=2-å‰æœŸé…ç½®>2 å‰æœŸé…ç½®<a hidden class=anchor aria-hidden=true href=#2-å‰æœŸé…ç½®>#</a></h1><p>ä»¥ä¸‹æ“ä½œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€æ‰§è¡Œ</p><p>ä¿®æ”¹ä¸»æœºå</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hostnamectl set-hostname ceph-admin
</span></span><span style=display:flex><span>bash
</span></span><span style=display:flex><span>hostnamectl set-hostname ceph-node1
</span></span><span style=display:flex><span>bash
</span></span><span style=display:flex><span>hostnamectl set-hostname ceph-node2
</span></span><span style=display:flex><span>bash
</span></span></code></pre></div><p>ä¿®æ”¹ hosts æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/hosts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>192.168.150.101 ceph-admin
</span></span><span style=display:flex><span>192.168.150.102 ceph-node1
</span></span><span style=display:flex><span>192.168.150.103 ceph-node2
</span></span></code></pre></div><p>å…³é—­é˜²ç«å¢™å’Œ selinuxã€ä¿®æ”¹ yum æºåŠå®‰è£…ä¸€äº›å¸¸ç”¨å·¥å…·</p><p>è¿™é‡Œæä¾›äº†ä¸€ä¸ªç®€å•çš„ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬ç”¨æ¥åšä¸Šè¿°æ“ä½œï¼Œé€‚ç”¨äº Centos7</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#f99b15>777</span> init.sh
</span></span><span style=display:flex><span>./init.sh
</span></span></code></pre></div><p>init.sh æ–‡ä»¶å†…å®¹</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#776e71>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#776e71></span>
</span></span><span style=display:flex><span>echo <span style=color:#48b685>&#34;========start=============&#34;</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#48b685>&#39;/SELINUX/s/enforcing/disabled/&#39;</span> /etc/sysconfig/selinux
</span></span><span style=display:flex><span>setenforce <span style=color:#f99b15>0</span>
</span></span><span style=display:flex><span>iptables -F
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span><span style=display:flex><span>systemctl stop firewalld
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#48b685>&#34;====dowload wget=========&#34;</span>
</span></span><span style=display:flex><span>yum install -y wget
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#48b685>&#34;====backup repo===========&#34;</span>
</span></span><span style=display:flex><span>mkdir /etc/yum.repos.d/bak
</span></span><span style=display:flex><span>mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/ 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#48b685>&#34;====dowload aliyum-repo====&#34;</span>
</span></span><span style=display:flex><span>wget http://mirrors.aliyun.com/repo/Centos-7.repo -O /etc/yum.repos.d/Centos-Base.repo
</span></span><span style=display:flex><span>wget http://mirrors.aliyun.com/repo/epel-7.repo -O /etc/yum.repos.d/epel.repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#48b685>&#34;====upgrade yum============&#34;</span>
</span></span><span style=display:flex><span>yum clean all
</span></span><span style=display:flex><span>yum makecache fast
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#48b685>&#34;====dowload tools=========&#34;</span>
</span></span><span style=display:flex><span>yum install -y net-tools vim bash-completion
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#48b685>&#34;=========finish============&#34;</span>
</span></span></code></pre></div><p>æ¯ä¸ªèŠ‚ç‚¹å®‰è£…å’Œé…ç½® NTP (å®˜æ–¹æ¨èçš„æ˜¯é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹å…¨éƒ¨å®‰è£…å¹¶é…ç½® NTPï¼Œéœ€è¦ä¿è¯å„èŠ‚ç‚¹çš„ç³»ç»Ÿæ—¶é—´ä¸€è‡´ã€‚æ²¡æœ‰è‡ªå·±éƒ¨ç½² ntp æœåŠ¡å™¨ï¼Œå°±åœ¨çº¿åŒæ­¥ NTP)</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install chrony -y
</span></span><span style=display:flex><span>systemctl start chronyd
</span></span><span style=display:flex><span>systemctl enable chronyd
</span></span></code></pre></div><p>ceph-admin</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/chrony.conf
</span></span><span style=display:flex><span>systemctl restart chronyd
</span></span><span style=display:flex><span>chronyc sources
</span></span></code></pre></div><p>è¿™é‡Œä½¿ç”¨é˜¿é‡Œäº‘çš„ ntp æœåŠ¡å™¨</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20211206142640253.png alt=image-20211206142640253 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20211206142640253.png alt=image-20211206142640253></noscript></p><p>ceph-node1ã€ceph-node2</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/chrony.conf
</span></span><span style=display:flex><span>systemctl restart chronyd
</span></span><span style=display:flex><span>chronyc sources
</span></span></code></pre></div><p>è¿™é‡ŒæŒ‡å®š ceph-admin èŠ‚ç‚¹çš„ ip å³å¯</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20211206142908590.png alt=image-20211206142908590 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20211206142908590.png alt=image-20211206142908590></noscript></p><p>æ·»åŠ  ceph æº</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum -y install epel-release
</span></span><span style=display:flex><span>rpm --import http://mirrors.163.com/ceph/keys/release.asc
</span></span><span style=display:flex><span>rpm -Uvh --replacepkgs http://mirrors.163.com/ceph/rpm-nautilus/el7/noarch/ceph-release-1-1.el7.noarch.rpm
</span></span></code></pre></div><p>å®‰è£…å®Œååº”æœ‰å¦‚ä¸‹å†…å®¹çš„ repo æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>[Ceph]
</span></span><span style=display:flex><span>name=Ceph packages for $basearch
</span></span><span style=display:flex><span>baseurl=http://download.ceph.com/rpm-nautilus/el7/$basearch
</span></span><span style=display:flex><span>enabled=1
</span></span><span style=display:flex><span>gpgcheck=1
</span></span><span style=display:flex><span>type=rpm-md
</span></span><span style=display:flex><span>gpgkey=https://download.ceph.com/keys/release.asc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Ceph-noarch]
</span></span><span style=display:flex><span>name=Ceph noarch packages
</span></span><span style=display:flex><span>baseurl=http://download.ceph.com/rpm-nautilus/el7/noarch
</span></span><span style=display:flex><span>enabled=1
</span></span><span style=display:flex><span>gpgcheck=1
</span></span><span style=display:flex><span>type=rpm-md
</span></span><span style=display:flex><span>gpgkey=https://download.ceph.com/keys/release.asc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[ceph-source]
</span></span><span style=display:flex><span>name=Ceph source packages
</span></span><span style=display:flex><span>baseurl=http://download.ceph.com/rpm-nautilus/el7/SRPMS
</span></span><span style=display:flex><span>enabled=1
</span></span><span style=display:flex><span>gpgcheck=1
</span></span><span style=display:flex><span>type=rpm-md
</span></span><span style=display:flex><span>gpgkey=https://download.ceph.com/keys/release.asc
</span></span></code></pre></div><h1 id=3-ç£ç›˜å‡†å¤‡>3 ç£ç›˜å‡†å¤‡<a hidden class=anchor aria-hidden=true href=#3-ç£ç›˜å‡†å¤‡>#</a></h1><p>ä»¥ä¸‹æ“ä½œåœ¨ osd èŠ‚ç‚¹ï¼ˆceph-node1ã€ceph-node2ï¼‰æ‰§è¡Œ</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#776e71># æ£€æŸ¥ç£ç›˜</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># fdisk -l /dev/sdb</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># æ ¼å¼åŒ–ç£ç›˜</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># parted -s /dev/sdb mklabel gpt mkpart primary xfs 0% 100%</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># mkfs.xfs /dev/sdb -f</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># æŸ¥çœ‹ç£ç›˜æ ¼å¼</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># blkid -o value -s TYPE /dev/sdb</span>
</span></span><span style=display:flex><span>xfs
</span></span></code></pre></div><h1 id=4-å®‰è£…-ceph-é›†ç¾¤>4 å®‰è£… ceph é›†ç¾¤<a hidden class=anchor aria-hidden=true href=#4-å®‰è£…-ceph-é›†ç¾¤>#</a></h1><p>é…ç½® ssh å…å¯†</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ssh-keygen</span>
</span></span><span style=display:flex><span><span style=color:#776e71># ä¸€è·¯å›è½¦</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ssh-copy-id root@ceph-node1</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ssh-copy-id root@ceph-node2</span>
</span></span></code></pre></div><p>å®‰è£… ceph-deploy</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># yum install -y python2-pip</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># yum install -y ceph-deploy</span>
</span></span></code></pre></div><p>åˆ›å»ºæ–‡ä»¶å¤¹ç”¨æˆ·å­˜æ”¾é›†ç¾¤æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># mkdir /root/my-ceph</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># cd /root/my-ceph/</span>
</span></span></code></pre></div><p>åˆ›å»ºé›†ç¾¤, åé¢å¡«å†™ monit èŠ‚ç‚¹çš„ä¸»æœºåï¼Œè¿™é‡Œ monit èŠ‚ç‚¹å’Œç®¡ç†èŠ‚ç‚¹æ˜¯åŒä¸€å°æœºå™¨ï¼Œå³ ceph-admin</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy new ceph-admin</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.conf<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> found configuration file at: /root/.cephdeploy.conf
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> Invoked <span style=color:#5bc4bf>(</span>2.0.1<span style=color:#5bc4bf>)</span>: /usr/bin/ceph-deploy new ceph-admin
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> ceph-deploy options:
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  username                      : None
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  func                          : &lt;<span style=color:#815ba4>function</span> new at 0x7f2217df3de8&gt;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  verbose                       : False
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  overwrite_conf                : False
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  quiet                         : False
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf instance at 0x7f221756e4d0&gt;
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  cluster                       : ceph
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  ssh_copykey                   : True
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  mon                           : <span style=color:#5bc4bf>[</span><span style=color:#48b685>&#39;ceph-admin&#39;</span><span style=color:#5bc4bf>]</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  public_network                : None
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  ceph_conf                     : None
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  cluster_network               : None
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  default_release               : False
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.cli<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span>  fsid                          : None
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Creating new cluster named ceph
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> making sure passwordless SSH succeeds
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-admin<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> connected to host: ceph-admin
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-admin<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> detect platform information from remote host
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-admin<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> detect machine type
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-admin<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> find the location of an executable
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-admin<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> Running command: /usr/sbin/ip link show
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-admin<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> Running command: /usr/sbin/ip addr show
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-admin<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> IP addresses found: <span style=color:#5bc4bf>[</span>u<span style=color:#48b685>&#39;192.168.150.101&#39;</span><span style=color:#5bc4bf>]</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Resolving host ceph-admin
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Monitor ceph-admin at 192.168.150.101
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Monitor initial members are <span style=color:#5bc4bf>[</span><span style=color:#48b685>&#39;ceph-admin&#39;</span><span style=color:#5bc4bf>]</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Monitor addrs are <span style=color:#5bc4bf>[</span><span style=color:#48b685>&#39;192.168.150.101&#39;</span><span style=color:#5bc4bf>]</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Creating a random mon key...
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Writing monitor keyring to ceph.mon.keyring...
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph_deploy.new<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Writing initial config to ceph.conf...
</span></span></code></pre></div><p>ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶</p><p>æ³¨æ„ï¼šmon_host å¿…é¡»å’Œ public network ç½‘ç»œæ˜¯åŒç½‘æ®µå†…</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># vim ceph.conf</span>
</span></span><span style=display:flex><span><span style=color:#776e71># æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œå†…å®¹</span>
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span><span style=color:#ef6155>public_network</span> <span style=color:#5bc4bf>=</span> 192.168.150.0/24
</span></span><span style=display:flex><span><span style=color:#ef6155>osd_pool_default_size</span> <span style=color:#5bc4bf>=</span> <span style=color:#f99b15>2</span>
</span></span></code></pre></div><p>å¼€å§‹å®‰è£…</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy install --release nautilus ceph-admin ceph-node1 ceph-node2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#776e71># å‡ºç°ä»¥ä¸‹æç¤ºè¯´æ˜å®‰è£…æˆåŠŸ</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-node2<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> Complete!
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-node2<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> Running command: ceph --version
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-node2<span style=color:#5bc4bf>][</span>DEBUG <span style=color:#5bc4bf>]</span> ceph version 12.2.13 <span style=color:#5bc4bf>(</span>584a20eb0237c657dc0567da126be145106aa47e<span style=color:#5bc4bf>)</span> nautilus <span style=color:#5bc4bf>(</span>stable<span style=color:#5bc4bf>)</span>
</span></span></code></pre></div><p>åˆå§‹åŒ– monit ç›‘æ§èŠ‚ç‚¹ï¼Œå¹¶æ”¶é›†æ‰€æœ‰å¯†é’¥</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy mon create-initial</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy gatherkeys ceph-admin</span>
</span></span></code></pre></div><p>æ£€æŸ¥ OSD èŠ‚ç‚¹ä¸Šæ‰€æœ‰å¯ç”¨çš„ç£ç›˜</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy disk list ceph-node1 ceph-node2</span>
</span></span></code></pre></div><p>åˆ é™¤æ‰€æœ‰ osd èŠ‚ç‚¹ä¸Šçš„åˆ†åŒºã€å‡†å¤‡ osd åŠæ¿€æ´» osd</p><p>ä¸»æœºä¸Šæœ‰å¤šå—ç£ç›˜è¦ä½œä¸º osd æ—¶æ–°å¢ <code>--data</code> å³å¯, æ¯ä¸ª <code>--data</code> åè·Ÿä¸€å—ç£ç›˜</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>[root@ceph-admin my-ceph]# ceph-deploy osd create ceph-node1 --data /dev/sdb
</span></span><span style=display:flex><span>[root@ceph-admin my-ceph]# ceph-deploy osd create ceph-node2 --data /dev/sdb
</span></span></code></pre></div><p>åœ¨ä¸¤ä¸ª osd èŠ‚ç‚¹ä¸Šé€šè¿‡å‘½ä»¤å·²æ˜¾ç¤ºç£ç›˜å·²æˆåŠŸ mount</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># lsblk                       </span>
</span></span></code></pre></div><p>æŸ¥çœ‹ osd</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy disk list ceph-node1 ceph-node2</span>
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-node1<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> Disk /dev/mapper/ceph--2bb0ec8d--547c--42c2--9858--08ccfd043bd4-osd--block--33e8dba4--6dfc--4753--b9ba--0d0c54166f0c: 21.5 GB, <span style=color:#f99b15>21470642176</span> bytes, <span style=color:#f99b15>41934848</span> sectors
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>ceph-node2<span style=color:#5bc4bf>][</span>INFO  <span style=color:#5bc4bf>]</span> Disk /dev/mapper/ceph--f9a95e6c--fc7b--46b4--a835--dd997c0d6335-osd--block--db903124--4c01--40d7--8a58--b26e17c1db29: 21.5 GB, <span style=color:#f99b15>21470642176</span> bytes, <span style=color:#f99b15>41934848</span> sectors
</span></span></code></pre></div><p>åŒæ­¥é›†ç¾¤æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ ceph å‘½ä»¤äº†</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy admin ceph-admin ceph-node1 ceph-node2</span>
</span></span></code></pre></div><p>åœ¨å…¶ä»–èŠ‚ç‚¹æŸ¥çœ‹ osd çš„ç›®å½•æ ‘</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-node1 ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph osd tree</span>
</span></span><span style=display:flex><span>ID CLASS WEIGHT  TYPE NAME           STATUS REWEIGHT PRI-AFF
</span></span><span style=display:flex><span>-1       0.03897 root default
</span></span><span style=display:flex><span>-3       0.01949     host ceph-node1
</span></span><span style=display:flex><span> <span style=color:#f99b15>0</span>   hdd 0.01949         osd.0           up  1.00000 1.00000
</span></span><span style=display:flex><span>-5       0.01949     host ceph-node2
</span></span><span style=display:flex><span> <span style=color:#f99b15>1</span>   hdd 0.01949         osd.1           up  1.00000 1.00000
</span></span></code></pre></div><p>é…ç½® mgr</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy mgr create ceph-admin</span>
</span></span></code></pre></div><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å’Œé›†ç¾¤ service çŠ¶æ€</p><p>æ­¤æ—¶æ˜¯ HEALTH_WARN çŠ¶æ€ï¼Œæ˜¯ç”±äºå¯ç”¨äº†ä¸å®‰å…¨æ¨¡å¼</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph health</span>
</span></span><span style=display:flex><span>HEALTH_WARN mon is allowing insecure global_id reclaim
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph -s</span>
</span></span><span style=display:flex><span>  cluster:
</span></span><span style=display:flex><span>    id:     fd816347-598c-4ed6-b356-591a618a0bdc
</span></span><span style=display:flex><span>    health: HEALTH_WARN
</span></span><span style=display:flex><span>            mon is allowing insecure global_id reclaim
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  services:
</span></span><span style=display:flex><span>    mon: <span style=color:#f99b15>1</span> daemons, quorum ceph-admin <span style=color:#5bc4bf>(</span>age 3h<span style=color:#5bc4bf>)</span>
</span></span><span style=display:flex><span>    mgr: mon_mgr<span style=color:#5bc4bf>(</span>active, since 17s<span style=color:#5bc4bf>)</span>
</span></span><span style=display:flex><span>    osd: <span style=color:#f99b15>2</span> osds: <span style=color:#f99b15>2</span> up <span style=color:#5bc4bf>(</span>since 3m<span style=color:#5bc4bf>)</span>, <span style=color:#f99b15>2</span> in <span style=color:#5bc4bf>(</span>since 3m<span style=color:#5bc4bf>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  data:
</span></span><span style=display:flex><span>    pools:   <span style=color:#f99b15>0</span> pools, <span style=color:#f99b15>0</span> pgs
</span></span><span style=display:flex><span>    objects: <span style=color:#f99b15>0</span> objects, <span style=color:#f99b15>0</span> B
</span></span><span style=display:flex><span>    usage:   2.0 GiB used, <span style=color:#f99b15>38</span> GiB / <span style=color:#f99b15>40</span> GiB avail
</span></span><span style=display:flex><span>    pgs:
</span></span></code></pre></div><p>ç¦ç”¨ä¸å®‰å…¨æ¨¡å¼</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph config set mon auth_allow_insecure_global_id_reclaim false</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph health</span>
</span></span><span style=display:flex><span>HEALTH_OK
</span></span></code></pre></div><h1 id=5-å¼€å¯-dashboard>5 å¼€å¯ dashboard<a hidden class=anchor aria-hidden=true href=#5-å¼€å¯-dashboard>#</a></h1><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># yum install -y ceph-mgr-dashboard</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph mgr module enable dashboard</span>
</span></span><span style=display:flex><span><span style=color:#776e71># åˆ›å»ºè‡ªç­¾è¯ä¹¦</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard create-self-signed-cert</span>
</span></span><span style=display:flex><span><span style=color:#776e71># åˆ›å»ºå¯†ç æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># echo abc123 &gt; ./dashboard_user_pw</span>
</span></span><span style=display:flex><span><span style=color:#776e71># åˆ›å»ºdashboardçš„ç™»å½•ç”¨æˆ·</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard ac-user-create admin -i ./dashboard_user_pw administrator</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>{</span><span style=color:#48b685>&#34;username&#34;</span>: <span style=color:#48b685>&#34;admin&#34;</span>, <span style=color:#48b685>&#34;lastUpdate&#34;</span>: 1646037503, <span style=color:#48b685>&#34;name&#34;</span>: null, <span style=color:#48b685>&#34;roles&#34;</span>: <span style=color:#5bc4bf>[</span><span style=color:#48b685>&#34;administrator&#34;</span><span style=color:#5bc4bf>]</span>, <span style=color:#48b685>&#34;password&#34;</span>: <span style=color:#48b685>&#34;</span><span style=color:#ef6155>$2</span><span style=color:#48b685>b</span><span style=color:#ef6155>$12$jGsvau8jFMb4pDwLU</span><span style=color:#48b685>/t8KO1sKvmBMcNUYycbXusmgkvTQzlzrMyKi&#34;</span>, <span style=color:#48b685>&#34;email&#34;</span>: null<span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph mgr services</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#48b685>&#34;dashboard&#34;</span>: <span style=color:#48b685>&#34;https://ceph-admin:8443/&#34;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><p>æµ‹è¯•è®¿é—®</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220228164616847.png alt=image-20220228164616847 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220228164616847.png alt=image-20220228164616847></noscript></p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220228164746181.png alt=image-20220228164746181 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220228164746181.png alt=image-20220228164746181></noscript></p><p>ä¸Šå›¾ä¸­æµ‹è¯•ç¯å¢ƒæ˜¯ win10+chromeï¼ŒåŒäº‹ååº” mac+chrome ä¼šå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼ŒåŸå› æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„è‡ªç­¾è¯ä¹¦ï¼Œæµè§ˆå™¨å¹¶ä¸ä¿¡ä»»æ­¤è¯ä¹¦ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è§£å†³</p><ol><li>å…³é—­ dashboard çš„ ssl è®¿é—®</li><li>ä¸‹è½½è¯ä¹¦é…ç½®æµè§ˆå™¨ä¿¡ä»»è¯ä¹¦</li></ol><h2 id=51-å…³é—­-ssl>5.1 å…³é—­ ssl<a hidden class=anchor aria-hidden=true href=#51-å…³é—­-ssl>#</a></h2><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph config set mgr mgr/dashboard/ssl false</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph mgr module disable dashboard</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph mgr module enable dashboard</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph mgr services</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>{</span>
</span></span><span style=display:flex><span>    <span style=color:#48b685>&#34;dashboard&#34;</span>: <span style=color:#48b685>&#34;http://ceph-admin:8080/&#34;</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><p>å¦‚æœå‡ºç° <code>Module 'dashboard' has failed: IOError("Port 8443 not free on '::'",)</code> è¿™ç§æŠ¥é”™ï¼Œéœ€è¦é‡å¯ä¸‹ mgrï¼š<code>systemctl restart ceph-mgr@ceph-admin</code></p><p>æµ‹è¯•è®¿é—®</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220228171237208.png alt=image-20220228171237208 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220228171237208.png alt=image-20220228171237208></noscript></p><h2 id=52-å¼€å¯-rgw>5.2 å¼€å¯ rgw<a hidden class=anchor aria-hidden=true href=#52-å¼€å¯-rgw>#</a></h2><p>é»˜è®¤ object gateway åŠŸèƒ½æ²¡æœ‰å¼€å¯</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302111303281.png alt decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302111303281.png alt></noscript></p><p>åˆ›å»º rgw å®ä¾‹</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ceph-deploy rgw create ceph-admin
</span></span></code></pre></div><p>é»˜è®¤è¿è¡Œç«¯å£æ˜¯ 7480</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302112418486.png alt=image-20220302112418486 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302112418486.png alt=image-20220302112418486></noscript></p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302112515398.png alt=image-20220302112515398 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302112515398.png alt=image-20220302112515398></noscript></p><p>åˆ›å»º rgw ç”¨æˆ·</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># radosgw-admin user create --uid=rgw --display-name=rgw --system</span>
</span></span></code></pre></div><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302111512864.png alt=image-20220302111512864 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302111512864.png alt=image-20220302111512864></noscript></p><p>æä¾› dashboard è¯ä¹¦</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># echo UI2T50HNZUCVVYYZNDHP &gt; rgw_user_access_key</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># echo 11rg0WbXuh2Svexck3vJKs19u1UQINixDWIpN5Dq &gt; rgw_user_secret_key</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard set-rgw-api-access-key -i rgw_user_access_key</span>
</span></span><span style=display:flex><span>Option RGW_API_ACCESS_KEY updated
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard set-rgw-api-secret-key -i rgw_user_secret_key</span>
</span></span><span style=display:flex><span>Option RGW_API_SECRET_KEY updated
</span></span></code></pre></div><p>ç¦ç”¨ ssl</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard set-rgw-api-ssl-verify False</span>
</span></span><span style=display:flex><span>Option RGW_API_SSL_VERIFY updated
</span></span></code></pre></div><p>å¯ç”¨ rgw</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard set-rgw-api-host 192.168.150.101</span>
</span></span><span style=display:flex><span>Option RGW_API_HOST updated
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard set-rgw-api-port 7480</span>
</span></span><span style=display:flex><span>Option RGW_API_PORT updated
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard set-rgw-api-scheme http</span>
</span></span><span style=display:flex><span>Option RGW_API_SCHEME updated
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph dashboard set-rgw-api-user-id rgw</span>
</span></span><span style=display:flex><span>Option RGW_API_USER_ID updated
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin my-ceph<span style=color:#5bc4bf>]</span><span style=color:#776e71># systemctl restart ceph-radosgw.target</span>
</span></span></code></pre></div><p>éªŒè¯</p><p>ç›®å‰ object gateway åŠŸèƒ½å·²æˆåŠŸå¼€å¯</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302112635543.png alt=image-20220302112635543 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302112635543.png alt=image-20220302112635543></noscript></p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302112655052.png alt=image-20220302112655052 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302112655052.png alt=image-20220302112655052></noscript></p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302112707308.png alt=image-20220302112707308 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302112707308.png alt=image-20220302112707308></noscript></p><h1 id=6-å…¶ä»–>6 å…¶ä»–<a hidden class=anchor aria-hidden=true href=#6-å…¶ä»–>#</a></h1><h2 id=61-æ¸…é™¤-ceph-é›†ç¾¤>6.1 æ¸…é™¤ ceph é›†ç¾¤<a hidden class=anchor aria-hidden=true href=#61-æ¸…é™¤-ceph-é›†ç¾¤>#</a></h2><p>æ¸…é™¤å®‰è£…åŒ…</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy purge ceph-admin ceph-node1 ceph-node2</span>
</span></span></code></pre></div><p>æ¸…é™¤é…ç½®ä¿¡æ¯</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy purgedata ceph-admin ceph-node1 ceph-node2</span>
</span></span><span style=display:flex><span><span style=color:#5bc4bf>[</span>root@ceph-admin ~<span style=color:#5bc4bf>]</span><span style=color:#776e71># ceph-deploy forgetkeys</span>
</span></span></code></pre></div><p>æ¯ä¸ªèŠ‚ç‚¹åˆ é™¤æ®‹ç•™çš„é…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm -rf /var/lib/ceph/osd/*
</span></span><span style=display:flex><span>rm -rf /var/lib/ceph/mon/*
</span></span><span style=display:flex><span>rm -rf /var/lib/ceph/mds/*
</span></span><span style=display:flex><span>rm -rf /var/lib/ceph/bootstrap-mds/*
</span></span><span style=display:flex><span>rm -rf /var/lib/ceph/bootstrap-osd/*
</span></span><span style=display:flex><span>rm -rf /var/lib/ceph/bootstrap-mon/*
</span></span><span style=display:flex><span>rm -rf /var/lib/ceph/tmp/*
</span></span><span style=display:flex><span>rm -rf /etc/ceph/*
</span></span><span style=display:flex><span>rm -rf /var/run/ceph/*
</span></span></code></pre></div><p>æ¸…ç†ç£ç›˜è®¾å¤‡ (/dev/mapper/ceph*)</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls /dev/mapper/ceph-* | xargs -I% -- dmsetup remove %
</span></span></code></pre></div><h2 id=62-dashboard-æ— æ³•è®¿é—®çš„é—®é¢˜>6.2 dashboard æ— æ³•è®¿é—®çš„é—®é¢˜<a hidden class=anchor aria-hidden=true href=#62-dashboard-æ— æ³•è®¿é—®çš„é—®é¢˜>#</a></h2><p>åœ¨å…³é—­ dashboard çš„ https åï¼Œå‡ºç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œä½¿ç”¨ chrome æµè§ˆå™¨æ— æ³•è®¿é—® dashboard äº†ï¼Œedge æˆ–è€…ä½¿ç”¨ chrome æ— ç—•æ¨¡å¼å¯ä»¥æ­£å¸¸è®¿é—®ï¼ŒæœŸé—´å°è¯•äº†å„ç§æ–¹æ³•åŒ…æ‹¬é‡æ–°é…ç½® dashboard å’Œæ¸…ç† chrome æµè§ˆå™¨çš„ç¼“å­˜å’Œ cookie ç­‰æ–¹å¼éƒ½æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œç»“æœç¬¬äºŒå¤©èµ·æ¥æ‰“å¼€ç¯å¢ƒä¸€çœ‹è‡ªå·±å¥½äº† ï¼ï¹ï¼œ</p><p>é—®é¢˜æƒ…å†µè§ä¸‹å›¾</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/GIF%202022-3-1%2015-21-48.gif alt="GIF 2022-3-1 15-21-48" decoding=async><noscript><img src=https://image.lvbibir.cn/blog/GIF%202022-3-1%2015-21-48.gif alt="GIF 2022-3-1 15-21-48"></noscript></p><p>æ—¥å¿—æŠ¥é”™ï¼š</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=https://image.lvbibir.cn/blog/image-20220302105649313.png alt=image-20220302105649313 decoding=async><noscript><img src=https://image.lvbibir.cn/blog/image-20220302105649313.png alt=image-20220302105649313></noscript></p><h2 id=63-åŒæ­¥é…ç½®æ–‡ä»¶>6.3 åŒæ­¥é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#63-åŒæ­¥é…ç½®æ–‡ä»¶>#</a></h2><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ceph-deploy --overwrite-conf config push ceph-node<span style=color:#5bc4bf>{</span>1,2,3,4<span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><h2 id=64-æ·»åŠ -mon-èŠ‚ç‚¹å’Œ-mgr-èŠ‚ç‚¹>6.4 æ·»åŠ  mon èŠ‚ç‚¹å’Œ mgr èŠ‚ç‚¹<a hidden class=anchor aria-hidden=true href=#64-æ·»åŠ -mon-èŠ‚ç‚¹å’Œ-mgr-èŠ‚ç‚¹>#</a></h2><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ceph-deploy mon create ceph-node<span style=color:#5bc4bf>{</span>1,2,3,4<span style=color:#5bc4bf>}</span>
</span></span><span style=display:flex><span>ceph-deploy mgr create ceph-node<span style=color:#5bc4bf>{</span>1,2,3,4<span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><p>è®°å¾—ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p><img class=lazyload src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 data-src=http://image.lvbibir.cn/blog/image-20220420102326624.png alt=image-20220420102326624 decoding=async><noscript><img src=http://image.lvbibir.cn/blog/image-20220420102326624.png alt=image-20220420102326624></noscript></p><p>ä¹‹ååŒæ­¥é…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ceph-deploy --overwrite-conf config push ceph-node<span style=color:#5bc4bf>{</span>1,2,3,4<span style=color:#5bc4bf>}</span>
</span></span></code></pre></div><p>ä»¥ä¸Š</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://image.lvbibir.cn/blog/wechatpay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://image.lvbibir.cn/blog/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick="var qr=document.getElementById('QR');qr.style.opacity==='0'?qr.style.opacity='1':qr.style.opacity='0'">
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/posts/tech/cve-1999-0526/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>CVE-1999-0526</span></a>
<a class=next href=https://www.lvbibir.cn/posts/tech/python-change-pip-repo/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>python | ä¿®æ”¹ pip æº</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=https://image.lvbibir.cn/js/twikoo/1.6.44/twikoo.min.js></script><script>twikoo.init({envId:"https://www.lvbibir.cn/twikoo/",el:"#tcomment",lang:'zh-CN',path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><a href=https://gohugo.io/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/frame-hugo-blue.svg></a>
<a href=https://github.com/adityatelange/hugo-PaperMod target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/theme-papermod-lightgrey.svg></a>
<a href=https://cn.aliyun.com/ target=_blank><img style=display:unset src=https://image.lvbibir.cn/blog/å›¾åºŠ-é˜¿é‡Œäº‘-orange.svg></a><br><span id=runtime_span></span>
<script type=text/javascript>function show_runtime(){window.setTimeout("show_runtime()",1e3),X=new Date("7/13/2021 1:00:00"),Y=new Date,T=Y.getTime()-X.getTime(),M=24*60*60*1e3,a=T/M,A=Math.floor(a),b=(a-A)*24,B=Math.floor(b),c=(b-B)*60,C=Math.floor((b-B)*60),D=Math.floor((c-C)*60),runtime_span.innerHTML="ç½‘ç«™å·²è¿è¡Œ"+A+"å¤©"+B+"å°æ—¶"+C+"åˆ†"+D+"ç§’"}show_runtime()</script>|
<script defer src=https://www.lvbibir.cn/busuanzi/js></script>
<span id=busuanzi_container>æ€»è®¿å®¢æ•°: <span id=busuanzi_site_uv></span>
|
æ€»è®¿é—®é‡: <span id=busuanzi_site_pv></span></span><br><a href=https://beian.miit.gov.cn/ target=_blank style="border-bottom:1px solid">äº¬ICPå¤‡2021023168å·-1</a>&nbsp;
|
<span>Copyright
&copy;
2020-2025
<a href=https://www.lvbibir.cn style="border-bottom:1px solid">lvbibir's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener('scroll',function(){const e=document.getElementById("read_progress"),t=document.documentElement.scrollHeight,n=document.documentElement.clientHeight,s=document.documentElement.scrollTop||document.body.scrollTop;e.innerText=((s/(t-n)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(s=>{const n=s.parentNode.parentNode,e=document.createElement('button');e.classList.add('copy-code'),e.innerText='ğŸ“„å¤åˆ¶';function l(){e.innerText='ğŸ‘ŒğŸ»å·²å¤åˆ¶!',setTimeout(()=>{e.innerText='ğŸ“„å¤åˆ¶'},2e3)}e.addEventListener('click',n=>{const e=document.createRange();e.selectNodeContents(s);const t=window.getSelection();t.removeAllRanges(),t.addRange(e);try{document.execCommand('copy'),l()}catch(e){}t.removeRange(e)});let c=s.className.replaceAll("language-",""),t=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");o.innerText=c,t.setAttribute('class','mac-tool'),i.setAttribute('class','mac bb1'),a.setAttribute('class','mac bb2'),r.setAttribute('class','mac bb3'),o.setAttribute('class','language-type'),t.appendChild(i),t.appendChild(a),t.appendChild(r),t.appendChild(o),n.classList.contains("highlight")?(n.appendChild(e),n.appendChild(t)):n.parentNode.firstChild===n||(s.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName==="TABLE"?(s.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e),n.appendChild(t)):(s.parentNode.appendChild(e),n.appendChild(t)))})</script></body></html>