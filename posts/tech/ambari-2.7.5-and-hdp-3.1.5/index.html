<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>部署 Ambari 2.7.5 + HDP3.1.5 | lvbibir's Blog</title><meta name=keywords content="hadoop"><meta name=description content="前期准备 1. 安装包准备 Ambari2.7.5. HDP3.1.5. libtirpc-devel: 链接：https://pan.baidu.com/s/1eteZ2jGkSq4Pz5YFfHyJgQ 提取码：6hq"><meta name=author content="
作者:&nbsp;lvbibir"><link rel=canonical href=https://www.lvbibir.cn/posts/tech/ambari-2.7.5-and-hdp-3.1.5/><link crossorigin=anonymous href=/assets/css/stylesheet.0b9ebc1d7ded60d00101b645d2188c55f5e06bdf122a4966066c63abd78b2d0e.css integrity="sha256-C568HX3tYNABAbZF0hiMVfXga98SKklmBmxjq9eLLQ4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=16x16 href=https://www.lvbibir.cn/img/avatar.gif><link rel=icon type=image/png sizes=32x32 href=https://www.lvbibir.cn/img/avatar.gif><link rel=apple-touch-icon href=https://www.lvbibir.cn/img/avatar.gif><link rel=mask-icon href=https://www.lvbibir.cn/img/avatar.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script src=https://kit.fontawesome.com/2e34783cd8.js crossorigin=anonymous></script><meta property="og:title" content="部署 Ambari 2.7.5 + HDP3.1.5"><meta property="og:description" content="前期准备 1. 安装包准备 Ambari2.7.5. HDP3.1.5. libtirpc-devel: 链接：https://pan.baidu.com/s/1eteZ2jGkSq4Pz5YFfHyJgQ 提取码：6hq"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lvbibir.cn/posts/tech/ambari-2.7.5-and-hdp-3.1.5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="部署 Ambari 2.7.5 + HDP3.1.5"><meta name=twitter:description content="前期准备 1. 安装包准备 Ambari2.7.5. HDP3.1.5. libtirpc-devel: 链接：https://pan.baidu.com/s/1eteZ2jGkSq4Pz5YFfHyJgQ 提取码：6hq"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"📚 文章","item":"https://www.lvbibir.cn/posts/"},{"@type":"ListItem","position":3,"name":"👨🏻‍💻 技术","item":"https://www.lvbibir.cn/posts/tech/"},{"@type":"ListItem","position":4,"name":"部署 Ambari 2.7.5 + HDP3.1.5","item":"https://www.lvbibir.cn/posts/tech/ambari-2.7.5-and-hdp-3.1.5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"部署 Ambari 2.7.5 + HDP3.1.5","name":"部署 Ambari 2.7.5 \u002b HDP3.1.5","description":"前期准备 1. 安装包准备 Ambari2.7.5. HDP3.1.5. libtirpc-devel: 链接：https://pan.baidu.com/s/1eteZ2jGkSq4Pz5YFfHyJgQ 提取码：6hq","keywords":["hadoop"],"articleBody":"前期准备 1. 安装包准备 Ambari2.7.5. HDP3.1.5. libtirpc-devel: 链接：https://pan.baidu.com/s/1eteZ2jGkSq4Pz5YFfHyJgQ 提取码：6hq3\n2.服务器配置 主机名 cpu 内存 硬盘 系统版本 ip地址 node001 4c 10g 50g isoft-serveros-4.2 192.168.150.106 node002 2c 4g 20g isoft-serveros-4.2 192.168.150.107 3.修改系统版本文件（所有节点执行） sed -i 's/4/7/g' /etc/redhat-release sed -i 's/4/7/g' /etc/os-release 4.配置主机名（所有节点执行） 2台服务器的hosts都需要做如下修改\n修改主机名 hostnamectl set-hostname node001 bash 修改hosts文件 vim /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.150.106 node001 192.168.150.107 node002 5.关闭防火墙及selinux（所有节点执行） 2台服务器上分别执行以下操作，关闭防火墙并配置开机不自动启动\nsystemctl stop firewalld systemctl disable firewalld setenforce 0 为了重启后依然关闭，配置如下文件\nvim /etc/sysconfig/selinux 修改 SELINUX=disabled 6.配置ssh互信（所有节点执行） 方法一\n在每台服务器上执行如下操作，一直回车即可\nssh-keygen -t rsa ssh-copy-id -i /root/.ssh/id_rsa.pub node001 ssh-copy-id -i /root/.ssh/id_rsa.pub node002 方法二\n在每台服务器上执行如下操作，一直回车即可\nssh-keygen -t rsa 在服务器1上将公钥（名为id_rsa.pub文件）追加到认证文件（名为authorized_keys文件）中:\ncat ~/.ssh/id_rsa.pub \u003e\u003e ~/.ssh/authorized_keys 去其他服务器节点将~/.ssh/id_rsa.pub中的内容拷贝到服务器1的~/.ssh/authorized_keys中,查看文件中的内容\ncat ~/.ssh/authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/eA09X4s5RIYvuYNxVvtOo6unY1mgipsFyoz/hy/Gwk0onfZvBi/Sl3TVRZO5aqcHccAGlLF7OPTKH1qUuKVtnUOQik0TouL5VKsOBDMHHRT9D5UwqaIE8tYDC8V6uwieFgscZcBjhrsJ/Iramo9ce7N9RTO3otRMRQxOs+Wd1F/ZOmpRtMGU2N4RH4i2quRU6m2lt/eJKpNupSHKoztTQRsEanilHVASnikAXH8JpG70iO7RXR/hLz+/Of3ISUrOMSO4/ZIIu4xnYN3jvsXOdK/qIhP/PI2s+uF22IvVE6xZYVadQFa4zAuhQmCBWkE7vMyI1UJkxP7OQYj72LUH root@node001 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnz8wHoytR2Xlnl04rQq4I2vgUVWbkKjv30pj+Toz4719ah4cY9pvZj0JsfhVzaaCsR14BLFVLkqKUhCWK3K6muT4iHb+N0WirpbwfJkztmQeco7Ha9xrPQ8v/I4xZujFoMVA0tkb/32zRTxOkPv9AUgB8V6Lin6LnB/AcnhnmoIs5PdbAdh/kBGpQGKIZkbyCUOYz9/PZuGJoJBblqfWiqzxYYLN9+cYMkmPnB1HdDewAepIsIC18U3ujE+1Su2UlmISPvvr1zG4XR4ZZoKQsOOJq3XRMGVkDvmFhl03JHZpd6BW0796CeYVZ41UomWXTOduQql+tYWUbegzGLmRZ root@node002 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8AFoGJHp2M45xLYNzXUHLWzRwHsgRPHjeErStq0tEy9bQv4OkN41j0FrxVAYJiGHdHGturriVgUEtL59RjcrJH6bAvhP54nM5YiQlNnWnSUR27Zuaodz4nhYUFq/Co5eDN6lTfL8pgYiEdpBOvE5t1w3bisdblP7YGQ2lF1zzCEGfQ79QbntEbyGNoR9sGHm11x9fOH+fape8TjQJrEAO4d1tAhMqVygQKwqwAPKeqhEum6BaLli83TsXzd7gyz9H7AAc1m04NaLB26xfynW6MVuk1j94awXKlGXjrbNTC/Kg6M8bd5PT/k3DOkx4b+nEs8xZ5x1j4D2OaO1X6rZx root@node003 设置认证文件的权限：\nchmod 600 ~/.ssh/authorized_keys 将~/.ssh/authorized_keys同步到其他节点\nscp ~/.ssh/authorized_keys node002:~/.ssh/authorized_keys 注意：这里第一次使用同步还需要密码，之后就不需要了\n验证免密是否配置成功\nssh到不同服务器\nssh node002 7. 配置ntp时钟同步 选择一台服务器作为NTP Server，这里选择node001\n将如下配置vim /etc/ntp.conf\n# Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). server 0.centos.pool.ntp.org iburst server 1.centos.pool.ntp.org iburst server 2.centos.pool.ntp.org iburst server 3.centos.pool.ntp.org iburst 修改为\n# Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). #server 0.centos.pool.ntp.org iburst #server 1.centos.pool.ntp.org iburst #server 2.centos.pool.ntp.org iburst #server 3.centos.pool.ntp.org iburst server 127.127.1.0 fudge 127.127.1.0 stratum 10 node002节点做如下配置\nvim /etc/ntp.conf 将\n# Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). server 0.centos.pool.ntp.org iburst server 1.centos.pool.ntp.org iburst server 2.centos.pool.ntp.org iburst server 3.centos.pool.ntp.org iburst 修改为\n# Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). #server 0.centos.pool.ntp.org iburst #server 1.centos.pool.ntp.org iburst #server 2.centos.pool.ntp.org iburst #server 3.centos.pool.ntp.org iburst server 192.168.150.106 在每台服务器上启动ntpd服务，并配置服务开机自启动\nsystemctl restart ntpd systemctl enable ntpd 9.设置swap（所有节点执行） echo vm.swappiness = 1 \u003e\u003e /etc/sysctl.conf sysctl vm.swappiness=1 sysctl -p 10. 关闭透明大页面（所有节点执行） 由于透明超大页面已知会导致意外的节点重新启动并导致RAC出现性能问题，因此Oracle强烈建议禁用\necho never \u003e /sys/kernel/mm/transparent_hugepage/defrag echo never \u003e /sys/kernel/mm/transparent_hugepage/enabled 11.安装http服务（node001节点执行） 安装apache的httpd服务主要用于搭建OS. Ambari和hdp的yum源。在集群服务器中选择一台服务器来安装httpd服务，命令如下：\nyum -y install httpd systemctl start httpd systemctl enable httpd.service 验证，在浏览器输入http://192.168.150.106看到如下截图则说明启动成功。\n13.安装Java（所有节点执行） 下载地址：https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html\ntar -zxvf jdk-8u271-linux-x64.tar.gz mkdir /usr/local/java mv jdk1.8.0_271/* /usr/local/java 配置环境变量\nvim /root/.bashrc 添加如下配置\nexport JAVA_HOME=/usr/local/java export PATH=$PATH:$JAVA_HOME/bin export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar export JRE_HOME=$JAVA_HOME/jre 激活配置\nsource /root/.bashrc java -version 14. 安装maven3.6（node001节点执行） 下载解压\ntar -zxvf apache-maven-3.6.3-bin.tar.gz mkdir -p /opt/src/maven mv apache-maven-3.6.3/* /opt/src/maven 配置maven环境变量\nvim /root/.bashrc # set maven home export PATH=$PATH:/opt/src/maven/bin 激活\nsource /root/.bashrc 安装Ambari\u0026HDP 1. 配置Ambari. HDP. libtirpc-devel本地源 解压\ntar -zxvf ambari-2.7.5.0-centos7.tar.gz -C /var/www/html/ tar -zxvf HDP-3.1.5.0-centos7-rpm.tar.gz -C /var/www/html/ tar -zxvf HDP-GPL-3.1.5.0-centos7-gpl.tar.gz -C /var/www/html/ tar -zxvf HDP-UTILS-1.1.0.22-centos7.tar.gz -C /var/www/html/ ll /var/www/html/ 总用量 0 drwxr-xr-x. 3 root root 21 11月 23 22:31 ambari drwxr-xr-x. 3 1001 users 21 12月 18 2019 HDP drwxr-xr-x. 3 1001 users 21 12月 18 2019 HDP-GPL drwxr-xr-x. 3 1001 users 21 8月 13 2018 HDP-UTILS 设置设置用户组和授权\nchown -R root:root /var/www/html/HDP chown -R root:root /var/www/html/HDP-GPL chown -R root:root /var/www/html/HDP-UTILS chmod -R 755 /var/www/html/HDP chmod -R 755 /var/www/html/HDP-GPL chmod -R 755 /var/www/html/HDP-UTILS 创建libtirpc-devel本地源\nmkdir /var/www/html/libtirpc mv /root/libtirpc-* /var/www/html/libtirpc/ cd /var/www/html/libtirpc createrepo . 制作本地源\n配置ambari.repo\nvim /etc/yum.repos.d/ambari.repo [Ambari-2.7.5.0] name=Ambari-2.7.5.0 baseurl=http://192.168.150.106/ambari/centos7/2.7.5.0-72/ gpgcheck=0 enabled=1 priority=1 配置HDP和HDP-TILS\nvim /etc/yum.repos.d/HDP.repo [HDP-3.1.5.0] name=HDP Version - HDP-3.1.5.0 baseurl=http://192.168.150.106/HDP/centos7/3.1.5.0-152/ gpgcheck=0 enabled=1 priority=1 [HDP-UTILS-1.1.0.22] name=HDP-UTILS Version - HDP-UTILS-1.1.0.22 baseurl=http://192.168.150.106/HDP-UTILS/centos7/1.1.0.22/ gpgcheck=0 enabled=1 priority=1 [HDP-GPL-3.1.5.0] name=HDP-GPL Version - HDP-GPL-3.1.5.0 baseurl=http://192.168.150.106/HDP-GPL/centos7/3.1.5.0-152 gpgcheck=0 enabled=1 priority=1 配置libtirpc.repo\nvim /etc/yum.repos.d/libtirpc.repo [libtirpc_repo] name=libtirpc-0.2.4-0.16 baseurl=http://192.168.150.106/libtirpc/ gpgcheck=0 enabled=1 priority=1 拷贝到其他节点\nscp /etc/yum.repos.d/* node002:/etc/yum.repos.d/ 查看源\nyum clean all yum repolist 2. 安装mariadb（node001节点执行） 安装MariaDB服务器\nyum install mariadb-server -y 启动并设置开机启动\nsystemctl enable mariadb systemctl start mariadb 初始化\n/usr/bin/mysql_secure_installation [...] Enter current password for root (enter for none): OK, successfully used password, moving on... [...] Set root password? [Y/n] Y New password:123456 Re-enter new password:123456 [...] Remove anonymous users? [Y/n] Y [...] Disallow root login remotely? [Y/n] N [...] Remove test database and access to it [Y/n] Y [...] Reload privilege tables now? [Y/n] Y [...] All done! If you've completed all of the above steps, your MariaDB 18 installation should now be secure. Thanks for using MariaDB! 为MariaDB安装MySQL JDBC驱动程序\ntar zxf mysql-connector-java-5.1.40.tar.gz mv mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar /usr/share/java/mysql-connector-java.jar 创建需要的数据库\n如果需要ranger，编辑以下⽂件： vim /etc/my.cnf 并添加以下⾏：\nlog_bin_trust_function_creators = 1 重启数据库并登录\nsystemctl restart mariadb mysql -u root -p123456 3. 安装和配置ambari-server（node001节点执行） 安装ambari-server\nyum -y install ambari-server 复制mysql jdbc驱动到/var/lib/ambari-server/resources/\ncp /usr/share/java/mysql-connector-java.jar /var/lib/ambari-server/resources/ 配置/etc/ambari-server/conf/ambari.properties，添加如下行\nvim /etc/ambari-server/conf/ambari.properties server.jdbc.driver.path=/usr/share/java/mysql-connector-java.jar 执行\nambari-server setup --jdbc-db=mysql --jdbc-driver=/usr/share/java/mysql-connector-java.jar 初始化ambari-server\nambari-server setup 1） 提示是否自定义设置。输入：y Customize user account for ambari-server daemon [y/n] (n)? y （2）ambari-server 账号。 Enter user account for ambari-server daemon (root): 如果直接回车就是默认选择root用户 如果输入已经创建的用户就会显示： Enter user account for ambari-server daemon (root):ambari Adjusting ambari-server permissions and ownership... （3）设置JDK。输入：2 Checking JDK... Do you want to change Oracle JDK [y/n] (n)? y [1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8 [2] Custom JDK ============================================================================== Enter choice (1): 2 如果上面选择3自定义JDK,则需要设置JAVA_HOME。输入：/usr/local/java WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts. WARNING: JCE Policy files are required for configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts. Path to JAVA_HOME: /usr/local/java Validating JDK on Ambari Server...done. Completing setup... （4）安装GPL，选择：y Checking GPL software agreement... GPL License for LZO: https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html Enable Ambari Server to download and install GPL Licensed LZO packages [y/n] (n)? y （5）数据库配置。选择：y Configuring database... Enter advanced database configuration [y/n] (n)? y （6）选择数据库类型。输入：3 Configuring database... ============================================================================== Choose one of the following options: [1] - PostgreSQL (Embedded) [2] - Oracle [3] - MySQL/ MariaDB [4] - PostgreSQL [5] - Microsoft SQL Server (Tech Preview) [6] - SQL Anywhere ============================================================================== Enter choice (3): 3 （7）设置数据库的具体配置信息，根据实际情况输入，如果和括号内相同，则可以直接回车。如果想重命名，就输入。 Hostname (localhost):node001 Port (3306): 3306 Database name (ambari): ambari Username (ambari): ambari Enter Database Password (bigdata):ambari123 Re-Enter password: ambari123 （8）将Ambari数据库脚本导入到数据库 WARNING: Before starting Ambari Server, you must run the following DDL against the database to create the schema: /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql 这个sql后面会用到，导入数据库 Proceed with configuring remote database connection properties [y/n] (y)? y 登录mariadb创建ambari安装所需要的库\n设置的账号后面配置ambari-server的时候会用到\nmysql -uroot -p123456 CREATE DATABASE ambari; use ambari; CREATE USER 'ambari'@'%' IDENTIFIED BY 'ambari123'; GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'%'; CREATE USER 'ambari'@'localhost' IDENTIFIED BY 'ambari123'; GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'localhost'; CREATE USER 'ambari'@'node001' IDENTIFIED BY 'ambari123'; GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'node001'; source /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql show tables; use mysql; select host,user from user where user='ambari'; CREATE DATABASE hive; use hive; CREATE USER 'hive'@'%' IDENTIFIED BY 'hive'; GRANT ALL PRIVILEGES ON *.* TO 'hive'@'%'; CREATE USER 'hive'@'localhost' IDENTIFIED BY 'hive'; GRANT ALL PRIVILEGES ON *.* TO 'hive'@'localhost'; CREATE USER 'hive'@'node001' IDENTIFIED BY 'hive'; GRANT ALL PRIVILEGES ON *.* TO 'hive'@'node001'; CREATE DATABASE oozie; use oozie; CREATE USER 'oozie'@'%' IDENTIFIED BY 'oozie'; GRANT ALL PRIVILEGES ON *.* TO 'oozie'@'%'; CREATE USER 'oozie'@'localhost' IDENTIFIED BY 'oozie'; GRANT ALL PRIVILEGES ON *.* TO 'oozie'@'localhost'; CREATE USER 'oozie'@'node001' IDENTIFIED BY 'oozie'; GRANT ALL PRIVILEGES ON *.* TO 'oozie'@'node001'; FLUSH PRIVILEGES; 4. 安装ambari-agent（所有节点执行） pssh -h /node.list -i 'yum -y install ambari-agent' pssh -h /node.list -i 'systemctl start ambari-agent' 5. 安装libtirpc-devel（所有节点） pssh -h /node.list -i 'yum -y install libtirpc-devel' 6. 启动ambari服务 ambari-server start 部署集群 1. 登录界面 http://192.168.150.106:8080\n默认管理员账户登录， 账户：admin 密码：admin\n2. 选择版本，配置yum源 1）选择Launch Install Wizard 2）配置集群名称 3）选择版本并修改本地源地址\n选HDP-3.1(Default Version Definition); 选Use Local Repository; 选redhat7:\nHDP-3.1：http://node001/HDP/centos7/3.1.5.0-152/ HDP-3.1-GPL: http://node001/HDP-GPL/centos7/3.1.5.0-152/ HDP-UTILS-1.1.0.22: http://node001/HDP-UTILS/centos7/1.1.0.22/\n3. 配置节点和密钥 下载主节点的/root/.ssh/id_rsa，并上传！点击下一步，进入确认主机界面\n也可直接cat /root/.ssh/id_rsa 粘贴即可\n验证通过\n4. 勾选需要安装的服务 由于资源有限，这里并没有选择所有服务\n5. 分配服务master 6. 分配服务slaves 设置相关服务的密码 Grafana Admin: 123456 Hive Database: hive Activity Explorer’s Admin: admin\n7. 连接数据库 8. 编辑配置，默认即可 9. 开始部署 10. 安装成功 右上角两个警告是磁盘使用率警告，虚机分配的磁盘较小\n其他 1. 添加其他系统支持 HDP默认不支持安装到 isoft-serverosv4.2，需手动添加支持\nvim /usr/lib/ambari-server/lib/ambari_commons/resources/os_family.json 添加如下两行，注意缩进和逗号\n2. YARN Registry DNS 服务启动失败 lsof -i:53 kill -9 3. 设置初始检测的系统版本 vim /etc/ambari-server/conf/ambari.properties server.os_family=redhat7 server.os_type=redhat7 参考 https://blog.csdn.net/qq_36048223/article/details/116113987\n","wordCount":"3173","inLanguage":"en","datePublished":"2021-12-01T00:00:00Z","dateModified":"2021-12-01T00:00:00Z","author":[{"@type":"Person","name":"lvbibir"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lvbibir.cn/posts/tech/ambari-2.7.5-and-hdp-3.1.5/"},"publisher":{"@type":"Organization","name":"lvbibir's Blog","logo":{"@type":"ImageObject","url":"https://www.lvbibir.cn/img/avatar.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.lvbibir.cn accesskey=h title="lvbibir's Blog (Alt + H)"><img src=https://www.lvbibir.cn/img/avatar.gif alt aria-label=logo height=35>lvbibir's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.lvbibir.cn/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://www.lvbibir.cn/ title="🏡 主页"><span>🏡 主页</span></a></li><li><a href=https://www.lvbibir.cn/posts title="📚 文章"><span>📚 文章</span></a></li><li><a href=https://www.lvbibir.cn/tags title="🏷️ 标签"><span>🏷️ 标签</span></a></li><li><a href=https://www.lvbibir.cn/archives title="📈 时间轴"><span>📈 时间轴</span></a></li><li><a href=https://www.lvbibir.cn/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://www.lvbibir.cn/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://www.lvbibir.cn>主页</a>&nbsp;»&nbsp;<a href=https://www.lvbibir.cn/posts/>📚 文章</a>&nbsp;»&nbsp;<a href=https://www.lvbibir.cn/posts/tech/>👨🏻‍💻 技术</a></div><h1 class=post-title>部署 Ambari 2.7.5 + HDP3.1.5</h1><div class=post-meta>创建:&nbsp;<span title='2021-12-01 00:00:00 +0000 UTC'>2021-12-01</span>&nbsp;|&nbsp;更新:&nbsp;2021-12-01&nbsp;|&nbsp;字数:&nbsp;3173字&nbsp;|&nbsp;时长:&nbsp;7分钟&nbsp;|&nbsp;
作者:&nbsp;lvbibir
&nbsp;|&nbsp;标签: &nbsp;<ul class=post-tags-meta><a href=https://www.lvbibir.cn/tags/hadoop/>hadoop</a></ul><span id=busuanzi_container_page_pv>&nbsp;| 访问: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>文章目录</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e6%9c%9f%e5%87%86%e5%a4%87 aria-label=前期准备>前期准备</a><ul><li><a href=#1-%e5%ae%89%e8%a3%85%e5%8c%85%e5%87%86%e5%a4%87 aria-label="1. 安装包准备">1. 安装包准备</a></li><li><a href=#2%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%85%8d%e7%bd%ae aria-label=2.服务器配置>2.服务器配置</a></li><li><a href=#3%e4%bf%ae%e6%94%b9%e7%b3%bb%e7%bb%9f%e7%89%88%e6%9c%ac%e6%96%87%e4%bb%b6%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label=3.修改系统版本文件（所有节点执行）>3.修改系统版本文件（所有节点执行）</a></li><li><a href=#4%e9%85%8d%e7%bd%ae%e4%b8%bb%e6%9c%ba%e5%90%8d%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label=4.配置主机名（所有节点执行）>4.配置主机名（所有节点执行）</a></li><li><a href=#5%e5%85%b3%e9%97%ad%e9%98%b2%e7%81%ab%e5%a2%99%e5%8f%8aselinux%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label=5.关闭防火墙及selinux（所有节点执行）>5.关闭防火墙及selinux（所有节点执行）</a></li><li><a href=#6%e9%85%8d%e7%bd%aessh%e4%ba%92%e4%bf%a1%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label=6.配置ssh互信（所有节点执行）>6.配置ssh互信（所有节点执行）</a></li><li><a href=#7-%e9%85%8d%e7%bd%aentp%e6%97%b6%e9%92%9f%e5%90%8c%e6%ad%a5 aria-label="7. 配置ntp时钟同步">7. 配置ntp时钟同步</a></li><li><a href=#9%e8%ae%be%e7%bd%aeswap%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label=9.设置swap（所有节点执行）>9.设置swap（所有节点执行）</a></li><li><a href=#10-%e5%85%b3%e9%97%ad%e9%80%8f%e6%98%8e%e5%a4%a7%e9%a1%b5%e9%9d%a2%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label="10. 关闭透明大页面（所有节点执行）">10. 关闭透明大页面（所有节点执行）</a></li><li><a href=#11%e5%ae%89%e8%a3%85http%e6%9c%8d%e5%8a%a1node001%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label=11.安装http服务（node001节点执行）>11.安装http服务（node001节点执行）</a></li><li><a href=#13%e5%ae%89%e8%a3%85java%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label=13.安装Java（所有节点执行）>13.安装Java（所有节点执行）</a></li><li><a href=#14-%e5%ae%89%e8%a3%85maven36node001%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label="14. 安装maven3.6（node001节点执行）">14. 安装maven3.6（node001节点执行）</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85ambarihdp aria-label=安装Ambari&amp;amp;HDP>安装Ambari&HDP</a><ul><li><a href=#1-%e9%85%8d%e7%bd%aeambari-hdp-libtirpc-devel%e6%9c%ac%e5%9c%b0%e6%ba%90 aria-label="1. 配置Ambari. HDP. libtirpc-devel本地源">1. 配置Ambari. HDP. libtirpc-devel本地源</a></li><li><a href=#2-%e5%ae%89%e8%a3%85mariadbnode001%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label="2. 安装mariadb（node001节点执行）">2. 安装mariadb（node001节点执行）</a></li><li><a href=#3-%e5%ae%89%e8%a3%85%e5%92%8c%e9%85%8d%e7%bd%aeambari-servernode001%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label="3. 安装和配置ambari-server（node001节点执行）">3. 安装和配置ambari-server（node001节点执行）</a></li><li><a href=#4-%e5%ae%89%e8%a3%85ambari-agent%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c aria-label="4. 安装ambari-agent（所有节点执行）">4. 安装ambari-agent（所有节点执行）</a></li><li><a href=#5-%e5%ae%89%e8%a3%85libtirpc-devel%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9 aria-label="5. 安装libtirpc-devel（所有节点）">5. 安装libtirpc-devel（所有节点）</a></li><li><a href=#6-%e5%90%af%e5%8a%a8ambari%e6%9c%8d%e5%8a%a1 aria-label="6. 启动ambari服务">6. 启动ambari服务</a></li></ul></li><li><a href=#%e9%83%a8%e7%bd%b2%e9%9b%86%e7%be%a4 aria-label=部署集群>部署集群</a><ul><li><a href=#1-%e7%99%bb%e5%bd%95%e7%95%8c%e9%9d%a2 aria-label="1. 登录界面">1. 登录界面</a></li><li><a href=#2-%e9%80%89%e6%8b%a9%e7%89%88%e6%9c%ac%e9%85%8d%e7%bd%aeyum%e6%ba%90 aria-label="2. 选择版本，配置yum源">2. 选择版本，配置yum源</a></li><li><a href=#3-%e9%85%8d%e7%bd%ae%e8%8a%82%e7%82%b9%e5%92%8c%e5%af%86%e9%92%a5 aria-label="3. 配置节点和密钥">3. 配置节点和密钥</a></li><li><a href=#4-%e5%8b%be%e9%80%89%e9%9c%80%e8%a6%81%e5%ae%89%e8%a3%85%e7%9a%84%e6%9c%8d%e5%8a%a1 aria-label="4. 勾选需要安装的服务">4. 勾选需要安装的服务</a></li><li><a href=#5-%e5%88%86%e9%85%8d%e6%9c%8d%e5%8a%a1master aria-label="5. 分配服务master">5. 分配服务master</a></li><li><a href=#6-%e5%88%86%e9%85%8d%e6%9c%8d%e5%8a%a1slaves aria-label="6. 分配服务slaves">6. 分配服务slaves</a></li><li><a href=#7-%e8%bf%9e%e6%8e%a5%e6%95%b0%e6%8d%ae%e5%ba%93 aria-label="7. 连接数据库">7. 连接数据库</a></li><li><a href=#8-%e7%bc%96%e8%be%91%e9%85%8d%e7%bd%ae%e9%bb%98%e8%ae%a4%e5%8d%b3%e5%8f%af aria-label="8. 编辑配置，默认即可">8. 编辑配置，默认即可</a></li><li><a href=#9--%e5%bc%80%e5%a7%8b%e9%83%a8%e7%bd%b2 aria-label="9.  开始部署">9. 开始部署</a></li><li><a href=#10-%e5%ae%89%e8%a3%85%e6%88%90%e5%8a%9f aria-label="10. 安装成功">10. 安装成功</a></li></ul></li><li><a href=#%e5%85%b6%e4%bb%96 aria-label=其他>其他</a><ul><li><a href=#1-%e6%b7%bb%e5%8a%a0%e5%85%b6%e4%bb%96%e7%b3%bb%e7%bb%9f%e6%94%af%e6%8c%81 aria-label="1. 添加其他系统支持">1. 添加其他系统支持</a></li><li><a href=#2-yarn-registry-dns-%e6%9c%8d%e5%8a%a1%e5%90%af%e5%8a%a8%e5%a4%b1%e8%b4%a5 aria-label="2. YARN Registry DNS 服务启动失败">2. YARN Registry DNS 服务启动失败</a></li><li><a href=#3-%e8%ae%be%e7%bd%ae%e5%88%9d%e5%a7%8b%e6%a3%80%e6%b5%8b%e7%9a%84%e7%b3%bb%e7%bb%9f%e7%89%88%e6%9c%ac aria-label="3. 设置初始检测的系统版本">3. 设置初始检测的系统版本</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=前期准备>前期准备<a hidden class=anchor aria-hidden=true href=#前期准备>#</a></h1><h2 id=1-安装包准备>1. 安装包准备<a hidden class=anchor aria-hidden=true href=#1-安装包准备>#</a></h2><p><strong>Ambari2.7.5. HDP3.1.5. libtirpc-devel:</strong>
链接：https://pan.baidu.com/s/1eteZ2jGkSq4Pz5YFfHyJgQ
提取码：6hq3</p><h2 id=2服务器配置>2.服务器配置<a hidden class=anchor aria-hidden=true href=#2服务器配置>#</a></h2><table><thead><tr><th>主机名</th><th>cpu</th><th>内存</th><th>硬盘</th><th>系统版本</th><th>ip地址</th></tr></thead><tbody><tr><td>node001</td><td>4c</td><td>10g</td><td>50g</td><td>isoft-serveros-4.2</td><td>192.168.150.106</td></tr><tr><td>node002</td><td>2c</td><td>4g</td><td>20g</td><td>isoft-serveros-4.2</td><td>192.168.150.107</td></tr></tbody></table><h2 id=3修改系统版本文件所有节点执行>3.修改系统版本文件（所有节点执行）<a hidden class=anchor aria-hidden=true href=#3修改系统版本文件所有节点执行>#</a></h2><pre tabindex=0><code>sed -i &#39;s/4/7/g&#39; /etc/redhat-release
sed -i &#39;s/4/7/g&#39; /etc/os-release
</code></pre><h2 id=4配置主机名所有节点执行>4.配置主机名（所有节点执行）<a hidden class=anchor aria-hidden=true href=#4配置主机名所有节点执行>#</a></h2><p><strong>2台服务器的hosts都需要做如下修改</strong></p><ul><li>修改主机名</li></ul><pre tabindex=0><code>hostnamectl set-hostname node001
bash
</code></pre><ul><li>修改hosts文件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/hosts
</span></span><span style=display:flex><span>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
</span></span><span style=display:flex><span>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</span></span><span style=display:flex><span>192.168.150.106 node001
</span></span><span style=display:flex><span>192.168.150.107 node002
</span></span></code></pre></div><h2 id=5关闭防火墙及selinux所有节点执行>5.关闭防火墙及selinux（所有节点执行）<a hidden class=anchor aria-hidden=true href=#5关闭防火墙及selinux所有节点执行>#</a></h2><p><strong>2台服务器上分别执行以下操作，关闭防火墙并配置开机不自动启动</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl stop firewalld
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span><span style=display:flex><span>setenforce <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>为了重启后依然关闭，配置如下文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/sysconfig/selinux
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>修改
</span></span><span style=display:flex><span>SELINUX<span style=color:#f92672>=</span>disabled
</span></span></code></pre></div><h2 id=6配置ssh互信所有节点执行>6.配置ssh互信（所有节点执行）<a hidden class=anchor aria-hidden=true href=#6配置ssh互信所有节点执行>#</a></h2><p><strong>方法一</strong></p><p>在每台服务器上执行如下操作，一直回车即可</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa
</span></span><span style=display:flex><span>ssh-copy-id -i /root/.ssh/id_rsa.pub node001
</span></span><span style=display:flex><span>ssh-copy-id -i /root/.ssh/id_rsa.pub node002
</span></span></code></pre></div><p><strong>方法二</strong></p><p>在每台服务器上执行如下操作，一直回车即可</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa
</span></span></code></pre></div><p>在服务器1上将公钥（名为id_rsa.pub文件）追加到认证文件（名为authorized_keys文件）中:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys 
</span></span></code></pre></div><p>去其他服务器节点将<code>~/.ssh/id_rsa.pub</code>中的内容拷贝到服务器1的<code>~/.ssh/authorized_keys</code>中,查看文件中的内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat ~/.ssh/authorized_keys
</span></span><span style=display:flex><span>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/eA09X4s5RIYvuYNxVvtOo6unY1mgipsFyoz/hy/Gwk0onfZvBi/Sl3TVRZO5aqcHccAGlLF7OPTKH1qUuKVtnUOQik0TouL5VKsOBDMHHRT9D5UwqaIE8tYDC8V6uwieFgscZcBjhrsJ/Iramo9ce7N9RTO3otRMRQxOs+Wd1F/ZOmpRtMGU2N4RH4i2quRU6m2lt/eJKpNupSHKoztTQRsEanilHVASnikAXH8JpG70iO7RXR/hLz+/Of3ISUrOMSO4/ZIIu4xnYN3jvsXOdK/qIhP/PI2s+uF22IvVE6xZYVadQFa4zAuhQmCBWkE7vMyI1UJkxP7OQYj72LUH root@node001
</span></span><span style=display:flex><span>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnz8wHoytR2Xlnl04rQq4I2vgUVWbkKjv30pj+Toz4719ah4cY9pvZj0JsfhVzaaCsR14BLFVLkqKUhCWK3K6muT4iHb+N0WirpbwfJkztmQeco7Ha9xrPQ8v/I4xZujFoMVA0tkb/32zRTxOkPv9AUgB8V6Lin6LnB/AcnhnmoIs5PdbAdh/kBGpQGKIZkbyCUOYz9/PZuGJoJBblqfWiqzxYYLN9+cYMkmPnB1HdDewAepIsIC18U3ujE+1Su2UlmISPvvr1zG4XR4ZZoKQsOOJq3XRMGVkDvmFhl03JHZpd6BW0796CeYVZ41UomWXTOduQql+tYWUbegzGLmRZ root@node002
</span></span><span style=display:flex><span>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8AFoGJHp2M45xLYNzXUHLWzRwHsgRPHjeErStq0tEy9bQv4OkN41j0FrxVAYJiGHdHGturriVgUEtL59RjcrJH6bAvhP54nM5YiQlNnWnSUR27Zuaodz4nhYUFq/Co5eDN6lTfL8pgYiEdpBOvE5t1w3bisdblP7YGQ2lF1zzCEGfQ79QbntEbyGNoR9sGHm11x9fOH+fape8TjQJrEAO4d1tAhMqVygQKwqwAPKeqhEum6BaLli83TsXzd7gyz9H7AAc1m04NaLB26xfynW6MVuk1j94awXKlGXjrbNTC/Kg6M8bd5PT/k3DOkx4b+nEs8xZ5x1j4D2OaO1X6rZx root@node003
</span></span></code></pre></div><p>设置认证文件的权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> ~/.ssh/authorized_keys
</span></span></code></pre></div><p>将<code>~/.ssh/authorized_keys</code>同步到其他节点</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp ~/.ssh/authorized_keys node002:~/.ssh/authorized_keys
</span></span></code></pre></div><blockquote><p>注意：这里第一次使用同步还需要密码，之后就不需要了</p></blockquote><p>验证免密是否配置成功</p><p>ssh到不同服务器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh node002
</span></span></code></pre></div><h2 id=7-配置ntp时钟同步>7. 配置ntp时钟同步<a hidden class=anchor aria-hidden=true href=#7-配置ntp时钟同步>#</a></h2><p>选择一台服务器作为NTP Server，这里选择node001</p><p>将如下配置<code>vim /etc/ntp.conf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Use public servers from the pool.ntp.org project.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span>
</span></span><span style=display:flex><span>server 0.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 1.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 2.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 3.centos.pool.ntp.org iburst
</span></span></code></pre></div><p>修改为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Use public servers from the pool.ntp.org project.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 0.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 1.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 2.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 3.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span>server 127.127.1.0 
</span></span><span style=display:flex><span>fudge 127.127.1.0 stratum <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p>node002节点做如下配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/ntp.conf
</span></span></code></pre></div><p>将</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Use public servers from the pool.ntp.org project.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span>
</span></span><span style=display:flex><span>server 0.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 1.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 2.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 3.centos.pool.ntp.org iburst
</span></span></code></pre></div><p>修改为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Use public servers from the pool.ntp.org project.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 0.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 1.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 2.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#server 3.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span>server 192.168.150.106
</span></span></code></pre></div><p>在每台服务器上启动ntpd服务，并配置服务开机自启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart ntpd
</span></span><span style=display:flex><span>systemctl enable ntpd
</span></span></code></pre></div><h2 id=9设置swap所有节点执行>9.设置swap（所有节点执行）<a hidden class=anchor aria-hidden=true href=#9设置swap所有节点执行>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo vm.swappiness <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> &gt;&gt; /etc/sysctl.conf
</span></span><span style=display:flex><span>sysctl vm.swappiness<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>sysctl -p
</span></span></code></pre></div><h2 id=10-关闭透明大页面所有节点执行>10. 关闭透明大页面（所有节点执行）<a hidden class=anchor aria-hidden=true href=#10-关闭透明大页面所有节点执行>#</a></h2><p>由于透明超大页面已知会导致意外的节点重新启动并导致RAC出现性能问题，因此Oracle强烈建议禁用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
</span></span><span style=display:flex><span>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</span></span></code></pre></div><h2 id=11安装http服务node001节点执行>11.安装http服务（node001节点执行）<a hidden class=anchor aria-hidden=true href=#11安装http服务node001节点执行>#</a></h2><p>安装apache的httpd服务主要用于搭建OS. Ambari和hdp的yum源。在集群服务器中选择一台服务器来安装httpd服务，命令如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum -y install httpd
</span></span><span style=display:flex><span>systemctl start httpd
</span></span><span style=display:flex><span>systemctl enable httpd.service
</span></span></code></pre></div><p>验证，在浏览器输入http://192.168.150.106看到如下截图则说明启动成功。</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123141149628.png alt=image-20211123141149628></p><h2 id=13安装java所有节点执行>13.安装Java（所有节点执行）<a hidden class=anchor aria-hidden=true href=#13安装java所有节点执行>#</a></h2><p>下载地址：https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar -zxvf jdk-8u271-linux-x64.tar.gz 
</span></span><span style=display:flex><span>mkdir /usr/local/java
</span></span><span style=display:flex><span>mv jdk1.8.0_271/* /usr/local/java
</span></span></code></pre></div><p>配置环境变量</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /root/.bashrc
</span></span></code></pre></div><p>添加如下配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export JAVA_HOME<span style=color:#f92672>=</span>/usr/local/java
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$PATH:$JAVA_HOME/bin
</span></span><span style=display:flex><span>export CLASSPATH<span style=color:#f92672>=</span>.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
</span></span><span style=display:flex><span>export JRE_HOME<span style=color:#f92672>=</span>$JAVA_HOME/jre
</span></span></code></pre></div><p>激活配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source /root/.bashrc
</span></span><span style=display:flex><span>java -version
</span></span></code></pre></div><h2 id=14-安装maven36node001节点执行>14. 安装maven3.6（node001节点执行）<a hidden class=anchor aria-hidden=true href=#14-安装maven36node001节点执行>#</a></h2><p>下载解压</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tar -zxvf apache-maven-3.6.3-bin.tar.gz
</span></span><span style=display:flex><span>mkdir -p /opt/src/maven
</span></span><span style=display:flex><span>mv apache-maven-3.6.3/* /opt/src/maven
</span></span></code></pre></div><p>配置maven环境变量</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /root/.bashrc
</span></span><span style=display:flex><span><span style=color:#75715e># set maven home</span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$PATH:/opt/src/maven/bin
</span></span></code></pre></div><p>激活</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source /root/.bashrc
</span></span></code></pre></div><h1 id=安装ambarihdp>安装Ambari&HDP<a hidden class=anchor aria-hidden=true href=#安装ambarihdp>#</a></h1><h2 id=1-配置ambari-hdp-libtirpc-devel本地源>1. 配置Ambari. HDP. libtirpc-devel本地源<a hidden class=anchor aria-hidden=true href=#1-配置ambari-hdp-libtirpc-devel本地源>#</a></h2><p>解压</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar -zxvf  ambari-2.7.5.0-centos7.tar.gz -C /var/www/html/
</span></span><span style=display:flex><span>tar -zxvf  HDP-3.1.5.0-centos7-rpm.tar.gz -C /var/www/html/
</span></span><span style=display:flex><span>tar -zxvf  HDP-GPL-3.1.5.0-centos7-gpl.tar.gz -C /var/www/html/
</span></span><span style=display:flex><span>tar -zxvf  HDP-UTILS-1.1.0.22-centos7.tar.gz -C /var/www/html/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ll /var/www/html/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>总用量 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> root root  <span style=color:#ae81ff>21</span> 11月 <span style=color:#ae81ff>23</span> 22:31 ambari
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>1001</span> users <span style=color:#ae81ff>21</span> 12月 <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>2019</span> HDP
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>1001</span> users <span style=color:#ae81ff>21</span> 12月 <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>2019</span> HDP-GPL
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>1001</span> users <span style=color:#ae81ff>21</span> 8月  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>2018</span> HDP-UTILS
</span></span></code></pre></div><p>设置设置用户组和授权</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chown -R root:root /var/www/html/HDP
</span></span><span style=display:flex><span>chown -R root:root /var/www/html/HDP-GPL
</span></span><span style=display:flex><span>chown -R root:root /var/www/html/HDP-UTILS
</span></span><span style=display:flex><span>chmod -R <span style=color:#ae81ff>755</span> /var/www/html/HDP
</span></span><span style=display:flex><span>chmod -R <span style=color:#ae81ff>755</span> /var/www/html/HDP-GPL
</span></span><span style=display:flex><span>chmod -R <span style=color:#ae81ff>755</span> /var/www/html/HDP-UTILS
</span></span></code></pre></div><p>创建libtirpc-devel本地源</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /var/www/html/libtirpc
</span></span><span style=display:flex><span>mv /root/libtirpc-* /var/www/html/libtirpc/
</span></span><span style=display:flex><span>cd /var/www/html/libtirpc
</span></span><span style=display:flex><span>createrepo .
</span></span></code></pre></div><p>制作本地源</p><p>配置ambari.repo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/yum.repos.d/ambari.repo
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Ambari-2.7.5.0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>name<span style=color:#f92672>=</span>Ambari-2.7.5.0
</span></span><span style=display:flex><span>baseurl<span style=color:#f92672>=</span>http://192.168.150.106/ambari/centos7/2.7.5.0-72/
</span></span><span style=display:flex><span>gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>priority<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>配置HDP和HDP-TILS</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/yum.repos.d/HDP.repo
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>HDP-3.1.5.0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>name<span style=color:#f92672>=</span>HDP Version - HDP-3.1.5.0
</span></span><span style=display:flex><span>baseurl<span style=color:#f92672>=</span>http://192.168.150.106/HDP/centos7/3.1.5.0-152/
</span></span><span style=display:flex><span>gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>priority<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>HDP-UTILS-1.1.0.22<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>name<span style=color:#f92672>=</span>HDP-UTILS Version - HDP-UTILS-1.1.0.22
</span></span><span style=display:flex><span>baseurl<span style=color:#f92672>=</span>http://192.168.150.106/HDP-UTILS/centos7/1.1.0.22/
</span></span><span style=display:flex><span>gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>priority<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>HDP-GPL-3.1.5.0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>name<span style=color:#f92672>=</span>HDP-GPL Version - HDP-GPL-3.1.5.0
</span></span><span style=display:flex><span>baseurl<span style=color:#f92672>=</span>http://192.168.150.106/HDP-GPL/centos7/3.1.5.0-152
</span></span><span style=display:flex><span>gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>priority<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>配置libtirpc.repo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/yum.repos.d/libtirpc.repo
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>libtirpc_repo<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>name<span style=color:#f92672>=</span>libtirpc-0.2.4-0.16
</span></span><span style=display:flex><span>baseurl<span style=color:#f92672>=</span>http://192.168.150.106/libtirpc/
</span></span><span style=display:flex><span>gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>priority<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>拷贝到其他节点</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp /etc/yum.repos.d/* node002:/etc/yum.repos.d/
</span></span></code></pre></div><p>查看源</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum clean all
</span></span><span style=display:flex><span>yum repolist
</span></span></code></pre></div><h2 id=2-安装mariadbnode001节点执行>2. 安装mariadb（node001节点执行）<a hidden class=anchor aria-hidden=true href=#2-安装mariadbnode001节点执行>#</a></h2><p>安装MariaDB服务器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install mariadb-server -y
</span></span></code></pre></div><p>启动并设置开机启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl enable mariadb
</span></span><span style=display:flex><span>systemctl start mariadb
</span></span></code></pre></div><p>初始化</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/usr/bin/mysql_secure_installation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Enter current password <span style=color:#66d9ef>for</span> root <span style=color:#f92672>(</span>enter <span style=color:#66d9ef>for</span> none<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>OK, successfully used password, moving on...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Set root password? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y
</span></span><span style=display:flex><span>New password:123456
</span></span><span style=display:flex><span>Re-enter new password:123456
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> 
</span></span><span style=display:flex><span>Remove anonymous users? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> 
</span></span><span style=display:flex><span>Disallow root login remotely? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> N 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> 
</span></span><span style=display:flex><span>Remove test database and access to it <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> 
</span></span><span style=display:flex><span>Reload privilege tables now? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> 
</span></span><span style=display:flex><span>All <span style=color:#66d9ef>done</span>! If you<span style=color:#960050;background-color:#1e0010>&#39;</span>ve completed all of the above steps, your MariaDB <span style=color:#ae81ff>18</span> installation should now be secure. 
</span></span><span style=display:flex><span>Thanks <span style=color:#66d9ef>for</span> using MariaDB!
</span></span></code></pre></div><p>为MariaDB安装MySQL JDBC驱动程序</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar zxf mysql-connector-java-5.1.40.tar.gz
</span></span><span style=display:flex><span>mv mysql-connector-java-5.1.40/mysql-connector-java-5.1.40-bin.jar /usr/share/java/mysql-connector-java.jar
</span></span></code></pre></div><p>创建需要的数据库</p><p>如果需要ranger，编辑以下⽂件： vim /etc/my.cnf 并添加以下⾏：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>log_bin_trust_function_creators <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>重启数据库并登录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart mariadb
</span></span><span style=display:flex><span>mysql -u root -p123456
</span></span></code></pre></div><h2 id=3-安装和配置ambari-servernode001节点执行>3. 安装和配置ambari-server（node001节点执行）<a hidden class=anchor aria-hidden=true href=#3-安装和配置ambari-servernode001节点执行>#</a></h2><p>安装ambari-server</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum -y install ambari-server
</span></span></code></pre></div><p>复制mysql jdbc驱动到/var/lib/ambari-server/resources/</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp /usr/share/java/mysql-connector-java.jar /var/lib/ambari-server/resources/
</span></span></code></pre></div><p>配置/etc/ambari-server/conf/ambari.properties，添加如下行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/ambari-server/conf/ambari.properties
</span></span><span style=display:flex><span>server.jdbc.driver.path<span style=color:#f92672>=</span>/usr/share/java/mysql-connector-java.jar
</span></span></code></pre></div><p>执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ambari-server setup --jdbc-db<span style=color:#f92672>=</span>mysql --jdbc-driver<span style=color:#f92672>=</span>/usr/share/java/mysql-connector-java.jar
</span></span></code></pre></div><p>初始化ambari-server</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ambari-server setup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1） 提示是否自定义设置。输入：y
</span></span><span style=display:flex><span>Customize user account <span style=color:#66d9ef>for</span> ambari-server daemon <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>n<span style=color:#f92672>)</span>? y
</span></span><span style=display:flex><span>（2）ambari-server 账号。
</span></span><span style=display:flex><span>Enter user account <span style=color:#66d9ef>for</span> ambari-server daemon <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>如果直接回车就是默认选择root用户
</span></span><span style=display:flex><span>如果输入已经创建的用户就会显示：
</span></span><span style=display:flex><span>Enter user account <span style=color:#66d9ef>for</span> ambari-server daemon <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>:ambari
</span></span><span style=display:flex><span>Adjusting ambari-server permissions and ownership...
</span></span><span style=display:flex><span>（3）设置JDK。输入：2
</span></span><span style=display:flex><span>Checking JDK...
</span></span><span style=display:flex><span>Do you want to change Oracle JDK <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>n<span style=color:#f92672>)</span>? y
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> Oracle JDK 1.8 + Java Cryptography Extension <span style=color:#f92672>(</span>JCE<span style=color:#f92672>)</span> Policy Files <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2<span style=color:#f92672>]</span> Custom JDK
</span></span><span style=display:flex><span><span style=color:#f92672>==============================================================================</span>
</span></span><span style=display:flex><span>Enter choice <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>如果上面选择3自定义JDK,则需要设置JAVA_HOME。输入：/usr/local/java
</span></span><span style=display:flex><span>WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.
</span></span><span style=display:flex><span>WARNING: JCE Policy files are required <span style=color:#66d9ef>for</span> configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.
</span></span><span style=display:flex><span>Path to JAVA_HOME: /usr/local/java
</span></span><span style=display:flex><span>Validating JDK on Ambari Server...done.
</span></span><span style=display:flex><span>Completing setup...
</span></span><span style=display:flex><span>（4）安装GPL，选择：y
</span></span><span style=display:flex><span>Checking GPL software agreement...
</span></span><span style=display:flex><span>GPL License <span style=color:#66d9ef>for</span> LZO: https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html
</span></span><span style=display:flex><span>Enable Ambari Server to download and install GPL Licensed LZO packages <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>n<span style=color:#f92672>)</span>? y
</span></span><span style=display:flex><span>（5）数据库配置。选择：y
</span></span><span style=display:flex><span>Configuring database...
</span></span><span style=display:flex><span>Enter advanced database configuration <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>n<span style=color:#f92672>)</span>? y
</span></span><span style=display:flex><span>（6）选择数据库类型。输入：3
</span></span><span style=display:flex><span>Configuring database...
</span></span><span style=display:flex><span><span style=color:#f92672>==============================================================================</span>
</span></span><span style=display:flex><span>Choose one of the following options:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> - PostgreSQL <span style=color:#f92672>(</span>Embedded<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2<span style=color:#f92672>]</span> - Oracle
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>3<span style=color:#f92672>]</span> - MySQL/ MariaDB
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>4<span style=color:#f92672>]</span> - PostgreSQL
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>5<span style=color:#f92672>]</span> - Microsoft SQL Server <span style=color:#f92672>(</span>Tech Preview<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>6<span style=color:#f92672>]</span> - SQL Anywhere
</span></span><span style=display:flex><span><span style=color:#f92672>==============================================================================</span>
</span></span><span style=display:flex><span>Enter choice <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>（7）设置数据库的具体配置信息，根据实际情况输入，如果和括号内相同，则可以直接回车。如果想重命名，就输入。
</span></span><span style=display:flex><span>Hostname <span style=color:#f92672>(</span>localhost<span style=color:#f92672>)</span>:node001
</span></span><span style=display:flex><span>Port <span style=color:#f92672>(</span>3306<span style=color:#f92672>)</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>Database name <span style=color:#f92672>(</span>ambari<span style=color:#f92672>)</span>: ambari
</span></span><span style=display:flex><span>Username <span style=color:#f92672>(</span>ambari<span style=color:#f92672>)</span>: ambari
</span></span><span style=display:flex><span>Enter Database Password <span style=color:#f92672>(</span>bigdata<span style=color:#f92672>)</span>:ambari123
</span></span><span style=display:flex><span>Re-Enter password: ambari123
</span></span><span style=display:flex><span>（8）将Ambari数据库脚本导入到数据库
</span></span><span style=display:flex><span>WARNING: Before starting Ambari Server, you must run the following DDL against the database to create the schema: /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql 这个sql后面会用到，导入数据库
</span></span><span style=display:flex><span>Proceed with configuring remote database connection properties <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>y<span style=color:#f92672>)</span>? y
</span></span></code></pre></div><p>登录mariadb创建ambari安装所需要的库</p><p>设置的账号后面配置ambari-server的时候会用到</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mysql -uroot -p123456
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CREATE DATABASE ambari; 
</span></span><span style=display:flex><span>use ambari; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;ambari&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;ambari123&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;ambari&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span>; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;ambari&#39;</span>@<span style=color:#e6db74>&#39;localhost&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;ambari123&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;ambari&#39;</span>@<span style=color:#e6db74>&#39;localhost&#39;</span>; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;ambari&#39;</span>@<span style=color:#e6db74>&#39;node001&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;ambari123&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;ambari&#39;</span>@<span style=color:#e6db74>&#39;node001&#39;</span>; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>source /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql 
</span></span><span style=display:flex><span>show tables; 
</span></span><span style=display:flex><span>use mysql; 
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> host,user from user where user<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ambari&#39;</span>; 
</span></span><span style=display:flex><span>CREATE DATABASE hive; 
</span></span><span style=display:flex><span>use hive; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;hive&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;hive&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;hive&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span>; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;hive&#39;</span>@<span style=color:#e6db74>&#39;localhost&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;hive&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;hive&#39;</span>@<span style=color:#e6db74>&#39;localhost&#39;</span>; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;hive&#39;</span>@<span style=color:#e6db74>&#39;node001&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;hive&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;hive&#39;</span>@<span style=color:#e6db74>&#39;node001&#39;</span>; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CREATE DATABASE oozie; 
</span></span><span style=display:flex><span>use oozie; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;oozie&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;oozie&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;oozie&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span>; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;oozie&#39;</span>@<span style=color:#e6db74>&#39;localhost&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;oozie&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;oozie&#39;</span>@<span style=color:#e6db74>&#39;localhost&#39;</span>; 
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;oozie&#39;</span>@<span style=color:#e6db74>&#39;node001&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;oozie&#39;</span>; 
</span></span><span style=display:flex><span>GRANT ALL PRIVILEGES ON *.* TO <span style=color:#e6db74>&#39;oozie&#39;</span>@<span style=color:#e6db74>&#39;node001&#39;</span>; 
</span></span><span style=display:flex><span>FLUSH PRIVILEGES;
</span></span></code></pre></div><h2 id=4-安装ambari-agent所有节点执行>4. 安装ambari-agent（所有节点执行）<a hidden class=anchor aria-hidden=true href=#4-安装ambari-agent所有节点执行>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pssh -h /node.list -i <span style=color:#e6db74>&#39;yum -y install ambari-agent&#39;</span>
</span></span><span style=display:flex><span>pssh -h /node.list -i <span style=color:#e6db74>&#39;systemctl start ambari-agent&#39;</span>
</span></span></code></pre></div><h2 id=5-安装libtirpc-devel所有节点>5. 安装libtirpc-devel（所有节点）<a hidden class=anchor aria-hidden=true href=#5-安装libtirpc-devel所有节点>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pssh -h /node.list -i <span style=color:#e6db74>&#39;yum -y install libtirpc-devel&#39;</span>
</span></span></code></pre></div><h2 id=6-启动ambari服务>6. 启动ambari服务<a hidden class=anchor aria-hidden=true href=#6-启动ambari服务>#</a></h2><pre tabindex=0><code>ambari-server start
</code></pre><h1 id=部署集群>部署集群<a hidden class=anchor aria-hidden=true href=#部署集群>#</a></h1><h2 id=1-登录界面>1. 登录界面<a hidden class=anchor aria-hidden=true href=#1-登录界面>#</a></h2><p>http://192.168.150.106:8080</p><p>默认管理员账户登录， 账户：admin 密码：admin</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123145726406.png alt=image-20211123145726406></p><h2 id=2-选择版本配置yum源>2. 选择版本，配置yum源<a hidden class=anchor aria-hidden=true href=#2-选择版本配置yum源>#</a></h2><p>1）选择Launch Install Wizard
2）配置集群名称
3）选择版本并修改本地源地址</p><p>选HDP-3.1(Default Version Definition);
选Use Local Repository;
选redhat7:</p><p>HDP-3.1：http://node001/HDP/centos7/3.1.5.0-152/
HDP-3.1-GPL: http://node001/HDP-GPL/centos7/3.1.5.0-152/
HDP-UTILS-1.1.0.22: http://node001/HDP-UTILS/centos7/1.1.0.22/</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123150120718.png alt=image-20211123150120718></p><h2 id=3-配置节点和密钥>3. 配置节点和密钥<a hidden class=anchor aria-hidden=true href=#3-配置节点和密钥>#</a></h2><p>下载主节点的/root/.ssh/id_rsa，并上传！点击下一步，进入确认主机界面</p><p>也可直接cat /root/.ssh/id_rsa 粘贴即可</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123150255012.png alt=image-20211123150255012></p><p>验证通过</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123150337730.png alt=image-20211123150337730></p><h2 id=4-勾选需要安装的服务>4. 勾选需要安装的服务<a hidden class=anchor aria-hidden=true href=#4-勾选需要安装的服务>#</a></h2><p>由于资源有限，这里并没有选择所有服务</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123151238695.png alt=image-20211123151238695></p><h2 id=5-分配服务master>5. 分配服务master<a hidden class=anchor aria-hidden=true href=#5-分配服务master>#</a></h2><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123151312856.png alt=image-20211123151312856></p><h2 id=6-分配服务slaves>6. 分配服务slaves<a hidden class=anchor aria-hidden=true href=#6-分配服务slaves>#</a></h2><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123151134172.png alt=image-20211123151134172></p><p>设置相关服务的密码
Grafana Admin: 123456
Hive Database: hive
Activity Explorer’s Admin: admin</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123151427030.png alt=image-20211123151427030></p><h2 id=7-连接数据库>7. 连接数据库<a hidden class=anchor aria-hidden=true href=#7-连接数据库>#</a></h2><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123151525068.png alt=image-20211123151525068></p><h2 id=8-编辑配置默认即可>8. 编辑配置，默认即可<a hidden class=anchor aria-hidden=true href=#8-编辑配置默认即可>#</a></h2><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123151547943.png alt=image-20211123151547943></p><h2 id=9--开始部署>9. 开始部署<a hidden class=anchor aria-hidden=true href=#9--开始部署>#</a></h2><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123151705941.png alt=image-20211123151705941></p><h2 id=10-安装成功>10. 安装成功<a hidden class=anchor aria-hidden=true href=#10-安装成功>#</a></h2><p>右上角两个警告是磁盘使用率警告，虚机分配的磁盘较小</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123163439475.png alt=image-20211123163439475></p><h1 id=其他>其他<a hidden class=anchor aria-hidden=true href=#其他>#</a></h1><h2 id=1-添加其他系统支持>1. 添加其他系统支持<a hidden class=anchor aria-hidden=true href=#1-添加其他系统支持>#</a></h2><p>HDP默认不支持安装到 isoft-serverosv4.2，需手动添加支持</p><pre tabindex=0><code>vim /usr/lib/ambari-server/lib/ambari_commons/resources/os_family.json
</code></pre><p>添加如下两行，注意缩进和逗号</p><p><img loading=lazy src=https://image.lvbibir.cn/blog/image-20211123145525458.png alt=image-20211123145525458></p><h2 id=2-yarn-registry-dns-服务启动失败>2. YARN Registry DNS 服务启动失败<a hidden class=anchor aria-hidden=true href=#2-yarn-registry-dns-服务启动失败>#</a></h2><pre tabindex=0><code>lsof -i:53
kill -9
</code></pre><h2 id=3-设置初始检测的系统版本>3. 设置初始检测的系统版本<a hidden class=anchor aria-hidden=true href=#3-设置初始检测的系统版本>#</a></h2><pre tabindex=0><code>vim /etc/ambari-server/conf/ambari.properties
server.os_family=redhat7
server.os_type=redhat7
</code></pre><h1 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h1><p><a href=https://blog.csdn.net/qq_36048223/article/details/116113987 target=_blank rel=noopener style=color:#42b983 ;>https://blog.csdn.net/qq_36048223/article/details/116113987</a></p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://www.lvbibir.cn/img/wechat_pay.png alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://www.lvbibir.cn/img/alipay.png alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>🧧 鼓励</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.lvbibir.cn/posts/tech/change-file-in-rpm-pkg/><span class=title>« 上一页</span><br><span>通过反编译修改rpm包内的文件</span></a>
<a class=next href=https://www.lvbibir.cn/posts/tech/openstack-kolla-ansible-allinone-train/><span class=title>下一页 »</span><br><span>kolla-ansible部署Train版openstack（all-in-one）</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>💬评论</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo.lvbibir.cn/",el:"#tcomment",lang:"zh-CN",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><a href=https://gohugo.io/ target=_blank><img style=display:unset src="https://img.shields.io/badge/frame-hugo-blue?style=flat&logo=hugo"></a>
<a href=https://github.com/adityatelange/hugo-PaperMod target=_blank><img style=display:unset src="https://img.shields.io/badge/theme-papermod-lightgrey?style=flat&logo=BookStack"></a>
<a href=https://cn.aliyun.com/ target=_blank><img style=display:unset src="https://img.shields.io/badge/图床-阿里云-orange?style=flat&logo=alibabacloud"></a></a><br><span id=runtime_span></span>
<script type=text/javascript>function show_runtime(){window.setTimeout("show_runtime()",1e3),X=new Date("7/13/2021 1:00:00"),Y=new Date,T=Y.getTime()-X.getTime(),M=24*60*60*1e3,a=T/M,A=Math.floor(a),b=(a-A)*24,B=Math.floor(b),c=(b-B)*60,C=Math.floor((b-B)*60),D=Math.floor((c-C)*60),runtime_span.innerHTML="网站已运行"+A+"天"+B+"小时"+C+"分"+D+"秒"}show_runtime()</script>|
<span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>总访客数: <i class="fa fa-user"></i><span id=busuanzi_value_site_uv></span>
|
总访问量: <i class="fa fa-eye"></i><span id=busuanzi_value_site_pv></span></span><br><a href=https://beian.miit.gov.cn/ target=_blank style="border-bottom:1px solid">京ICP备2021023168号-1</a>&nbsp;
|
<span>Copyright
&copy;
2020-2022
<a href=https://www.lvbibir.cn style="border-bottom:1px solid">lvbibir's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="📄复制";function s(){t.innerText="👌🏻已复制!",setTimeout(()=>{t.innerText="📄复制"},2e3)}t.addEventListener("click",t=>{const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>